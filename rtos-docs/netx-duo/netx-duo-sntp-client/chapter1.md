---
title: Capítulo 1 - Introdução ao Azure RTOS NetX Duo SNTP
description: O Azure RTOS NetX Simple Network Time Protocol (SNTP) é um protocolo concebido para sincronizar relógios através da Internet.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: b3e1170197c6c4981060459104da80e354fac5db
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104825753"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-sntp"></a><span data-ttu-id="8e14f-103">Capítulo 1 - Introdução ao Azure RTOS NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="8e14f-103">Chapter 1 - Introduction to Azure RTOS NetX Duo SNTP</span></span> 

<span data-ttu-id="8e14f-104">O Azure RTOS NetX Simple Network Time Protocol (SNTP) é um protocolo concebido para sincronizar relógios através da Internet.</span><span class="sxs-lookup"><span data-stu-id="8e14f-104">The Azure RTOS NetX Simple Network Time Protocol (SNTP) is a protocol designed for synchronizing clocks over the Internet.</span></span> <span data-ttu-id="8e14f-105">A Versão 4 da SNTP é um protocolo simplificado baseado no Protocolo de Tempo de Rede (NTP).</span><span class="sxs-lookup"><span data-stu-id="8e14f-105">SNTP Version 4 is a simplified protocol based on the Network Time Protocol (NTP).</span></span> <span data-ttu-id="8e14f-106">Utiliza os serviços do Protocolo de Datagram do Utilizador (UDP) para executar atualizações de tempo num protocolo simples e apátrida.</span><span class="sxs-lookup"><span data-stu-id="8e14f-106">It utilizes User Datagram Protocol (UDP) services to perform time updates in a simple, stateless protocol.</span></span> <span data-ttu-id="8e14f-107">Embora não seja tão complexo como o NTP, o SNTP é altamente fiável e preciso.</span><span class="sxs-lookup"><span data-stu-id="8e14f-107">Though not as complex as NTP, SNTP is highly reliable and accurate.</span></span> <span data-ttu-id="8e14f-108">Na maioria dos locais da Internet de hoje, a SNTP fornece precisões de 1-50 milissegundos, dependendo das características da fonte de sincronização e dos caminhos de rede.</span><span class="sxs-lookup"><span data-stu-id="8e14f-108">In most places of the Internet of today, SNTP provides accuracies of 1-50 milliseconds, depending on the characteristics of the synchronization source and network paths.</span></span> <span data-ttu-id="8e14f-109">A SNTP tem muitas opções para fornecer fiabilidade de receber atualizações de tempo.</span><span class="sxs-lookup"><span data-stu-id="8e14f-109">SNTP has many options to provide reliability of receiving time updates.</span></span> <span data-ttu-id="8e14f-110">A capacidade de mudar para servidores alternativos, aplicar algoritmos de votação de volta e a descoberta automática de servidores de tempo são apenas alguns dos meios para um cliente SNTP lidar com um ambiente de serviço de tempo de Internet variável.</span><span class="sxs-lookup"><span data-stu-id="8e14f-110">Ability to switch to alternative servers, applying back off polling algorithms and automatic time server discovery are just a few of the means for an SNTP client to handle a variable Internet time service environment.</span></span> <span data-ttu-id="8e14f-111">O que lhe falta em precisão compensa na simplicidade e facilidade de implementação.</span><span class="sxs-lookup"><span data-stu-id="8e14f-111">What it lacks in precision it makes up for in simplicity and ease of implementation.</span></span> <span data-ttu-id="8e14f-112">A SNTP destina-se principalmente a fornecer mecanismos abrangentes para aceder aos serviços nacionais de divulgação de tempo e frequência (por exemplo, servidor NTP).</span><span class="sxs-lookup"><span data-stu-id="8e14f-112">SNTP is intended primarily for providing comprehensive mechanisms to access national time and frequency dissemination (e.g. NTP server) services.</span></span>

## <a name="netx-duo-sntp-client-requirements"></a><span data-ttu-id="8e14f-113">Requisitos do cliente NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="8e14f-113">NetX Duo SNTP Client Requirements</span></span>

<span data-ttu-id="8e14f-114">O Cliente SNTP Da Dupla NetX exige que já tenha sido criada uma instância IP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-114">The NetX Duo SNTP Client requires that an IP instance has already been created.</span></span> <span data-ttu-id="8e14f-115">Além disso, a UDP deve ser ativada nesse mesmo caso IP e deve ter acesso à conhecida porta 123 para o envio *de* dados de tempo para um SNTP Server, embora as portas alternativas também funcionem.</span><span class="sxs-lookup"><span data-stu-id="8e14f-115">In addition, UDP must be enabled on that same IP instance and should have access to the *well-known* port 123 for sending time data to an SNTP Server, although alternative ports will work as well.</span></span> <span data-ttu-id="8e14f-116">Os clientes de radiodifusão devem ligar a porta UDP que o seu servidor de transmissão está a enviar, normalmente 123.</span><span class="sxs-lookup"><span data-stu-id="8e14f-116">Broadcast clients should bind the UDP port their broadcast server is sending on, usually 123.</span></span> <span data-ttu-id="8e14f-117">A aplicação do Cliente NetX Duo SNTP deve ter um ou mais endereços IP SNTP Server.</span><span class="sxs-lookup"><span data-stu-id="8e14f-117">The NetX Duo SNTP Client application must have one or more IP SNTP Server addresses.</span></span>

## <a name="netx-duo-sntp-client-limitations"></a><span data-ttu-id="8e14f-118">Limitações do cliente NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="8e14f-118">NetX Duo SNTP Client Limitations</span></span> 

<span data-ttu-id="8e14f-119">A precisão na representação do tempo local nas atualizações de tempo NTP tratadas pela API do Cliente SNTP limita-se à resolução milissegundo.</span><span class="sxs-lookup"><span data-stu-id="8e14f-119">Precision in local time representation in NTP time updates handled by the SNTP Client API is limited to millisecond resolution.</span></span>

<span data-ttu-id="8e14f-120">O Cliente SNTP só tem um único endereço SNTP Server a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="8e14f-120">The SNTP Client only holds a single SNTP Server address at any time.</span></span> <span data-ttu-id="8e14f-121">Se esse Servidor parecer já não ser válido, a aplicação deve parar a tarefa do Cliente SNTP e reinitilizá-la com outro endereço de servidor SNTP, utilizando a comunicação SNTP transmitida ou unicast.</span><span class="sxs-lookup"><span data-stu-id="8e14f-121">If that Server appears to be no longer valid, the application must stop the SNTP Client task, and reinitialize it with another SNTP server address, using either broadcast or unicast SNTP communication.</span></span>

<span data-ttu-id="8e14f-122">O Cliente SNTP não suporta muitos elencos.</span><span class="sxs-lookup"><span data-stu-id="8e14f-122">The SNTP Client does not support manycast.</span></span>

<span data-ttu-id="8e14f-123">O Cliente NetX Duo SNTP não suporta mecanismos de autenticação para verificar os dados dos pacotes recebidos.</span><span class="sxs-lookup"><span data-stu-id="8e14f-123">NetX Duo SNTP Client does not support authentication mechanisms for verifying received packet data.</span></span>

## <a name="netx-duo-sntp-client-operation"></a><span data-ttu-id="8e14f-124">Operação cliente SNTP duo NetX</span><span class="sxs-lookup"><span data-stu-id="8e14f-124">NetX Duo SNTP Client Operation</span></span>

<span data-ttu-id="8e14f-125">O RFC 4330 recomenda que os clientes SNTP operem apenas no estrato mais alto da sua rede local e de preferência em configurações em que nenhum cliente NTP ou SNTP os dependa para sincronização.</span><span class="sxs-lookup"><span data-stu-id="8e14f-125">RFC 4330 recommends that SNTP clients should operate only at the highest stratum of their local network and preferably in configurations where no NTP or SNTP client is dependent them for synchronization.</span></span> <span data-ttu-id="8e14f-126">O nível de estrato reflete a posição de anfitrião na hierarquia do tempo NTP, onde o estrato 1 é o nível mais alto (um servidor de tempo de raiz) e 15 é o nível mais baixo permitido (por exemplo, Cliente).</span><span class="sxs-lookup"><span data-stu-id="8e14f-126">Stratum level reflects the host position in the NTP time hierarchy where stratum 1 is the highest level (a root time server) and 15 is the lowest allowed level (e.g. Client).</span></span> <span data-ttu-id="8e14f-127">O estrato mínimo do Cliente SNTP é 2.</span><span class="sxs-lookup"><span data-stu-id="8e14f-127">The SNTP Client default minimum stratum is 2.</span></span>

<span data-ttu-id="8e14f-128">O Cliente SNTP NetX Duo pode operar num dos dois modos básicos, unicast ou transmitido, para obter tempo através da Internet.</span><span class="sxs-lookup"><span data-stu-id="8e14f-128">The NetX Duo SNTP Client can operate in one of two basic modes, unicast or broadcast, to obtain time over the Internet.</span></span> <span data-ttu-id="8e14f-129">No modo unicast, o Cliente sonda o seu Servidor SNTP em intervalos regulares e espera receber uma resposta desse Servidor.</span><span class="sxs-lookup"><span data-stu-id="8e14f-129">In unicast mode, the Client polls its SNTP Server on regular intervals and waits to receive a reply from that Server.</span></span> <span data-ttu-id="8e14f-130">Quando um é recebido, o Cliente verifica que a resposta contém uma atualização de tempo válida aplicando um conjunto de 'verificações de sanidade' recomendadas pelo RFC 4330.</span><span class="sxs-lookup"><span data-stu-id="8e14f-130">When one is received, the Client verifies that the reply contains a valid time update by applying a set of ‘sanity checks’ recommended by RFC 4330.</span></span> <span data-ttu-id="8e14f-131">O Cliente aplica então a diferença horária, se houver, com o relógio do Servidor ao relógio local.</span><span class="sxs-lookup"><span data-stu-id="8e14f-131">The Client then applies the time difference, if any, with the Server clock to its local clock.</span></span> <span data-ttu-id="8e14f-132">No modo de transmissão, o Cliente apenas ouve as transmissões de atualização de tempo e mantém o seu relógio local depois de aplicar um conjunto semelhante de verificações de sanidade para verificar os dados de tempo de atualização.</span><span class="sxs-lookup"><span data-stu-id="8e14f-132">In broadcast mode, the Client merely listens for time update broadcasts and maintains its local clock after applying a similar set of sanity checks to verify the update time data.</span></span> <span data-ttu-id="8e14f-133">Os controlos de sanidade são descritos em pormenor na secção **SNTP Sanity Checks** abaixo.</span><span class="sxs-lookup"><span data-stu-id="8e14f-133">Sanity checks are described in detail in the **SNTP Sanity Checks** section below.</span></span>

<span data-ttu-id="8e14f-134">Antes de o Cliente poder funcionar em ambos os modos, deve estabelecer os seus parâmetros de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="8e14f-134">Before the Client can run in either mode, it must establish its operating parameters.</span></span> <span data-ttu-id="8e14f-135">Isto é feito chamando *nx_sntp_client_initialize_unicast* ou *nx_sntp_client_initialize_broadcast* para modos unicast ou de transmissão, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="8e14f-135">This is done by calling either *nx_sntp_client_initialize_unicast* or *nx_sntp_client_initialize_broadcast* for unicast or broadcast modes, respectively.</span></span> <span data-ttu-id="8e14f-136">Estes servem definir os intervalos de tempo para o lapso de tempo máximo sem uma atualização válida, o limite de atualizações inválidas consecutivas recebidas, um intervalo de votação para o modo unicast, modo de funcionamento, por exemplo, unicast vs. transmissão, e SNTP Server.</span><span class="sxs-lookup"><span data-stu-id="8e14f-136">These serves set the time outs for maximum time lapse without a valid update, the limit on consecutive invalid updates received, a polling interval for unicast mode, operation mode e.g. unicast vs. broadcast, and SNTP Server.</span></span>

<span data-ttu-id="8e14f-137">Se o lapso de tempo máximo ou as atualizações inválidas máximas recebidas forem ultrapassadas, o Cliente SNTP continua a funcionar, mas define o estado atual do SNTP Server para inválido.</span><span class="sxs-lookup"><span data-stu-id="8e14f-137">If the maximum time lapse or maximum invalid updates received is exceeded, the SNTP Client continues to run but sets the current SNTP Server status to invalid.</span></span> <span data-ttu-id="8e14f-138">A aplicação pode sondar o Cliente SNTP usando o serviço *nx_sntp_client_receiving_updates* para verificar se o SNTP Server ainda está a enviar atualizações válidas.</span><span class="sxs-lookup"><span data-stu-id="8e14f-138">The application can poll the SNTP Client using the *nx_sntp_client_receiving_updates* service to verify the SNTP Server is still sending valid updates.</span></span> <span data-ttu-id="8e14f-139">Caso contrário, deverá parar a linha do Cliente SNTP utilizando o serviço *nx_sntp_client_stop* e ligar para qualquer um dos dois serviços de inicialização para definir outro endereço SNTP Server.</span><span class="sxs-lookup"><span data-stu-id="8e14f-139">If not, it should stop the SNTP Client thread using the *nx_sntp_client_stop* service and call either of the two initialize services to set another SNTP Server address.</span></span> <span data-ttu-id="8e14f-140">Para reiniciar o Cliente SNTP, a aplicação chama *nx_sntp_client_run_broadcast* ou *nx_sntp_client_run_unicast*.</span><span class="sxs-lookup"><span data-stu-id="8e14f-140">To restart the SNTP Client, the application calls *nx_sntp_client_run_broadcast* or *nx_sntp_client_run_unicast*.</span></span> <span data-ttu-id="8e14f-141">Note que a aplicação pode alterar o modo de funcionamento do Cliente SNTP na chamada inicial para mudar para unicast ou transmitir conforme desejado.</span><span class="sxs-lookup"><span data-stu-id="8e14f-141">Note that the application can change SNTP Client operating mode in the initialize call to switch to unicast or broadcast as desired.</span></span>

### <a name="local-clock-operation"></a><span data-ttu-id="8e14f-142">Operação Local do Relógio</span><span class="sxs-lookup"><span data-stu-id="8e14f-142">Local Clock Operation</span></span>

<span data-ttu-id="8e14f-143">O tempo SNTP baseado no número de segundos no relógio master NTP, ou número de segundos decorridos na primeira época NTP, por exemplo, de 1 de janeiro **1900 00:00:00 a** jan **1 1999 00:00:00**.</span><span class="sxs-lookup"><span data-stu-id="8e14f-143">The SNTP time based on the number of seconds on the master NTP clock, or number of seconds elapsed in the first NTP epoch e.g. from Jan 1 **1900 00:00:00 to** Jan 1 **1999 00:00:00**.</span></span> <span data-ttu-id="8e14f-144">O significado de 01-01-1999 foi quando ocorreu o último salto segundo.</span><span class="sxs-lookup"><span data-stu-id="8e14f-144">The significance of 01-01-1999 was when the last leap second occurred.</span></span> <span data-ttu-id="8e14f-145">Este valor é definido da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="8e14f-145">This value is defined as follows:</span></span>

<span data-ttu-id="8e14f-146">\#definir NTP_SECONDS_AT_01011999 0xBA368E80</span><span class="sxs-lookup"><span data-stu-id="8e14f-146">\#define NTP_SECONDS_AT_01011999 0xBA368E80</span></span>

<span data-ttu-id="8e14f-147">Antes do Cliente SNTP ser executado, a aplicação pode opcionalmente inicializar o Cliente SNTP local para que o Cliente utilize como um tempo de base.</span><span class="sxs-lookup"><span data-stu-id="8e14f-147">Before the SNTP Client runs, the application can optionally initialize the SNTP Client local time for the Client to use as a baseline time.</span></span> <span data-ttu-id="8e14f-148">Para tal, deve utilizar o *serviço nx_sntp_client_set_local_time.*</span><span class="sxs-lookup"><span data-stu-id="8e14f-148">To do so, it must use the *nx_sntp_client_set_local_time* service.</span></span> <span data-ttu-id="8e14f-149">Isto leva o tempo em formato NTP, segundos e fração, onde a fração é o milissegundo no tempo condensado NTP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-149">This takes the time in NTP format, seconds and fraction, where fraction is the milliseconds in the NTP condensed time.</span></span> <span data-ttu-id="8e14f-150">Idealmente, a aplicação pode obter um tempo SNTP a partir de uma fonte independente.</span><span class="sxs-lookup"><span data-stu-id="8e14f-150">Ideally the application can obtain an SNTP time from an independent source.</span></span> <span data-ttu-id="8e14f-151">Não existe API para conversão de ano, mês, data e hora para uma hora NTP no NetX Duo SNTP Client.</span><span class="sxs-lookup"><span data-stu-id="8e14f-151">There is no API for converting year, month, date and time to an NTP time in the NetX Duo SNTP Client.</span></span> <span data-ttu-id="8e14f-152">Para uma descrição do formato de tempo NTP, consulte a *versão 4 do RFC4330 "Simple Network Time Protocol (SNTP) para IPv4, IPv6 e OSI".*</span><span class="sxs-lookup"><span data-stu-id="8e14f-152">For a description of NTP time format, refer to *RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI”.*</span></span>

<span data-ttu-id="8e14f-153">Se não for fornecida nenhuma hora local base quando o Cliente SNTP começar, o Cliente SNTP aceitará as atualizações SNTP sem comparar com a sua hora local na primeira atualização.</span><span class="sxs-lookup"><span data-stu-id="8e14f-153">If no base local time is supplied when the SNTP Client starts up, the SNTP Client will accept the SNTP updates without comparing to its local time on the first update.</span></span> <span data-ttu-id="8e14f-154">A partir daí, aplicará os valores máximos e mínimos de atualização do tempo para determinar se irá modificar a sua hora local.</span><span class="sxs-lookup"><span data-stu-id="8e14f-154">Thereafter it will apply the maximum and minimum time update values to determine if it will modify its local time.</span></span>

<span data-ttu-id="8e14f-155">Para obter o Cliente SNTP a tempo local, a aplicação pode utilizar o serviço *nx_sntp_client_get_local_time_extended.*</span><span class="sxs-lookup"><span data-stu-id="8e14f-155">To obtain the SNTP Client local time, the application can use the *nx_sntp_client_get_local_time_extended* service.</span></span>

### <a name="sntp-sanity-checks"></a><span data-ttu-id="8e14f-156">Verificações de Sanidade SNTP</span><span class="sxs-lookup"><span data-stu-id="8e14f-156">SNTP Sanity Checks</span></span> 

<span data-ttu-id="8e14f-157">O Cliente examina o pacote de entrada para os seguintes critérios:</span><span class="sxs-lookup"><span data-stu-id="8e14f-157">The Client examines the incoming packet for the following criteria:</span></span>

  - <span data-ttu-id="8e14f-158">O endereço IP de origem deve corresponder ao endereço IP do servidor atual.</span><span class="sxs-lookup"><span data-stu-id="8e14f-158">Source IP address must match the current server IP address.</span></span>

  - <span data-ttu-id="8e14f-159">A porta de origem do remetente deve coincidir com a porta de origem do servidor atual.</span><span class="sxs-lookup"><span data-stu-id="8e14f-159">Sender source port must match with the current server source port.</span></span>

  - <span data-ttu-id="8e14f-160">O comprimento do pacote deve ser o comprimento mínimo para segurar uma mensagem de tempo SNTP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-160">Packet length must be the minimum length to hold an SNTP time message.</span></span>

<span data-ttu-id="8e14f-161">Em seguida, os dados de tempo são extraídos do tampão do pacote ao qual o Cliente aplica um conjunto de "verificações de sanidade" específicas:</span><span class="sxs-lookup"><span data-stu-id="8e14f-161">Next, the time data is extracted from the packet buffer to which the Client then applies a set of specific ‘sanity checks’:</span></span>

  - <span data-ttu-id="8e14f-162">O indicador de salto definido para 3 indica que o Servidor não está sincronizado.</span><span class="sxs-lookup"><span data-stu-id="8e14f-162">The Leap Indicator set to 3 indicates the Server is not synchronized.</span></span> <span data-ttu-id="8e14f-163">O Cliente deve tentar encontrar um servidor alternativo.</span><span class="sxs-lookup"><span data-stu-id="8e14f-163">The Client should attempt to find an alternative server.</span></span>

  - <span data-ttu-id="8e14f-164">Um campo de estrato definido para zero é conhecido como um pacote de Beijo da Morte (KOD).</span><span class="sxs-lookup"><span data-stu-id="8e14f-164">A stratum field set to zero is known as a Kiss of Death (KOD) packet.</span></span> <span data-ttu-id="8e14f-165">O manipulador KOD do Cliente SMTP para esta situação é uma chamada definida pelo utilizador.</span><span class="sxs-lookup"><span data-stu-id="8e14f-165">The SMTP Client KOD handler for this situation is a user defined callback.</span></span> <span data-ttu-id="8e14f-166">O pequeno ficheiro de demonstração de exemplo contém um simples manipulador KOD para esta situação.</span><span class="sxs-lookup"><span data-stu-id="8e14f-166">The small example demo file contains a simple KOD handler for this situation.</span></span> <span data-ttu-id="8e14f-167">O campo de identificação de referência contém opcionalmente um código que indica o motivo da resposta KOD.</span><span class="sxs-lookup"><span data-stu-id="8e14f-167">The Reference ID field optionally contains a code indicating the reason for the KOD reply.</span></span> <span data-ttu-id="8e14f-168">De qualquer forma, o manipulador KOD deve indicar como lidar com receber um beijo de morte do Servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-168">At any rate, the KOD handler must indicate how to handle receiving a kiss of death from the SNTP Server.</span></span> <span data-ttu-id="8e14f-169">Normalmente, vai querer reiniciar o Cliente SNTP com outro Servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-169">Typically it will want to reinitialize the SNTP Client with another SNTP Server.</span></span>

  - <span data-ttu-id="8e14f-170">A versão SNTP do Servidor, o estrato e o modo de funcionamento devem ser compatíveis com o serviço Cliente.</span><span class="sxs-lookup"><span data-stu-id="8e14f-170">The Server SNTP version, stratum and mode of operation must be matched to the Client service.</span></span>

  - <span data-ttu-id="8e14f-171">Se o Cliente estiver configurado com um máximo de dispersão do relógio do servidor, o Cliente verifica a dispersão do relógio do servidor apenas na primeira atualização recebida e, se exceder o máximo de Cliente, o Cliente rejeita o Servidor.</span><span class="sxs-lookup"><span data-stu-id="8e14f-171">If the Client is configured with a server clock dispersion maximum, the Client checks the server clock dispersion on the first update received only, and if it exceeds the Client maximum, the Client rejects the Server.</span></span>

  - <span data-ttu-id="8e14f-172">Os campos de carimbo de tempo do Servidor também devem passar verificações específicas.</span><span class="sxs-lookup"><span data-stu-id="8e14f-172">The Server time stamp fields must also pass specific checks.</span></span> <span data-ttu-id="8e14f-173">Para o servidor unicast, todos os campos de tempo devem ser preenchidos e não podem ser NUOSos.</span><span class="sxs-lookup"><span data-stu-id="8e14f-173">For the unicast Server, all time fields must be filled in and cannot be NULL.</span></span> <span data-ttu-id="8e14f-174">O carimbo de tempo de origem deve ser igual ao carimbo de tempo transmito no pedido de mensagem de tempo SNTP do Cliente.</span><span class="sxs-lookup"><span data-stu-id="8e14f-174">The Origination time stamp must equal the Transmit time stamp in the Client’s SNTP time message request.</span></span> <span data-ttu-id="8e14f-175">Isto protege o Cliente de intrusos maliciosos e comportamento fraudulento do Servidor.</span><span class="sxs-lookup"><span data-stu-id="8e14f-175">This protects the Client from malicious intruders and rogue Server behavior.</span></span> <span data-ttu-id="8e14f-176">O servidor de transmissão só precisa de preencher a carimbo de tempo transmit.</span><span class="sxs-lookup"><span data-stu-id="8e14f-176">The broadcast Server need only fill in the Transmit time stamp.</span></span> <span data-ttu-id="8e14f-177">Uma vez que não recebe nada do Cliente não tem campos de Receção ou Origem para preencher.</span><span class="sxs-lookup"><span data-stu-id="8e14f-177">Since it does not receive anything from the Client it has no Receive or Origination fields to fill in.</span></span>

    <span data-ttu-id="8e14f-178">Uma verificação de sanidade falhada marca uma atualização de tempo como uma atualização de tempo inválida.</span><span class="sxs-lookup"><span data-stu-id="8e14f-178">A failed sanity check brands a time update as an invalid time update.</span></span> <span data-ttu-id="8e14f-179">O serviço de verificação de sanidade do Cliente SNTP rastreia o número de atualizações de tempo inválidas consecutivas recebidas do mesmo Servidor.</span><span class="sxs-lookup"><span data-stu-id="8e14f-179">The SNTP Client sanity check service tracks the number of consecutive invalid time updates received from the same Server.</span></span>

<span data-ttu-id="8e14f-180">Quando a tarefa de thread do Cliente SNTP verifica a validade de um pacote SNTP para se candidatar ao tempo de Cliente SNTP local, aumenta a contagem do Cliente SNTP Também devolve um estado de `nx_sntp_client_invalid_time_updates.` erro ao chamador, mas este é todo o processamento interno para que não seja imediatamente visível para a aplicação.</span><span class="sxs-lookup"><span data-stu-id="8e14f-180">When SNTP Client thread task checks the validity of an SNTP packet for applying to the local SNTP Client time, it increments the count of the SNTP Client `nx_sntp_client_invalid_time_updates.` It also returns an error status to the caller but this is all internal processing so it is not immediately visible to the application.</span></span> <span data-ttu-id="8e14f-181">A forma de detetar atualizações de tempo falhadas é consultar o valor do Cliente SNTP depois de `nx_sntp_client_invalid_time_updates` receber atualizações de tempo do SNTP Server.</span><span class="sxs-lookup"><span data-stu-id="8e14f-181">The way to detect failed time updates is to query the value of the SNTP Client `nx_sntp_client_invalid_time_updates` after receiving SNTP Server time updates.</span></span>

<span data-ttu-id="8e14f-182">Se a atualização do tempo do Servidor passar nas verificações de sanidade, o Cliente tenta então processar os dados de tempo para a sua hora local.</span><span class="sxs-lookup"><span data-stu-id="8e14f-182">If the Server time update passes the sanity checks, the Client then attempts to process the time data to its local time.</span></span> <span data-ttu-id="8e14f-183">Se o Cliente estiver configurado para cálculo de ida e volta, por exemplo, o tempo de envio de um pedido de atualização para a hora em que um é recebido, o tempo de viagem de ida e volta é calculado.</span><span class="sxs-lookup"><span data-stu-id="8e14f-183">If the Client is configured for round trip calculation, e.g. the time from sending an update request to the time one is received, the round trip time is calculated.</span></span> <span data-ttu-id="8e14f-184">Este valor é reduzido para metade e, em seguida, adicionado ao tempo do Servidor.</span><span class="sxs-lookup"><span data-stu-id="8e14f-184">This value is halved and then added to the Server’s time.</span></span>

<span data-ttu-id="8e14f-185">Em seguida, se esta for a primeira atualização recebida do atual Servidor SNTP, o Cliente SNTP determina se deve ignorar a diferença entre o Servidor e o Cliente local.</span><span class="sxs-lookup"><span data-stu-id="8e14f-185">Next, if this is the first update received from the current SNTP Server, the SNTP Client determines if it should ignore the difference between the Server and Client local time.</span></span> <span data-ttu-id="8e14f-186">Posteriormente, todas as atualizações do SNTP Server são avaliadas para a diferença com o Cliente local.</span><span class="sxs-lookup"><span data-stu-id="8e14f-186">Thereafter all updates from the SNTP Server are evaluated for the difference with the Client local time.</span></span>

<span data-ttu-id="8e14f-187">A diferença entre o tempo de Cliente e servidor é comparada com `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT` .</span><span class="sxs-lookup"><span data-stu-id="8e14f-187">The difference between Client and Server time is compared with `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT`.</span></span> <span data-ttu-id="8e14f-188">Se exceder este valor, os dados são deitados fora. Se a diferença for inferior `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` à diferença, considera-se demasiado pequena para exigir ajustamento.</span><span class="sxs-lookup"><span data-stu-id="8e14f-188">If it exceeds this value, the data is thrown out. If the difference is less than the `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` the difference is considered too small to require adjustment.</span></span>

<span data-ttu-id="8e14f-189">Passando todas estas verificações, a atualização de tempo é então aplicada ao Cliente SNTP com algumas correções por atrasos no processamento interno do Cliente SNTP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-189">Passing all these checks, the time update is then applied to the SNTP Client with some corrections for delays in internal SNTP Client processing.</span></span>

### <a name="sntp-asynchronous-unicast-requests"></a><span data-ttu-id="8e14f-190">Pedidos de Unicast Assíncronos SNTP Asynchronous</span><span class="sxs-lookup"><span data-stu-id="8e14f-190">SNTP Asynchronous Unicast Requests</span></span> 

<span data-ttu-id="8e14f-191">O Cliente SNTP permite que a aplicação do anfitrião envie assincroticamente um pedido unicast para o tempo atual a partir do servidor NTP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-191">The SNTP Client allows the host application to asynchronously send a unicast request for the current time from the NTP server.</span></span>

```C
UINT _nx_sntp_client_request_unicast_time(
NX_SNTP_CLIENT *client_ptr, 
UINT wait_option)
```

<span data-ttu-id="8e14f-192">A opção de espera é a expiração para esperar por uma resposta.</span><span class="sxs-lookup"><span data-stu-id="8e14f-192">The wait option is the expiration to wait for a response.</span></span>

<span data-ttu-id="8e14f-193">Se o Servidor NTP responder, o pacote será submetido às mesmas verificações de processamento e sanidade descritas na secção anterior antes de atualizar o Cliente SNTP local.</span><span class="sxs-lookup"><span data-stu-id="8e14f-193">If the NTP Server responds, the packet is subjected to the same processing and sanity checks as described in the previous section before updating the SNTP Client local time.</span></span>

<span data-ttu-id="8e14f-194">Se a chamada retornar com sucesso, a aplicação pode ligar *para nx_sntp_client_utility_display_date_time* ou *nx_sntp_client_get_local_time_extended* para a hora local atualizada.</span><span class="sxs-lookup"><span data-stu-id="8e14f-194">If the call returns successful completion, the application can call *nx_sntp_client_utility_display_date_time* or *nx_sntp_client_get_local_time_extended* for the updated local time.</span></span>

<span data-ttu-id="8e14f-195">Estes pedidos unicast não interferem com o horário normal do Cliente SNTP para o envio do próximo pedido unicast, ou se em modo de transmissão, quando esperar a próxima transmissão NTP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-195">These unicast requests do not interfere with the normal SNTP Client schedule for sending the next unicast request, or if in broadcast mode, when to expect the next NTP broadcast.</span></span>

### <a name="periodic-local-time-updates"></a><span data-ttu-id="8e14f-196">Atualizações periódicas do tempo local</span><span class="sxs-lookup"><span data-stu-id="8e14f-196">Periodic Local Time Updates</span></span>

<span data-ttu-id="8e14f-197">O ajuste máximo à hora local é definido na opção NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT (em milissegundos).</span><span class="sxs-lookup"><span data-stu-id="8e14f-197">The maximum adjustment to the local time is set in the NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT option (in milliseconds).</span></span> <span data-ttu-id="8e14f-198">O intervalo de atualização de sondagens para operações unicast SNTP Cliente é definido na opção NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL (em segundos).</span><span class="sxs-lookup"><span data-stu-id="8e14f-198">The polling update interval for unicast SNTP Client operations is set in the NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL option (in seconds).</span></span> <span data-ttu-id="8e14f-199">Se o intervalo de votação for maior do que o ajuste máximo, então as atualizações subsequentes do servidor após a primeira atualização do servidor serão rejeitadas.</span><span class="sxs-lookup"><span data-stu-id="8e14f-199">If the polling interval is greater than the maximum adjustment, then subsequent server updates after the first server update will be rejected.</span></span> <span data-ttu-id="8e14f-200">Para evitar isto, o Cliente SNTP atualizará periodicamente o tempo local definido como NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span><span class="sxs-lookup"><span data-stu-id="8e14f-200">To prevent this, the SNTP Client will update the local time periodically defined as NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span></span> 

<span data-ttu-id="8e14f-201">Se houver uma diferença de tempo entre o RTC a bordo e a hora do servidor (a que deve ser definida a hora local do Cliente SNTP), o RTC deve ser sincronizado com o tempo de Cliente SNTP (não demonstramos isso neste Manual do Utilizador).</span><span class="sxs-lookup"><span data-stu-id="8e14f-201">If there is a difference in time between the on board RTC and the server time (which the SNTP Client local time should be set to), the RTC should be synched to the SNTP Client time (we do not demonstrate that in this User Guide).</span></span>

<span data-ttu-id="8e14f-202">Uma vez que as atualizações do servidor SNTP não devem ocorrer mais frequentemente do que uma vez por hora, não é útil inquirir o Cliente SNTP para atualizações de servidores ou estado do servidor com mais frequência do que isso.</span><span class="sxs-lookup"><span data-stu-id="8e14f-202">Since SNTP server updates should not occur more often than once per hour, it is not useful to poll the SNTP Client for server updates or server status more often than that.</span></span> <span data-ttu-id="8e14f-203">No entanto, o Cliente SNTP deve atualizar o seu relógio local com frequência suficiente para não cair mais do que o parâmetro de ajuste de tempo máximo NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span><span class="sxs-lookup"><span data-stu-id="8e14f-203">However, the SNTP Client should update its local clock often enough not to fall further than the maximum time adjustment parameter NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span></span>

<span data-ttu-id="8e14f-204">Em alternativa, o NX_SNTP_CLIENT_MAX_TIME_LAPSE de regulação máximo pode ser definido para maior do que a atualização de sondagens unicast (ou intervalos de transmissão previstos).</span><span class="sxs-lookup"><span data-stu-id="8e14f-204">Alternatively, the maximum adjustment NX_SNTP_CLIENT_MAX_TIME_LAPSE can be set to greater than the unicast polling update (or anticipated broadcast intervals).</span></span> <span data-ttu-id="8e14f-205">Este último elimina a necessidade de um relógio independente em tempo real.</span><span class="sxs-lookup"><span data-stu-id="8e14f-205">The latter eliminates the need for an independent real time clock.</span></span> <span data-ttu-id="8e14f-206">No entanto, a intenção do protocolo SNTP é evitar a dependência total das atualizações locais de RTC ou de tempo de rede.</span><span class="sxs-lookup"><span data-stu-id="8e14f-206">However, the intention of SNTP protocol is to avoid total reliance on either local RTC or network time updates.</span></span> <span data-ttu-id="8e14f-207">Além disso, as atualizações do SNTP Server destinam-se a evitar derivas no relógio de tempo local.</span><span class="sxs-lookup"><span data-stu-id="8e14f-207">Further, the SNTP Server updates are intended to prevent drift in the local time clock.</span></span>

## <a name="multiple-network-interfaces"></a><span data-ttu-id="8e14f-208">Múltiplas interfaces de rede</span><span class="sxs-lookup"><span data-stu-id="8e14f-208">Multiple Network Interfaces</span></span>

<span data-ttu-id="8e14f-209">O Cliente SNTP NetX Duo pode ser configurado para funcionar em redes secundárias desde que essas redes estejam registadas com a instância IP.</span><span class="sxs-lookup"><span data-stu-id="8e14f-209">NetX Duo SNTP Client can be configured to run on secondary networks as long as those networks are registered with the IP instance.</span></span> <span data-ttu-id="8e14f-210">Consulte o NetX Duo ou o NetX User Guide para obter mais informações sobre como registar redes secundárias.</span><span class="sxs-lookup"><span data-stu-id="8e14f-210">See the NetX Duo or NetX User Guide for more information on how to register secondary networks.</span></span>

<span data-ttu-id="8e14f-211">Na *chamada nx_sntp_client_create,* desave a terceira entrada, iface_index, para o índice da rede para o Cliente SNTP receber atualizações de tempo.</span><span class="sxs-lookup"><span data-stu-id="8e14f-211">In the *nx_sntp_client_create* call, set the third input, iface_index, to the index of the network for the SNTP Client to receive time updates on.</span></span> <span data-ttu-id="8e14f-212">A interface primária está sempre no índice 0.</span><span class="sxs-lookup"><span data-stu-id="8e14f-212">The primary interface is always at index 0.</span></span> <span data-ttu-id="8e14f-213">O Cliente SNTP NetX Duo não consegue suportar atualizações de tempo simultaneamente em múltiplas interfaces de rede.</span><span class="sxs-lookup"><span data-stu-id="8e14f-213">NetX Duo SNTP Client cannot support time updates simultaneously on multiple network interface.</span></span>

## <a name="sntp-and-ntp-rfcs"></a><span data-ttu-id="8e14f-214">SNTP e NTP RFCs</span><span class="sxs-lookup"><span data-stu-id="8e14f-214">SNTP and NTP RFCs</span></span>

<span data-ttu-id="8e14f-215">O cliente NetX Duo SNTP está em conformidade com o RFC4330 "Simple Network Time Protocol (SNTP) Versão 4 para IPv4, IPv6 e OSI" e RFCs relacionados.</span><span class="sxs-lookup"><span data-stu-id="8e14f-215">NetX Duo SNTP client is compliant with RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI” and related RFCs.</span></span>