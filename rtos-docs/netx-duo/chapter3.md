---
title: Capítulo 3 - Componentes funcionais do Azure RTOS NetX Duo
description: Este capítulo contém uma descrição da pilha Azure RTOS NetX Duo TCP/IP de uma perspetiva funcional.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 31900c7b822c88079e4b9fe28a8a388d20f819aa
ms.sourcegitcommit: 60ad844b58639d88830f2660ab0c4ff86b92c10f
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 04/07/2021
ms.locfileid: "106549849"
---
# <a name="chapter-3---functional-components-of-azure-rtos-netx-duo"></a><span data-ttu-id="c4a98-103">Capítulo 3 - Componentes funcionais do Azure RTOS NetX Duo</span><span class="sxs-lookup"><span data-stu-id="c4a98-103">Chapter 3 - Functional Components of Azure RTOS NetX Duo</span></span>

<span data-ttu-id="c4a98-104">Este capítulo contém uma descrição da pilha Azure RTOS NetX Duo TCP/IP de uma perspetiva funcional.</span><span class="sxs-lookup"><span data-stu-id="c4a98-104">This chapter contains a description of the high- performance Azure RTOS NetX Duo TCP/IP stack from a functional perspective.</span></span> 

## <a name="execution-overview"></a><span data-ttu-id="c4a98-105">Visão geral da execução</span><span class="sxs-lookup"><span data-stu-id="c4a98-105">Execution Overview</span></span>

<span data-ttu-id="c4a98-106">Existem cinco tipos de execução de programas dentro de uma aplicação NetX Duo: inicialização, chamadas de interface de aplicação, fio IP interno, temporizadores periódicos IP e o controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-106">There are five types of program execution within a NetX Duo application: initialization, application interface calls, internal IP thread, IP periodic timers, and the network driver.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-107">*A NetX Duo assume a existência da ThreadX e depende da sua execução de fios, suspensão, temporizadores periódicos e instalações de exclusão mútua.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-107">*NetX Duo assumes the existence of ThreadX and depends on its thread execution, suspension, periodic timers, and mutual exclusion facilities.*</span></span>

### <a name="initialization"></a><span data-ttu-id="c4a98-108">Inicialização</span><span class="sxs-lookup"><span data-stu-id="c4a98-108">Initialization</span></span>

<span data-ttu-id="c4a98-109">O serviço \***nx_system_initialize** _ deve ser chamado antes de qualquer outro serviço NetX Duo ser chamado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-109">The service \***nx_system_initialize** _ must be called before any other NetX Duo service is called.</span></span> <span data-ttu-id="c4a98-110">A inicialização do sistema pode ser chamada a partir da função ThreadX _ *_tx_application_define_*\* ou a partir de fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-110">System initialization can be called either from the ThreadX _ *_tx_application_define_*\* function or from application threads.</span></span>

<span data-ttu-id="c4a98-111">Depois de \***nx_system_initialize** _ devoluções, o sistema está pronto para criar pacotes de piscinas e instâncias IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-111">After \***nx_system_initialize** _ returns, the system is ready to create packet pools and IP instances.</span></span> <span data-ttu-id="c4a98-112">Como a criação de uma instância IP requer um pacote de pacotes predefinidos, pelo menos um conjunto de pacotes NetX Duo deve existir antes de criar uma instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-112">Because creating an IP instance requires a default packet pool, at least one NetX Duo packet pool must exist prior to creating an IP instance.</span></span> <span data-ttu-id="c4a98-113">A criação de piscinas de pacotes e instâncias IP são permitidas a partir da função de inicialização ThreadX _ *_tx_application_define_*\* e a partir de fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-113">Creating packet pools and IP instances are allowed from the ThreadX initialization function _ *_tx_application_define_*\* and from application threads.</span></span>

<span data-ttu-id="c4a98-114">Internamente, a criação de uma instância IP é realizada em duas partes: A primeira parte é feita no contexto do chamador, seja a partir de ***tx_application_define*** ou do contexto de um fio de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-114">Internally, creating an IP instance is accomplished in two parts: The first part is done within the context of the caller, either from ***tx_application_define*** or from an application thread's context.</span></span> <span data-ttu-id="c4a98-115">Isto inclui a criação da estrutura de dados IP e a criação de vários recursos IP, incluindo o fio IP interno.</span><span class="sxs-lookup"><span data-stu-id="c4a98-115">This includes setting up the IP data structure and creating various IP resources, including the internal IP thread.</span></span> <span data-ttu-id="c4a98-116">A segunda parte é executada durante a execução inicial a partir do fio IP interno.</span><span class="sxs-lookup"><span data-stu-id="c4a98-116">The second part is performed during the initial execution from the internal IP thread.</span></span> <span data-ttu-id="c4a98-117">É aqui que o controlador de rede, fornecido durante a primeira parte da criação de IP, é chamado pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="c4a98-117">This is where the network driver, supplied during the first part of IP creation, is first called.</span></span> <span data-ttu-id="c4a98-118">A chamada do controlador de rede a partir da linha IP interna permite ao condutor efetuar E/S e suspender durante o processamento de inicialização.</span><span class="sxs-lookup"><span data-stu-id="c4a98-118">Calling the network driver from the internal IP thread enables the driver to perform I/O and suspend during its initialization processing.</span></span>

<span data-ttu-id="c4a98-119">Quando o controlador de rede regressa do seu processamento de inicialização, a criação ip fica completa.</span><span class="sxs-lookup"><span data-stu-id="c4a98-119">When the network driver returns from its initialization processing, the IP creation is complete.</span></span>

<span data-ttu-id="c4a98-120">A inicialização do IPv6 na NetX Duo requer alguns serviços adicionais da NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-120">Initialization of IPv6 in NetX Duo requires a few additional NetX Duo services.</span></span> <span data-ttu-id="c4a98-121">Estes são descritos em maior detalhe na secção [IPv6 na NetX Duo](#ipv6-in-netx-duo) mais tarde neste capítulo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-121">These are described in greater detail in the section [IPv6 in NetX Duo](#ipv6-in-netx-duo) later in this chapter.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-122">*O serviço NetX Duo **nx_ip_status_check** está disponível para obter informações sobre a instância IP e o seu estado de interface primária. Essas informações de estado incluem se o link é ou não inicializado, ativado e endereço IP é resolvido. Estas informações são utilizadas para sincronizar os fios de aplicação que precisam de utilizar uma instância IP recém-criada. Para sistemas multihomes, consulte [o Multihome Support](#multihome-support). **nx_ip_interface_status_check** está disponível para obter 3 informações sobre a interface especificada.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-122">*The NetX Duo service **nx_ip_status_check** is available to obtain information on the IP instance and its primary interface status. Such status information includes whether or not the link is initialized, enabled and IP address is resolved. This information is used to synchronize application threads needing to use a newly created IP instance. For multihome systems, see [Multihome Support](#multihome-support). **nx_ip_interface_status_check** is available to obtain 3information on the specified interface.*</span></span>

### <a name="application-interface-calls"></a><span data-ttu-id="c4a98-123">Chamadas de Interface de Aplicação</span><span class="sxs-lookup"><span data-stu-id="c4a98-123">Application Interface Calls</span></span>

<span data-ttu-id="c4a98-124">As chamadas da aplicação são feitas em grande parte a partir de fios de aplicação que estão a ser geridos sob o ThreadX RTOS.</span><span class="sxs-lookup"><span data-stu-id="c4a98-124">Calls from the application are largely made from application threads running under the ThreadX RTOS.</span></span> <span data-ttu-id="c4a98-125">No entanto, algumas inicializaçãos, criar e permitir serviços podem ser chamados a partir de ***tx_application_define***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-125">However, some initialization, create, and enable services may be called from ***tx_application_define***.</span></span> <span data-ttu-id="c4a98-126">As secções "Allowed From" [do Capítulo 4 - Descrição dos Serviços Azure RTOS NetX Duo](chapter4.md) indicam a partir do qual cada serviço NetX Duo pode ser chamado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-126">The "Allowed From" sections in [Chapter 4 - Description of Azure RTOS NetX Duo Services](chapter4.md) indicate from which each NetX Duo service can be called.</span></span>

<span data-ttu-id="c4a98-127">Na maior parte das vezes, o processamento de atividades intensivas, como as despesas de computação, é feito dentro do contexto do fio de chamada , sem bloquear o acesso de outros fios à instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-127">For the most part, processing intensive activities such as computing checksums is done within the calling thread's context—without blocking access of other threads to the IP instance.</span></span> <span data-ttu-id="c4a98-128">Por exemplo, na transmissão, o cálculo da UDP checksum é realizado dentro do serviço \***nx_udp_socket_send** _ , antes de ligar para a função de envio IP subjacente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-128">For example, on transmission, the UDP checksum calculation is performed inside the \***nx_udp_socket_send** _ service, prior to calling the underlying IP send function.</span></span> <span data-ttu-id="c4a98-129">Num pacote recebido, a conta de verificação da UDP é calculada no serviço _ *_nx_udp_socket_receive*_\* executado no fio da aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-129">On a received packet, the UDP checksum is calculated in the _ *_nx_udp_socket_receive_*\* service, executed in the  of the application thread.</span></span> <span data-ttu-id="c4a98-130">Isto ajuda a prevenir o bloqueio de pedidos de rede de fios de maior prioridade devido ao processamento de cálculo intensivo de checkum em fios de menor prioridade.</span><span class="sxs-lookup"><span data-stu-id="c4a98-130">This helps prevent stalling network requests of higher-priority threads because of processing intensive checksum computation in lower-priority threads.</span></span>

<span data-ttu-id="c4a98-131">Valores, como endereços IP e números de porta, são passados para APIs em ordem byte de anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-131">Values, such as IP addresses and port numbers, are passed to APIs in host byte order.</span></span> <span data-ttu-id="c4a98-132">Internamente, estes valores também são armazenados na ordem byte de anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-132">Internally these values are stored in host byte order as well.</span></span> <span data-ttu-id="c4a98-133">Isto permite que os desenvolvedores vejam facilmente os valores através de um depurar.</span><span class="sxs-lookup"><span data-stu-id="c4a98-133">This allows developers to easily view the values via a debugger.</span></span> <span data-ttu-id="c4a98-134">Quando estes valores são programados num quadro para transmissão, são convertidos para ordem byte de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-134">When these values are programmed into a frame for transmission, they are converted to network byte order.</span></span>

### <a name="internal-ip-thread"></a><span data-ttu-id="c4a98-135">Fio IP interno</span><span class="sxs-lookup"><span data-stu-id="c4a98-135">Internal IP Thread</span></span>

<span data-ttu-id="c4a98-136">Como mencionado, cada instância IP na NetX Duo tem o seu próprio fio.</span><span class="sxs-lookup"><span data-stu-id="c4a98-136">As mentioned, each IP instance in NetX Duo has its own thread.</span></span> <span data-ttu-id="c4a98-137">A prioridade e o tamanho da pilha do fio IP interno é definido no serviço ***nx_ip_create.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-137">The priority and stack size of the internal IP thread is defined in the ***nx_ip_create*** service.</span></span> <span data-ttu-id="c4a98-138">O fio IP interno é criado num modo pronto a executar.</span><span class="sxs-lookup"><span data-stu-id="c4a98-138">The internal IP thread is created in a ready-to-execute mode.</span></span> <span data-ttu-id="c4a98-139">Se o fio IP tiver uma prioridade maior do que o fio de chamada, a pré-substituição pode ocorrer dentro da chamada de criação IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-139">If the IP thread has a higher priority than the calling thread, preemption may occur inside the IP create call.</span></span>

<span data-ttu-id="c4a98-140">O ponto de entrada do fio IP interno encontra-se na função interna _ ***nx_ip_thread_entry***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-140">The entry point of the internal IP thread is at the internal function _ ***nx_ip_thread_entry***.</span></span> <span data-ttu-id="c4a98-141">Quando iniciado, o fio IP interno completa primeiro a inicialização do controlador de rede, que consiste em fazer três chamadas para o controlador de rede específico da aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-141">When started, the internal IP thread first completes network driver initialization, which consists of making three calls to the application-specific network driver.</span></span> <span data-ttu-id="c4a98-142">A primeira chamada é anexar o controlador de rede à instância IP, seguida de uma chamada de inicialização, que permite ao controlador de rede passar pelo processo de inicialização.</span><span class="sxs-lookup"><span data-stu-id="c4a98-142">The first call is to attach the network driver to the IP instance, followed by an initialization call, which allows the network driver to go through the initialization process.</span></span> <span data-ttu-id="c4a98-143">Após o retorno do controlador de rede da inicialização (pode suspender-se enquanto aguarda a instalação correta do hardware), o fio IP interno volta a ligar para o controlador de rede para ativar a ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-143">After the network driver returns from initialization (it may suspend while waiting for the hardware to be properly set up), the internal IP thread calls the network driver again to enable the link.</span></span> <span data-ttu-id="c4a98-144">Após a retorna do controlador de rede a partir da chamada de ativação de ligação, o fio IP interno introduz uma verificação de loop para sempre para vários eventos que precisam de ser processados para esta instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-144">After the network driver returns from the link enable call, the internal IP thread enters a forever loop checking for various events that need processing for this IP instance.</span></span> <span data-ttu-id="c4a98-145">Os eventos processados neste ciclo incluem receção de pacotes IP diferidos, montagem de fragmentos de pacote IP, processamento de ping ICMP, processamento de IGMP, processamento de fila de pacotes TCP, processamento periódico de TCP, intervalos de montagem de fragmentos IP e processamento periódico IGMP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-145">Events processed in this loop include deferred IP packet reception, IP packet fragment assembly, ICMP ping processing, IGMP processing, TCP packet queue processing, TCP periodic processing, IP fragment assembly timeouts, and IGMP periodic processing.</span></span> <span data-ttu-id="c4a98-146">Os eventos incluem também atividades de resolução de endereços; Processamento de pacotes ARP e processamento periódico ARP em IPv4, Deteção de Endereços Duplicados, Solicitação de Router e Descoberta de Vizinhos no IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-146">Events also include address resolution activities; ARP packet processing and ARP periodic processing in IPv4, Duplicate Address Detection, Router Solicitation, and Neighbor Discovery in IPv6.</span></span>

> [!CAUTION]
> <span data-ttu-id="c4a98-147">*As funções de retorno netx Duo, incluindo chamadas de escuta e desconexão, são chamadas a partir do fio IP interno - e não do fio de chamada original. A aplicação deve ter o cuidado de não suspender dentro de qualquer função de retorno NetX Duo.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-147">*The NetX Duo callback functions, including listen and disconnect callbacks, are called from the internal IP thread—not the original calling thread. The application must take care not to suspend inside any NetX Duo callback function.*</span></span>

### <a name="ip-periodic-timers"></a><span data-ttu-id="c4a98-148">Temporizadores periódicos IP</span><span class="sxs-lookup"><span data-stu-id="c4a98-148">IP Periodic Timers</span></span>

<span data-ttu-id="c4a98-149">Existem dois temporizadores periódicos ThreadX utilizados para cada instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-149">There are two ThreadX periodic timers used for each IP instance.</span></span> <span data-ttu-id="c4a98-150">O primeiro é um temporizador de um segundo para ARP, IGMP, TCP timeout, e também impulsiona o processamento de remontagem de fragmentos IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-150">The first one is a one-second timer for ARP, IGMP, TCP timeout, and it also drives IP fragment reassemble processing.</span></span> <span data-ttu-id="c4a98-151">O segundo temporizador é um temporizador de 100 ms para conduzir o tempo de retransmissão TCP e as operações relacionadas com o IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-151">The second timer is a 100ms timer to drive the TCP retransmission timeout and IPv6-related operations.</span></span>

### <a name="network-driver"></a><span data-ttu-id="c4a98-152">Controlador de rede</span><span class="sxs-lookup"><span data-stu-id="c4a98-152">Network Driver</span></span>

<span data-ttu-id="c4a98-153">Cada instância IP no NetX Duo tem uma interface primária, que é identificada pelo seu controlador de dispositivos especificado no serviço ***nx_ip_create.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-153">Each IP instance in NetX Duo has a primary interface, which is identified by its device driver specified in the ***nx_ip_create*** service.</span></span> <span data-ttu-id="c4a98-154">O controlador de rede é responsável pelo tratamento de vários pedidos da NetX Duo, incluindo transmissão de pacotes, receção de pacotes e pedidos de estado e controlo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-154">The network driver is responsible for handling various NetX Duo requests, including packet transmission, packet reception, and requests for status and control.</span></span> 

<span data-ttu-id="c4a98-155">Para um sistema multi-casa, a instância IP tem múltiplas interfaces, cada uma com um controlador de rede associado que executa estas tarefas para a respetiva interface.</span><span class="sxs-lookup"><span data-stu-id="c4a98-155">For a multi-home system, the IP instance has multiple interfaces, each with an associated network driver that performs these tasks for the respective interface.</span></span>

<span data-ttu-id="c4a98-156">O controlador da rede também deve lidar com eventos assíncronos que ocorrem nos meios de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-156">The network driver must also handle asynchronous events occurring on the media.</span></span> <span data-ttu-id="c4a98-157">Eventos assíncronos dos meios de comunicação incluem receção de pacotes, conclusão da transmissão de pacotes e alterações de estado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-157">Asynchronous events from the media include packet reception, packet transmission completion, and status changes.</span></span> <span data-ttu-id="c4a98-158">A NetX Duo fornece ao controlador de rede várias funções de acesso para lidar com vários eventos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-158">NetX Duo provides the network driver with several access functions to handle various events.</span></span> <span data-ttu-id="c4a98-159">Estas funções foram concebidas para serem chamadas a partir da parte de rotina de serviço de interrupção do controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-159">These functions are designed to be called from the  interrupt service routine portion of the network driver.</span></span> <span data-ttu-id="c4a98-160">Para as redes IPv4, o controlador de rede deve encaminhar todos os pacotes ARP recebidos para a função interna ***_nx_arp_packet_deferred_receive.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-160">For IPv4 networks, the network driver should forward all ARP packets received to the ***_nx_arp_packet_deferred_receive*** internal function.</span></span> <span data-ttu-id="c4a98-161">Todos os pacotes RARP devem ser encaminhados para \***_nx_rarp_packet_deferred_receive** _ função interna.</span><span class="sxs-lookup"><span data-stu-id="c4a98-161">All RARP packets should be forwarded to \***_nx_rarp_packet_deferred_receive** _ internal function.</span></span> <span data-ttu-id="c4a98-162">Existem duas opções para pacotes IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-162">There are two options for IP packets.</span></span> <span data-ttu-id="c4a98-163">Se for necessária uma expedição rápida dos pacotes IP, os pacotes IP de entrada devem ser encaminhados para _ *_nx_ip_packet_receive_* _ para processamento imediato.</span><span class="sxs-lookup"><span data-stu-id="c4a98-163">If fast dispatch of IP packets is required, incoming IP packets should be forwarded to _ *_ _nx_ip_packet_receive_* _ for immediate processing.</span></span> <span data-ttu-id="c4a98-164">Isto melhora consideravelmente o desempenho da NetX Duo no manuseamento de pacotes IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-164">This greatly improves NetX Duo performance in handling IP packets.</span></span> <span data-ttu-id="c4a98-165">Caso contrário, o encaminhamento dos pacotes IP para _ *_ _nx_ip_packet_deferred_receive_*\* deve ser feito.</span><span class="sxs-lookup"><span data-stu-id="c4a98-165">Otherwise, forwarding IP packets to _ *_ _nx_ip_packet_deferred_receive_*\* should be done.</span></span> <span data-ttu-id="c4a98-166">Este serviço coloca o pacote IP na fila de processamento diferida, onde é depois manuseado pela linha IP interna, o que resulta na menor quantidade de tempo de processamento do ISR.</span><span class="sxs-lookup"><span data-stu-id="c4a98-166">This service places the IP packet in the deferred processing queue where it is then handled by the internal IP thread, which results in the least amount of ISR processing time.</span></span>

<span data-ttu-id="c4a98-167">O controlador de rede também pode adiar o processamento de interrupção para ficar sem o contexto do fio IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-167">The network driver can also defer interrupt processing to run out of the context of the IP thread.</span></span> <span data-ttu-id="c4a98-168">Neste modo, o ISR deve guardar as informações necessárias, ligar para a função interna ***_nx_ip_driver_deferred_processing***, e reconhecer o controlador de interrupção.</span><span class="sxs-lookup"><span data-stu-id="c4a98-168">In this mode, the ISR shall save the necessary information, call the internal function ***_nx_ip_driver_deferred_processing***, and acknowledge the interrupt controller.</span></span> <span data-ttu-id="c4a98-169">Este serviço notifica a linha IP para agendar uma chamada ao controlador do dispositivo para completar o processo do evento que causa a interrupção.</span><span class="sxs-lookup"><span data-stu-id="c4a98-169">This service notifies IP thread to schedule a callback to the device driver to complete the process of the event that causes the interrupt.</span></span>

<span data-ttu-id="c4a98-170">Alguns controladores de rede são capazes de executar a computação e validação de checkum de cabeçalho TCP/IP em hardware, sem ocupar recursos valiosos da CPU.</span><span class="sxs-lookup"><span data-stu-id="c4a98-170">Some network controllers are capable of performing TCP/IP header checksum computation and validation in hardware, without taking up valuable CPU resources.</span></span> <span data-ttu-id="c4a98-171">Para tirar partido da funcionalidade de capacidade de hardware, o NetX Duo oferece opções para ativar ou desativar vários cálculos de verificação de software no momento da compilação, bem como ligar ou desligar a computação checkum no tempo de execução, se o controlador do dispositivo for capaz de comunicar com a camada IP sobre as capacidades de hardware.</span><span class="sxs-lookup"><span data-stu-id="c4a98-171">To take advantage of the hardware capability feature, NetX Duo provides options to enable or disable various software checksum computation at compilation time, as well as turning on or off checksum computation at run time, if the device driver is able to communicate with the IP layer about is hardware capabilities.</span></span> <span data-ttu-id="c4a98-172">Consulte [o Capítulo 5 - Azure RTOS NetX Duo Network Drivers](chapter5.md) para obter informações mais detalhadas sobre a escrita dos controladores de rede NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-172">See [Chapter 5 - Azure RTOS NetX Duo Network Drivers](chapter5.md) for more detailed information on writing NetX Duo network drivers.</span></span>

### <a name="multihome-support"></a><span data-ttu-id="c4a98-173">Suporte Multihome</span><span class="sxs-lookup"><span data-stu-id="c4a98-173">Multihome Support</span></span>

<span data-ttu-id="c4a98-174">O NetX Duo suporta sistemas ligados a múltiplos dispositivos físicos utilizando uma única instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-174">NetX Duo supports systems connected to multiple physical devices using a single IP instance.</span></span> <span data-ttu-id="c4a98-175">Cada interface física é atribuída a um bloco de controlo de interface na instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-175">Each physical interface is assigned to an interface control block in the IP instance.</span></span> <span data-ttu-id="c4a98-176">As aplicações que desejem utilizar um sistema multihome devem definir o valor para \***NX_MAX_PHSYCIAL_INTERFACES** _ ao número de dispositivos físicos ligados ao sistema e reconstruir a biblioteca NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-176">Applications wishing to use a multihome system must define the value for \***NX_MAX_PHSYCIAL_INTERFACES** _ to the number of physical devices attached to the system, and rebuild NetX Duo library.</span></span> <span data-ttu-id="c4a98-177">Por predefinição ,*_o NX_MAX_PHYSICAL_INTERFACES_*\* está definido para um, criando um bloco de controlo de interface na instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-177">By default _ *_NX_MAX_PHYSICAL_INTERFACES_*\* is set to one, creating one interface control block in the IP instance.</span></span>

<span data-ttu-id="c4a98-178">A aplicação NetX Duo cria uma única instância IP para o dispositivo primário utilizando o serviço \***nx_ip_create** _ .</span><span class="sxs-lookup"><span data-stu-id="c4a98-178">The NetX Duo application creates a single IP instance for the primary device using the \***nx_ip_create** _ service.</span></span> <span data-ttu-id="c4a98-179">Para cada dispositivo de rede adicional, a aplicação liga o dispositivo à instância IP utilizando o serviço _ *_nx_ip_interface_attach_*\* .</span><span class="sxs-lookup"><span data-stu-id="c4a98-179">For each additional network devices, the application attaches the device to the IP instance using the _ *_nx_ip_interface_attach_*\* service.</span></span>

<span data-ttu-id="c4a98-180">Cada estrutura de interface de rede contém um subconjunto de informações de rede sobre a interface de rede que está contida no bloco de controlo IP, incluindo endereço IPv4 de interface, máscara de sub-rede, tamanho IP MTU e informações de endereço de camada MAC.</span><span class="sxs-lookup"><span data-stu-id="c4a98-180">Each network interface structure contains a subset of network information about the network interface that is contained in the IP control block, including interface IPv4 address, subnet mask, IP MTU size, and MAC-layer address information.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-181">*NetX Duo com suporte multihome é retrocompatível com versões anteriores do NetX Duo. Serviços que não levam informações de interface explícitas padrão ao dispositivo de rede primária.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-181">*NetX Duo with multihome support is backward compatible with earlier versions of NetX Duo. Services that do not take explicit interface information default to the primary network device.*</span></span>

<span data-ttu-id="c4a98-182">A interface primária tem índice zero na lista de instâncias IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-182">The primary interface has index zero in the IP instance list.</span></span> <span data-ttu-id="c4a98-183">Cada dispositivo subsequente ligado à instância IP é atribuído o próximo índice.</span><span class="sxs-lookup"><span data-stu-id="c4a98-183">Each subsequent device attached to the IP instance is assigned the next index.</span></span>

<span data-ttu-id="c4a98-184">Todos os serviços de protocolo de camada superior para os quais a instância IP está ativada, incluindo TCP, UDP, ICMP e IGMP, estão disponíveis para todos os dispositivos anexos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-184">All upper layer protocol services for which the IP instance is enabled, including TCP, UDP, ICMP, and IGMP, are available to all the attached devices.</span></span>

<span data-ttu-id="c4a98-185">Na maioria dos casos, o NetX Duo pode determinar o melhor endereço de origem a utilizar ao transmitir um pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-185">In most cases, NetX Duo can determine the best source address to use when transmitting a packet.</span></span> <span data-ttu-id="c4a98-186">A seleção do endereço de origem baseia-se no endereço de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-186">The source address selection is based on the destination address.</span></span> <span data-ttu-id="c4a98-187">Os serviços NetX Duo são adicionados para permitir que as aplicações especifiquem um endereço de origem específico para usar, nos casos em que o mais adequado não possa ser determinado pelo endereço de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-187">NetX Duo services are added to allow applications to specify a specific source address to use, in cases where the most suitable one cannot be determined by the destination address.</span></span> <span data-ttu-id="c4a98-188">Um exemplo seria num sistema multihome, uma aplicação precisa enviar um pacote para uma transmissão IPv4 ou endereços de destino multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-188">An example would be in a multihome system, an application needs to send a packet to an IPv4 broadcast or multicast destination addresses.</span></span>

<span data-ttu-id="c4a98-189">Os serviços especificamente para o desenvolvimento de aplicações multihomes incluem:</span><span class="sxs-lookup"><span data-stu-id="c4a98-189">Services specifically for developing multihome applications include the following:</span></span>

- <span data-ttu-id="c4a98-190">*nx_igmp_multicast_interface_join*</span><span class="sxs-lookup"><span data-stu-id="c4a98-190">*nx_igmp_multicast_interface_join*</span></span>
- <span data-ttu-id="c4a98-191">*nx_igmp_multicast_interface_leave*</span><span class="sxs-lookup"><span data-stu-id="c4a98-191">*nx_igmp_multicast_interface_leave*</span></span>
- <span data-ttu-id="c4a98-192">*nx_ip_driver_interface_direct_command*</span><span class="sxs-lookup"><span data-stu-id="c4a98-192">*nx_ip_driver_interface_direct_command*</span></span>
- <span data-ttu-id="c4a98-193">*nx_ip_interface_address_get*</span><span class="sxs-lookup"><span data-stu-id="c4a98-193">*nx_ip_interface_address_get*</span></span>
- <span data-ttu-id="c4a98-194">*nx_ip_interface_address_mapping_configure*</span><span class="sxs-lookup"><span data-stu-id="c4a98-194">*nx_ip_interface_address_mapping_configure*</span></span>
- <span data-ttu-id="c4a98-195">*nx_ip_interface_address_set*</span><span class="sxs-lookup"><span data-stu-id="c4a98-195">*nx_ip_interface_address_set*</span></span>  
- <span data-ttu-id="c4a98-196">*nx_ip_interface_attach*</span><span class="sxs-lookup"><span data-stu-id="c4a98-196">*nx_ip_interface_attach*</span></span>
- <span data-ttu-id="c4a98-197">*nx_ip_interface_capability_get*</span><span class="sxs-lookup"><span data-stu-id="c4a98-197">*nx_ip_interface_capability_get*</span></span> 
- <span data-ttu-id="c4a98-198">*nx_ip_interface_capability_set*</span><span class="sxs-lookup"><span data-stu-id="c4a98-198">*nx_ip_interface_capability_set*</span></span>
- <span data-ttu-id="c4a98-199">*nx_ip_interface_detach*</span><span class="sxs-lookup"><span data-stu-id="c4a98-199">*nx_ip_interface_detach*</span></span>
- <span data-ttu-id="c4a98-200">*nx_ip_interface_info_get*</span><span class="sxs-lookup"><span data-stu-id="c4a98-200">*nx_ip_interface_info_get*</span></span>
- <span data-ttu-id="c4a98-201">*nx_ip_interface_mtu_set*</span><span class="sxs-lookup"><span data-stu-id="c4a98-201">*nx_ip_interface_mtu_set*</span></span>
- <span data-ttu-id="c4a98-202">*nx_ip_interface_physical_address_get*</span><span class="sxs-lookup"><span data-stu-id="c4a98-202">*nx_ip_interface_physical_address_get*</span></span>
- <span data-ttu-id="c4a98-203">*nx_ip_interface_physical_address_set*</span><span class="sxs-lookup"><span data-stu-id="c4a98-203">*nx_ip_interface_physical_address_set*</span></span>
- <span data-ttu-id="c4a98-204">*nx_ip_interface_status_check*</span><span class="sxs-lookup"><span data-stu-id="c4a98-204">*nx_ip_interface_status_check*</span></span>
- <span data-ttu-id="c4a98-205">*nx_ip_raw_packet_source_send*</span><span class="sxs-lookup"><span data-stu-id="c4a98-205">*nx_ip_raw_packet_source_send*</span></span>
- <span data-ttu-id="c4a98-206">*nx_ipv4_multicast_interface_join*</span><span class="sxs-lookup"><span data-stu-id="c4a98-206">*nx_ipv4_multicast_interface_join*</span></span>
- <span data-ttu-id="c4a98-207">*nx_ipv4_multicast_interface_leave*</span><span class="sxs-lookup"><span data-stu-id="c4a98-207">*nx_ipv4_multicast_interface_leave*</span></span>
- <span data-ttu-id="c4a98-208">*nx_udp_socket_source_send*</span><span class="sxs-lookup"><span data-stu-id="c4a98-208">*nx_udp_socket_source_send*</span></span>
- <span data-ttu-id="c4a98-209">*nxd_ipv6_multicast_interface_join*</span><span class="sxs-lookup"><span data-stu-id="c4a98-209">*nxd_ipv6_multicast_interface_join*</span></span>
- <span data-ttu-id="c4a98-210">*nxd_ipv6_multicast_interface_leave*</span><span class="sxs-lookup"><span data-stu-id="c4a98-210">*nxd_ipv6_multicast_interface_leave*</span></span> 
- <span data-ttu-id="c4a98-211">*nxd_udp_socket_source_send*</span><span class="sxs-lookup"><span data-stu-id="c4a98-211">*nxd_udp_socket_source_send*</span></span>
- <span data-ttu-id="c4a98-212">*nxd_icmp_source_ping*</span><span class="sxs-lookup"><span data-stu-id="c4a98-212">*nxd_icmp_source_ping*</span></span>
- <span data-ttu-id="c4a98-213">*nxd_ip_raw_packet_source_send*</span><span class="sxs-lookup"><span data-stu-id="c4a98-213">*nxd_ip_raw_packet_source_send*</span></span>
- <span data-ttu-id="c4a98-214">*nxd_udp_socket_source_send*</span><span class="sxs-lookup"><span data-stu-id="c4a98-214">*nxd_udp_socket_source_send*</span></span>

<span data-ttu-id="c4a98-215">Estes serviços são explicados em maior detalhe na [Descrição dos Serviços NetX Duo.](chapter4.md)</span><span class="sxs-lookup"><span data-stu-id="c4a98-215">These services are explained in greater detail in [Description of NetX Duo Services](chapter4.md).</span></span>

### <a name="loopback-interface"></a><span data-ttu-id="c4a98-216">Loopback Interface</span><span class="sxs-lookup"><span data-stu-id="c4a98-216">Loopback Interface</span></span>

<span data-ttu-id="c4a98-217">A interface loopback é uma interface de rede especial sem uma ligação física anexada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-217">The loopback interface is a special network interface without an physical link attached to.</span></span> <span data-ttu-id="c4a98-218">A interface loopback permite que as aplicações comuniquem utilizando o endereço de backback IPv4 127.0.0.0.1 Para utilizar uma interface de loopback lógica, certifique-se de que a opção configurável ***NX_DISABLE_LOOPBACK_INTERFACE*** não está definida.</span><span class="sxs-lookup"><span data-stu-id="c4a98-218">The loopback interface allows applications to communicate using the IPv4 loopback address 127.0.0.1 To utilize a logical loopback interface, ensure the configurable option ***NX_DISABLE_LOOPBACK_INTERFACE*** is not set.</span></span>

### <a name="interface-control-blocks"></a><span data-ttu-id="c4a98-219">Blocos de controlo de interface</span><span class="sxs-lookup"><span data-stu-id="c4a98-219">Interface Control Blocks</span></span>

<span data-ttu-id="c4a98-220">O número de blocos de controlo de interface na instância IP é o número de interfaces físicas (definidas por \***NX_MAX_PHYSICAL_INTERFACES** _) mais a interface loopback se estiver ativada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-220">The number of interface control blocks in the IP instance is the number of physical interfaces (defined by \***NX_MAX_PHYSICAL_INTERFACES** _) plus the loopback interface if it is enabled.</span></span> <span data-ttu-id="c4a98-221">O número total de interfaces é definido em _\*_NX_MAX_IP_INTERFACES_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-221">The total number of interfaces is defined in _\*_NX_MAX_IP_INTERFACES_\*\*.</span></span>

## <a name="protocol-layering"></a><span data-ttu-id="c4a98-222">Camada de protocolo</span><span class="sxs-lookup"><span data-stu-id="c4a98-222">Protocol Layering</span></span>

<span data-ttu-id="c4a98-223">O TCP/IP implementado pela NetX Duo é um protocolo em camadas, o que significa que protocolos mais complexos são construídos em cima de protocolos subjacentes mais simples.</span><span class="sxs-lookup"><span data-stu-id="c4a98-223">The TCP/IP implemented by NetX Duo is a layered protocol, which means more complex protocols are built on top of simpler underlying protocols.</span></span> <span data-ttu-id="c4a98-224">No TCP/IP, o protocolo de camada mais baixo está ao nível da *ligação* e é manuseado pelo controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-224">In TCP/IP, the lowest layer protocol is at the *link level* and is handled by the network driver.</span></span> <span data-ttu-id="c4a98-225">Este nível é tipicamente direcionado para Ethernet, mas também pode ser fibra, série ou praticamente qualquer meio físico.</span><span class="sxs-lookup"><span data-stu-id="c4a98-225">This level is typically targeted towards Ethernet, but it could also be fiber, serial, or virtually any physical media.</span></span>

<span data-ttu-id="c4a98-226">Em cima da camada de ligação está a *camada de rede.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-226">On top of the link layer is the *network layer*.</span></span> <span data-ttu-id="c4a98-227">Em TCP/IP, este é o IP, que é basicamente responsável por enviar e receber pacotes simples - de forma a melhor esforço - em toda a rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-227">In TCP/IP, this is the IP, which is basically responsible for sending and receiving simple packets—in a best-effort manner—across the network.</span></span> <span data-ttu-id="c4a98-228">Os protocolos de tipo de gestão como o ICMP e o IGMP são tipicamente também classificados como camadas de rede, mesmo que dependam de IP para envio e receção.</span><span class="sxs-lookup"><span data-stu-id="c4a98-228">Management-type protocols like ICMP and IGMP are typically also categorized as network layers, even though they rely on IP for sending and receiving.</span></span>

<span data-ttu-id="c4a98-229">A *camada de transporte* assenta em cima da camada de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-229">The *transport layer* rests on top of the network layer.</span></span> <span data-ttu-id="c4a98-230">Esta camada é responsável pela gestão do fluxo de dados entre os anfitriões na rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-230">This layer is responsible for managing the flow of data between hosts on the network.</span></span> <span data-ttu-id="c4a98-231">Existem dois tipos de serviços de transporte apoiados pela NetX Duo: UDP e TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-231">There are two types of transport services supported by NetX Duo: UDP and TCP.</span></span> <span data-ttu-id="c4a98-232">Os serviços da UDP fornecem o melhor esforço de envio e receção de dados entre dois anfitriões de forma sem ligação, enquanto a TCP fornece um serviço fiável orientado para a ligação entre duas entidades hospedeiras.</span><span class="sxs-lookup"><span data-stu-id="c4a98-232">UDP services provide best-effort sending and receiving of data between two hosts in a connectionless manner, while TCP provides reliable connection-oriented service between two host entities.</span></span>

<span data-ttu-id="c4a98-233">Esta camada reflete-se nos pacotes de dados de rede reais.</span><span class="sxs-lookup"><span data-stu-id="c4a98-233">This layering is reflected in the actual network data packets.</span></span> <span data-ttu-id="c4a98-234">Cada camada em TCP/IP contém um bloco de informação chamado cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="c4a98-234">Each layer in TCP/IP contains a block of information called a header.</span></span> <span data-ttu-id="c4a98-235">Esta técnica de dados circundantes (e possivelmente informações protocolares) com um cabeçalho é tipicamente chamada de encapsulamento de dados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-235">This technique of surrounding data (and possibly protocol information) with a header is typically called data encapsulation.</span></span> <span data-ttu-id="c4a98-236">A figura 1 mostra um exemplo de camadas netX Duo e a Figura 2 mostra o encapsulamento de dados resultante para os dados da UDP que estão a ser enviados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-236">Figure 1 shows an example of NetX Duo layering and Figure 2 shows the resulting data encapsulation for UDP data being sent.</span></span>

![Camada de protocolo](./media/user-guide/image12.jpg)

<span data-ttu-id="c4a98-238">**FIGURA 1. Camada de protocolo**</span><span class="sxs-lookup"><span data-stu-id="c4a98-238">**FIGURE 1. Protocol Layering**</span></span>

## <a name="packet-pools"></a><span data-ttu-id="c4a98-239">Piscinas de Pacotes</span><span class="sxs-lookup"><span data-stu-id="c4a98-239">Packet Pools</span></span>

<span data-ttu-id="c4a98-240">A atribuição de pacotes de forma rápida e determinística é sempre um desafio nas aplicações de networking em tempo real.</span><span class="sxs-lookup"><span data-stu-id="c4a98-240">Allocating packets in a fast and deterministic manner is always a challenge in real-time networking applications.</span></span> <span data-ttu-id="c4a98-241">Com isto em mente, o NetX Duo fornece a capacidade de criar e gerir várias piscinas de pacotes de rede de tamanho fixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-241">With this in mind, NetX Duo provides the ability to create and manage multiple pools of fixed-size network packets.</span></span>

<span data-ttu-id="c4a98-242">Como as piscinas de pacotes NetX Duo consistem em blocos de memória de tamanho fixo, nunca existem problemas internos de fragmentação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-242">Because NetX Duo packet pools consist of fixed-size memory blocks, there are never any internal fragmentation problems.</span></span> <span data-ttu-id="c4a98-243">Claro, a fragmentação causa comportamentos que não são inerentemente indeterminados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-243">Of course, fragmentation causes behavior that is inherently nondeterministic.</span></span> <span data-ttu-id="c4a98-244">Além disso, o tempo necessário para alocar e libertar um pacote NetX Duo equivale a uma simples manipulação de listas ligadas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-244">In addition, the time required to allocate and free a NetX Duo packet amounts to simple linked-list manipulation.</span></span> <span data-ttu-id="c4a98-245">Além disso, a atribuição de pacotes e alocação de acordos são feitas no chefe da lista disponível.</span><span class="sxs-lookup"><span data-stu-id="c4a98-245">Furthermore, packet allocation and deallocation is done at the head of the available list.</span></span> <span data-ttu-id="c4a98-246">Isto fornece o processamento de listas mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="c4a98-246">This provides the fastest possible linked list processing.</span></span>

![Encapsulamento de Dados da UDP](./media/user-guide/image13.png)

<span data-ttu-id="c4a98-248">**FIGURA 2. Encapsulamento de Dados da UDP**</span><span class="sxs-lookup"><span data-stu-id="c4a98-248">**FIGURE 2. UDP Data Encapsulation**</span></span>

<span data-ttu-id="c4a98-249">A falta de flexibilidade é tipicamente a principal desvantagem das piscinas de pacotes de tamanho fixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-249">Lack of flexibility is typically the main drawback of fixed-size packet pools.</span></span> <span data-ttu-id="c4a98-250">Determinar o tamanho ideal da carga útil do pacote que também lida com o pacote de entrada na pior das hipóteses é uma tarefa difícil.</span><span class="sxs-lookup"><span data-stu-id="c4a98-250">Determining the optimal packet payload size that also handles the worst-case incoming packet is a difficult task.</span></span> <span data-ttu-id="c4a98-251">Os pacotes NetX Duo abordam este problema com uma funcionalidade opcional chamada chaining de pacotes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-251">NetX Duo packets address this problem with an optional feature called packet chaining.</span></span> <span data-ttu-id="c4a98-252">Um pacote de rede real pode ser feito de um ou mais pacotes NetX Duo ligados entre si.</span><span class="sxs-lookup"><span data-stu-id="c4a98-252">An actual network packet can be made of one or more NetX Duo packets linked together.</span></span> <span data-ttu-id="c4a98-253">Além disso, o cabeçalho do pacote mantém um ponteiro para a parte superior do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-253">In addition, the packet header maintains a pointer to the top of the packet.</span></span> <span data-ttu-id="c4a98-254">À medida que os protocolos adicionais são adicionados, este ponteiro é simplesmente movido para trás e o novo cabeçalho é escrito diretamente na frente dos dados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-254">As additional protocols are added, this pointer is simply moved backwards and the new header is written directly in front of the data.</span></span> <span data-ttu-id="c4a98-255">Sem a tecnologia de pacote flexível, a pilha teria de alocar outro tampão e copiar os dados para um novo tampão com o novo cabeçalho, que está a processar intensivamente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-255">Without the flexible packet technology, the stack would have to allocate another buffer and copy the data into a new buffer with the new header, which is processing intensive.</span></span>

<span data-ttu-id="c4a98-256">Uma vez que cada tamanho de carga útil do pacote é fixado para um determinado pacote, os dados da aplicação maiores do que o tamanho da carga útil exigiriam vários pacotes acorrentados em conjunto.</span><span class="sxs-lookup"><span data-stu-id="c4a98-256">Since each packet payload size is fixed for a given packet pool, application data larger than the payload size would require multiple packets chained together.</span></span> <span data-ttu-id="c4a98-257">Ao preencher um pacote com dados do utilizador, a aplicação utilizará o serviço ***nx_packet_data_append***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-257">When filling a packet with user data, the application shall use the service ***nx_packet_data_append***.</span></span> <span data-ttu-id="c4a98-258">Este serviço move os dados da aplicação para um pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-258">This service moves application data into a packet.</span></span> <span data-ttu-id="c4a98-259">Em situações em que um pacote não é suficiente para guardar os dados dos utilizadores, os pacotes adicionais são atribuídos para armazenar dados do utilizador.</span><span class="sxs-lookup"><span data-stu-id="c4a98-259">In situations where a packet is not enough to hold user data, additional packets are allocated to store user data.</span></span> <span data-ttu-id="c4a98-260">Para utilizar acorrentado de pacotes, o condutor deve poder receber ou transmitir a partir de pacotes acorrentados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-260">To use packet chaining, the driver must be able to receive into or transmit from chained packets.</span></span>

<span data-ttu-id="c4a98-261">Para sistemas incorporados que não necessitam de utilizar a funcionalidade de acorrentamento de pacotes, a biblioteca NetX Duo pode ser construída com \***NX_DISABLE_PACKET_CHAIN** _ para remover a lógica de acorrentamento do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-261">For embedded systems that do not need to use the packet chaining feature, the NetX Duo library can be built with \***NX_DISABLE_PACKET_CHAIN** _ to remove the packet chaining logic.</span></span> <span data-ttu-id="c4a98-262">Note que a função de fragmentação e remontagem IP pode precisar de utilizar a função de pacote acorrentado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-262">Note that the IP fragmentation and reassembly feature may need to utilize the chained packet feature.</span></span> <span data-ttu-id="c4a98-263">Portanto, definir _*_NX_DISABLE_PACKET_CHAIN_*_ requer _ *_NX_DISABLE_FRAGMENTATION_*\* também ser definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-263">Therefore defining _*_NX_DISABLE_PACKET_CHAIN_*_ requires _ *_NX_DISABLE_FRAGMENTATION_*\* also be defined.</span></span> 

<span data-ttu-id="c4a98-264">Cada conjunto de memórias de pacotes NetX Duo é um recurso público.</span><span class="sxs-lookup"><span data-stu-id="c4a98-264">Each NetX Duo packet memory pool is a public resource.</span></span> <span data-ttu-id="c4a98-265">NetX Duo não coloca constrangimentos na forma como as piscinas de pacotes são usadas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-265">NetX Duo places no constraints on how packet pools are used.</span></span> 

### <a name="packet-pool-memory-area"></a><span data-ttu-id="c4a98-266">Área de memória da piscina de pacotes</span><span class="sxs-lookup"><span data-stu-id="c4a98-266">Packet Pool Memory Area</span></span>

<span data-ttu-id="c4a98-267">A área de memória para a piscina de pacotes é especificada durante a criação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-267">The memory area for the packet pool is specified during creation.</span></span> <span data-ttu-id="c4a98-268">Tal como outras áreas de memória para objetos ThreadX e NetX Duo, pode ser localizado em qualquer lugar do espaço de endereço do alvo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-268">Like other memory areas for ThreadX and NetX Duo objects, it can be located anywhere in the target's address space.</span></span> 

<span data-ttu-id="c4a98-269">Esta é uma característica importante devido à considerável flexibilidade que confere à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-269">This is an important feature because of the considerable flexibility it gives the application.</span></span> <span data-ttu-id="c4a98-270">Por exemplo, suponha que um produto de comunicação tem uma área de memória de alta velocidade para tampão de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-270">For example, suppose that a communication product has a high-speed memory area for network buffers.</span></span> <span data-ttu-id="c4a98-271">Esta área de memória é facilmente utilizada transformando-a num conjunto de memórias de pacotes NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-271">This memory area is easily utilized by making it into a NetX Duo packet memory pool.</span></span>

### <a name="creating-packet-pools"></a><span data-ttu-id="c4a98-272">Criação de piscinas de pacotes</span><span class="sxs-lookup"><span data-stu-id="c4a98-272">Creating Packet Pools</span></span>

<span data-ttu-id="c4a98-273">As piscinas de pacotes são criadas durante a inicialização ou durante o tempo de execução por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-273">Packet pools are created either during initialization or during runtime by  application threads.</span></span> <span data-ttu-id="c4a98-274">Não existem limites no número de piscinas de memória de pacotes numa aplicação NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-274">There are no limits on the number of packet memory pools in a NetX Duo application.</span></span>

### <a name="dual-packet-pool"></a><span data-ttu-id="c4a98-275">Piscina dual pacote</span><span class="sxs-lookup"><span data-stu-id="c4a98-275">Dual Packet Pool</span></span>

<span data-ttu-id="c4a98-276">Tipicamente, o tamanho da carga útil do pacote IP predefinido é grande o suficiente para acomodar o tamanho do quadro até à interface de rede MTU.</span><span class="sxs-lookup"><span data-stu-id="c4a98-276">Typically the payload size of the default IP packet pool is large enough to accommodate frame size up to the network interface MTU.</span></span> <span data-ttu-id="c4a98-277">Durante o funcionamento normal, o fio IP precisa de enviar mensagens como ARP, mensagens de controlo TCP, mensagens IGMP, mensagens ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-277">During normal operation, the IP thread needs to send messages such as ARP, TCP control messages, IGMP messages, ICMPv6 messages.</span></span> <span data-ttu-id="c4a98-278">Estas mensagens utilizam os pacotes atribuídos a partir do conjunto de pacotes predefinidos na instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-278">These messages use the packets allocated from the default packet pool in the IP instance.</span></span> <span data-ttu-id="c4a98-279">Num sistema limitado pela memória, onde a quantidade de memória disponível para o pool de pacotes é limitada, utilizando uma piscina de um único pacote (com o grande tamanho de carga útil para corresponder ao tamanho MTU) pode não ser uma solução ideal.</span><span class="sxs-lookup"><span data-stu-id="c4a98-279">On a memory-constrained system where the amount of memory available for packet pool is limited, using a single packet pool (with the large payload size to match MTU size) may not be an optimal solution.</span></span> <span data-ttu-id="c4a98-280">O NetX Duo permite a instalação de um conjunto auxiliar de pacotes, onde o tamanho da carga útil é menor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-280">NetX Duo allows application to install an auxiliary packet pool, where the payload size is smaller.</span></span> <span data-ttu-id="c4a98-281">Uma vez instalado o pacote auxiliar, o fio do ajudante IP destinaria pacotes da piscina de pacotes predefinidos ou da piscina auxiliar, dependendo do tamanho da mensagem que transmite.</span><span class="sxs-lookup"><span data-stu-id="c4a98-281">Once the auxiliary packet pool is installed, the IP helper thread would allocate packets from either the default packet pool or the auxiliary pool, depending on the size of the message it transmits.</span></span> <span data-ttu-id="c4a98-282">Para uma piscina de pacotes auxiliares, um tamanho de carga útil de 200 bytes funcionaria com a maioria das mensagens que o fio do ajudante IP transmite.</span><span class="sxs-lookup"><span data-stu-id="c4a98-282">For an auxiliary packet pool, a payload size of 200 bytes would work with most of the messages the IP helper thread transmits.</span></span>

<span data-ttu-id="c4a98-283">Por defeito, a biblioteca NetX Duo é construída sem permitir a piscina de pacotes duplos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-283">By default NetX Duo library is built without enabling dual packet pool.</span></span> <span data-ttu-id="c4a98-284">Para ativar a funcionalidade, construa a biblioteca com \***NX_DUAL_PACKET_POOL_ENABLE** _ definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-284">To enable the feature, build the library with \***NX_DUAL_PACKET_POOL_ENABLE** _ defined.</span></span> <span data-ttu-id="c4a98-285">Em seguida, a piscina de pacotes auxiliares pode ser definida chamando _\*_nx_ip_auxiliary_packet_pool_set_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-285">Then the auxiliary packet pool can be set by calling _\*_nx_ip_auxiliary_packet_pool_set_\*\*.</span></span>

<span data-ttu-id="c4a98-286">Há também a opção de criar mais de um pacote de piscina.</span><span class="sxs-lookup"><span data-stu-id="c4a98-286">There is also the option of creating more than one packet pool.</span></span> <span data-ttu-id="c4a98-287">Por exemplo, um conjunto de pacotes de transmissão é criado com o tamanho ideal da carga útil para tamanhos de mensagem esperados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-287">For example a transmit packet pool is created with optimal payload size for expected message sizes.</span></span> <span data-ttu-id="c4a98-288">Um pacote de receção é criado no condutor com um tamanho de carga útil definido para o condutor MTU, uma vez que não se pode prever o tamanho dos pacotes recebidos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-288">A receive packet pool is created in the driver with a payload size set to the driver MTU, since one cannot predict the size of received packets.</span></span>

### <a name="packet-header-nx_packet"></a><span data-ttu-id="c4a98-289">NX_PACKET cabeçalho do pacote</span><span class="sxs-lookup"><span data-stu-id="c4a98-289">Packet Header NX_PACKET</span></span>   
<span data-ttu-id="c4a98-290">Por predefinição, o NetX Duo coloca o cabeçalho do pacote imediatamente antes da área de carga do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-290">By default, NetX Duo places the packet header immediately before the packet payload area.</span></span> <span data-ttu-id="c4a98-291">O conjunto de memórias de pacotes é basicamente uma série de pacotes, cabeçalhos seguidos imediatamente pela carga útil do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-291">The packet memory pool is basically a series of packets— headers followed immediately by the packet payload.</span></span> <span data-ttu-id="c4a98-292">O cabeçalho do pacote ***(NX_PACKET)*** e o layout da piscina do pacote estão representados na Figura 3.</span><span class="sxs-lookup"><span data-stu-id="c4a98-292">The packet header (***NX_PACKET***) and the layout of the packet pool are pictured in Figure 3.</span></span>

<span data-ttu-id="c4a98-293">Para o controlador de dispositivos de rede que seja capaz de realizar operações de cópia zero, normalmente o endereço inicial da área de carga útil do pacote está programado na lógica DMA.</span><span class="sxs-lookup"><span data-stu-id="c4a98-293">For network devices driver that are able to perform zero copy operations, typically the starting address of the packet payload area is programmed into the DMA logic.</span></span> <span data-ttu-id="c4a98-294">Certos motores DMA têm requisitos de alinhamento na área de carga útil.</span><span class="sxs-lookup"><span data-stu-id="c4a98-294">Certain DMA engines have alignment requirement on the payload area.</span></span> <span data-ttu-id="c4a98-295">Para que o endereço de partida da área de carga se alinhe corretamente para o motor DMA ou para o funcionamento da cache, o utilizador pode definir o símbolo ***NX_PACKET_ALIGNMENT***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-295">To make the starting address of the payload area align properly for the DMA engine, or the cache operation, the user can define the symbol ***NX_PACKET_ALIGNMENT***.</span></span>

> [!WARNING]
> <span data-ttu-id="c4a98-296">*É importante que o controlador de rede utilize a função **nx_packet_transmit_release** quando a transmissão de um pacote estiver concluída. Esta função verifica se o pacote não faz parte de uma fila de saída TCP antes de ser realmente colocado de volta na piscina disponível.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-296">*It is important for the network driver to use the **nx_packet_transmit_release** function when transmission of a packet is complete. This function checks to make sure the packet is not part of a TCP output queue before it is actually placed back in the available pool.*</span></span>

![Cabeçalho de pacote e layout de piscina de pacote](./media/user-guide/image14.jpg)

<span data-ttu-id="c4a98-298">**FIGURA 3. Cabeçalho de pacote e layout de piscina de pacote**</span><span class="sxs-lookup"><span data-stu-id="c4a98-298">**FIGURE 3. Packet Header and Packet Pool Layout**</span></span>

<span data-ttu-id="c4a98-299">Os campos do cabeçalho do pacote são definidos da seguinte forma.</span><span class="sxs-lookup"><span data-stu-id="c4a98-299">The fields of the packet header are defined as follows.</span></span> <span data-ttu-id="c4a98-300">Note que esta tabela não é uma lista completa de todos os membros da estrutura *NX_PACKET.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-300">Note that this table is not a comprehensive list of all the members in the *NX_PACKET* structure.</span></span>

|<span data-ttu-id="c4a98-301">Cabeçalho de pacote</span><span class="sxs-lookup"><span data-stu-id="c4a98-301">Packet header</span></span> | <span data-ttu-id="c4a98-302">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-302">Purpose</span></span> |
|---|---|
|<span data-ttu-id="c4a98-303">***nx_packet_pool_owner***</span><span class="sxs-lookup"><span data-stu-id="c4a98-303">***nx_packet_pool_owner***</span></span>|<span data-ttu-id="c4a98-304">Este campo aponta para a piscina de pacotes que detém este pacote em particular.</span><span class="sxs-lookup"><span data-stu-id="c4a98-304">This field points to the packet pool that owns this particular packet.</span></span> <span data-ttu-id="c4a98-305">Quando o pacote é lançado, é libertado para esta piscina em particular.</span><span class="sxs-lookup"><span data-stu-id="c4a98-305">When the packet is released, it is released to this particular pool.</span></span> <span data-ttu-id="c4a98-306">Com a propriedade da piscina dentro de cada pacote, é possível que um datagrama abra por vários pacotes de várias piscinas de pacotes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-306">With the pool ownership inside each packet, it is possible for a datagram to span multiple packets from multiple packet pools.</span></span>|
|<span data-ttu-id="c4a98-307">\***nx_packet_next**</span><span class="sxs-lookup"><span data-stu-id="c4a98-307">\***nx_packet_next** _</span></span>|<span data-ttu-id="c4a98-308">Este campo aponta para o próximo pacote dentro do mesmo quadro.</span><span class="sxs-lookup"><span data-stu-id="c4a98-308">This field points to the next packet within the same frame.</span></span> <span data-ttu-id="c4a98-309">Se o NU, não existem pacotes adicionais que fazem parte da moldura.</span><span class="sxs-lookup"><span data-stu-id="c4a98-309">If NULL, there are no additional packets that are part of the frame.</span></span> <span data-ttu-id="c4a98-310">Este campo também é utilizado para conter pacotes fragmentados até que todo o pacote possa ser remontado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-310">This field is also used to hold fragmented packets until the entire packet can be re-assembled.</span></span> <span data-ttu-id="c4a98-311">é removido se _\*_NX_DISABLE_PACKET_CHAIN_\*\*é definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-311">it is removed if _\*_NX_DISABLE_PACKET_CHAIN_\*\*is defined.</span></span>|
|<span data-ttu-id="c4a98-312">\***nx_packet_last**</span><span class="sxs-lookup"><span data-stu-id="c4a98-312">\***nx_packet_last** _</span></span>|<span data-ttu-id="c4a98-313">Este campo aponta para o último pacote dentro do mesmo pacote de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-313">This field points to the last packet within the same network packet.</span></span> <span data-ttu-id="c4a98-314">Se o NU, este pacote representa todo o pacote de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-314">If NULL, this packet represents the entire network packet.</span></span> <span data-ttu-id="c4a98-315">Este campo é removido se _\*_NX_DISABLE_PACKET_CHAIN_\*\*é definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-315">This field is removed if _\*_NX_DISABLE_PACKET_CHAIN_\*\*is defined.</span></span>|
|<span data-ttu-id="c4a98-316">\***nx_packet_length** _</span><span class="sxs-lookup"><span data-stu-id="c4a98-316">\***nx_packet_length** _</span></span>| <span data-ttu-id="c4a98-317">Este campo contém o número total de bytes em todo o pacote de rede, incluindo o total de todos os bytes em todos os pacotes acorrentados pelo membro _nx_packet_next\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-317">This field contains the total number of bytes in the entire network packet, including the total of all bytes in all packets chained together by the _nx_packet_next\*member.</span></span>|
|<span data-ttu-id="c4a98-318">***nx_packet_ip_interface***</span><span class="sxs-lookup"><span data-stu-id="c4a98-318">***nx_packet_ip_interface***</span></span>| <span data-ttu-id="c4a98-319">Este campo é o bloco de controlo de interface que é atribuído ao pacote quando é recebido pelo controlador de interface, e pela NetX Duo para pacotes de saída.</span><span class="sxs-lookup"><span data-stu-id="c4a98-319">This field is the interface control block which is assigned to the packet when it is received by the interface driver, and by NetX Duo for outgoing packets.</span></span> <span data-ttu-id="c4a98-320">Um bloco de controlo de interface descreve a interface, por exemplo, endereço de rede, endereço MAC, endereço IP e estado de interface, como ligação ativada e mapeamento físico necessário.</span><span class="sxs-lookup"><span data-stu-id="c4a98-320">An interface control block describes the interface e.g. network address, MAC address, IP address and interface status such as link enabled and physical mapping required.</span></span>|
|<span data-ttu-id="c4a98-321">\***nx_packet_data_start**</span><span class="sxs-lookup"><span data-stu-id="c4a98-321">\***nx_packet_data_start** _</span></span>| <span data-ttu-id="c4a98-322">Este campo aponta para o início da área de carga física deste pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-322">This field points to the start of the physical payload area of this packet.</span></span> <span data-ttu-id="c4a98-323">Não tem de ser imediatamente após o cabeçalho NX_PACKET, mas este é o padrão para o serviço _ *_nx_packet_pool_create*_\*</span><span class="sxs-lookup"><span data-stu-id="c4a98-323">It does not have to be immediately following the NX_PACKET header, but that is the default for the _ *_nx_packet_pool_create_*\* service.</span></span>|
|<span data-ttu-id="c4a98-324">\***nx_packet_data_end**</span><span class="sxs-lookup"><span data-stu-id="c4a98-324">\***nx_packet_data_end** _</span></span>|<span data-ttu-id="c4a98-325">Este campo aponta para o fim da área de carga física deste pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-325">This field points to the end of the physical payload area of this packet.</span></span> <span data-ttu-id="c4a98-326">A diferença entre este campo e o campo _nx_packet_data_start\* representa o tamanho da carga útil.</span><span class="sxs-lookup"><span data-stu-id="c4a98-326">The difference between this field and the _nx_packet_data_start\* field represents the payload size.</span></span>|
|<span data-ttu-id="c4a98-327">\***nx_packet_prepend_ptr** _</span><span class="sxs-lookup"><span data-stu-id="c4a98-327">\***nx_packet_prepend_ptr** _</span></span>|<span data-ttu-id="c4a98-328">Este campo aponta para a localização de onde os dados do pacote, quer o cabeçalho do protocolo, quer os dados reais, são adicionados à frente dos dados do pacote existentes (se houver) na área de carga útil do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-328">This field points to the location of where packet data, either protocol header or actual data, is added in front of the existing packet data (if any) in the packet payload area.</span></span> <span data-ttu-id="c4a98-329">Deve ser maior ou igual à localização do ponteiro _nx_packet_data_start\* e inferior ou igual ao *ponteiro nx_packet_append_ptr.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-329">It must be greater than or equal to the _nx_packet_data_start\* pointer location and less than or equal to the *nx_packet_append_ptr* pointer.</span></span>|
> [!CAUTION]
> <span data-ttu-id="c4a98-330">*Por razões de desempenho, a NetX Duo assume que quando o pacote é passado para os serviços NetX Duo para transmissão, o ponteiro pré-end aponta para um endereço alinhado com palavras longas.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-330">*For performance reasons, NetX Duo assumes that when the packet is passed into NetX Duo services for transmission, the prepend pointer points to long word aligned address.*</span></span>

| <span data-ttu-id="c4a98-331">Cabeçalho de pacote</span><span class="sxs-lookup"><span data-stu-id="c4a98-331">Packet header</span></span> | <span data-ttu-id="c4a98-332">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-332">Purpose</span></span> |
|---|---|
|<span data-ttu-id="c4a98-333">\***nx_packet_append_ptr**</span><span class="sxs-lookup"><span data-stu-id="c4a98-333">\***nx_packet_append_ptr** _</span></span>|<span data-ttu-id="c4a98-334">Este campo aponta para o fim dos dados atualmente na área de carga útil do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-334">This field points to the end of the data currently in the packet payload area.</span></span> <span data-ttu-id="c4a98-335">Deve estar entre o local da memória apontado por _nx_packet_prepend_ptr\* e *nx_packet_data_end.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-335">It must be in between the memory location pointed to by _nx_packet_prepend_ptr\* and *nx_packet_data_end.*</span></span> <span data-ttu-id="c4a98-336">A diferença entre este campo e o campo *nx_packet_prepend_ptr* representa a quantidade de dados neste pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-336">The difference between this field and the *nx_packet_prepend_ptr* field represents the amount of data in this packet.</span></span>|
|<span data-ttu-id="c4a98-337">\***nx_packet_packet_pad**</span><span class="sxs-lookup"><span data-stu-id="c4a98-337">\***nx_packet_packet_pad** _</span></span>|<span data-ttu-id="c4a98-338">Estes campos definem o comprimento do acolchoamento em 4 bytes para alcançar o requisito de alinhamento desejado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-338">This fields defines the length of padding in 4-byte words to achieve the desired alignment requirement.</span></span> <span data-ttu-id="c4a98-339">Este campo é removido se _*_NX_PACKET_HEADER_PAD_*_ não estiver definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-339">This field is removed if _*_NX_PACKET_HEADER_PAD_*_ is not defined.</span></span> <span data-ttu-id="c4a98-340">_*_Alternativamente, NX_PACKET_ALIGNMENT_*_ pode ser usado em vez de definir _nx_packet_header_pad.\*</span><span class="sxs-lookup"><span data-stu-id="c4a98-340">Alternatively _*_NX_PACKET_ALIGNMENT_*_ can be used instead of defining _nx_packet_header_pad.\*</span></span>|

### <a name="packet-header-offsets"></a><span data-ttu-id="c4a98-341">Compensações do cabeçalho do pacote</span><span class="sxs-lookup"><span data-stu-id="c4a98-341">Packet Header Offsets</span></span>

<span data-ttu-id="c4a98-342">O tamanho do cabeçalho do pacote é definido para permitir espaço suficiente para acomodar o tamanho do cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="c4a98-342">Packet header size is defined to allow enough room  to accommodate the size of the header.</span></span> <span data-ttu-id="c4a98-343">O serviço ***nx_packet_allocate*** é utilizado para alocar um pacote e ajusta o ponteiro pré-final no pacote de acordo com o tipo de pacote especificado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-343">The ***nx_packet_allocate*** service is used to allocate a packet and adjusts the prepend pointer in the packet according to the type of packet specified.</span></span> <span data-ttu-id="c4a98-344">O tipo de pacote diz ao NetX Duo a compensação necessária para inserir o cabeçalho do protocolo (como UDP, TCP ou ICMP) em frente aos dados do protocolo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-344">The packet type tells NetX Duo the offset required for inserting the protocol header (such as UDP, TCP, or ICMP) in front of the protocol data.</span></span>

<span data-ttu-id="c4a98-345">Os seguintes tipos são definidos no NetX Duo para ter em conta o cabeçalho IP e a camada física (Ethernet) no pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-345">The following types are defined in NetX Duo to take into account the IP header and physical layer (Ethernet) header in the packet.</span></span> <span data-ttu-id="c4a98-346">Neste último caso, presume-se que sejam 16 bytes tendo em consideração o alinhamento de 4 bytes necessário.</span><span class="sxs-lookup"><span data-stu-id="c4a98-346">In the latter case, it is assumed to be 16 bytes taking the required 4-byte alignment into consideration.</span></span> <span data-ttu-id="c4a98-347">Os pacotes IPv4 ainda estão definidos no NetX Duo para aplicações para alocar pacotes para redes IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-347">IPv4 packets are still defined in NetX Duo for applications to allocate packets for IPv4 networks.</span></span> <span data-ttu-id="c4a98-348">Note que se a biblioteca NetX Duo for construída com iPv6 ativado, os tipos de pacotes genéricos (como NX_IP_PACKET) são mapeados para a versão IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-348">Note that if the NetX Duo library is built with IPv6 enabled, the generic packet types (such as NX_IP_PACKET) are mapped to the IPv6 version.</span></span> <span data-ttu-id="c4a98-349">Se a Biblioteca NetX Duo for construída sem iPv6 ativada, estes tipos genéricos de pacotes são mapeados para a versão IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-349">If the NetX Duo Library is built without IPv6 enabled, these generic packet types are mapped to the IPv4 version.</span></span>

<span data-ttu-id="c4a98-350">A tabela a seguir mostra símbolos definidos com IPv6 ativado:</span><span class="sxs-lookup"><span data-stu-id="c4a98-350">The following table shows symbols defined with IPv6 enabled:</span></span>

|<span data-ttu-id="c4a98-351">**Tipo de pacote**</span><span class="sxs-lookup"><span data-stu-id="c4a98-351">**Packet Type**</span></span> |<span data-ttu-id="c4a98-352">**Valor**</span><span class="sxs-lookup"><span data-stu-id="c4a98-352">**Value**</span></span> |
|---|---|
|<span data-ttu-id="c4a98-353">NX_IPv6_PACKET (NX_IP_PACKET)</span><span class="sxs-lookup"><span data-stu-id="c4a98-353">NX_IPv6_PACKET (NX_IP_PACKET)</span></span> | <span data-ttu-id="c4a98-354">0x38</span><span class="sxs-lookup"><span data-stu-id="c4a98-354">0x38</span></span> |
|<span data-ttu-id="c4a98-355">NX_UDPv6_PACKET (NX_UDP_PACKET)</span><span class="sxs-lookup"><span data-stu-id="c4a98-355">NX_UDPv6_PACKET (NX_UDP_PACKET)</span></span> |<span data-ttu-id="c4a98-356">0x40</span><span class="sxs-lookup"><span data-stu-id="c4a98-356">0x40</span></span> |
|<span data-ttu-id="c4a98-357">NX_TCPv6_PACKET (NX_TCP_PACKET)</span><span class="sxs-lookup"><span data-stu-id="c4a98-357">NX_TCPv6_PACKET (NX_TCP_PACKET)</span></span> |<span data-ttu-id="c4a98-358">0x4c</span><span class="sxs-lookup"><span data-stu-id="c4a98-358">0x4c</span></span> |
|<span data-ttu-id="c4a98-359">NX_IPv4_PACKET</span><span class="sxs-lookup"><span data-stu-id="c4a98-359">NX_IPv4_PACKET</span></span> |<span data-ttu-id="c4a98-360">0x24</span><span class="sxs-lookup"><span data-stu-id="c4a98-360">0x24</span></span> |
|<span data-ttu-id="c4a98-361">NX_IPv4_UDP_PACKET</span><span class="sxs-lookup"><span data-stu-id="c4a98-361">NX_IPv4_UDP_PACKET</span></span> |<span data-ttu-id="c4a98-362">0x2c</span><span class="sxs-lookup"><span data-stu-id="c4a98-362">0x2c</span></span> |
|<span data-ttu-id="c4a98-363">NX_IPv4_TCP_PACKET</span><span class="sxs-lookup"><span data-stu-id="c4a98-363">NX_IPv4_TCP_PACKET</span></span> |<span data-ttu-id="c4a98-364">0x38</span><span class="sxs-lookup"><span data-stu-id="c4a98-364">0x38</span></span> |

<span data-ttu-id="c4a98-365">A tabela a seguir mostra símbolos definidos com IPv6 desativado:</span><span class="sxs-lookup"><span data-stu-id="c4a98-365">The following table shows symbols defined with IPv6 disabled:</span></span>

|<span data-ttu-id="c4a98-366">**Tipo de pacote**</span><span class="sxs-lookup"><span data-stu-id="c4a98-366">**Packet Type**</span></span> |<span data-ttu-id="c4a98-367">**Valor**</span><span class="sxs-lookup"><span data-stu-id="c4a98-367">**Value**</span></span> |
|---|---|
|<span data-ttu-id="c4a98-368">NX_IPv4_PACKET (NX_IP_PACKET)</span><span class="sxs-lookup"><span data-stu-id="c4a98-368">NX_IPv4_PACKET (NX_IP_PACKET)</span></span> |<span data-ttu-id="c4a98-369">0x24</span><span class="sxs-lookup"><span data-stu-id="c4a98-369">0x24</span></span> |
|<span data-ttu-id="c4a98-370">NX_IPv4_UDP_PACKET (NX_UDP_PACKET)</span><span class="sxs-lookup"><span data-stu-id="c4a98-370">NX_IPv4_UDP_PACKET (NX_UDP_PACKET)</span></span> |<span data-ttu-id="c4a98-371">0x2c</span><span class="sxs-lookup"><span data-stu-id="c4a98-371">0x2c</span></span> |
|<span data-ttu-id="c4a98-372">NX_IPv4_TCP_PACKET (NX_TCP_PACKET)</span><span class="sxs-lookup"><span data-stu-id="c4a98-372">NX_IPv4_TCP_PACKET (NX_TCP_PACKET)</span></span> |<span data-ttu-id="c4a98-373">0x38</span><span class="sxs-lookup"><span data-stu-id="c4a98-373">0x38</span></span> |

<span data-ttu-id="c4a98-374">Note que estes valores mudarão se *NX_IPSEC_ENABLE* for definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-374">Note that these values will change if *NX_IPSEC_ENABLE* is defined.</span></span> <span data-ttu-id="c4a98-375">Para obter a aplicação utilizando o IPsec, consulte o Guia do Utilizador NetX Duo IPsec para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="c4a98-375">For application using IPsec, refer to NetX Duo IPsec User Guide for more information.</span></span>

### <a name="pool-capacity"></a><span data-ttu-id="c4a98-376">Capacidade da Piscina</span><span class="sxs-lookup"><span data-stu-id="c4a98-376">Pool Capacity</span></span>

<span data-ttu-id="c4a98-377">O número de pacotes numa piscina de pacotes é uma função do tamanho da carga útil e do número total de bytes na área de memória fornecida à piscina de pacotes criar serviço.</span><span class="sxs-lookup"><span data-stu-id="c4a98-377">The number of packets in a packet pool is a function of the payload size and the total number of bytes in the memory area supplied to the packet pool create service.</span></span> <span data-ttu-id="c4a98-378">A capacidade da piscina é calculada dividindo o tamanho do pacote (incluindo o tamanho do cabeçalho NX_PACKET, o tamanho da carga útil e o alinhamento adequado) no número total de bytes na área de memória fornecida.</span><span class="sxs-lookup"><span data-stu-id="c4a98-378">The capacity of the pool is calculated by dividing the packet size (including the size of the NX_PACKET header, the payload size, and proper alignment) into the total number of bytes in the supplied memory area.</span></span>

### <a name="payload-area-alignment"></a><span data-ttu-id="c4a98-379">Alinhamento da área de carga útil</span><span class="sxs-lookup"><span data-stu-id="c4a98-379">Payload Area Alignment</span></span>

<span data-ttu-id="c4a98-380">O design da piscina de pacotes no NetX Duo suporta cópia zero.</span><span class="sxs-lookup"><span data-stu-id="c4a98-380">Packet pool design in NetX Duo supports zero-copy.</span></span> <span data-ttu-id="c4a98-381">Ao nível do controlador do dispositivo, o controlador é capaz de atribuir a área de carga útil diretamente aos descritores tampão para a receção de dados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-381">At the device driver level, the driver is able to assign the payload area directly into buffer descriptors for data reception.</span></span> <span data-ttu-id="c4a98-382">Por vezes, o motor DMA ou o mecanismo de sincronização de cache requerem que o endereço de partida da área de carga útil tenha um determinado requisito de alinhamento.</span><span class="sxs-lookup"><span data-stu-id="c4a98-382">Sometimes the DMA engine or the cache synchronization mechanism requires the starting address of the payload area to have a certain alignment requirement.</span></span> <span data-ttu-id="c4a98-383">Isto pode ser conseguido definindo o requisito de alinhamento desejado (in bytes) em ***NX_PACKET_ALIGNMENT***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-383">This can be achieved by defining the desired alignment requirement (in bytes) in ***NX_PACKET_ALIGNMENT***.</span></span> <span data-ttu-id="c4a98-384">Ao criar uma piscina de pacotes, o endereço inicial da área de carga útil irá alinhar-se a este valor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-384">When creating a packet pool, the starting address of the payload area will aligned to this value.</span></span> <span data-ttu-id="c4a98-385">Por predefinição, o endereço inicial está alinhado com 4 bytes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-385">By default, starting address is 4-byte aligned.</span></span>

### <a name="thread-suspension"></a><span data-ttu-id="c4a98-386">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="c4a98-386">Thread Suspension</span></span>

<span data-ttu-id="c4a98-387">Os fios de aplicação podem suspender enquanto esperam por um pacote de uma piscina vazia.</span><span class="sxs-lookup"><span data-stu-id="c4a98-387">Application threads can suspend while waiting for a packet from an empty pool.</span></span> <span data-ttu-id="c4a98-388">Quando um pacote é devolvido à piscina, o fio suspenso é dado este pacote e retomado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-388">When a packet is returned to the pool, the suspended thread is given this packet and resumed.</span></span>

<span data-ttu-id="c4a98-389">Se várias linhas forem suspensas na mesma piscina de pacotes, elas retomadas na ordem em que foram suspensas (FIFO).</span><span class="sxs-lookup"><span data-stu-id="c4a98-389">If multiple threads are suspended on the same packet pool, they  resumed in the order they were suspended (FIFO).</span></span>

### <a name="pool-statistics-and-errors"></a><span data-ttu-id="c4a98-390">Estatísticas e erros da piscina</span><span class="sxs-lookup"><span data-stu-id="c4a98-390">Pool Statistics and Errors</span></span>

<span data-ttu-id="c4a98-391">Se ativado, o software de gestão de pacotes NetX Duo acompanha várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-391">If enabled, the NetX Duo packet management software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-392">São mantidas as seguintes estatísticas e relatórios de erro para os pools de pacotes:</span><span class="sxs-lookup"><span data-stu-id="c4a98-392">The following statistics and error reports are maintained for packet pools:</span></span>

- <span data-ttu-id="c4a98-393">Pacotes totais em piscina</span><span class="sxs-lookup"><span data-stu-id="c4a98-393">Total Packets in Pool</span></span>
- <span data-ttu-id="c4a98-394">Pacotes gratuitos na piscina</span><span class="sxs-lookup"><span data-stu-id="c4a98-394">Free Packets in Pool</span></span>
- <span data-ttu-id="c4a98-395">Total de dotações de pacotes</span><span class="sxs-lookup"><span data-stu-id="c4a98-395">Total Packet Allocations</span></span>
- <span data-ttu-id="c4a98-396">Pedidos de atribuição vazios da piscina</span><span class="sxs-lookup"><span data-stu-id="c4a98-396">Pool Empty Allocation Requests</span></span>
- <span data-ttu-id="c4a98-397">Suspensões de atribuição vazias da piscina</span><span class="sxs-lookup"><span data-stu-id="c4a98-397">Pool Empty Allocation Suspensions</span></span>
- <span data-ttu-id="c4a98-398">Lançamentos de pacotes inválidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-398">Invalid Packet Releases</span></span>

<span data-ttu-id="c4a98-399">Todas estas estatísticas e relatórios de erro, com exceção da contagem total e gratuita de pacotes na piscina, são incorporados na biblioteca NetX Duo, a menos que \***NX_DISABLE_PACKET_INFO** _ seja definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-399">All of these statistics and error reports, except for total and free packet count in pool, are built into NetX Duo library unless \***NX_DISABLE_PACKET_INFO** _ is defined.</span></span> <span data-ttu-id="c4a98-400">Estes dados estão disponíveis para a aplicação com o serviço _ *_nx_packet_pool_info_get*_\*</span><span class="sxs-lookup"><span data-stu-id="c4a98-400">This data is available to the application with the _ *_nx_packet_pool_info_get_*\* service.</span></span>

### <a name="packet-pool-control-block-nx_packet_pool"></a><span data-ttu-id="c4a98-401">Bloco de controlo de piscina de pacote NX_PACKET_POOL</span><span class="sxs-lookup"><span data-stu-id="c4a98-401">Packet Pool Control Block NX_PACKET_POOL</span></span>

<span data-ttu-id="c4a98-402">As características de cada conjunto de memória de pacotes encontram-se no seu bloco de controlo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-402">The characteristics of each packet memory pool are found in its control block.</span></span> <span data-ttu-id="c4a98-403">Contém informações úteis, tais como a lista ligada de pacotes gratuitos, o número de pacotes gratuitos e o tamanho da carga útil para pacotes nesta piscina.</span><span class="sxs-lookup"><span data-stu-id="c4a98-403">It contains useful information such as the linked list of free packets, the number of free packets, and the payload size for packets in this pool.</span></span> <span data-ttu-id="c4a98-404">Esta estrutura é definida no ficheiro ***nx_api.h.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-404">This structure is defined in the ***nx_api.h*** file.</span></span>

<span data-ttu-id="c4a98-405">Os blocos de controlo da piscina de pacote podem ser localizados em qualquer lugar da memória, mas é mais comum fazer do bloco de controlo uma estrutura global definindo-o fora do âmbito de qualquer função.</span><span class="sxs-lookup"><span data-stu-id="c4a98-405">Packet pool control blocks can be located anywhere in memory, but it is most common to make the control block a global structure by defining it outside the scope of any function.</span></span>

## <a name="ipv4-protocol"></a><span data-ttu-id="c4a98-406">Protocolo IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-406">IPv4 Protocol</span></span>

<span data-ttu-id="c4a98-407">O componente de Protocolo de Internet (IP) da NetX Duo é responsável pelo envio e receção de pacotes IPv4 na Internet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-407">The Internet Protocol (IP) component of NetX Duo is responsible for sending and receiving IPv4 packets on the Internet.</span></span> <span data-ttu-id="c4a98-408">No NetX Duo, é o componente em última instância responsável pelo envio e receção de mensagens TCP, UDP, ICMP e IGMP, utilizando o controlador de rede subjacente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-408">In NetX Duo, it is the component ultimately responsible for sending and receiving TCP, UDP, ICMP, and IGMP messages, utilizing the underlying network driver.</span></span>

<span data-ttu-id="c4a98-409">NetX Duo suporta o protocolo IPv4 (RFC 791) e o protocolo IPv6 (RFC 2460).</span><span class="sxs-lookup"><span data-stu-id="c4a98-409">NetX Duo supports both IPv4 protocol (RFC 791) and IPv6 protocol (RFC 2460).</span></span> <span data-ttu-id="c4a98-410">Esta secção discute o IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-410">This section discusses IPv4.</span></span> <span data-ttu-id="c4a98-411">O IPv6 é discutido na próxima secção.</span><span class="sxs-lookup"><span data-stu-id="c4a98-411">IPv6 is discussed in the next section.</span></span>

### <a name="ipv4-addresses"></a><span data-ttu-id="c4a98-412">Endereços IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-412">IPv4 Addresses</span></span>

<span data-ttu-id="c4a98-413">Cada anfitrião na Internet tem um identificador único de 32 bits chamado endereço IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-413">Each host on the Internet has a unique 32-bit identifier called an IP address.</span></span> <span data-ttu-id="c4a98-414">Existem cinco classes de endereços IPv4, conforme descrito na Figura 4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-414">There are five classes of IPv4 addresses as described in Figure 4.</span></span> <span data-ttu-id="c4a98-415">As gamas das cinco classes de endereços IPv4 são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="c4a98-415">The ranges of the five IPv4 address classes are as follows:</span></span>

|<span data-ttu-id="c4a98-416">Classe</span><span class="sxs-lookup"><span data-stu-id="c4a98-416">Class</span></span>|<span data-ttu-id="c4a98-417">Intervalo</span><span class="sxs-lookup"><span data-stu-id="c4a98-417">Range</span></span>|
|---|---|
|<span data-ttu-id="c4a98-418">A</span><span class="sxs-lookup"><span data-stu-id="c4a98-418">A</span></span> |<span data-ttu-id="c4a98-419">0.0.0.0 para 127.255.255.255</span><span class="sxs-lookup"><span data-stu-id="c4a98-419">0.0.0.0 to 127.255.255.255</span></span>|
|<span data-ttu-id="c4a98-420">B</span><span class="sxs-lookup"><span data-stu-id="c4a98-420">B</span></span> |<span data-ttu-id="c4a98-421">128.0.0.0 para 191.255.255.255</span><span class="sxs-lookup"><span data-stu-id="c4a98-421">128.0.0.0 to 191.255.255.255</span></span>|
|<span data-ttu-id="c4a98-422">C</span><span class="sxs-lookup"><span data-stu-id="c4a98-422">C</span></span> |<span data-ttu-id="c4a98-423">192.0.0.0 para 223.255.255.255</span><span class="sxs-lookup"><span data-stu-id="c4a98-423">192.0.0.0 to 223.255.255.255</span></span>|
|<span data-ttu-id="c4a98-424">D</span><span class="sxs-lookup"><span data-stu-id="c4a98-424">D</span></span> |<span data-ttu-id="c4a98-425">224.0.0.0 para 239.255.255.255</span><span class="sxs-lookup"><span data-stu-id="c4a98-425">224.0.0.0 to 239.255.255.255</span></span>|
|<span data-ttu-id="c4a98-426">E</span><span class="sxs-lookup"><span data-stu-id="c4a98-426">E</span></span> |<span data-ttu-id="c4a98-427">240.0.0.0 para 247.255.255.255</span><span class="sxs-lookup"><span data-stu-id="c4a98-427">240.0.0.0 to 247.255.255.255</span></span>|

![Diagrama da Estrutura de Endereços IPv4.](./media/user-guide/ipv4-address-structure.png)

### <a name="figure-4-ipv4-address-structure"></a><span data-ttu-id="c4a98-429">FIGURA 4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-429">FIGURE 4.</span></span> <span data-ttu-id="c4a98-430">Estrutura de endereços IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-430">IPv4 Address Structure</span></span>

<span data-ttu-id="c4a98-431">Existem também três tipos de especificações de endereços: *unicast,* *transmissão* e *multicast.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-431">There are also three types of address specifications: *unicast*, *broadcast*, and *multicast*.</span></span> <span data-ttu-id="c4a98-432">Os endereços unicast são os endereços IPv4 que identificam um anfitrião específico na Internet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-432">Unicast addresses are those IPv4 addresses that identify a specific host on the Internet.</span></span> <span data-ttu-id="c4a98-433">Os endereços Unicast podem ser uma fonte ou um endereço IPv4 de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-433">Unicast addresses can be either a source or a destination IPv4 address.</span></span> <span data-ttu-id="c4a98-434">Um endereço de transmissão identifica todos os anfitriões numa rede ou sub-rede específica e só pode ser usado como endereços de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-434">A broadcast address identifies all hosts on a specific network or sub-network and can only be used as destination addresses.</span></span> <span data-ttu-id="c4a98-435">Os endereços de transmissão são especificados tendo a parte de identificação do anfitrião do endereço definida para os outros.</span><span class="sxs-lookup"><span data-stu-id="c4a98-435">Broadcast addresses are specified by having the host ID portion of the address set to ones.</span></span> <span data-ttu-id="c4a98-436">Endereços multicast (Classe D) especificam um grupo dinâmico de anfitriões na Internet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-436">Multicast addresses (Class D) specify a dynamic group of hosts on the Internet.</span></span> <span data-ttu-id="c4a98-437">Os membros do grupo multicast podem juntar-se e sair quando quiserem.</span><span class="sxs-lookup"><span data-stu-id="c4a98-437">Members of the multicast group may join and leave whenever they wish.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-438">*Apenas protocolos sem ligação como o UDP sobre o IPv4 podem utilizar a transmissão e a capacidade de transmissão limitada do grupo multicast.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-438">*Only connectionless protocols like UDP over IPv4 can utilize broadcast and the limited broadcast capability of the multicast group.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-439">\*O *IP_ADDRESS* macro é definido em \***nx_api.h** _.</span><span class="sxs-lookup"><span data-stu-id="c4a98-439">\*The macro *IP_ADDRESS* is defined in \***nx_api.h** _.</span></span> <span data-ttu-id="c4a98-440">Permite uma especificação fácil dos endereços IPv4 utilizando vírgulas em vez de um período.</span><span class="sxs-lookup"><span data-stu-id="c4a98-440">It allows easy specification of IPv4 addresses using commas instead of a periods.</span></span> <span data-ttu-id="c4a98-441">Por exemplo, _IP_ADDRESS (128,0,0,0)\* especifica o endereço da primeira classe B mostrado na Figura 4.\*</span><span class="sxs-lookup"><span data-stu-id="c4a98-441">For example, _IP_ADDRESS(128,0,0,0)\* specifies the first class B address shown in Figure 4.\*</span></span>

### <a name="ipv4-gateway-address"></a><span data-ttu-id="c4a98-442">Endereço IPv4 Gateway</span><span class="sxs-lookup"><span data-stu-id="c4a98-442">IPv4 Gateway Address</span></span>

<span data-ttu-id="c4a98-443">Os gateways de rede ajudam os anfitriões nas suas redes a transmitir pacotes destinados a destinos fora do domínio local.</span><span class="sxs-lookup"><span data-stu-id="c4a98-443">Network gateways assist hosts on their networks to relay packets destined to destinations outside the local domain.</span></span> <span data-ttu-id="c4a98-444">Cada nó tem algum conhecimento de qual próximo salto enviar para, seja o destino de um dos seus vizinhos, ou através de uma mesa de encaminhamento estático pré-programada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-444">Each node has some knowledge of which next hop to send to, either the destination one of its neighbors, or through a pre-programmed static routing table.</span></span> <span data-ttu-id="c4a98-445">No entanto, se estas abordagens falharem, o nó deve encaminhar o pacote para o seu gateway predefinido, que tem um melhor conhecimento sobre como encaminhar o pacote para o seu destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-445">However if these approaches fail, the node should forward the packet to its default gateway which has better knowledge on how to route the packet to its destination.</span></span> <span data-ttu-id="c4a98-446">Note que o gateway predefinido deve ser diretamente acessível através de uma das interfaces físicas anexas à instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-446">Note that the default gateway must be directly accessible through one of the physical interfaces attached to the IP instance.</span></span> <span data-ttu-id="c4a98-447">A aplicação chama \***nx_ip_gateway_address_set** _ para configurar o endereço de gateway padrão IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-447">The application calls \***nx_ip_gateway_address_set** _ to configure IPv4 default gateway address.</span></span> <span data-ttu-id="c4a98-448">Utilize o _*_nx_ip_gateway_address_get_*_ de serviço para recuperar as atuais definições de gateway IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-448">Use the service _*_nx_ip_gateway_address_get_*_ to retrieve the current IPv4 gateway settings.</span></span> <span data-ttu-id="c4a98-449">A aplicação deve utilizar o serviço _ *_nx_ip_gateway_address_clear_*\* para limpar a definição do gateway.</span><span class="sxs-lookup"><span data-stu-id="c4a98-449">Application shall use the service _ *_nx_ip_gateway_address_clear_*\* to clear the gateway setting.</span></span>

### <a name="ipv4-header"></a><span data-ttu-id="c4a98-450">Cabeçalho IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-450">IPv4 Header</span></span>

<span data-ttu-id="c4a98-451">Para que qualquer pacote IPv4 seja enviado na Internet, deve ter um cabeçalho IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-451">For any IPv4 packet to be sent on the Internet, it must have an IPv4 header.</span></span> <span data-ttu-id="c4a98-452">Quando os protocolos de nível superior (UDP, TCP, ICMP ou IGMP) ligam para o componente IP para enviar um pacote, o módulo de transmissão IPv4 coloca um cabeçalho IPv4 à frente dos dados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-452">When higher-level protocols (UDP, TCP, ICMP, or IGMP) call the IP component to send a packet, the IPv4 transmit module places an IPv4 header in front of the data.</span></span> <span data-ttu-id="c4a98-453">Inversamente, quando os pacotes IP são recebidos da rede, o componente IP remove o cabeçalho IPv4 do pacote antes da entrega aos protocolos de nível superior.</span><span class="sxs-lookup"><span data-stu-id="c4a98-453">Conversely, when IP packets are received from the network, the IP component removes the IPv4 header from the packet before delivery to the higher-level protocols.</span></span> <span data-ttu-id="c4a98-454">A figura 5 mostra o formato do cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-454">Figure 5 shows the format of the IP header.</span></span>

![Formato iPv4 header](./media/user-guide/ipv4-header-format.png)

### <a name="figure-5-ipv4-header-format"></a><span data-ttu-id="c4a98-456">FIGURA 5.</span><span class="sxs-lookup"><span data-stu-id="c4a98-456">FIGURE 5.</span></span> <span data-ttu-id="c4a98-457">Formato iPv4 header</span><span class="sxs-lookup"><span data-stu-id="c4a98-457">IPv4 Header Format</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-458">*Espera-se que todos os cabeçalhos na implementação TCP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo. Por exemplo, a versão de 4 bits e o comprimento do cabeçalho de 4 bits do cabeçalho IP devem ser localizados no primeiro byte do cabeçalho.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-458">*All headers in the TCP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address. For example, the 4-bit version and the 4-bit header length of the IP header must be located on the first byte of the header.*</span></span>

<span data-ttu-id="c4a98-459">Os campos do cabeçalho IPv4 são definidos da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="c4a98-459">The fields of the IPv4 header are defined as follows:</span></span>

|<span data-ttu-id="c4a98-460">Campo de &nbsp; cabeçalho IPv4 &nbsp;</span><span class="sxs-lookup"><span data-stu-id="c4a98-460">IPv4&nbsp;Header&nbsp;Field</span></span> |<span data-ttu-id="c4a98-461">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-461">Purpose</span></span> |
|---|---|
|<span data-ttu-id="c4a98-462">***Versão de 4 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-462">***4-bit version***</span></span> |<span data-ttu-id="c4a98-463">Este campo contém a versão de IP que este cabeçalho representa.</span><span class="sxs-lookup"><span data-stu-id="c4a98-463">This field contains the version of IP this header represents.</span></span> <span data-ttu-id="c4a98-464">Para a versão IP 4, que é o que o NetX Duo suporta, o valor deste campo é 4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-464">For IP version 4, which is what NetX Duo supports, the value of this field is 4.</span></span> |
|<span data-ttu-id="c4a98-465">***Comprimento do cabeçalho de 4 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-465">***4-bit header length***</span></span> |<span data-ttu-id="c4a98-466">Este campo especifica o número de palavras de 32 bits no cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-466">This field specifies the number of 32-bit words in the IP header.</span></span> <span data-ttu-id="c4a98-467">Se não houver palavras de opção, o valor para este campo é 5.</span><span class="sxs-lookup"><span data-stu-id="c4a98-467">If no option words are present, the value for this field is 5.</span></span> |
|<span data-ttu-id="c4a98-468">***Tipo de serviço de 8 bits (TOS)***</span><span class="sxs-lookup"><span data-stu-id="c4a98-468">***8-bit type of service (TOS)***</span></span> |<span data-ttu-id="c4a98-469">Este campo especifica o tipo de serviço solicitado para este pacote IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-469">This field specifies the type of service requested for this IP packet.</span></span> <span data-ttu-id="c4a98-470">Os pedidos válidos são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="c4a98-470">Valid requests are as follows:</span></span><br /><span data-ttu-id="c4a98-471">- Normal: 0x00</span><span class="sxs-lookup"><span data-stu-id="c4a98-471">- Normal: 0x00</span></span> <br /><span data-ttu-id="c4a98-472">- Atraso mínimo: 0x00</span><span class="sxs-lookup"><span data-stu-id="c4a98-472">- Minimum Delay: 0x00</span></span><br /><span data-ttu-id="c4a98-473">- Dados Máximos: 0x08</span><span class="sxs-lookup"><span data-stu-id="c4a98-473">- Maximum Data: 0x08</span></span><br /><span data-ttu-id="c4a98-474">- Fiabilidade máxima: 0x04</span><span class="sxs-lookup"><span data-stu-id="c4a98-474">- Maximum Reliability: 0x04</span></span><br /><span data-ttu-id="c4a98-475">- Custo Mínimo: 0x02</span><span class="sxs-lookup"><span data-stu-id="c4a98-475">- Minimum Cost: 0x02</span></span> |
|<span data-ttu-id="c4a98-476">***Comprimento total de 16 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-476">***16-bit total length***</span></span> |<span data-ttu-id="c4a98-477">Este campo contém o comprimento total do datagrama IP em bytes, incluindo o cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-477">This field contains the total length of the IP datagram in bytes, including the IP header.</span></span> <span data-ttu-id="c4a98-478">Um datagrama IP é a unidade básica de informação encontrada numa Internet TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-478">An IP datagram is the basic unit of information found on a TCP/IP Internet.</span></span> <span data-ttu-id="c4a98-479">Contém um endereço de destino e origem para além dos dados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-479">It contains a destination and source address in addition to data.</span></span> <span data-ttu-id="c4a98-480">Por ser um campo de 16 bits, o tamanho máximo de um datagrama IP é de 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-480">Because it is a 16-bit field, the maximum size of an IP datagram is 65,535 bytes.</span></span>|
|<span data-ttu-id="c4a98-481">***Identificação de 16 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-481">***16-bit identification***</span></span> |<span data-ttu-id="c4a98-482">O campo é um número usado para identificar exclusivamente cada datagrama IP enviado de um anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-482">The field is a number used to uniquely identify each IP datagram sent from a host.</span></span> <span data-ttu-id="c4a98-483">Este número é tipicamente incrementado após o envio de um datagrama IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-483">This number is typically incremented after an IP datagram is sent.</span></span> <span data-ttu-id="c4a98-484">É especialmente útil na montagem de fragmentos de pacotes IP recebidos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-484">It is especially useful in assembling received IP packet fragments.</span></span>|
|<span data-ttu-id="c4a98-485">***Bandeiras de 3 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-485">***3-bit flags***</span></span> |<span data-ttu-id="c4a98-486">Este campo contém informações de fragmentação IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-486">This field contains IP fragmentation information.</span></span> <span data-ttu-id="c4a98-487">O bit 14 é a parte do "não se fragmentar".</span><span class="sxs-lookup"><span data-stu-id="c4a98-487">Bit 14 is the "don't fragment" bit.</span></span> <span data-ttu-id="c4a98-488">Se esta bit estiver definida, o datagrama ip de saída não será fragmentado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-488">If this bit is set, the outgoing IP datagram will not be fragmented.</span></span> <span data-ttu-id="c4a98-489">O bit 13 é a parte "mais fragmentos".</span><span class="sxs-lookup"><span data-stu-id="c4a98-489">Bit 13 is the "more fragments" bit.</span></span> <span data-ttu-id="c4a98-490">Se esta parte estiver definida, há mais fragmentos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-490">If this bit is set, there are more fragments.</span></span> <span data-ttu-id="c4a98-491">Se esta parte estiver clara, este é o último fragmento do pacote IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-491">If this bit is clear, this is the last fragment of the IP packet.</span></span>|
|<span data-ttu-id="c4a98-492">***Compensação de fragmentos de 13 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-492">***13-bit fragment offset***</span></span> |<span data-ttu-id="c4a98-493">Este campo contém os 13 bits superiores da offset do fragmento.</span><span class="sxs-lookup"><span data-stu-id="c4a98-493">This field contains the upper 13-bits of the fragment offset.</span></span> <span data-ttu-id="c4a98-494">Por causa disso, as compensações de fragmentos só são permitidas em limites de 8 bytes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-494">Because of this, fragment offsets are only allowed on 8-byte boundaries.</span></span> <span data-ttu-id="c4a98-495">O primeiro fragmento de um datagrama ip fragmentado terá o conjunto de bits "mais fragmentos" e terá uma compensação de 0.</span><span class="sxs-lookup"><span data-stu-id="c4a98-495">The first fragment of a fragmented IP datagram will have the "more fragments" bit set and have an offset of 0.</span></span>|
|<span data-ttu-id="c4a98-496">***8 bits de tempo para viver (TTL)***</span><span class="sxs-lookup"><span data-stu-id="c4a98-496">***8-bit time to live (TTL)***</span></span> |<span data-ttu-id="c4a98-497">Este campo contém o número de routers que este datagrama pode passar, o que basicamente limita o tempo de vida útil do datagrama.</span><span class="sxs-lookup"><span data-stu-id="c4a98-497">This field contains the number of routers this datagram can pass, which basically limits the lifetime of the datagram.</span></span>|
|<span data-ttu-id="c4a98-498">***Protocolo de 8 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-498">***8-bit protocol***</span></span>|<span data-ttu-id="c4a98-499">Este campo especifica qual o protocolo que está a utilizar o datagrama IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-499">This field specifies which protocol is using the IP datagram.</span></span> <span data-ttu-id="c4a98-500">Segue-se uma lista de protocolos válidos e seus valores:</span><span class="sxs-lookup"><span data-stu-id="c4a98-500">The following is a list of valid protocols and their values:</span></span><br /><span data-ttu-id="c4a98-501">- ICMP: 0x01</span><span class="sxs-lookup"><span data-stu-id="c4a98-501">- ICMP: 0x01</span></span> <br /><span data-ttu-id="c4a98-502">- IGMP: 0x02</span><span class="sxs-lookup"><span data-stu-id="c4a98-502">- IGMP: 0x02</span></span><br /><span data-ttu-id="c4a98-503">- TCP: 0X06</span><span class="sxs-lookup"><span data-stu-id="c4a98-503">- TCP: 0X06</span></span><br /><span data-ttu-id="c4a98-504">- UDP: 0X11</span><span class="sxs-lookup"><span data-stu-id="c4a98-504">- UDP: 0X11</span></span> |
|<span data-ttu-id="c4a98-505">***Cheque de 16 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-505">***16-bit checksum***</span></span> |<span data-ttu-id="c4a98-506">Este campo contém a parte de verificação de 16 bits que cobre apenas o cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-506">This field contains the 16-bit checksum that covers the IP header only.</span></span> <span data-ttu-id="c4a98-507">Existem despesas de verificação adicionais nos protocolos de nível superior que cobrem a carga útil ip.</span><span class="sxs-lookup"><span data-stu-id="c4a98-507">There are additional checksums in the higher level protocols that cover the IP payload.</span></span> |
|<span data-ttu-id="c4a98-508">***Endereço IP de origem de 32 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-508">***32-bit source IP address***</span></span> |<span data-ttu-id="c4a98-509">Este campo contém o endereço IP do remetente e é sempre um endereço de anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-509">This field contains the IP address of the sender and is always a host address.</span></span> |
|<span data-ttu-id="c4a98-510">***Endereço IP de destino de 32 bits***</span><span class="sxs-lookup"><span data-stu-id="c4a98-510">***32-bit destination IP address***</span></span> |<span data-ttu-id="c4a98-511">Este campo contém o endereço IP do recetor ou dos recetores se o endereço for um endereço transmitido ou multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-511">This field contains the IP address of the receiver or receivers if the address is a broadcast or multicast address.</span></span> |

### <a name="creating-ip-instances"></a><span data-ttu-id="c4a98-512">Criação de Instâncias IP</span><span class="sxs-lookup"><span data-stu-id="c4a98-512">Creating IP Instances</span></span>

<span data-ttu-id="c4a98-513">As instâncias IP são criadas durante a inicialização ou durante o tempo de execução por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-513">IP instances are created either during initialization or during runtime by application threads.</span></span> <span data-ttu-id="c4a98-514">O endereço IPv4 inicial, máscara de rede, conjunto de pacotes predefinidos, controlador de mídia e memória e prioridade do fio IP interno são definidos pelo serviço ***nx_ip_create*** mesmo que a aplicação pretenda utilizar apenas as redes IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-514">The initial IPv4 address, network mask, default packet pool, media driver, and memory and priority of the internal IP thread are defined by the ***nx_ip_create*** service even if the application intends to use IPv6 networks only.</span></span> <span data-ttu-id="c4a98-515">Se a aplicação rubricar a instância IP com o seu endereço IPv4 definido para um endereço inválido (0.0.0.0), presume-se que o endereço de interface será resolvido por configuração manual mais tarde, via RARP, ou através de DHCP ou protocolos semelhantes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-515">If the application initializes the IP instance with its IPv4 address set to an invalid address(0.0.0.0), it is assumed that the interface address is going to resolved by manual configuration later, via RARP, or through DHCP or similar protocols.</span></span>

<span data-ttu-id="c4a98-516">Para sistemas com múltiplas interfaces de rede, a interface primária é designada ao chamar \***nx_ip_create** _.</span><span class="sxs-lookup"><span data-stu-id="c4a98-516">For systems with multiple network interfaces, the primary interface is designated when calling \***nx_ip_create** _.</span></span> <span data-ttu-id="c4a98-517">Cada interface adicional pode ser anexada à mesma instância IP chamando _\*_nx_ip_interface_attach_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-517">Each additional interface can be attached to the same IP instance by calling _\*_nx_ip_interface_attach_\*\*.</span></span> <span data-ttu-id="c4a98-518">Este serviço armazena informações sobre a interface de rede (como endereço IP, máscara de rede) no bloco de controlo de interface, e associa a instância do condutor ao bloco de controlo de interface na instância IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-518">This service stores information about the network interface (such as IP address, network mask) in the interface control block, and associates the driver instance with the interface control block in the IP instance.</span></span> <span data-ttu-id="c4a98-519">Como o condutor recebe um pacote de dados, precisa de armazenar a informação da interface na estrutura NX_PACKET antes de reencaminhar para a lógica de receção IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-519">As the driver receives a data packet, it needs to store the interface information in the NX_PACKET structure before forwarding it to the IP receive logic.</span></span> <span data-ttu-id="c4a98-520">Note que uma instância IP já deve ser criada antes de anexar quaisquer interfaces.</span><span class="sxs-lookup"><span data-stu-id="c4a98-520">Note an IP instance must already be created before attaching any interfaces.</span></span>

<span data-ttu-id="c4a98-521">Os serviços IPv6 não são iniciados depois de ligar \***nx_ip_create** _.</span><span class="sxs-lookup"><span data-stu-id="c4a98-521">IPv6 services are not started after calling \***nx_ip_create** _.</span></span> <span data-ttu-id="c4a98-522">As aplicações que desejem utilizar os serviços IPv6 devem ligar para o serviço _ *_nx_ipv6_enable_*\* para iniciar o IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-522">Applications wishing to use IPv6 services must call the service _ *_nx_ipv6_enable_*\* to start IPv6.</span></span>

<span data-ttu-id="c4a98-523">Na rede IPv6, cada interface em instância IP pode ter vários endereços globais IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-523">On the IPv6 network, each interface in an IP instance may have multiple IPv6 global addresses.</span></span> <span data-ttu-id="c4a98-524">Além de utilizar o DHCPv6 para a atribuição de endereços IPv6, um dispositivo também pode utilizar a Configuração automática do Endereço Apátrida.</span><span class="sxs-lookup"><span data-stu-id="c4a98-524">In addition to using DHCPv6 for IPv6 address assignment, a device may also use Stateless Address Autoconfiguration.</span></span> <span data-ttu-id="c4a98-525">Mais informações estão disponíveis nas secções "Ip Control Block" e "Resolução de Endereços IPv6" mais tarde neste capítulo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-525">More information is available in the "IP Control Block" and "IPv6 Address Resolution" sections later in this chapter.</span></span>

### <a name="ip-send"></a><span data-ttu-id="c4a98-526">IP Enviar</span><span class="sxs-lookup"><span data-stu-id="c4a98-526">IP Send</span></span>

<span data-ttu-id="c4a98-527">O processamento de envio IP em NetX Duo é muito simplificado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-527">The IP send processing in NetX Duo is very streamlined.</span></span> <span data-ttu-id="c4a98-528">O ponteiro pré-final do pacote é movido para trás para acomodar o cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-528">The prepend pointer in the packet is moved backwards to accommodate the IP header.</span></span> <span data-ttu-id="c4a98-529">O cabeçalho IP é preenchido (com todas as opções especificadas pela camada do protocolo de chamada), a estação de verificação IP é calculada em linha (apenas para pacotes IPv4), e o pacote é enviado para o controlador de rede associado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-529">The IP header is completed (with all the options specified by the calling protocol layer), the IP checksum is computed in-line (for IPv4 packets only), and the packet is dispatched to the associated network driver.</span></span> <span data-ttu-id="c4a98-530">Além disso, a fragmentação de saída também é coordenada a partir do processamento de envio de IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-530">In addition, outgoing fragmentation is also coordinated from within the IP send processing.</span></span>

<span data-ttu-id="c4a98-531">Para o IPv4, a NetX Duo inicia pedidos de ARP se for necessário mapeamento físico para o endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-531">For IPv4, NetX Duo initiates ARP requests if physical mapping is needed for the destination IP address.</span></span> <span data-ttu-id="c4a98-532">O IPv6 usa a Neighbor Discovery para mapeamento de endereços tofísicos iPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-532">IPv6 uses Neighbor Discovery for IPv6-address-tophysical-address mapping.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-533">*Para a conectividade IPv4, os pacotes que requerem resolução de endereço IP (isto é, mapeamento físico) são encadeados na fila ARP até que o número de pacotes em fila exceda a profundidade da fila ARP (definida pelo símbolo **NX_ARP_MAX_QUEUE_DEPTH).** Se a profundidade da fila for alcançada, o NetX Duo removerá o pacote mais antigo da fila e continuará à espera da resolução de endereços para os restantes pacotes encadeados. Por outro lado, se uma entrada ARP não for resolvida, os pacotes pendentes na entrada ARP são lançados após o tempo de entrada do ARP.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-533">*For IPv4 connectivity, packets that require IP address resolution (i.e., physical mapping) are enqueued on the ARP queue until the number of packets queued exceeds the ARP queue depth (defined by the symbol **NX_ARP_MAX_QUEUE_DEPTH**). If the queue depth is reached, NetX Duo will remove the oldest packet on the queue and continue waiting for address resolution for the remaining packets enqueued. On the other hand, if an ARP entry is not resolved, the pending packets on the ARP entry are released upon ARP entry timeout.*</span></span>

<span data-ttu-id="c4a98-534">Para sistemas com múltiplas interfaces de rede, o NetX Duo escolhe uma interface baseada no endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-534">For systems with multiple network interfaces, NetX Duo chooses an interface based on the destination IP address.</span></span> <span data-ttu-id="c4a98-535">Aplica-se o seguinte procedimento ao processo de seleção:</span><span class="sxs-lookup"><span data-stu-id="c4a98-535">The following procedure applies to the selection process:</span></span>

1. <span data-ttu-id="c4a98-536">Se o remetente especificar uma interface de saída e a interface for válida, utilize essa interface.</span><span class="sxs-lookup"><span data-stu-id="c4a98-536">If the sender specifies an outgoing interface and the interface is valid, use that interface.</span></span>
2. <span data-ttu-id="c4a98-537">Se um endereço de destino for emissão IPv4 ou multicast, a primeira interface física ativada é utilizada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-537">If a destination address is IPv4 broadcast or multicast, the first enabled physical interface is used.</span></span>
3. <span data-ttu-id="c4a98-538">Se o endereço de destino for encontrado na tabela de encaminhamento estático, a interface associada ao gateway é utilizada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-538">If the destination address is found in the static routing table, the interface associated with the gateway is used.</span></span>
4. <span data-ttu-id="c4a98-539">Se o destino estiver ligado, a interface on-link é utilizada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-539">If the destination is on-link, the on-link interface is used.</span></span>
5. <span data-ttu-id="c4a98-540">Se o endereço de destino for um endereço link-local (169.254.0.0/16), é utilizada a primeira interface válida.</span><span class="sxs-lookup"><span data-stu-id="c4a98-540">If the destination address is a link-local address (169.254.0.0/16), the first valid interface is used.</span></span>
6. <span data-ttu-id="c4a98-541">Se o gateway predefinido estiver configurado, utilize a interface associada ao gateway predefinido para transmitir o pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-541">If the default gateway is configured, use the interface associated with the default gateway to transmit the packet.</span></span>
7. <span data-ttu-id="c4a98-542">Finalmente, se um dos endereços IP de interface válido for o endereço link-local (169.254.0.0/16), esta interface é utilizada como endereço de origem para a transmissão.</span><span class="sxs-lookup"><span data-stu-id="c4a98-542">Finally, if one of the valid interface IP address is link-local address (169.254.0.0/16), this interface is used as source address for the transmission.</span></span>
8. <span data-ttu-id="c4a98-543">O pacote de saída é largado se tudo acima falhar.</span><span class="sxs-lookup"><span data-stu-id="c4a98-543">The output packet is dropped if all above fails.</span></span>

### <a name="ip-receive"></a><span data-ttu-id="c4a98-544">IP Receber</span><span class="sxs-lookup"><span data-stu-id="c4a98-544">IP Receive</span></span>

<span data-ttu-id="c4a98-545">O processamento de receção IP é chamado do controlador de rede ou do fio IP interno (para processamento de pacotes na fila de pacotes recebidos diferidos).</span><span class="sxs-lookup"><span data-stu-id="c4a98-545">The IP receive processing is either called from the network driver or the internal IP thread (for processing packets on the deferred received packet queue).</span></span> <span data-ttu-id="c4a98-546">O processamento de receção IP examina o campo do protocolo e tenta enviar o pacote para o componente de protocolo adequado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-546">The IP receive processing examines the protocol field and attempts to dispatch the packet to the proper protocol component.</span></span> <span data-ttu-id="c4a98-547">Antes de o pacote ser realmente despachado, o cabeçalho IP é removido avançando o ponteiro pré-final para além do cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-547">Before the packet is actually dispatched, the IP header is removed by advancing the prepend pointer past the IP header.</span></span>

<span data-ttu-id="c4a98-548">O processamento de receção IP também deteta pacotes IP fragmentados e executa as medidas necessárias para os remontar se a fragmentação estiver ativada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-548">IP receive processing also detects fragmented IP packets and performs the necessary steps to reassemble them if fragmentation is enabled.</span></span> <span data-ttu-id="c4a98-549">Se for necessária fragmentação, mas não ativada, o pacote é largado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-549">If fragmentation is needed but not enabled, the packet is dropped.</span></span>

<span data-ttu-id="c4a98-550">O NetX Duo determina a interface de rede adequada com base na interface especificada no pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-550">NetX Duo determines the appropriate network interface based on the interface specified in the packet.</span></span> <span data-ttu-id="c4a98-551">Se a interface do pacote for NU, o NetX Duo desrescumula a interface primária.</span><span class="sxs-lookup"><span data-stu-id="c4a98-551">If the packet interface is NULL, NetX Duo defaults to the primary interface.</span></span> <span data-ttu-id="c4a98-552">Isto é feito para garantir compatibilidade com os condutores legados NetX Duo Ethernet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-552">This is done to guarantee compatibility with legacy NetX Duo Ethernet drivers.</span></span>

### <a name="raw-ip-send"></a><span data-ttu-id="c4a98-553">Envio de IP cru</span><span class="sxs-lookup"><span data-stu-id="c4a98-553">Raw IP Send</span></span>

<span data-ttu-id="c4a98-554">Um pacote IP cru é um quadro IP que contém carga útil do protocolo de camada superior não suportado diretamente (e processado) por NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-554">A raw IP packet is an IP frame that contains upper layer protocol payload not directly supported (and processed) by NetX Duo.</span></span> <span data-ttu-id="c4a98-555">Um pacote cru permite que os desenvolvedores definam as suas próprias aplicações baseadas em IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-555">A raw packet allows developers to define their own IP-based applications.</span></span> <span data-ttu-id="c4a98-556">Uma aplicação pode enviar pacotes IP crus diretamente utilizando o serviço ***nxd_ip_raw_packet_send** _ se o processamento de pacotes IP crus tiver sido ativado com o serviço _*_nx_ip_raw_packet_enabled._\*_</span><span class="sxs-lookup"><span data-stu-id="c4a98-556">An application may send raw IP packets directly using the ***nxd_ip_raw_packet_send** _ service if raw IP packet processing has been enabled with the _*_nx_ip_raw_packet_enabled_\*_ service.</span></span> <span data-ttu-id="c4a98-557">Ao transmitir um pacote unicast numa rede IPv6, a NetX Duo determina automaticamente o melhor endereço IPv6 de origem para utilizar para enviar os pacotes, com base no endereço de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-557">When transmitting a unicast packet on an IPv6 network, NetX Duo automatically determines the best source IPv6 address to use to send the packets out on, based on the destination address.</span></span> <span data-ttu-id="c4a98-558">Se o endereço de destino for um endereço multicast (ou transmitido para IPv4), no entanto, o NetX Duo irá por defeito na primeira interface (primária).</span><span class="sxs-lookup"><span data-stu-id="c4a98-558">If the destination address is a multicast (or broadcast for IPv4) address, however, NetX Duo will default to the first (primary) interface.</span></span> <span data-ttu-id="c4a98-559">Portanto, para enviar esses pacotes em interfaces secundárias, a aplicação deve utilizar o serviço _ *_nx_ip_raw_packet_source_send_*\* para especificar o endereço de origem a utilizar para o pacote de saída.</span><span class="sxs-lookup"><span data-stu-id="c4a98-559">Therefore, to send such packets out on secondary interfaces, the application must use the _ *_nx_ip_raw_packet_source_send_*\* service to specify the source address to use for the outgoing packet.</span></span>

### <a name="raw-ip-receive"></a><span data-ttu-id="c4a98-560">Receber IP cru</span><span class="sxs-lookup"><span data-stu-id="c4a98-560">Raw IP Receive</span></span>

<span data-ttu-id="c4a98-561">Se o processamento de pacotes IP cru estiver ativado, a aplicação pode receber pacotes IP crus através do serviço \***nx_ip_raw_packet_receive** _ .</span><span class="sxs-lookup"><span data-stu-id="c4a98-561">If raw IP packet processing is enabled, the application may receive raw IP packets through the \***nx_ip_raw_packet_receive** _ service.</span></span> <span data-ttu-id="c4a98-562">Todos os pacotes de entrada são processados de acordo com o protocolo especificado no cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-562">All incoming packets are processed according to the protocol specified in the IP header.</span></span> <span data-ttu-id="c4a98-563">Se o protocolo especificar UDP, TCP, IGMP ou ICMP, a NetX Duo processará o pacote utilizando o manipulador apropriado para o tipo de protocolo de pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-563">If the protocol specifies UDP, TCP, IGMP or ICMP, NetX Duo will process the packet using the appropriate handler for the packet protocol type.</span></span> <span data-ttu-id="c4a98-564">Se o protocolo não for um destes protocolos, e a receção ip bruta estiver ativada, o pacote de entrada será colocado na fila de pacotes brutos à espera que a aplicação o receba através do serviço _*_nx_ip_raw_packet_receive*_\* Além disso, os fios de aplicação podem suspender com um intervalo opcional enquanto aguardam um pacote IP cru. O número de pacotes que podem ser colocados na fila de pacotes brutos é limitado. O valor máximo é definido em \***NX_IP_RAW_MAX_QUEUE_DEPTH,**_ cujo valor predefinido é de 20.</span><span class="sxs-lookup"><span data-stu-id="c4a98-564">If the protocol is not one of these protocols, and raw IP receive is enabled, the incoming packet will be put into the raw packet queue waiting for the application to receive it via the _*_nx_ip_raw_packet_receive_*\* service. In addition, application threads may suspend with an optional timeout while waiting for a raw IP packet. The number of packets that can be queued on the raw packet queue is limited. The maximum value is defined in \***NX_IP_RAW_MAX_QUEUE_DEPTH**_, whose default value is 20.</span></span> <span data-ttu-id="c4a98-565">Uma aplicação pode alterar o valor máximo chamando o serviço _ *_nx_ip_raw_receive_queue_max_set_*\* .</span><span class="sxs-lookup"><span data-stu-id="c4a98-565">An application may change the maximum value by calling the _ *_nx_ip_raw_receive_queue_max_set_*\* service.</span></span>

<span data-ttu-id="c4a98-566">Em alternativa, a biblioteca NetX Duo pode ser construída com \***NX_ENABLE_IP_RAW_PACKET_FILTER\*.**</span><span class="sxs-lookup"><span data-stu-id="c4a98-566">Alternatively, the NetX Duo library may be built with \***NX_ENABLE_IP_RAW_PACKET_FILTER\*.**</span></span> <span data-ttu-id="c4a98-567">Neste modo de funcionamento, a aplicação fornece uma função de retorno que é invocada sempre que um pacote com um tipo de protocolo não manipulado é recebido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-567">In this mode of operation, the application provides a callback function that is invoked every time a packet with an unhandled protocol type is received.</span></span> <span data-ttu-id="c4a98-568">A lógica de receção IP encaminha o pacote para o pacote cru definido pelo utilizador receber a rotina do filtro.</span><span class="sxs-lookup"><span data-stu-id="c4a98-568">The IP receive logic forwards the packet to the user-defined raw packet receive filter routine.</span></span> <span data-ttu-id="c4a98-569">A rotina do filtro decide se mantém ou não o pacote cru para o processo futuro.</span><span class="sxs-lookup"><span data-stu-id="c4a98-569">The filter routine decides whether or not to keep the raw packet for future process.</span></span> <span data-ttu-id="c4a98-570">O valor de retorno da rotina de retorno indica se o pacote foi processado pelo filtro de receção de pacote cru.</span><span class="sxs-lookup"><span data-stu-id="c4a98-570">The return value from the callback routine indicates whether the packet has been processed by the raw packet receive filter.</span></span> <span data-ttu-id="c4a98-571">Se o pacote for processado pela função de retorno, o pacote deve ser libertado após a aplicação ser feita com o pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-571">If the packet is processed by the callback function, the packet should be released after the application is done with the packet.</span></span> <span data-ttu-id="c4a98-572">Caso contrário, a NetX Duo é responsável pela libertação do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-572">Otherwise, NetX Duo is responsible for releasing the packet.</span></span> <span data-ttu-id="c4a98-573">Consulte a **_nx_ip_raw_packet_filter_set_** para obter mais informações sobre como utilizar a função de filtro de pacotes brutos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-573">Refer to the **_nx_ip_raw_packet_filter_set_** for more information on how to use the raw packet filter function.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-574">\*A função de invólucro BSD para NetX Duo baseia-se na função de filtro de pacotes brutos para manusear tomadas em bruto BSD.</span><span class="sxs-lookup"><span data-stu-id="c4a98-574">\*The BSD wrapper function for NetX Duo relies on the raw packet filter function to handle BSD raw sockets.</span></span> <span data-ttu-id="c4a98-575">Por isso, para suportar a tomada em bruto no invólucro BSD, a biblioteca NetX Duo deve ser construída com ***NX_ENABLE_IP_RAW_PACKET_FILTER** _ definido, e a aplicação não deve usar o _*_nx_ip_raw_packet_filter_set_\*_ para instalar o seu próprio filtro de pacote cru functions._</span><span class="sxs-lookup"><span data-stu-id="c4a98-575">Therefore, to support raw socket in the BSD wrapper, the NetX Duo library must be built with ***NX_ENABLE_IP_RAW_PACKET_FILTER** _ defined, and the application should not use the _*_nx_ip_raw_packet_filter_set_\*_ to install its own raw packet filter functions._</span></span>

### <a name="default-packet-pool"></a><span data-ttu-id="c4a98-576">Piscina de pacotes predefinidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-576">Default Packet Pool</span></span>

<span data-ttu-id="c4a98-577">Cada instância IP recebe um pacote de pacote padrão durante a criação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-577">Each IP instance is given a default packet pool during creation.</span></span> <span data-ttu-id="c4a98-578">Esta piscina de pacotes é usada para alocar pacotes para ARP, RARP, ICMP, IGMP, vários pacotes de controlo TCP (SYN, ACK, e assim por diante), Neighbor Discovery, Router Discovery e Duplicate Address Detection.</span><span class="sxs-lookup"><span data-stu-id="c4a98-578">This packet pool is used to allocate packets for ARP, RARP, ICMP, IGMP, various TCP control packets (SYN, ACK, and so on), Neighbor Discovery, Router Discovery, and Duplicate Address Detection.</span></span> <span data-ttu-id="c4a98-579">Se o pacote predefinido estiver vazio quando o NetX Duo precisar de alocar um pacote, o NetX Duo poderá ter de abortar a operação em particular e devolverá uma mensagem de erro se possível.</span><span class="sxs-lookup"><span data-stu-id="c4a98-579">If the default packet pool is empty when NetX Duo needs to allocate a packet, NetX Duo may have to abort the particular operation, and will return an error message if possible.</span></span>

### <a name="ip-helper-thread"></a><span data-ttu-id="c4a98-580">Fio de ajudante IP</span><span class="sxs-lookup"><span data-stu-id="c4a98-580">IP Helper Thread</span></span>

<span data-ttu-id="c4a98-581">Cada instância IP tem um fio de ajuda.</span><span class="sxs-lookup"><span data-stu-id="c4a98-581">Each IP instance has a helper thread.</span></span> <span data-ttu-id="c4a98-582">Este fio é responsável pelo manuseamento de todo o processamento de pacotes diferidos e de todo o processamento periódico.</span><span class="sxs-lookup"><span data-stu-id="c4a98-582">This thread is responsible for handling all deferred packet processing and all periodic processing.</span></span> <span data-ttu-id="c4a98-583">O fio do ajudante IP é criado em ***nx_ip_create.*** É aqui que o fio é dado a sua pilha e prioridade.</span><span class="sxs-lookup"><span data-stu-id="c4a98-583">The IP helper thread is created in ***nx_ip_create.*** This is where the thread is given its stack and priority.</span></span> <span data-ttu-id="c4a98-584">Note que o primeiro processamento na linha de ajuda IP é terminar a inicialização do controlador de rede associada ao serviço de criação IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-584">Note that the first processing in the IP helper thread is to finish the network driver initialization associated with the IP create service.</span></span> <span data-ttu-id="c4a98-585">Após a inicialização do controlador de rede estar concluída, o fio do ajudante inicia um ciclo interminável para processar pacotes e pedidos periódicos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-585">After the network driver initialization is complete, the helper thread starts an endless loop to process packet and periodic requests.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-586">*Se o comportamento inexplicável for visto dentro do fio do ajudante IP, aumentar o tamanho da pilha durante o serviço de criação IP é o primeiro passo de depurar. Se a pilha for muito pequena, o fio do ajudante IP pode estar a sobrepor-se à memória, o que pode causar problemas incomuns.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-586">*If unexplained behavior is seen within the IP helper thread, increasing its stack size during the IP create service is the first debugging step. If the stack is too small, the IP helper thread could possibly be overwriting memory, which may cause unusual problems.*</span></span>

### <a name="thread-suspension"></a><span data-ttu-id="c4a98-587">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="c4a98-587">Thread Suspension</span></span>

<span data-ttu-id="c4a98-588">Os fios de aplicação podem suspender enquanto tentam receber pacotes IP crus.</span><span class="sxs-lookup"><span data-stu-id="c4a98-588">Application threads can suspend while attempting to receive raw IP packets.</span></span> <span data-ttu-id="c4a98-589">Depois de recebido um pacote cru, o novo pacote é dado ao primeiro fio suspenso e esse fio é retomado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-589">After a raw packet is received, the new packet is given to the first thread suspended and that thread is resumed.</span></span> <span data-ttu-id="c4a98-590">Os serviços da NetX Duo para receber pacotes têm um tempo de suspensão opcional.</span><span class="sxs-lookup"><span data-stu-id="c4a98-590">NetX Duo services for receiving packets all have an optional suspension timeout.</span></span> <span data-ttu-id="c4a98-591">Quando um pacote é recebido ou o tempo limite expira, o fio de aplicação é retomado com o estado de conclusão adequado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-591">When a packet is received or the timeout expires, the application thread is resumed with the appropriate completion status.</span></span>

### <a name="ip-statistics-and-errors"></a><span data-ttu-id="c4a98-592">Estatísticas e erros ip</span><span class="sxs-lookup"><span data-stu-id="c4a98-592">IP Statistics and Errors</span></span>

<span data-ttu-id="c4a98-593">Se ativado, o Duo NetX regista várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-593">If enabled, the NetX Duo keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-594">As seguintes estatísticas e relatórios de erro são mantidos para cada instância DEP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-594">The following statistics and error reports are maintained for each IP instance:</span></span>

- <span data-ttu-id="c4a98-595">Total de pacotes IP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-595">Total IP Packets Sent</span></span>
- <span data-ttu-id="c4a98-596">Total de bytes IP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-596">Total IP Bytes Sent</span></span>
- <span data-ttu-id="c4a98-597">Total de pacotes IP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-597">Total IP Packets Received</span></span>
- <span data-ttu-id="c4a98-598">Total de bytes IP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-598">Total IP Bytes Received</span></span>
- <span data-ttu-id="c4a98-599">Total de pacotes inválidos IP</span><span class="sxs-lookup"><span data-stu-id="c4a98-599">Total IP Invalid Packets</span></span>
- <span data-ttu-id="c4a98-600">Total de pacotes de receção IP abandonados</span><span class="sxs-lookup"><span data-stu-id="c4a98-600">Total IP Receive Packets Dropped</span></span>
- <span data-ttu-id="c4a98-601">Total IP Receber Erros de Checkum</span><span class="sxs-lookup"><span data-stu-id="c4a98-601">Total IP Receive Checksum Errors</span></span>
- <span data-ttu-id="c4a98-602">Total IP Enviar Pacotes Abandonados</span><span class="sxs-lookup"><span data-stu-id="c4a98-602">Total IP Send Packets Dropped</span></span>
- <span data-ttu-id="c4a98-603">Total de fragmentos ip enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-603">Total IP Fragments Sent</span></span>
- <span data-ttu-id="c4a98-604">Total de fragmentos ip recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-604">Total IP Fragments Received</span></span>

<span data-ttu-id="c4a98-605">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_ip_info_get.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-605">All of these statistics and error reports are available to the application with the ***nx_ip_info_get*** service.</span></span>

### <a name="ip-control-block-nx_ip"></a><span data-ttu-id="c4a98-606">NX_IP do Bloco de Controlo IP</span><span class="sxs-lookup"><span data-stu-id="c4a98-606">IP Control Block NX_IP</span></span>

<span data-ttu-id="c4a98-607">As características de cada instância IP encontram-se no seu bloco de controlo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-607">The characteristics of each IP instance are found in its control block.</span></span> <span data-ttu-id="c4a98-608">Contém informações úteis, tais como endereços IP e máscaras de rede de cada dispositivo de rede, e uma tabela de IP vizinho e mapeamento de endereços de hardware físico.</span><span class="sxs-lookup"><span data-stu-id="c4a98-608">It contains useful information such as the IP addresses and network masks of each network device, and a table of neighbor IP and physical hardware address mapping.</span></span> <span data-ttu-id="c4a98-609">Esta estrutura é definida na _file \***nx_api.h.**</span><span class="sxs-lookup"><span data-stu-id="c4a98-609">This structure is defined in the \***nx_api.h** _file.</span></span> <span data-ttu-id="c4a98-610">Se o IPv6 estiver ativado, também contém um conjunto de endereços IPv6, número dos quais é especificado pela opção configurável do utilizador _\*_NX_MAX_IPV6_ADDRESSES_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-610">If IPv6 is enabled, it also contains an array of IPv6 address, the number of which is specified by the user configurable option _\*_NX_MAX_IPV6_ADDRESSES_\*\*.</span></span> <span data-ttu-id="c4a98-611">O valor predefinido permite que cada interface de rede física tenha três endereços IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-611">The default value allows each physical network interface to have three IPv6 addresses.</span></span>

<span data-ttu-id="c4a98-612">Os blocos de controlo de instância IP podem ser localizados em qualquer lugar da memória, mas é mais comum fazer do bloco de controlo uma estrutura global definindo-o fora do âmbito de qualquer função.</span><span class="sxs-lookup"><span data-stu-id="c4a98-612">IP instance control blocks can be located anywhere in memory, but it is most common to make the control block a global structure by defining it outside the scope of any function.</span></span>

### <a name="static-ipv4-routing"></a><span data-ttu-id="c4a98-613">Encaminhamento estático IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-613">Static IPv4 Routing</span></span>

<span data-ttu-id="c4a98-614">A funcionalidade de encaminhamento estático permite que uma aplicação especifique uma rede IPv4 e o próximo endereço de lúpulo para endereços IP específicos fora da rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-614">The static routing feature allows an application to specify an IPv4 network and next hop address for specific out of network destination IP addresses.</span></span> <span data-ttu-id="c4a98-615">Se o encaminhamento estático estiver ativado, o NetX Duo procura através da tabela de encaminhamento estático para uma entrada correspondente ao endereço de destino do pacote a enviar.</span><span class="sxs-lookup"><span data-stu-id="c4a98-615">If static routing is enabled, NetX Duo searches through the static routing table for an entry matching the destination address of the packet to send.</span></span> <span data-ttu-id="c4a98-616">Se não for encontrado qualquer correspondência, o NetX Duo procura através da lista de interfaces físicas e escolhe um endereço IP de origem e próximo endereço de lúpulo baseado no endereço IP de destino e na máscara de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-616">If no match is found, NetX Duo searches through the list of physical interfaces and chooses a source IP address and next hop address based on the destination IP address and the network mask.</span></span> <span data-ttu-id="c4a98-617">Se o destino não corresponder a nenhum dos endereços IP dos controladores de rede ligados à instância IP, o NetX Duo escolhe uma interface que está diretamente ligada ao gateway predefinido e utiliza o endereço IP da interface como endereço de origem, e o gateway predefinido como o próximo salto.</span><span class="sxs-lookup"><span data-stu-id="c4a98-617">If the destination does not match any of the IP addresses of the network drivers attached to the IP instance, NetX Duo chooses an interface that is directly connected to the default gateway, and uses the IP address of the interface as source address, and the default gateway as the next hop.</span></span>

<span data-ttu-id="c4a98-618">As entradas podem ser adicionadas e removidas da tabela de encaminhamento estático utilizando os serviços ***nx_ip_static_route_add** _ e _ *_nx_ip_static_route_delete_** respectivamente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-618">Entries can be added and removed from the static routing table using the ***nx_ip_static_route_add** _ and _ *_nx_ip_static_route_delete_** services, respectively.</span></span> <span data-ttu-id="c4a98-619">Para utilizar o encaminhamento estático, a aplicação do anfitrião deve ativar esta função definindo ***NX_ENABLE_IP_STATIC_ROUTING.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-619">To use static routing, the host application must enable this feature by defining ***NX_ENABLE_IP_STATIC_ROUTING.***</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-620">*Ao adicionar uma entrada na tabela de encaminhamento estático, o NetX Duo verifica uma entrada correspondente para o endereço de destino especificado já na tabela. Se existir, dá preferência à entrada com a rede mais pequena (prefixo mais longo) na máscara de rede.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-620">*When adding an entry to the static routing table, NetX Duo checks for a matching entry for the specified destination address already in the table. If one exists, it gives preference to the entry with the smaller network (longer prefix) in the network mask.*</span></span>

### <a name="ipv4-forwarding"></a><span data-ttu-id="c4a98-621">Encaminhamento IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-621">IPv4 Forwarding</span></span>

<span data-ttu-id="c4a98-622">Se o pacote IPv4 de entrada não estiver destinado a este nó e a função de reencaminhamento IPv4 estiver ativada, a NetX Duo tenta encaminhar o pacote através das outras interfaces.</span><span class="sxs-lookup"><span data-stu-id="c4a98-622">If the incoming IPv4 packet is not destined for this node and IPv4 forwarding feature is enabled, NetX Duo attempts to forward the packet out via the other interfaces.</span></span>  

### <a name="ip-fragmentation"></a><span data-ttu-id="c4a98-623">Fragmentação ip</span><span class="sxs-lookup"><span data-stu-id="c4a98-623">IP Fragmentation</span></span>

<span data-ttu-id="c4a98-624">O dispositivo de rede pode ter limites no tamanho dos pacotes de saída.</span><span class="sxs-lookup"><span data-stu-id="c4a98-624">The network device may have limits on the size of outgoing packets.</span></span> <span data-ttu-id="c4a98-625">Este limite é chamado de unidade de transmissão máxima (MTU).</span><span class="sxs-lookup"><span data-stu-id="c4a98-625">This limit is called the maximum transmission unit (MTU).</span></span> <span data-ttu-id="c4a98-626">IP MTU é o maior tamanho de quadro IP que o controlador de camada de ligação é capaz de transmitir sem fragmentar o pacote IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-626">IP MTU is the largest IP frame size a link layer driver is able to transmit without fragmenting the IP packet.</span></span> <span data-ttu-id="c4a98-627">Durante uma fase de inicialização do controlador do dispositivo, o módulo do condutor deve configurar o seu tamanho IP MTU através do ***serviço nx_ip_interface_mtu_set.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-627">During a device driver initialization phase, the driver module must configure its IP MTU size via the service ***nx_ip_interface_mtu_set.***</span></span>

<span data-ttu-id="c4a98-628">Embora não recomendado, a aplicação pode gerar datagramas maiores do que o IP MTU subjacente suportado pelo dispositivo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-628">Although not recommended, the application may generate datagrams larger than the underlying IP MTU supported by the device.</span></span> <span data-ttu-id="c4a98-629">Antes de transmitir tais datagramas de IP, a camada IP deve fragmentar estes pacotes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-629">Before transmitting such IP datagram, the IP layer must fragment these packets.</span></span> <span data-ttu-id="c4a98-630">Ao receber quadros IP fragmentados, a extremidade recetora deve armazenar todos os quadros IP fragmentados com o mesmo ID de fragmentação e montá-los em ordem.</span><span class="sxs-lookup"><span data-stu-id="c4a98-630">On receiving fragmented IP frames, the receiving end must store all fragmented IP frames with the same fragmentation ID, and reassemble them in order.</span></span> <span data-ttu-id="c4a98-631">Se a lógica de receção ip não for capaz de recolher todos os fragmentos para restaurar o quadro IP original no tempo, todos os fragmentos são libertados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-631">If the IP receive logic is unable to collect all the fragments to restore the original IP frame in time, all the fragments are released.</span></span> <span data-ttu-id="c4a98-632">Cabe ao protocolo da camada superior detetar tal perda de pacote e recuperá-la.</span><span class="sxs-lookup"><span data-stu-id="c4a98-632">It is up to the upper layer protocol to detect such packet loss and recover from it.</span></span>

<span data-ttu-id="c4a98-633">A fragmentação do IP aplica-se tanto aos pacotes IPv4 como IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-633">The IP fragmentation applies to both IPv4 and IPv6 packets.</span></span>

<span data-ttu-id="c4a98-634">Para suportar a fragmentação e o funcionamento da fragmentação IP, o designer de sistema deve ativar a função de fragmentação IP no NetX Duo utilizando o serviço ***nx_ip_fragment_enable.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-634">In order to support IP fragmentation and reassembly operation, the system designer must enable the IP fragmentation feature in NetX Duo using the ***nx_ip_fragment_enable*** service.</span></span> <span data-ttu-id="c4a98-635">Se esta função não estiver ativada, os pacotes IP fragmentados de entrada são descartados, bem como pacotes que excedam o MTU do controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-635">If this feature is not enabled, incoming fragmented IP packets are discarded, as well as packets that exceed the network driver's MTU.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-636">\*A lógica de fragmentação IP pode ser completamente removida definindo \***NX_DISABLE_FRAGMENTATION** _ ao construir a biblioteca NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-636">\*The IP Fragmentation logic can be removed completely by defining \***NX_DISABLE_FRAGMENTATION** _ when building the NetX Duo library.</span></span> <span data-ttu-id="c4a98-637">Ao fazê-lo, ajuda a reduzir o tamanho do código do NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-637">Doing so helps reduce the code size of NetX Duo.</span></span> <span data-ttu-id="c4a98-638">Note que, nesta situação, as funções de fragmentação/remontagem do IPv4 e do IPv6 são disabled._</span><span class="sxs-lookup"><span data-stu-id="c4a98-638">Note that in this situation, both the IPv4 and IPv6 fragmentation/reassembly functions are disabled._</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-639">*Se **NX_DISABLE_CHAINED_PACKET** estiver definido, a fragmentação ip deve ser desativada.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-639">*If **NX_DISABLE_CHAINED_PACKET** is defined, IP fragmentation must be disabled.*</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-640">*Numa rede IPv6, os routers não fragmentam um datagrama se o tamanho do datagrama exceder o seu tamanho mínimo de MTU. Por conseguinte, cabe ao dispositivo de envio determinar o mínimo MTU entre a fonte e o destino, e garantir que o tamanho do datagrama IP não exceda o caminho MTU. No NetX Duo, a descoberta IPv6 PATH MTU pode ser ativada através da construção da biblioteca NetX Duo com o símbolo **NX_ENABLE_IPV6_PATH_MTU_DISCOVERY** definido.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-640">*In an IPv6 network, routers do not fragment a datagram if the size of the datagram exceeds its minimum MTU size. Therefore, it is up to the sending device to determine the minimum MTU between the source and the destination, and to ensure the IP datagram size does not exceed the path MTU. In NetX Duo, IPv6 PATH MTU discovery can be enabled by building NetX Duo library with the symbol **NX_ENABLE_IPV6_PATH_MTU_DISCOVERY** defined.*</span></span>

## <a name="address-resolution-protocol-arp-in-ipv4"></a><span data-ttu-id="c4a98-641">Protocolo de Resolução de Endereços (ARP) no IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-641">Address Resolution Protocol (ARP) in IPv4</span></span>

<span data-ttu-id="c4a98-642">O Protocolo de Resolução de Endereços (ARP) é responsável por mapear dinamicamente endereços IPv4 de 32 bits aos dos meios físicos subjacentes (RFC 826).</span><span class="sxs-lookup"><span data-stu-id="c4a98-642">The Address Resolution Protocol (ARP) is responsible for dynamically mapping 32-bit IPv4 addresses to those of the underlying physical media (RFC 826).</span></span> <span data-ttu-id="c4a98-643">Ethernet é o meio físico mais típico, e suporta endereços de 48 bits.</span><span class="sxs-lookup"><span data-stu-id="c4a98-643">Ethernet is the most typical physical media, and it supports 48-bit addresses.</span></span> <span data-ttu-id="c4a98-644">A necessidade de ARP é determinada pelo controlador de rede fornecido ao serviço \***nx_ip_create** _ .</span><span class="sxs-lookup"><span data-stu-id="c4a98-644">The need for ARP is determined by the network driver supplied to the \***nx_ip_create** _ service.</span></span> <span data-ttu-id="c4a98-645">Se for necessário um mapeamento físico, o controlador de rede deve utilizar o serviço _ *_nx_interface_address_mapping_needed_*\* para configurar corretamente a interface do controlador.</span><span class="sxs-lookup"><span data-stu-id="c4a98-645">If physical mapping is required, the network driver must use the _ *_nx_interface_address_mapping_needed_*\* service to configure the driver interface properly.</span></span>

### <a name="arp-enable"></a><span data-ttu-id="c4a98-646">Ativar a ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-646">ARP Enable</span></span>

<span data-ttu-id="c4a98-647">Para que a ARP funcione corretamente, deve primeiro ser ativada pela aplicação com o serviço ***nx_arp_enable.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-647">For ARP to function properly, it must first be enabled by the application with the ***nx_arp_enable*** service.</span></span> <span data-ttu-id="c4a98-648">Este serviço estabelece várias estruturas de dados para o processamento de ARP, incluindo a criação de uma área de cache ARP a partir da memória fornecida ao serviço de ativação ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-648">This service sets up various data structures for ARP processing, including the creation of an ARP cache area from the memory supplied to the ARP enable service.</span></span>

### <a name="arp-cache"></a><span data-ttu-id="c4a98-649">ARP Cache</span><span class="sxs-lookup"><span data-stu-id="c4a98-649">ARP Cache</span></span>

<span data-ttu-id="c4a98-650">A cache ARP pode ser vista como uma matriz de estruturas internas de dados de mapeamento ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-650">The ARP cache can be viewed as an array of internal ARP mapping data structures.</span></span> <span data-ttu-id="c4a98-651">Cada estrutura interna é capaz de manter a relação entre um endereço IP e um endereço de hardware físico.</span><span class="sxs-lookup"><span data-stu-id="c4a98-651">Each internal structure is capable of maintaining the relationship between an IP address and a physical hardware address.</span></span> <span data-ttu-id="c4a98-652">Além disso, cada estrutura de dados tem ponteiros de ligação para que possa fazer parte de várias listas ligadas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-652">In addition, each data structure has link pointers so it can be part of multiple linked lists.</span></span>

<span data-ttu-id="c4a98-653">A aplicação pode procurar um endereço IP a partir da cache ARP fornecendo o endereço MAC de hardware usando o serviço \***nx_arp_ip_address_find** _ se o mapeamento existir na tabela ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-653">Application can look up an IP address from the ARP cache by supplying hardware MAC address using the service \***nx_arp_ip_address_find** _ if the mapping exists in the ARP table.</span></span> <span data-ttu-id="c4a98-654">Da mesma forma, o serviço _ *_nx_arp_hardware_address_find_*\* devolve o endereço MAC para um determinado endereço IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-654">Similarly, the service _ *_nx_arp_hardware_address_find_*\* returns the MAC address for a given IP address.</span></span>

### <a name="arp-dynamic-entries"></a><span data-ttu-id="c4a98-655">Entradas dinâmicas ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-655">ARP Dynamic Entries</span></span>

<span data-ttu-id="c4a98-656">Por predefinição, o ARP permite que todas as entradas na cache ARP na lista de entradas ARP dinâmicas disponíveis.</span><span class="sxs-lookup"><span data-stu-id="c4a98-656">By default, the ARP enable service places all entries in the ARP cache on the list of available dynamic ARP entries.</span></span> <span data-ttu-id="c4a98-657">Uma entrada dinâmica de ARP é atribuída a partir desta lista pela NetX Duo quando é detetado um pedido de envio para um endereço IP não mapeado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-657">A dynamic ARP entry is allocated from this list by NetX Duo when a send request to an unmapped IP address is detected.</span></span> <span data-ttu-id="c4a98-658">Após a atribuição, a entrada ARP é configurada e um pedido ARP é enviado para os meios físicos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-658">After allocation, the ARP entry is set up and an ARP request is sent to the physical media.</span></span>

<span data-ttu-id="c4a98-659">Uma entrada dinâmica também pode ser criada pelo serviço ***nx_arp_dynamic_entry_set***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-659">A dynamic entry can also be created by the service ***nx_arp_dynamic_entry_set***.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-660">*Se todas as entradas ARP dinâmicas estiverem a ser utilizadas, a entrada ARP menos utilizada é substituída por um novo mapeamento.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-660">*If all dynamic ARP entries are in use, the least recently used ARP entry is replaced with a new mapping.*</span></span>

### <a name="arp-static-entries"></a><span data-ttu-id="c4a98-661">Entradas Estáticas ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-661">ARP Static Entries</span></span>

<span data-ttu-id="c4a98-662">A aplicação também pode configurar mapeamento ARP estático usando o \***nx_arp_static_entry_create** _service.</span><span class="sxs-lookup"><span data-stu-id="c4a98-662">The application can also set up static ARP mapping by using the \***nx_arp_static_entry_create** _service.</span></span> <span data-ttu-id="c4a98-663">Este serviço atribui uma entrada ARP da lista dinâmica de entrada ARP e coloca-a na lista estática com as informações de mapeamento fornecidas pela aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-663">This service allocates an ARP entry from the dynamic ARP entry list and places it on the static list with the mapping information supplied by the application.</span></span> <span data-ttu-id="c4a98-664">As entradas ARP estáticas não estão sujeitas a reutilização ou envelhecimento.</span><span class="sxs-lookup"><span data-stu-id="c4a98-664">Static ARP entries are not subject to reuse or aging.</span></span> <span data-ttu-id="c4a98-665">A aplicação pode eliminar uma entrada estática utilizando o serviço _*_nx_arp_static_entry_delete_*_.</span><span class="sxs-lookup"><span data-stu-id="c4a98-665">The application can delete a static entry by using the service _*_nx_arp_static_entry_delete_*_.</span></span> <span data-ttu-id="c4a98-666">Para remover todas as entradas estáticas na tabela ARP, a aplicação pode utilizar o serviço _\*_nx_arp_static_entries_delete_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-666">To remove all static entries in the ARP table, the application may use the service _\*_nx_arp_static_entries_delete_\*\*.</span></span>

### <a name="automatic-arp-entry"></a><span data-ttu-id="c4a98-667">Entrada Automática de ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-667">Automatic ARP Entry</span></span>

<span data-ttu-id="c4a98-668">NetX Duo grava o mapeamento IP/MAC do par após as respostas dos pares ao pedido de ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-668">NetX Duo records the peer's IP/MAC mapping after the peer responses to the ARP request.</span></span> <span data-ttu-id="c4a98-669">O NetX Duo também implementa a funcionalidade de entrada automática de ARP onde regista o mapeamento de endereços PEER/MAC com base em pedidos ARP não solicitados da rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-669">NetX Duo also implements the automatic ARP entry feature where it records peer IP/MAC address mapping based on unsolicited ARP requests from the network.</span></span> <span data-ttu-id="c4a98-670">Esta funcionalidade permite que a tabela ARP seja povoada com informações de pares, reduzindo o atraso necessário para passar pelo ciclo de pedido/resposta ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-670">This feature allows the ARP table to be populated with peer information, reducing the delay needed to go through the ARP request/response cycle.</span></span> <span data-ttu-id="c4a98-671">No entanto, a desvantagem com a ativação automática do ARP é que a tabela ARP tende a encher-se rapidamente numa rede movimentada com muitos nós na ligação local, o que acabaria por levar à substituição da entrada do ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-671">However the downside with enabling automatic ARP is that the ARP table tend to fill up quickly on a busy network with many nodes on the local link, which would eventually lead to ARP entry replacement.</span></span>

<span data-ttu-id="c4a98-672">Esta funcionalidade é ativada por padrão.</span><span class="sxs-lookup"><span data-stu-id="c4a98-672">This feature is enabled by default.</span></span> <span data-ttu-id="c4a98-673">Para desativá-la, a biblioteca NetX Duo deve ser compilada com o símbolo ***NX_DISABLE_ARP_AUTO_ENTRY*** definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-673">To disable it, the NetX Duo library must be compiled with the symbol ***NX_DISABLE_ARP_AUTO_ENTRY*** defined.</span></span></p>

### <a name="arp-messages"></a><span data-ttu-id="c4a98-674">Mensagens ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-674">ARP Messages</span></span>

<span data-ttu-id="c4a98-675">Como mencionado anteriormente, uma mensagem de pedido ARP é enviada quando a tarefa IP deteta que o mapeamento é necessário para um endereço IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-675">As mentioned previously, an ARP request message is sent when the IP task detects that mapping is needed for an IP address.</span></span> <span data-ttu-id="c4a98-676">Os pedidos de ARP são enviados periodicamente (a cada \***NX_ARP_UPDATE_RATE** _ segundos) até que seja recebida uma resposta ARP correspondente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-676">ARP requests are sent periodically (every \***NX_ARP_UPDATE_RATE** _ seconds) until a corresponding ARP response is received.</span></span> <span data-ttu-id="c4a98-677">Um total de _ *_NX_ARP_MAXIMUM_RETRIES_*\* pedidos de ARP são feitos antes da tentativa de ARP ser abandonada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-677">A total of _ *_NX_ARP_MAXIMUM_RETRIES_*\* ARP requests are made before the ARP attempt is abandoned.</span></span> <span data-ttu-id="c4a98-678">Quando uma resposta ARP é recebida, as informações de endereço físico associados são armazenadas na entrada ARP que está na cache.</span><span class="sxs-lookup"><span data-stu-id="c4a98-678">When an ARP response is received, the associated physical address information is stored in the ARP entry that is in the cache.</span></span>

<span data-ttu-id="c4a98-679">Para sistemas multihomes, o NetX Duo determina qual a interface para enviar os pedidos e respostas ARP com base no endereço de destino especificado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-679">For multihome systems, NetX Duo determines which interface to send the ARP requests and responses based on destination address specified.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-680">*Os pacotes IP de saída são em fila enquanto o NetX Duo aguarda a resposta ARP. O número de pacotes IP de saída em fila é definido pela **NX_ARP_MAX_QUEUE_DEPTH** constante .*</span><span class="sxs-lookup"><span data-stu-id="c4a98-680">*Outgoing IP packets are queued while NetX Duo waits for the ARP response. The number of outgoing IP packets queued is defined by the constant **NX_ARP_MAX_QUEUE_DEPTH**.*</span></span>

<span data-ttu-id="c4a98-681">A NetX Duo também responde aos pedidos de ARP de outros nós na rede local IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-681">NetX Duo also responds to ARP requests from other nodes on the local IPv4 network.</span></span> <span data-ttu-id="c4a98-682">Quando é feito um pedido de ARP externo que corresponde ao endereço IP atual da interface que recebe o pedido ARP, o NetX Duo constrói uma mensagem de resposta ARP que contém o endereço físico atual.</span><span class="sxs-lookup"><span data-stu-id="c4a98-682">When an external ARP request is made that matches the current IP address of the interface that receives the ARP request, NetX Duo builds an ARP response message that contains the current physical address.</span></span>

<span data-ttu-id="c4a98-683">Os formatos de pedidos e respostas Ethernet ARP são mostrados na Figura 6 e são descritos abaixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-683">The formats of Ethernet ARP requests and responses are shown in Figure 6 and are described below.</span></span>

| <span data-ttu-id="c4a98-684">**Campo de Pedido/Resposta &nbsp;**</span><span class="sxs-lookup"><span data-stu-id="c4a98-684">**Request/Response&nbsp;Field**</span></span>         | <span data-ttu-id="c4a98-685">**Objetivo**</span><span class="sxs-lookup"><span data-stu-id="c4a98-685">**Purpose**</span></span>            |
| ---------------------------------- | ---------------------- |
| <span data-ttu-id="c4a98-686">***Endereço de destino Ethernet***</span><span class="sxs-lookup"><span data-stu-id="c4a98-686">***Ethernet Destination Address***</span></span> | <span data-ttu-id="c4a98-687">Este campo de 6 bytes contém o endereço de destino para a resposta ARP e é uma transmissão (todas) para pedidos ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-687">This 6-byte field contains the destination address for the ARP response and is a broadcast (all ones) for ARP requests.</span></span> <span data-ttu-id="c4a98-688">Este campo é configurado pelo controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-688">This field is setup by the network driver.</span></span> 
| <span data-ttu-id="c4a98-689">***Endereço de origem Ethernet***</span><span class="sxs-lookup"><span data-stu-id="c4a98-689">***Ethernet Source Address***</span></span>      | <span data-ttu-id="c4a98-690">Este campo de 6 bytes contém o endereço do remetente do pedido ou resposta ARP e é criado pelo controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-690">This 6-byte field contains the address of the sender of the ARP request or response and is set up by the network driver.</span></span> |
| <span data-ttu-id="c4a98-691">***Tipo de quadro***</span><span class="sxs-lookup"><span data-stu-id="c4a98-691">***Frame Type***</span></span> | <span data-ttu-id="c4a98-692">Este campo de 2 bytes contém o tipo de quadro Ethernet presente e, para pedidos e respostas ARP, este é igual a 0x0806.</span><span class="sxs-lookup"><span data-stu-id="c4a98-692">This 2-byte field contains the type of Ethernet frame present and, for ARP requests and responses, this is equal to 0x0806.</span></span> <span data-ttu-id="c4a98-693">Este é o último campo que o controlador de rede é responsável pela configuração.</span><span class="sxs-lookup"><span data-stu-id="c4a98-693">This is the last field the network driver is responsible for setting up.</span></span> |
| <span data-ttu-id="c4a98-694">***Tipo de hardware***</span><span class="sxs-lookup"><span data-stu-id="c4a98-694">***Hardware Type***</span></span> | <span data-ttu-id="c4a98-695">Este campo de 2 bytes contém o tipo de hardware, que é 0x0001 para o Ethernet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-695">This 2-byte field contains the hardware type, which is 0x0001 for Ethernet.</span></span> |
| <span data-ttu-id="c4a98-696">***Tipo de Protocolo***</span><span class="sxs-lookup"><span data-stu-id="c4a98-696">***Protocol Type***</span></span> | <span data-ttu-id="c4a98-697">Este campo de 2 bytes contém o tipo de protocolo, que é 0x0800 para endereços IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-697">This 2-byte field contains the protocol type, which is 0x0800 for IP addresses.</span></span> |
| <span data-ttu-id="c4a98-698">***Tamanho do hardware***</span><span class="sxs-lookup"><span data-stu-id="c4a98-698">***Hardware Size***</span></span> | <span data-ttu-id="c4a98-699">Este campo de 1 byte contém o tamanho do endereço de hardware, que é 6 para endereços Ethernet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-699">This 1-byte field contains the hardware address size, which is 6 for Ethernet addresses.</span></span> |

![Diagrama do Formato ARP Packet.](./media/user-guide/arp-packet-format.png)

<span data-ttu-id="c4a98-701">**FIGURA 6. Formato de pacote ARP**</span><span class="sxs-lookup"><span data-stu-id="c4a98-701">**FIGURE 6. ARP Packet Format**</span></span>

| <span data-ttu-id="c4a98-702">Campo de Pedido/Resposta &nbsp;</span><span class="sxs-lookup"><span data-stu-id="c4a98-702">Request/Response&nbsp;Field</span></span> | <span data-ttu-id="c4a98-703">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-703">Purpose</span></span> |
|---|---|
| <span data-ttu-id="c4a98-704">***Tamanho do protocolo***</span><span class="sxs-lookup"><span data-stu-id="c4a98-704">***Protocol Size***</span></span> | <span data-ttu-id="c4a98-705">Este campo de 1 byte contém o tamanho do endereço IP, que é 4 para endereços IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-705">This 1-byte field contains the IP address size, which is 4 for IP addresses.</span></span> |
| <span data-ttu-id="c4a98-706">***Código de Operação***</span><span class="sxs-lookup"><span data-stu-id="c4a98-706">***Operation Code***</span></span> | <span data-ttu-id="c4a98-707">Este campo de 2 bytes contém a operação para este pacote ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-707">This 2-byte field contains the operation for this ARP packet.</span></span> <span data-ttu-id="c4a98-708">Um pedido ARP é especificado com o valor de 0x0001, enquanto uma resposta ARP é representada por um valor de 0x0002.</span><span class="sxs-lookup"><span data-stu-id="c4a98-708">An ARP request is specified with the value of 0x0001, while an ARP response is represented by a value of 0x0002.</span></span> |
| <span data-ttu-id="c4a98-709">***Endereço Ethernet Ethernet***</span><span class="sxs-lookup"><span data-stu-id="c4a98-709">***Sender Ethernet Address***</span></span> | <span data-ttu-id="c4a98-710">Este campo de 6 bytes contém o endereço Ethernet do remetente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-710">This 6-byte field contains the sender's Ethernet address.</span></span> |
| <span data-ttu-id="c4a98-711">***Endereço IP remetente***</span><span class="sxs-lookup"><span data-stu-id="c4a98-711">***Sender IP Address***</span></span> | <span data-ttu-id="c4a98-712">Este campo de 4 bytes contém o endereço IP do remetente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-712">This 4-byte field contains the sender's IP address.</span></span> |
| <span data-ttu-id="c4a98-713">***Endereço Ethernet alvo***</span><span class="sxs-lookup"><span data-stu-id="c4a98-713">***Target Ethernet Address***</span></span> | <span data-ttu-id="c4a98-714">Este campo de 6 bytes contém o endereço Ethernet do alvo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-714">This 6-byte field contains the target's Ethernet address.</span></span> |
| <span data-ttu-id="c4a98-715">***Endereço IP alvo***</span><span class="sxs-lookup"><span data-stu-id="c4a98-715">***Target IP Address***</span></span> | <span data-ttu-id="c4a98-716">Este campo de 4 bytes contém o endereço IP do alvo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-716">This 4-byte field contains the target's IP address.</span></span> |

> [!NOTE]
> <span data-ttu-id="c4a98-717">*Os pedidos e respostas da ARP são pacotes ao nível da Ethernet. Todos os outros pacotes TCP/IP são encapsulados por um cabeçalho de pacote IP.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-717">*ARP requests and responses are Ethernet-level packets. All other TCP/IP packets are encapsulated by an IP packet header.*</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-718">*Espera-se que todas as mensagens ARP na implementação TCP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-718">*All ARP messages in the TCP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

### <a name="arp-aging"></a><span data-ttu-id="c4a98-719">Envelhecimento ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-719">ARP Aging</span></span>

<span data-ttu-id="c4a98-720">NetX suporta a invalidação de entrada ARP dinâmica automática.</span><span class="sxs-lookup"><span data-stu-id="c4a98-720">NetX supports automatic dynamic ARP entry invalidation.</span></span><span data-ttu-id="c4a98-721">\ ***NX_ARP_EXPIRATION_RATE** _ especifica o número de segundos que um endereço IP estabelecido para mapeamento físico permanece válido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-721">\ ***NX_ARP_EXPIRATION_RATE** _ specifies the number of seconds an established IP address to physical mapping stays valid.</span></span> <span data-ttu-id="c4a98-722">Após a expiração, a entrada ARP é removida da cache ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-722">After expiration, the ARP entry is removed from the ARP cache.</span></span> <span data-ttu-id="c4a98-723">A próxima tentativa de envio para o endereço IP correspondente resultará num novo pedido de ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-723">The next attempt to send to the corresponding IP address will result in a new ARP request.</span></span> <span data-ttu-id="c4a98-724">Definição _ *_NX_ARP_EXPIRATION_RATE_*\* a zero desativa o envelhecimento do ARP, que é a configuração padrão.</span><span class="sxs-lookup"><span data-stu-id="c4a98-724">Setting _ *_NX_ARP_EXPIRATION_RATE_*\* to zero disables ARP aging, which is the default configuration.</span></span>

### <a name="arp-defend"></a><span data-ttu-id="c4a98-725">ARP Defender</span><span class="sxs-lookup"><span data-stu-id="c4a98-725">ARP Defend</span></span>

<span data-ttu-id="c4a98-726">Quando um pacote de resposta ARP ou ARP é recebido e o remetente tem o mesmo endereço IP, que entra em conflito com o endereço IP deste nó, a NetX Duo envia um pedido ARP para esse endereço como defesa.</span><span class="sxs-lookup"><span data-stu-id="c4a98-726">When an ARP request or ARP response packet is received and the sender has the same IP address, which conflicts with the IP address of this node, NetX Duo sends an ARP request for that address as a defense.</span></span> <span data-ttu-id="c4a98-727">Se o pacote ARP de conflito for recebido mais de uma vez em 10 segundos, a NetX Duo não envia mais pacotes de defesa.</span><span class="sxs-lookup"><span data-stu-id="c4a98-727">If the conflict ARP packet is received more than once in 10 seconds, NetX Duo does not send more defend packets.</span></span> <span data-ttu-id="c4a98-728">O intervalo padrão de 10 segundos pode ser redefinido por \***NX_ARP_DEFEND_INTERVAL** _.</span><span class="sxs-lookup"><span data-stu-id="c4a98-728">The default interval 10 seconds can be redefined by \***NX_ARP_DEFEND_INTERVAL** _.</span></span> <span data-ttu-id="c4a98-729">Este comportamento segue a política especificada em 2.4(c) de RFC5227.</span><span class="sxs-lookup"><span data-stu-id="c4a98-729">This behavior follows the policy specified in 2.4(c) of RFC5227.</span></span> <span data-ttu-id="c4a98-730">Uma vez que o Windows XP ignora o anúncio do ARP como resposta para a sua sonda ARP, o utilizador pode definir _ *_NX_ARP_DEFEND_BY_REPLY_*\* para enviar a resposta ARP como defesa adicional.</span><span class="sxs-lookup"><span data-stu-id="c4a98-730">Since Windows XP ignores ARP announcement as a response for its ARP probe, user can define _ *_NX_ARP_DEFEND_BY_REPLY_*\* to send ARP response as additional defence.</span></span>

### <a name="arp-statistics-and-errors"></a><span data-ttu-id="c4a98-731">Estatísticas e erros da ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-731">ARP Statistics and Errors</span></span>

<span data-ttu-id="c4a98-732">Se ativado, o software ARP NetX Duo acompanha várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-732">If enabled, the NetX Duo ARP software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-733">São mantidas as seguintes estatísticas e relatórios de erro para o processamento de ARP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-733">The following statistics and error reports are maintained for each IP's ARP processing:</span></span>

- <span data-ttu-id="c4a98-734">Total de pedidos de ARP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-734">Total ARP Requests Sent</span></span>
- <span data-ttu-id="c4a98-735">Total de pedidos de ARP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-735">Total ARP Requests Received</span></span>
- <span data-ttu-id="c4a98-736">Total de respostas ARP enviadas</span><span class="sxs-lookup"><span data-stu-id="c4a98-736">Total ARP Responses Sent</span></span> 
- <span data-ttu-id="c4a98-737">Total de respostas ARP recebidas</span><span class="sxs-lookup"><span data-stu-id="c4a98-737">Total ARP Responses Received</span></span> 
- <span data-ttu-id="c4a98-738">Entradas dinâmicas totais do ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-738">Total ARP Dynamic Entries</span></span> 
- <span data-ttu-id="c4a98-739">Total de entradas estáticas ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-739">Total ARP Static Entries</span></span> 
- <span data-ttu-id="c4a98-740">Total de entradas envelhecidas em ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-740">Total ARP Aged Entries</span></span> 
- <span data-ttu-id="c4a98-741">Total de mensagens inválidas da ARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-741">Total ARP Invalid Messages</span></span> 

<span data-ttu-id="c4a98-742">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_arp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-742">All these statistics and error reports are available to the application with the ***nx_arp_info_get*** service.</span></span>

## <a name="reverse-address-resolution-protocol-rarp-in-ipv4"></a><span data-ttu-id="c4a98-743">Protocolo de Resolução de Endereços Reversos (RARP) no IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-743">Reverse Address Resolution Protocol (RARP) in IPv4</span></span>

<span data-ttu-id="c4a98-744">O Protocolo de Resolução de Endereços Reversos (RARP) é o protocolo para solicitar a atribuição de rede dos endereços IP de 32 bits do anfitrião (RFC 903).</span><span class="sxs-lookup"><span data-stu-id="c4a98-744">The Reverse Address Resolution Protocol (RARP) is the protocol for requesting network assignment of the host's 32-bit IP addresses (RFC 903).</span></span> <span data-ttu-id="c4a98-745">Isto é feito através de um pedido RARP e continua periodicamente até que um membro da rede atribua um endereço IP à interface de rede de anfitrião numa resposta RARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-745">This is done through an RARP request and continues periodically until a network member assigns an IP address to the host network interface in an RARP response.</span></span> <span data-ttu-id="c4a98-746">A aplicação cria uma instância IP pelo serviço ***nx_ip_create*** com um endereço IP zero.</span><span class="sxs-lookup"><span data-stu-id="c4a98-746">The application creates an IP instance by the service ***nx_ip_create*** with a zero IP address.</span></span> <span data-ttu-id="c4a98-747">Se o RARP estiver ativado pela aplicação, pode utilizar o protocolo RARP para solicitar um endereço IP a partir do servidor de rede acessível através da interface que tem um endereço IP zero.</span><span class="sxs-lookup"><span data-stu-id="c4a98-747">If RARP is enabled by the application, it can use the RARP protocol to request an IP address from the network server accessible through the interface that has a zero IP address.</span></span>

### <a name="rarp-enable"></a><span data-ttu-id="c4a98-748">Ativar RARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-748">RARP Enable</span></span>

<span data-ttu-id="c4a98-749">Para utilizar o RARP, a aplicação deve criar a instância IP com um endereço IP de zero e, em seguida, ativar o RARP utilizando o serviço ***nx_rarp_enable***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-749">To use RARP, the application must create the IP instance with an IP address of zero, then enable RARP using the service ***nx_rarp_enable***.</span></span> <span data-ttu-id="c4a98-750">Para os sistemas multihome, pelo menos um dispositivo de rede associado à instância IP deve ter um endereço IP de zero.</span><span class="sxs-lookup"><span data-stu-id="c4a98-750">For multihome systems, at least one network device associated with the IP instance must have an IP address of zero.</span></span> <span data-ttu-id="c4a98-751">O processamento rarp envia periodicamente mensagens de pedido rarp para o sistema NetX Duo que requer um endereço IP até que seja recebida uma resposta RARP válida com o endereço IP designado pela rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-751">The RARP processing periodically sends RARP request messages for the NetX Duo system requiring an IP address until a valid RARP reply with the network designated IP address is received.</span></span> <span data-ttu-id="c4a98-752">Neste momento, o processamento de RARP está completo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-752">At this point, RARP processing is complete.</span></span>

<span data-ttu-id="c4a98-753">Depois de o RARP ter sido ativado, este é desativado automaticamente depois de resolvidos todos os endereços de interface.</span><span class="sxs-lookup"><span data-stu-id="c4a98-753">After RARP has been enabled, it is disabled automatically after all interface addresses are resolved.</span></span> <span data-ttu-id="c4a98-754">O pedido pode forçar a RARP a encerrar utilizando o serviço ***nx_rarp_disable***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-754">The application may force RARP to terminate by using the service ***nx_rarp_disable***.</span></span>

### <a name="rarp-request"></a><span data-ttu-id="c4a98-755">Pedido RARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-755">RARP Request</span></span>

<span data-ttu-id="c4a98-756">O formato de um pacote de pedido RARP é quase idêntico ao pacote ARP indicado na [Figura 6](#arp-messages). A única diferença é que o campo do tipo de fotogramas é 0x8035 e o campo *Código de Operação* é 3, designando um pedido RARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-756">The format of an RARP request packet is almost identical to the ARP packet shown in [Figure 6](#arp-messages).The only difference is the frame type field is 0x8035 and the *Operation Code* field is 3, designating an RARP request.</span></span> <span data-ttu-id="c4a98-757">Como mencionado anteriormente, os pedidos de RARP serão enviados periodicamente (a cada ***NX_RARP_UPDATE_RATE*** segundos) até que seja recebida uma resposta RARP com o endereço IP atribuído à rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-757">As mentioned previously, RARP requests will be sent periodically (every ***NX_RARP_UPDATE_RATE*** seconds) until a RARP reply with the network assigned IP address is received.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-758">*Espera-se que todas as mensagens RARP na implementação TCP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-758">*All RARP messages in the TCP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

### <a name="rarp-reply"></a><span data-ttu-id="c4a98-759">Resposta RARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-759">RARP Reply</span></span>

<span data-ttu-id="c4a98-760">As mensagens de resposta RARP são recebidas da rede e contêm o endereço IP atribuído à rede para este anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-760">RARP reply messages are received from the network and contain the network assigned IP address for this host.</span></span> <span data-ttu-id="c4a98-761">O formato de um pacote de resposta RARP é quase idêntico ao pacote ARP indicado na Figura 6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-761">The format of an RARP reply packet is almost identical to the ARP packet shown in Figure 6.</span></span> <span data-ttu-id="c4a98-762">A única diferença é que o campo do tipo de fotogramas é 0x8035 e o campo *Código de Operação* é 4, que designa uma resposta RARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-762">The only difference is the frame type field is 0x8035 and the *Operation Code* field is 4, which designates an RARP reply.</span></span> <span data-ttu-id="c4a98-763">Depois de recebido, o endereço IP é configurado no caso IP, o pedido periódico de RARP é desativado, e a instância IP está agora pronta para o funcionamento normal da rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-763">After received, the IP address is setup in the IP instance, the periodic RARP request is disabled, and the IP instance is now ready for normal network operation.</span></span>

<span data-ttu-id="c4a98-764">Para os anfitriões multihome, o endereço IP é aplicado à interface de rede de pedidos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-764">For multihome hosts, the IP address is applied to the requesting network interface.</span></span> <span data-ttu-id="c4a98-765">Se existirem outras interfaces de rede que ainda solicitam uma atribuição de endereço IP, o serviço raRP periódico continua até que todos os pedidos de endereço IP de interface sejam resolvidos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-765">If there are other network interfaces still requesting an IP address assignment, the periodic RARP service continues until all interface IP address requests are resolved.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-766">*O pedido não deve utilizar a instância IP até que o processamento rarp esteja completo. O **nx_ip_status_check** pode ser utilizado por aplicações para aguardar a conclusão do RARP. Para sistemas multihome, a aplicação não deve utilizar a interface de pedido até que o processamento rarp esteja completo nessa interface. O estado do endereço IP no dispositivo secundário pode ser verificado com o serviço **nx_ip_interface_status_check.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-766">*The application should not use the IP instance until the RARP processing is complete. The **nx_ip_status_check** may be used by applications to wait for the RARP completion. For multihome systems, the application should not use the requesting interface until the RARP processing is complete on that interface. Status of the IP address on the secondary device can be checked with the **nx_ip_interface_status_check** service.*</span></span>

### <a name="rarp-statistics-and-errors"></a><span data-ttu-id="c4a98-767">Estatísticas e erros da RARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-767">RARP Statistics and Errors</span></span>

<span data-ttu-id="c4a98-768">Se ativado, o software RARP netx Duo acompanha várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-768">If enabled, the NetX Duo RARP software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-769">São mantidas as seguintes estatísticas e relatórios de erro para o processamento de RARP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-769">The following statistics and error reports are maintained for each IP's RARP processing:</span></span>

- <span data-ttu-id="c4a98-770">Total de pedidos de RARP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-770">Total RARP Requests Sent</span></span>
- <span data-ttu-id="c4a98-771">Total de respostas rarp recebidas</span><span class="sxs-lookup"><span data-stu-id="c4a98-771">Total RARP Responses Received</span></span>
- <span data-ttu-id="c4a98-772">Total de mensagens inválidas da RARP</span><span class="sxs-lookup"><span data-stu-id="c4a98-772">Total RARP Invalid Messages</span></span>

<span data-ttu-id="c4a98-773">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_rarp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-773">All these statistics and error reports are available to the application with the ***nx_rarp_info_get*** service.</span></span>

## <a name="internet-control-message-protocol-icmp"></a><span data-ttu-id="c4a98-774">Protocolo de mensagem de controlo da Internet (ICMP)</span><span class="sxs-lookup"><span data-stu-id="c4a98-774">Internet Control Message Protocol (ICMP)</span></span>

<span data-ttu-id="c4a98-775">O Protocolo de Mensagem de Controlo de Internet para IPv4 (ICMP) limita-se a passar informações de erro e controlo entre membros da rede IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-775">Internet Control Message Protocol for IPv4 (ICMP) is limited to passing error and control information between IP network members.</span></span> <span data-ttu-id="c4a98-776">O Protocolo de Mensagem de Controlo de Internet para iPv6 (ICMPv6) também lida com informações de erro e controlo e é necessário para protocolos de resolução de endereços, tais como Duplicado Deteção de Endereços (DAD) e autoconfiguação de endereços apátridas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-776">Internet Control Message Protocol for IPv6 (ICMPv6) also handles error and control information and is required for address resolution protocols such as Duplicate Address Detection (DAD) and stateless address autoconfiguration.</span></span>

<span data-ttu-id="c4a98-777">Tal como a maioria das outras mensagens de camada de aplicação (por exemplo, TCP/IP), as mensagens ICMP e ICMPv6 são encapsuladas por um cabeçalho IP com a designação do protocolo ICMP (ou ICMPv6).</span><span class="sxs-lookup"><span data-stu-id="c4a98-777">Like most other application layer (e.g., TCP/IP) messages, ICMP and ICMPv6 messages are encapsulated by an IP header with the ICMP (or ICMPv6) protocol designation.</span></span>

### <a name="icmp-statistics-and-errors"></a><span data-ttu-id="c4a98-778">Estatísticas e erros do ICMP</span><span class="sxs-lookup"><span data-stu-id="c4a98-778">ICMP Statistics and Errors</span></span>

<span data-ttu-id="c4a98-779">Se ativado, o NetX Duo regista várias estatísticas e erros do ICMP que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-779">If enabled, NetX Duo keeps track of several ICMP statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-780">São mantidas as seguintes estatísticas e relatórios de erro para o processamento do ICMP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-780">The following statistics and error reports are maintained for each IP's ICMP processing:</span></span> 

- <span data-ttu-id="c4a98-781">Total de pings ICMP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-781">Total ICMP Pings Sent</span></span>  
- <span data-ttu-id="c4a98-782">Total de tempo de ping ICMP</span><span class="sxs-lookup"><span data-stu-id="c4a98-782">Total ICMP Ping Timeouts</span></span> 
- <span data-ttu-id="c4a98-783">Fios de ping total do ICMP suspensos</span><span class="sxs-lookup"><span data-stu-id="c4a98-783">Total ICMP Ping Threads Suspended</span></span> 
- <span data-ttu-id="c4a98-784">Total de respostas de ping do ICMP recebidas</span><span class="sxs-lookup"><span data-stu-id="c4a98-784">Total ICMP Ping Responses Received</span></span> 
- <span data-ttu-id="c4a98-785">Erros totais de verificação do ICMP</span><span class="sxs-lookup"><span data-stu-id="c4a98-785">Total ICMP Checksum Errors</span></span> 
- <span data-ttu-id="c4a98-786">Total de mensagens não manipuladas do ICMP</span><span class="sxs-lookup"><span data-stu-id="c4a98-786">Total ICMP Unhandled Messages</span></span> 

<span data-ttu-id="c4a98-787">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_icmp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-787">All these statistics and error reports are available to the application with the ***nx_icmp_info_get*** service.</span></span>

## <a name="icmpv4-services-in-netx-duo"></a><span data-ttu-id="c4a98-788">Serviços ICMPv4 em NetX Duo</span><span class="sxs-lookup"><span data-stu-id="c4a98-788">ICMPv4 Services in NetX Duo</span></span>

### <a name="icmpv4-enable"></a><span data-ttu-id="c4a98-789">ICMPv4 Ativar</span><span class="sxs-lookup"><span data-stu-id="c4a98-789">ICMPv4 Enable</span></span>

<span data-ttu-id="c4a98-790">Antes de as mensagens ICMPv4 poderem ser processadas pela NetX Duo, a aplicação deve ligar para o serviço ***nx_icmp_enable*** para permitir o processamento do ICMPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-790">Before ICMPv4 messages can be processed by NetX Duo, the application must call the ***nx_icmp_enable*** service to enable ICMPv4 processing.</span></span> <span data-ttu-id="c4a98-791">Depois disso, a aplicação pode emitir pedidos de ping e pacotes de ping de entrada no campo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-791">After this is done, the application can issue ping requests and field incoming ping packets.</span></span>  

### <a name="icmpv4-echo-request"></a><span data-ttu-id="c4a98-792">Pedido de Eco ICMPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-792">ICMPv4 Echo Request</span></span>

<span data-ttu-id="c4a98-793">Um pedido de eco é um tipo de mensagem ICMPv4 que é normalmente usada para verificar a existência de um nó específico na rede, identificado pelo seu endereço IP anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-793">An echo request is one type of ICMPv4 message that is typically used to check for the existence of a specific node on the network, as identified by its host IP address.</span></span> <span data-ttu-id="c4a98-794">O comando de ping popular é implementado usando mensagens de pedido de eco/eco ICMP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-794">The popular ping command is implemented using ICMP echo request/echo reply messages.</span></span> <span data-ttu-id="c4a98-795">Se o anfitrião específico estiver presente, a sua pilha de rede processa o pedido de ping e as respostas com uma resposta de ping.</span><span class="sxs-lookup"><span data-stu-id="c4a98-795">If the specific host is present, its network stack processes the ping request and responses with a ping response.</span></span> <span data-ttu-id="c4a98-796">A Figura 7 detalha o formato de mensagem de ping ICMPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-796">Figure 7 details the ICMPv4 ping message format.</span></span>

![Mensagem de ping ICMPv4](./media/user-guide/icmpv4-ping-message.png)  

<span data-ttu-id="c4a98-798">**FIGURA 7. Mensagem de ping ICMPv4**</span><span class="sxs-lookup"><span data-stu-id="c4a98-798">**FIGURE 7. ICMPv4 Ping Message**</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-799">*Espera-se que todas as mensagens ICMPv4 na implementação TCP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-799">*All ICMPv4 messages in the TCP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

<span data-ttu-id="c4a98-800">O seguinte descreve o formato do cabeçalho ICMPv4:</span><span class="sxs-lookup"><span data-stu-id="c4a98-800">The following describes the ICMPv4 header format:</span></span>

|<span data-ttu-id="c4a98-801">Campo de Cabeçalho</span><span class="sxs-lookup"><span data-stu-id="c4a98-801">Header Field</span></span> |<span data-ttu-id="c4a98-802">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-802">Purpose</span></span> |
|---|---|
|<span data-ttu-id="c4a98-803">**Tipo**</span><span class="sxs-lookup"><span data-stu-id="c4a98-803">**Type**</span></span> |<span data-ttu-id="c4a98-804">Este campo especifica a mensagem ICMPv4 (bits 31-24).</span><span class="sxs-lookup"><span data-stu-id="c4a98-804">This field specifies the ICMPv4 message (bits 31-24).</span></span> <span data-ttu-id="c4a98-805">Os mais comuns são:</span><span class="sxs-lookup"><span data-stu-id="c4a98-805">The most common are:</span></span><br /><span data-ttu-id="c4a98-806">- 0: Resposta do eco</span><span class="sxs-lookup"><span data-stu-id="c4a98-806">-  0: Echo Reply</span></span><br /><span data-ttu-id="c4a98-807">- 3: Destino Inalcançável</span><span class="sxs-lookup"><span data-stu-id="c4a98-807">- 3: Destination Unreachable</span></span><br /><span data-ttu-id="c4a98-808">- 8: Pedido de Eco</span><span class="sxs-lookup"><span data-stu-id="c4a98-808">- 8: Echo Request</span></span><br /><span data-ttu-id="c4a98-809">- 11: Tempo excedido</span><span class="sxs-lookup"><span data-stu-id="c4a98-809">- 11: Time Exceeded</span></span><br /><span data-ttu-id="c4a98-810">- 12: Problema dos parâmetros</span><span class="sxs-lookup"><span data-stu-id="c4a98-810">- 12: Parameter Problem</span></span> |
|<span data-ttu-id="c4a98-811">**Código**</span><span class="sxs-lookup"><span data-stu-id="c4a98-811">**Code**</span></span> |<span data-ttu-id="c4a98-812">Este campo é de contexto específico no campo tipo (bits 23-16).</span><span class="sxs-lookup"><span data-stu-id="c4a98-812">This field is context specific on the type field (bits 23-16).</span></span> <span data-ttu-id="c4a98-813">Para um pedido de eco ou resposta, o código está definido para zero.</span><span class="sxs-lookup"><span data-stu-id="c4a98-813">For an echo request or reply the code is set to zero.</span></span>|
|<span data-ttu-id="c4a98-814">**Checkum**</span><span class="sxs-lookup"><span data-stu-id="c4a98-814">**Checksum**</span></span> |<span data-ttu-id="c4a98-815">Este campo contém a parte de verificação de 16 bits da soma complementar da mensagem ICMPv4, incluindo todo o cabeçalho ICMPv4 a começar pelo campo Tipo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-815">This field contains the 16-bit checksum of the one's complement sum of the ICMPv4 message including the entire the ICMPv4 header starting with the Type field.</span></span> <span data-ttu-id="c4a98-816">Antes de gerar a caixa de verificação, o campo de verificação está limpo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-816">Before generating the checksum, the checksum field is cleared.</span></span>|
|<span data-ttu-id="c4a98-817">**Identificação**</span><span class="sxs-lookup"><span data-stu-id="c4a98-817">**Identification**</span></span> | <span data-ttu-id="c4a98-818">Este campo contém um valor de identificação que identifica o hospedeiro; um hospedeiro deve utilizar o ID extraído de um pedido DE ECO na RESPOSTA ECHO (bits 31-16).</span><span class="sxs-lookup"><span data-stu-id="c4a98-818">This field contains an ID value identifying the host; a host should use the ID extracted from an ECHO request in the ECHO REPLY (bits 31-16).</span></span>|
|<span data-ttu-id="c4a98-819">**Número de sequência**</span><span class="sxs-lookup"><span data-stu-id="c4a98-819">**Sequence number**</span></span> |<span data-ttu-id="c4a98-820">Este campo contém um valor de ID; um hospedeiro deve utilizar o ID extraído de um pedido DE ECO na RESPOSTA ECHO (bits 31-16).</span><span class="sxs-lookup"><span data-stu-id="c4a98-820">This field contains an ID value; a host should use the ID extracted from an ECHO request in the ECHO REPLY (bits 31-16).</span></span> <span data-ttu-id="c4a98-821">Ao contrário do campo do identificador, este valor mudará num pedido de Eco subsequente do mesmo anfitrião (bits 15-0).</span><span class="sxs-lookup"><span data-stu-id="c4a98-821">Unlike the identifier field, this value will change in a subsequent Echo request from the same host (bits 15-0).</span></span>|

### <a name="icmpv4-echo-response"></a><span data-ttu-id="c4a98-822">Resposta do Eco ICMPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-822">ICMPv4 Echo Response</span></span>    
<span data-ttu-id="c4a98-823">Uma resposta de ping é outro tipo de mensagem ICMP que é gerada internamente pela componente ICMP em resposta a um pedido externo de ping.</span><span class="sxs-lookup"><span data-stu-id="c4a98-823">A ping response is another type of ICMP message that is generated internally by the ICMP component in response to an external ping request.</span></span> <span data-ttu-id="c4a98-824">Além do reconhecimento, a resposta ao ping contém também uma cópia dos dados do utilizador fornecidos no pedido de ping.</span><span class="sxs-lookup"><span data-stu-id="c4a98-824">In addition to acknowledgement, the ping response also contains a copy of the user data supplied in the ping request.</span></span>

### <a name="icmpv4-error-messages"></a><span data-ttu-id="c4a98-825">Mensagens de erro ICMPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-825">ICMPv4 Error Messages</span></span>   
<span data-ttu-id="c4a98-826">As seguintes mensagens de erro ICMPv4 são suportadas no NetX Duo:</span><span class="sxs-lookup"><span data-stu-id="c4a98-826">The following ICMPv4 error messages are supported in NetX Duo:</span></span> 
- <span data-ttu-id="c4a98-827">Destino Inacessível</span><span class="sxs-lookup"><span data-stu-id="c4a98-827">Destination Unreachable</span></span> 
- <span data-ttu-id="c4a98-828">Exceder o tempo</span><span class="sxs-lookup"><span data-stu-id="c4a98-828">Time Exceed</span></span> 
- <span data-ttu-id="c4a98-829">Problema de parâmetros</span><span class="sxs-lookup"><span data-stu-id="c4a98-829">Parameter Problem</span></span>

## <a name="internet-group-management-protocol-igmp"></a><span data-ttu-id="c4a98-830">Protocolo de Gestão do Grupo de Internet (IGMP)</span><span class="sxs-lookup"><span data-stu-id="c4a98-830">Internet Group Management Protocol (IGMP)</span></span>

<span data-ttu-id="c4a98-831">O Protocolo de Gestão do Grupo internet (IGMP) fornece um dispositivo para comunicar com os seus vizinhos e seus routers que pretende receber, ou aderir, um grupo multicast IPv4 (RFC 1112 e RFC 2236).</span><span class="sxs-lookup"><span data-stu-id="c4a98-831">The Internet Group Management Protocol (IGMP) provides a device to communicate with its neighbors and its routers that it intends to receive, or join, an IPv4 multicast group (RFC 1112 and RFC 2236).</span></span> <span data-ttu-id="c4a98-832">Um grupo multicast é basicamente uma coleção dinâmica de membros da rede e é representado por um endereço IP classe D.</span><span class="sxs-lookup"><span data-stu-id="c4a98-832">A multicast group is basically a dynamic collection of network members and is represented by a Class D IP address.</span></span> <span data-ttu-id="c4a98-833">Os membros do grupo multicast podem sair a qualquer momento, e os novos membros podem aderir a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="c4a98-833">Members of the multicast group may leave at any time, and new members may join at any time.</span></span> <span data-ttu-id="c4a98-834">A coordenação envolvida na adesão e saída do grupo é da responsabilidade do IGMP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-834">The coordination involved in joining and leaving the group is the responsibility of IGMP.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-835">*O IGMP é projetado apenas para grupos multicast IPv4. Não pode ser utilizado na rede IPv6.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-835">*IGMP is designed only for IPv4 multicast groups. It cannot be used on the IPv6 network.*</span></span>

### <a name="igmp-enable"></a><span data-ttu-id="c4a98-836">IGMP Ativar</span><span class="sxs-lookup"><span data-stu-id="c4a98-836">IGMP Enable</span></span>     
<span data-ttu-id="c4a98-837">Antes de qualquer atividade multicasting poder ocorrer no NetX Duo, a aplicação deve ligar para o ***serviço nx_igmp_enable.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-837">Before any multicasting activity can take place in NetX Duo, the application must call the ***nx_igmp_enable*** service.</span></span> <span data-ttu-id="c4a98-838">Este serviço realiza a inicialização básica do IGMP em preparação para pedidos multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-838">This service performs basic IGMP initialization in preparation for multicast requests.</span></span>

### <a name="multicast-ipv4-addressing"></a><span data-ttu-id="c4a98-839">Endereço IPv4 multicast</span><span class="sxs-lookup"><span data-stu-id="c4a98-839">Multicast IPv4 Addressing</span></span>  
<span data-ttu-id="c4a98-840">Como mencionado anteriormente, os endereços multicast são, na verdade, endereços IP de classe D, tal como mostrado na [Figura 4](#ipv4-addresses).</span><span class="sxs-lookup"><span data-stu-id="c4a98-840">As mentioned previously, multicast addresses are actually Class D IP addresses as shown in [Figure 4](#ipv4-addresses).</span></span> <span data-ttu-id="c4a98-841">Os 28 bits inferiores do endereço classe D correspondem ao ID do grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-841">The lower 28-bits of the Class D address correspond to the multicast group ID.</span></span> <span data-ttu-id="c4a98-842">Existem uma série de endereços multicast pré-definidos; no entanto, o *endereço de todos os anfitriões* (244.0.0.1) é particularmente importante para o processamento do IGMP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-842">There are a series of pre-defined multicast addresses; however, the *all hosts address* (244.0.0.1) is particularly important to IGMP processing.</span></span> <span data-ttu-id="c4a98-843">O *endereço de todos os anfitriões* é utilizado pelos routers para consultar todos os membros multicasts para informar em que grupos multicast pertencem.</span><span class="sxs-lookup"><span data-stu-id="c4a98-843">The *all hosts address* is used by routers to query all multicast members to report on which multicast groups they belong to.</span></span>  

### <a name="physical-address-mapping-in-ipv4"></a><span data-ttu-id="c4a98-844">Mapeamento de endereço físico no IPv4</span><span class="sxs-lookup"><span data-stu-id="c4a98-844">Physical Address Mapping in IPv4</span></span>
<span data-ttu-id="c4a98-845">Endereços multicast classe D mapeam diretamente para endereços físicos Ethernet variando de 01.00.5e.00.00.00 a 01.00.5e.7f.ff.ff.</span><span class="sxs-lookup"><span data-stu-id="c4a98-845">Class D multicast addresses map directly to physical Ethernet addresses ranging from 01.00.5e.00.00.00 through 01.00.5e.7f.ff.ff.</span></span> <span data-ttu-id="c4a98-846">Os 23 bits inferiores do mapa de endereços multicast IP diretamente para os 23 bits inferiores do endereço Ethernet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-846">The lower 23 bits of the IP multicast address map directly to the lower 23 bits of the Ethernet address.</span></span>

### <a name="multicast-group-join"></a><span data-ttu-id="c4a98-847">Grupo Multicast Junta-se</span><span class="sxs-lookup"><span data-stu-id="c4a98-847">Multicast Group Join</span></span>
<span data-ttu-id="c4a98-848">As aplicações que precisam de aderir a um determinado grupo multicast podem fazê-lo chamando o ***serviço nx_igmp_multicast_join.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-848">Applications that need to join a particular multicast group may do so by calling the ***nx_igmp_multicast_join*** service.</span></span> <span data-ttu-id="c4a98-849">Este serviço acompanha o número de pedidos para se juntar a este grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-849">This service keeps track of the number of requests to join this multicast group.</span></span> <span data-ttu-id="c4a98-850">Se este for o primeiro pedido de candidatura para aderir ao grupo multicast, é enviado um relatório IGMP na rede primária indicando a intenção deste anfitrião de se juntar ao grupo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-850">If this is the first application requestto join the multicast group, an IGMP report is sent out on the primary network indicating this host's intention to join the group.</span></span> <span data-ttu-id="c4a98-851">Em seguida, o controlador de rede é chamado a configurar para ouvir pacotes com o endereço Ethernet para este grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-851">Next, the network driver is called to set up for listening for packets with the Ethernet address for this multicast group.</span></span>

<span data-ttu-id="c4a98-852">Num sistema multihome, se o grupo multicast estiver acessível através de uma interface específica, a aplicação utilizará o serviço ***nx_igmp_multicast_interface_join** _ em vez de _*_nx_igmp_multicast_join_\*\*, que se limita a grupos multicast na rede primária.</span><span class="sxs-lookup"><span data-stu-id="c4a98-852">In a multihome system, if the multicast group is accessible via a specific interface, application shall use the service ***nx_igmp_multicast_interface_join** _ instead of _*_nx_igmp_multicast_join_\*\*, which is limited to multicast groups on the primary network.</span></span>

### <a name="multicast-group-leave"></a><span data-ttu-id="c4a98-853">Licença de grupo multicast</span><span class="sxs-lookup"><span data-stu-id="c4a98-853">Multicast Group Leave</span></span>   
<span data-ttu-id="c4a98-854">As aplicações que necessitem de deixar um grupo multicast previamente aderido podem fazê-lo chamando o ***serviço nx_igmp_multicast_leave.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-854">Applications that need to leave a previously joined multicast group may do so by calling the ***nx_igmp_multicast_leave*** service.</span></span> <span data-ttu-id="c4a98-855">Este serviço reduz a contagem interna associada à quantidade de vezes que o grupo se juntou.</span><span class="sxs-lookup"><span data-stu-id="c4a98-855">This service reduces the internal count associated with how many times the group was joined.</span></span> <span data-ttu-id="c4a98-856">Se não houver pedidos de participação pendentes para um grupo, o controlador de rede é chamado a desativar a audição de pacotes com o endereço Ethernet deste grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-856">If there are no outstanding join requests for a group, the network driver is called to disable listening for packets with this multicast group's Ethernet address.</span></span>

### <a name="multicast-loopback"></a><span data-ttu-id="c4a98-857">Multicast Loopback</span><span class="sxs-lookup"><span data-stu-id="c4a98-857">Multicast Loopback</span></span>    
<span data-ttu-id="c4a98-858">Um pedido pode pretender receber tráfego multicast originário de uma das fontes no mesmo nó.</span><span class="sxs-lookup"><span data-stu-id="c4a98-858">An application may wish to receive multicast traffic originated from one of the sources on the same node.</span></span> <span data-ttu-id="c4a98-859">Isto requer que o componente multicast IP tenha o loopback ativado utilizando o serviço ***nx_igmp_loopback_enable***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-859">This requires the IP multicast component to have loopback enabled by using the service ***nx_igmp_loopback_enable***.</span></span>

### <a name="igmp-report-message"></a><span data-ttu-id="c4a98-860">Mensagem de relatório IGMP</span><span class="sxs-lookup"><span data-stu-id="c4a98-860">IGMP Report Message</span></span>      
<span data-ttu-id="c4a98-861">Quando a aplicação se junta a um grupo multicast, uma mensagem de relatório IGMP é enviada através da rede para indicar a intenção do anfitrião de se juntar a um determinado grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-861">When the application joins a multicast group, an IGMP report message is sent via the network to indicate the host's intention to join a particular multicast group.</span></span> <span data-ttu-id="c4a98-862">O formato da mensagem de relatório IGMP é mostrado na Figura 8.</span><span class="sxs-lookup"><span data-stu-id="c4a98-862">The format of the IGMP report message is shown in Figure 8.</span></span> <span data-ttu-id="c4a98-863">O endereço de grupo multicast é utilizado tanto para a mensagem de grupo na mensagem de relatório IGMP como para o endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-863">The multicast group address is used for both the group message in the IGMP report message and the destination IP address.</span></span>

<span data-ttu-id="c4a98-864">Na figura acima (Figura 8), o cabeçalho IGMP contém uma versão/tipo de campo, resposta máxima</span><span class="sxs-lookup"><span data-stu-id="c4a98-864">In the figure above (Figure 8), the IGMP header contains a version/type field, maximum response</span></span>

![Diagrama de uma mensagem de relatório IGMP.](./media/user-guide/image17.jpg)

<span data-ttu-id="c4a98-866">**FIGURA 8. Mensagem de relatório IGMP**</span><span class="sxs-lookup"><span data-stu-id="c4a98-866">**FIGURE 8. IGMP Report Message**</span></span>

<span data-ttu-id="c4a98-867">tempo, um campo de verificação e um campo de endereços de grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-867">time, a checksum field, and a multicast group address field.</span></span> <span data-ttu-id="c4a98-868">Para as mensagens IGMPv1, o campo Tempo de Resposta Máxima está sempre definido para zero, uma vez que este não faz parte do protocolo IGMPv1.</span><span class="sxs-lookup"><span data-stu-id="c4a98-868">For IGMPv1 messages, the Maximum Response Time field is always set to zero, as this is not part of the IGMPv1 protocol.</span></span> <span data-ttu-id="c4a98-869">O campo Tempo de Resposta Máxima é definido quando o anfitrião recebe uma mensagem IGMP tipo consulta e apurada quando um anfitrião recebe a mensagem do tipo Relatório de outro anfitrião, tal como definido pelo protocolo IGMPv2.</span><span class="sxs-lookup"><span data-stu-id="c4a98-869">The Maximum Response Time field is set when the host receives a Query type IGMP message and cleared when a host receives another host's Report type message as defined by the IGMPv2 protocol.</span></span>

<span data-ttu-id="c4a98-870">O seguinte descreve o formato do cabeçalho IGMP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-870">The following describes the IGMP header format:</span></span>

|<span data-ttu-id="c4a98-871">Campo de Cabeçalho</span><span class="sxs-lookup"><span data-stu-id="c4a98-871">Header Field</span></span>|<span data-ttu-id="c4a98-872">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-872">Purpose</span></span>|
|---|---|
|<span data-ttu-id="c4a98-873">**Versão**</span><span class="sxs-lookup"><span data-stu-id="c4a98-873">**Version**</span></span> |<span data-ttu-id="c4a98-874">Este campo especifica a versão IGMP (bits 31-28).</span><span class="sxs-lookup"><span data-stu-id="c4a98-874">This field specifies the IGMP version (bits 31- 28).</span></span>|
|<span data-ttu-id="c4a98-875">**Tipo**</span><span class="sxs-lookup"><span data-stu-id="c4a98-875">**Type**</span></span> |<span data-ttu-id="c4a98-876">Este campo especifica o tipo de mensagem IGMP (bits 27-24).</span><span class="sxs-lookup"><span data-stu-id="c4a98-876">This field specifies the type of IGMP message (bits 27 -24).</span></span>|
|<span data-ttu-id="c4a98-877">**Tempo máximo de resposta**</span><span class="sxs-lookup"><span data-stu-id="c4a98-877">**Maximum Response Time**</span></span> |<span data-ttu-id="c4a98-878">Não utilizado em IGMP v1.</span><span class="sxs-lookup"><span data-stu-id="c4a98-878">Not used in IGMP v1.</span></span> <span data-ttu-id="c4a98-879">No IGMP v2 este campo serve como o tempo máximo de resposta.</span><span class="sxs-lookup"><span data-stu-id="c4a98-879">In IGMP v2 this field serves as the maximum response time.</span></span>|
|<span data-ttu-id="c4a98-880">**Checkum**</span><span class="sxs-lookup"><span data-stu-id="c4a98-880">**Checksum**</span></span> |<span data-ttu-id="c4a98-881">Este campo contém a parte de verificação de 16 bits da soma de complemento da mensagem IGMP a começar pela versão IGMP (bits 0-15)</span><span class="sxs-lookup"><span data-stu-id="c4a98-881">This field contains the 16-bit checksum of the one's complement sum of the IGMP message starting with the IGMP version (bits 0-15)</span></span>|
|<span data-ttu-id="c4a98-882">**Endereço de grupo**</span><span class="sxs-lookup"><span data-stu-id="c4a98-882">**Group Address**</span></span> |<span data-ttu-id="c4a98-883">Endereço IP do grupo D de 32 bits</span><span class="sxs-lookup"><span data-stu-id="c4a98-883">32-bit class D group IP address</span></span>|

<span data-ttu-id="c4a98-884">As mensagens de relatório IGMP também são enviadas em resposta às mensagens de consulta IGMP enviadas por um router multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-884">IGMP report messages are also sent in response to IGMP query messages sent by a multicast router.</span></span> <span data-ttu-id="c4a98-885">Os routers multicast enviam periodicamente mensagens de consulta para ver quais os anfitriões que ainda precisam de ser membros do grupo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-885">Multicast routers periodically send query messages out to see which hosts still require group membership.</span></span> <span data-ttu-id="c4a98-886">As mensagens de consulta têm o mesmo formato que a mensagem IGMP Report mostrada na Figura 8.</span><span class="sxs-lookup"><span data-stu-id="c4a98-886">Query messages have the same format as the IGMP Report message shown in Figure 8.</span></span> <span data-ttu-id="c4a98-887">As únicas diferenças são que o tipo IGMP é igual a 1 e o campo de endereços de grupo está definido para 0.</span><span class="sxs-lookup"><span data-stu-id="c4a98-887">The only differences are the IGMP type is equal to 1 and the group address field is set to 0.</span></span> <span data-ttu-id="c4a98-888">As mensagens de consulta IGMP são enviadas para o endereço IP *de todos os anfitriões* pelo router multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-888">IGMP Query messages are sent to the *all hosts* IP address by the multicast router.</span></span> <span data-ttu-id="c4a98-889">Um anfitrião que ainda deseja manter a adesão ao grupo responde enviando outra mensagem do IGMP Report.</span><span class="sxs-lookup"><span data-stu-id="c4a98-889">A host that still wishes to maintain group membership responds by sending another IGMP Report message.</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-890">*Espera-se que todas as mensagens na implementação TCP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-890">*All messages in the TCP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

### <a name="igmp-statistics-and-errors"></a><span data-ttu-id="c4a98-891">Estatísticas e erros do IGMP</span><span class="sxs-lookup"><span data-stu-id="c4a98-891">IGMP Statistics and Errors</span></span>    
<th><p><span data-ttu-id="c4a98-892">Se ativado, o software NetX Duo IGMP acompanha várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-892">If enabled, the NetX Duo IGMP software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-893">São mantidas as seguintes estatísticas e relatórios de erro para o processamento de IGMP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-893">The following statistics and error reports are maintained for each IP's IGMP processing:</span></span> 

- <span data-ttu-id="c4a98-894">Total de relatórios IGMP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-894">Total IGMP Reports Sent</span></span> 
- <span data-ttu-id="c4a98-895">Total de consultas IGMP recebidas</span><span class="sxs-lookup"><span data-stu-id="c4a98-895">Total IGMP Queries Received</span></span> 
- <span data-ttu-id="c4a98-896">Erros totais do IGMP Checksum</span><span class="sxs-lookup"><span data-stu-id="c4a98-896">Total IGMP Checksum Errors</span></span> 
- <span data-ttu-id="c4a98-897">Total de grupos atuais do IGMP aderidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-897">Total IGMP Current Groups Joined</span></span> 

<span data-ttu-id="c4a98-898">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_igmp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-898">All these statistics and error reports are available to the application with the ***nx_igmp_info_get*** service.</span></span> 

### <a name="multicast-without-igmp"></a><span data-ttu-id="c4a98-899">Multicast sem IGMP</span><span class="sxs-lookup"><span data-stu-id="c4a98-899">Multicast without IGMP</span></span>  
<span data-ttu-id="c4a98-900">A aplicação que espera o tráfego multicast IPv4 pode juntar-se a um endereço de grupo multicast sem invocar mensagens IGMP utilizando o serviço ***nx_ipv4_multicast_interface_join***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-900">Application expecting IPv4 multicast traffic can join a multicast group address without invoking IGMP messages by using the service ***nx_ipv4_multicast_interface_join***.</span></span> <span data-ttu-id="c4a98-901">Este serviço instrui a camada IPv4 e o controlador de interface subjacente a aceitar pacotes do endereço multicast IPv4 designado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-901">This service instructs the IPv4 layer and the underlying interface driver to accept packets from the designated IPv4 multicast address.</span></span> <span data-ttu-id="c4a98-902">No entanto, não há mensagens de gestão do grupo IGMP enviadas ou processadas para este grupo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-902">However there is no IGMP group management messages being sent or processed for this group.</span></span>

<span data-ttu-id="c4a98-903">A aplicação já não pretende receber tráfego do grupo pode utilizar o ***serviço nx_ipv4_multicast_interface_leave.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-903">Application no longer wish to receive traffic from the group can use the service ***nx_ipv4_multicast_interface_leave.***</span></span>

## <a name="ipv6-in-netx-duo"></a><span data-ttu-id="c4a98-904">IPv6 em NetX Duo</span><span class="sxs-lookup"><span data-stu-id="c4a98-904">IPv6 in NetX Duo</span></span>

### <a name="ipv6-addresses"></a><span data-ttu-id="c4a98-905">Endereços IPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-905">IPv6 Addresses</span></span>   
<span data-ttu-id="c4a98-906">Os endereços IPv6 são 128 bits.</span><span class="sxs-lookup"><span data-stu-id="c4a98-906">IPv6 addresses are 128 bits.</span></span> <span data-ttu-id="c4a98-907">A arquitetura do endereço IPv6 é descrita no RFC 4291.</span><span class="sxs-lookup"><span data-stu-id="c4a98-907">The architecture of IPv6 address is described in RFC 4291.</span></span> <span data-ttu-id="c4a98-908">O endereço é dividido num prefixo que contém as partes mais significativas e um endereço de anfitrião contendo as partes inferiores.</span><span class="sxs-lookup"><span data-stu-id="c4a98-908">The address is divided into a prefix containing the most significant bits and a host address containing the lower bits.</span></span> <span data-ttu-id="c4a98-909">O prefixo indica o tipo de endereço e é aproximadamente o equivalente ao endereço de rede na rede IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-909">The prefix indicates the type of address and is roughly the equivalent of the network address in IPv4 network.</span></span>

<span data-ttu-id="c4a98-910">O IPv6 tem três tipos de especificações de endereço: unicast, anycast (não suportado no NetX Duo) e multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-910">IPv6 has three types of address specifications: unicast, anycast (not supported in NetX Duo), and multicast.</span></span> <span data-ttu-id="c4a98-911">Os endereços unicast são os endereços IP que identificam um anfitrião específico na Internet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-911">Unicast addresses are those IP addresses that identify a specific host on the Internet.</span></span> <span data-ttu-id="c4a98-912">Os endereços Unicast podem ser uma fonte ou um endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-912">Unicast addresses can be either a source or a destination IP address.</span></span> <span data-ttu-id="c4a98-913">Os endereços multicast especificam um grupo dinâmico de anfitriões na Internet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-913">Multicast addresses specify a dynamic group of hosts on the Internet.</span></span> <span data-ttu-id="c4a98-914">Os membros do grupo multicast podem juntar-se e sair quando quiserem.</span><span class="sxs-lookup"><span data-stu-id="c4a98-914">Members of the multicast group may join and leave whenever they wish.</span></span>

<span data-ttu-id="c4a98-915">O IPv6 não tem o equivalente ao mecanismo de transmissão IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-915">IPv6 does not have the equivalent of the IPv4 broadcast mechanism.</span></span> <span data-ttu-id="c4a98-916">A capacidade de enviar um pacote para todos os anfitriões pode ser alcançada enviando um pacote para o link-local todos os anfitriões grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-916">The ability to send a packet to all hosts can be achieved by sending a packet to the link-local all hosts multicast group.</span></span>

<span data-ttu-id="c4a98-917">O IPv6 utiliza endereços multicast para executar os procedimentos de configuração automática de endereços vizinhos, router e apátrida.</span><span class="sxs-lookup"><span data-stu-id="c4a98-917">IPv6 utilizes multicast addresses to perform Neighbor Discovery, Router Discovery, and Stateless Address Auto Configuration procedures.</span></span>

<span data-ttu-id="c4a98-918">Existem dois tipos de endereços unicast IPv6: link endereços locais, tipicamente construídos combinando o prefixo local de ligação bem conhecido com o endereço MAC interface, e endereços IP globais, que também tem a parte de prefixo e a parte de ID do anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-918">There are two types of IPv6 unicast addresses: link local addresses, typically constructed by combining the well-known link local prefix with the interface MAC address, and global IP addresses, which also has the prefix portion and the host ID portion.</span></span> <span data-ttu-id="c4a98-919">Um endereço global pode ser configurado manualmente, ou através da configuração automática do endereço apátrida ou DHCPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-919">A global address may be configured manually, or through the Stateless Address Autoconfiguration or DHCPv6.</span></span> <span data-ttu-id="c4a98-920">NetX Duo suporta o endereço local de ligação e o endereço global.</span><span class="sxs-lookup"><span data-stu-id="c4a98-920">NetX Duo supports both link local address and global address.</span></span>

<span data-ttu-id="c4a98-921">Para acomodar os formatos IPv4 e IPv6, o NetX Duo fornece um novo tipo de dados, NXD_ADDRESS, para a detenção de endereços IPv4 e IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-921">To accommodate both IPv4 and IPv6 formats, NetX Duo provides a new data type, NXD_ADDRESS, for holding IPv4 and IPv6 addresses.</span></span> <span data-ttu-id="c4a98-922">A definição desta estrutura é mostrada abaixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-922">The definition of this structure is shown below.</span></span> <span data-ttu-id="c4a98-923">O campo de endereços é uma união de endereços IPv4 e IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-923">The address field is a union of IPv4 and IPv6 addresses.</span></span>

```c
typedef struct NXD_ADDRESS_STRUCT
{
    ULONG nxd_ip_version;
    union
    {
        ULONG v4;
        ULONG v6[4];
    } nxd_ip_address;
} NXD_ADDRESS;
```

<span data-ttu-id="c4a98-924">Na estrutura NXD_ADDRESS, o primeiro elemento, *nxd_ip_version,* indica a versão IPv4 ou IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-924">In the NXD_ADDRESS structure, the first element, *nxd_ip_version*, indicates IPv4 or IPv6 version.</span></span> <span data-ttu-id="c4a98-925">Os valores suportados são NX_IP_VERSION_V4 ou NX_IP_VERSION_V6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-925">Supported values are either NX_IP_VERSION_V4 or NX_IP_VERSION_V6.</span></span> <span data-ttu-id="c4a98-926">*nxd_ip_version* indica qual o campo da *união nxd_ip_address* a utilizar como endereço IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-926">*nxd_ip_version* indicates which field in the *nxd_ip_address* union to use as the IP address.</span></span> <span data-ttu-id="c4a98-927">Os serviços da API netX Duo normalmente levam um ponteiro para NXD_ADDRESS estrutura como argumento de entrada em vez do endereço IP ULONG (32 bit).</span><span class="sxs-lookup"><span data-stu-id="c4a98-927">NetX Duo API services typically take a pointer to NXD_ADDRESS structure as input argument in lieu of the ULONG (32 bit) IP address.</span></span>

### <a name="link-local-addresses"></a><span data-ttu-id="c4a98-928">Link Endereços Locais</span><span class="sxs-lookup"><span data-stu-id="c4a98-928">Link Local Addresses</span></span>     
<span data-ttu-id="c4a98-929">Um endereço de link-local é válido apenas na rede local.</span><span class="sxs-lookup"><span data-stu-id="c4a98-929">A link-local address is only valid on the local network.</span></span> <span data-ttu-id="c4a98-930">Um dispositivo pode enviar e receber pacotes para outro dispositivo na mesma rede depois de lhe ser atribuído um endereço local de ligação válido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-930">A device can send and receive packets to another device on the same network after a valid link local address is assigned to it.</span></span> <span data-ttu-id="c4a98-931">Uma aplicação atribui um endereço link-local ligando para o serviço NetX Duo ***nxd_ipv6_address_set,*** com o parâmetro de comprimento do prefixo definido para 10.</span><span class="sxs-lookup"><span data-stu-id="c4a98-931">An application assigns a link-local address by calling the NetX Duo service ***nxd_ipv6_address_set***, with the prefix length parameter set to 10.</span></span> <span data-ttu-id="c4a98-932">A aplicação pode fornecer um endereço link-local para o serviço, ou pode simplesmente usar NX_NULL como endereço link-local e permitir que o NetX Duo construa um endereço link-local baseado no endereço MAC do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-932">The application may supply a link-local address to the service, or it may simply use NX_NULL as the link-local address and allow NetX Duo to construct a link-local address based on the device's MAC address.</span></span>

<span data-ttu-id="c4a98-933">O exemplo a seguir instrui o NetX Duo a configurar o endereço link-local com um prefixo de 10 no dispositivo primário (índice 0) utilizando o seu endereço MAC:</span><span class="sxs-lookup"><span data-stu-id="c4a98-933">The following example instructs NetX Duo to configure the link-local address with a prefix length of 10 on the primary device (index 0) using its MAC address:</span></span>

```c
nxd_ipv6_address_set(ip_ptr, 0, NX_NULL, 10, NX_NULL);
```
<span data-ttu-id="c4a98-934">No exemplo acima, se o endereço MAC da interface for 54:32:10:1A:BC:67, o endereço local de ligação correspondente seria:</span><span class="sxs-lookup"><span data-stu-id="c4a98-934">In the example above, if the MAC address of the interface is 54:32:10:1A:BC:67, the corresponding link-local address would be:</span></span>

```c
FE80::5632:10FF:FE1A:BC67
```
<span data-ttu-id="c4a98-935">Note que a parte de ID do anfitrião do endereço IPv6 **(5632:10FF:FE1A:BC67)** é composta pelo endereço MAC de 6 bytes, com as seguintes modificações:</span><span class="sxs-lookup"><span data-stu-id="c4a98-935">Note that the host ID portion of the IPv6 address (**5632:10FF:FE1A:BC67**) is made up of the 6-byte MAC address, with the following modifications:</span></span>

- <span data-ttu-id="c4a98-936">**0xFFFE** inseridas entre byte 3 e byte 4 do endereço MAC</span><span class="sxs-lookup"><span data-stu-id="c4a98-936">**0xFFFE** inserted between byte 3 and byte 4 of the MAC address</span></span>
- <span data-ttu-id="c4a98-937">A segunda parte mais baixa do primeiro byte do endereço MAC (bit U/L) está definida para 1</span><span class="sxs-lookup"><span data-stu-id="c4a98-937">Second lowest bit of the first byte of the MAC address (U/L bit) is set to 1</span></span>

<span data-ttu-id="c4a98-938">Consulte o RFC 2464 (Transmissão de Pacotes IPv6 através da Rede Ethernet) para obter mais informações sobre como construir a parte hospedeira de um endereço IPv6 a partir do seu endereço MAC de interface.</span><span class="sxs-lookup"><span data-stu-id="c4a98-938">Refer to RFC 2464 (Transmission of IPv6 Packets over Ethernet Network) for more information on how to construct the host portion of an IPv6 address from its interface MAC address.</span></span>

<span data-ttu-id="c4a98-939">Existem alguns endereços multicast especiais para o envio de mensagens multicast para um ou mais anfitriões no IPv6:</span><span class="sxs-lookup"><span data-stu-id="c4a98-939">There are a few special multicast addresses for sending multicast messages to one or more hosts in IPv6:</span></span>

| <span data-ttu-id="c4a98-940">Group</span><span class="sxs-lookup"><span data-stu-id="c4a98-940">Group</span></span>  | <span data-ttu-id="c4a98-941">Endereço</span><span class="sxs-lookup"><span data-stu-id="c4a98-941">Address</span></span>   | <span data-ttu-id="c4a98-942">Descrição</span><span class="sxs-lookup"><span data-stu-id="c4a98-942">Description</span></span>  |
|---|---|---|
|<span data-ttu-id="c4a98-943">Todos os grupos de nós</span><span class="sxs-lookup"><span data-stu-id="c4a98-943">All nodes group</span></span> |<span data-ttu-id="c4a98-944">**FF02::1**</span><span class="sxs-lookup"><span data-stu-id="c4a98-944">**FF02::1**</span></span> |<span data-ttu-id="c4a98-945">Todos os anfitriões da rede local</span><span class="sxs-lookup"><span data-stu-id="c4a98-945">All hosts on the local network</span></span>|
|<span data-ttu-id="c4a98-946">Todos os routers grupo</span><span class="sxs-lookup"><span data-stu-id="c4a98-946">All routers group</span></span> |<span data-ttu-id="c4a98-947">**FF02::2**</span><span class="sxs-lookup"><span data-stu-id="c4a98-947">**FF02::2**</span></span> |<span data-ttu-id="c4a98-948">Todos os routers da rede local</span><span class="sxs-lookup"><span data-stu-id="c4a98-948">All routers on the local network</span></span>|
|<span data-ttu-id="c4a98-949">Nó solicitado</span><span class="sxs-lookup"><span data-stu-id="c4a98-949">Solicited-node</span></span> |<span data-ttu-id="c4a98-950">**FF02::1:FF00:0/104**</span><span class="sxs-lookup"><span data-stu-id="c4a98-950">**FF02::1:FF00:0/104**</span></span> |<span data-ttu-id="c4a98-951">Explicado abaixo</span><span class="sxs-lookup"><span data-stu-id="c4a98-951">Explained below</span></span>|

<span data-ttu-id="c4a98-952">Um endereço multicast de nó solicitado visa anfitriões específicos na ligação local em vez de todos os anfitriões IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-952">A solicited-node multicast address targets specific hosts on the local link rather than all the IPv6 hosts.</span></span> <span data-ttu-id="c4a98-953">Consiste no prefixo **FF02::1:FF00:0/104,** que é de 104 bits e os últimos 24 bits do endereço IPv6 alvo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-953">It consists of the prefix **FF02::1:FF00:0/104**, which is 104 bits and the last 24-bits of the target IPv6 address.</span></span> <span data-ttu-id="c4a98-954">Por exemplo, um endereço IPv6 **205B:209D:D028::F058:D1C8:1024** tem um endereço multicast solicitado de endereço **FF02::1:FFC8:1024**.</span><span class="sxs-lookup"><span data-stu-id="c4a98-954">For example, an IPv6 address **205B:209D:D028::F058:D1C8:1024** has a solicitednode multicast address of address **FF02::1:FFC8:1024**.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-955">*A notação do cólon duplo indica que os pedaços de intervenção são todos zeros. **FF02::1:FF00:0/104** totalmente expandido parece* **FF02:0000:0000:0000:000:0001:FF00:000:000:000**</span><span class="sxs-lookup"><span data-stu-id="c4a98-955">*The double colon notation indicates the intervening bits are all zeroes. **FF02::1:FF00:0/104** fully expanded looks like* **FF02:0000:0000:0000:0000:0001:FF00:0000**</span></span>

### <a name="global-addresses"></a><span data-ttu-id="c4a98-956">Endereços Globais</span><span class="sxs-lookup"><span data-stu-id="c4a98-956">Global Addresses</span></span>    
<span data-ttu-id="c4a98-957">Um exemplo de um endereço global IPv6 é **2001:0123:4567:89AB:CDEF::1** NetX Duo armazena endereços IPv6 na estrutura NXD_ADDRESS.</span><span class="sxs-lookup"><span data-stu-id="c4a98-957">An example of an IPv6 global address is **2001:0123:4567:89AB:CDEF::1** NetX Duo stores IPv6 addresses in the NXD_ADDRESS structure.</span></span> <span data-ttu-id="c4a98-958">No exemplo abaixo, a variável NXD_ADDRESS **global_ipv6_address** contém um endereço IPv6 unicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-958">In the example below, the NXD_ADDRESS variable **global_ipv6_address** contains a unicast IPv6 address.</span></span> <span data-ttu-id="c4a98-959">O exemplo a seguir demonstra que um dispositivo NetX Duo cria um endereço global IPv6 específico para o seu dispositivo primário:</span><span class="sxs-lookup"><span data-stu-id="c4a98-959">The following example demonstrates a NetX Duo device creating a specific IPv6 global address for its primary device:</span></span>

```c
NXD_ADDRESS global_ipv6_address;
UINT        primary_interface_index = 0;

global_ipv6_address.nxd_ip_version = NX_IP_VERSION_V6;
global_ipv6_address.nxd_ip_address.v6[0] = 0x20010123;
global_ipv6_address.nxd_ip_address.v6[1] = 0x456789AB;
global_ipv6_address.nxd_ip_address.v6[2] = 0xCDEF0000;
global_ipv6_address.nxd_ip_address.v6[3] = 0x00000001;

status = nxd_ipv6_address_set(
            &ip_0,
            primary_interface_index,
            &global_ipv6_address,
            64,
            NX_NULL);
```
<span data-ttu-id="c4a98-960">Note que o prefixo deste endereço IPv6 é **2001:0123:4567:89AB**, que tem 64 bits de comprimento e é um comprimento prefixo comum para endereços IPv6 unicast global no Ethernet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-960">Note that the prefix of this IPv6 address is **2001:0123:4567:89AB**, which is 64 bits long and is a common prefix length for global unicast IPv6 addresses on Ethernet.</span></span>

<span data-ttu-id="c4a98-961">A estrutura NXD_ADDRESS também possui endereços IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-961">The NXD_ADDRESS structure also holds IPv4 addresses.</span></span> <span data-ttu-id="c4a98-962">Um endereço IP de **192.1.168.10** **(0xC001A80A)** armazenado em global_ipv4_address teria o seguinte layout de memória:</span><span class="sxs-lookup"><span data-stu-id="c4a98-962">An IP address of **192.1.168.10** (**0xC001A80A**) stored in global_ipv4_address would have the following memory layout:</span></span>

|<span data-ttu-id="c4a98-963">Campo</span><span class="sxs-lookup"><span data-stu-id="c4a98-963">Field</span></span> |<span data-ttu-id="c4a98-964">Valor</span><span class="sxs-lookup"><span data-stu-id="c4a98-964">Value</span></span> |
|---|---|
|<span data-ttu-id="c4a98-965">versão global_ipv4_address.nxd_ip_</span><span class="sxs-lookup"><span data-stu-id="c4a98-965">global_ipv4_address.nxd_ip_version</span></span> |<span data-ttu-id="c4a98-966">NX_IP_VERSION_V4</span><span class="sxs-lookup"><span data-stu-id="c4a98-966">NX_IP_VERSION_V4</span></span>|
|<span data-ttu-id="c4a98-967">global_ipv4_address.nxd_ip_address.v4</span><span class="sxs-lookup"><span data-stu-id="c4a98-967">global_ipv4_address.nxd_ip_address.v4</span></span> |<span data-ttu-id="c4a98-968">0xC001A80A</span><span class="sxs-lookup"><span data-stu-id="c4a98-968">0xC001A80A</span></span>|

<span data-ttu-id="c4a98-969">Quando uma aplicação passa um endereço para os serviços NetX Duo, o campo *nxd_ip_version* deve especificar a versão IP correta para o manuseamento adequado do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-969">When an application passes an address to NetX Duo services, the *nxd_ip_version* field must specify the correct IP version for proper packet handling.</span></span>

<span data-ttu-id="c4a98-970">Para ser retrocompatível com as aplicações NetX existentes, a NetX Duo suporta todos os serviços NetX.</span><span class="sxs-lookup"><span data-stu-id="c4a98-970">To be backward compatible with existing NetX applications, NetX Duo supports all NetX services.</span></span> <span data-ttu-id="c4a98-971">Internamente, o NetX Duo converte o tipo de endereço IPv4 ULONG para um tipo de dados NXD_ADDRESS antes de reencaminho para o serviço NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-971">Internally, NetX Duo converts the IPv4 address type ULONG to an NXD_ADDRESS data type before forwarding it to the actual NetX Duo service.</span></span>

<span data-ttu-id="c4a98-972">O exemplo a seguir ilustra a semelhança e as diferenças entre serviços na NetX e netX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-972">The following example illustrates the similarity and the differences between services in NetX and NetX Duo.</span></span>

```c
/* Make a connection to the destination IPv4 address
   192.1.168.12 through an already created TCP socket bound
   to the well known HTTP port number 80. */

global_ipv4_address.nxd_ip_version = NX_IP_VERSION_V4;
global_ipv4_address.nxd_ip_address.v4 = 0xC001A80C;

nxd_tcp_client_socket_connect(&tcp_socket,
                              &global_ipv4_address,
                              port_number,
                              NX_WAIT_FOREVER);
```

<span data-ttu-id="c4a98-973">Segue-se a API líquida equivalente:</span><span class="sxs-lookup"><span data-stu-id="c4a98-973">The following is the equivalent NetX API:</span></span>

```c
ULONG         server_ip = 0xC001A80C;
NX_TCP_SOCKET tcp_socket;
UINT          port_number = 80;

nx_tcp_client_socket_connect(&tcp_socket,
                             server_ip,
                             port_number,
                             NX_WAIT_FOREVER); 
```

> [!IMPORTANT]
> <span data-ttu-id="c4a98-974">*Os desenvolvedores de aplicações são encorajados a usar a versão nxd destes APIs*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-974">*Application developers are encouraged to use the nxd version of these APIs*.</span></span>

### <a name="ipv6-default-routers"></a><span data-ttu-id="c4a98-975">Routers padrão IPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-975">IPv6 Default Routers</span></span>    
<span data-ttu-id="c4a98-976">O IPv6 usa um router predefinido para encaminhar pacotes para destinos offlink.</span><span class="sxs-lookup"><span data-stu-id="c4a98-976">IPv6 uses a default router to forward packets to offlink destinations.</span></span> <span data-ttu-id="c4a98-977">O serviço NetX Duo ***nxd_ipv6_default_router_add*** permite que uma aplicação adicione um router IPv6 à tabela de routers predefinido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-977">The NetX Duo service ***nxd_ipv6_default_router_add*** enables an application to add an IPv6 router to the default router table.</span></span> <span data-ttu-id="c4a98-978">Consulte o capítulo 4 "Descrição dos Serviços" para serviços de router mais predefinidos oferecidos pela NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-978">See Chapter 4 "Description of Services" for more default router services offered by NetX Duo.</span></span>  

<span data-ttu-id="c4a98-979">Ao encaminhar os pacotes IPv6, o NetX Duo verifica primeiro se o destino do pacote está ligado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-979">When forwarding IPv6 packets, NetX Duo first checks if the packet destination is on-link.</span></span> <span data-ttu-id="c4a98-980">Caso contrário, o NetX Duo verifica a tabela de encaminhamento predefinido para um router válido para encaminhar o pacote off-link para.</span><span class="sxs-lookup"><span data-stu-id="c4a98-980">If not, NetX Duo checks the default routing table for a valid router to forward the off-link packet to.</span></span>  

<span data-ttu-id="c4a98-981">Para remover um router da tabela de routers predefinido IPv6, a aplicação deve utilizar o serviço \***nxd_ipv6_default_router_delete** _.</span><span class="sxs-lookup"><span data-stu-id="c4a98-981">To remove a router from the IPv6 default router table, application shall use the service \***nxd_ipv6_default_router_delete** _.</span></span> <span data-ttu-id="c4a98-982">Para obter entradas da tabela de routers predefinido IPv6, utilize o serviço _\*_nxd_ipv6_default_router_entry_get_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-982">To obtain entries of the IPv6 default router table, use the service _\*_nxd_ipv6_default_router_entry_get_\*\*.</span></span>

### <a name="ipv6-header"></a><span data-ttu-id="c4a98-983">Cabeçalho IPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-983">IPv6 Header</span></span>    
<span data-ttu-id="c4a98-984">O cabeçalho IPv6 foi modificado a partir do cabeçalho IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-984">The IPv6 header has been modified from the IPv4 header.</span></span> <span data-ttu-id="c4a98-985">Ao atribuir um pacote, o chamador especifica o protocolo de aplicação (por exemplo, UDP, TCP), tamanho tampão em bytes e limite de lúpulo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-985">When allocating a packet, the caller specifies the application protocol (e.g., UDP, TCP), buffer size in bytes, and hop limit.</span></span>   

<span data-ttu-id="c4a98-986">A figura 9 mostra o formato do cabeçalho IPv6 e a tabela lista os componentes do cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="c4a98-986">Figure 9 shows the format of the IPv6 header and the table lists the header components.</span></span>

![Diagrama do formato do cabeçalho IPv6.](./media/user-guide/image18.png)

<span data-ttu-id="c4a98-988">**FIGURA 9. Formato iPv6 Header**</span><span class="sxs-lookup"><span data-stu-id="c4a98-988">**FIGURE 9. IPv6 Header Format**</span></span>

|<span data-ttu-id="c4a98-989">Cabeçalho IP</span><span class="sxs-lookup"><span data-stu-id="c4a98-989">IP header</span></span> | <span data-ttu-id="c4a98-990">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-990">Purpose</span></span> |
|---|---|
|<span data-ttu-id="c4a98-991">Versão</span><span class="sxs-lookup"><span data-stu-id="c4a98-991">Version</span></span> |<span data-ttu-id="c4a98-992">Campo de 4 bits para a versão IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-992">4-bit field for IP version.</span></span> <span data-ttu-id="c4a98-993">Para as redes IPv6, o valor neste campo deve ser de 6; Para as redes IPv4 deve ser 4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-993">For IPv6 networks, the value in this field must be 6; For IPv4 networks it must be 4.</span></span>|
|<span data-ttu-id="c4a98-994">Classe de Tráfego</span><span class="sxs-lookup"><span data-stu-id="c4a98-994">Traffic Class</span></span> |<span data-ttu-id="c4a98-995">Campo de 8 bits que armazena a informação da classe de tráfego.</span><span class="sxs-lookup"><span data-stu-id="c4a98-995">8-bit field that stores the traffic class information.</span></span> <span data-ttu-id="c4a98-996">Este campo não é utilizado pela NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-996">This field is not used by NetX Duo.</span></span>|
|<span data-ttu-id="c4a98-997">Rótulo de fluxo</span><span class="sxs-lookup"><span data-stu-id="c4a98-997">Flow Label</span></span> |<span data-ttu-id="c4a98-998">Campo de 20 bits para identificar exclusivamente o fluxo, se houver, com o qual um pacote está associado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-998">20-bit field to uniquely identify the flow, if any, that a packet is associated with.</span></span> <span data-ttu-id="c4a98-999">Um valor de zero indica que o pacote não pertence a um fluxo específico.</span><span class="sxs-lookup"><span data-stu-id="c4a98-999">A value of zero indicates the packet does not belong to a particular flow.</span></span> <span data-ttu-id="c4a98-1000">Este campo substitui o campo *TOS* no IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1000">This field replaces the *TOS* field in IPv4.</span></span>|
|<span data-ttu-id="c4a98-1001">Comprimento da carga útil</span><span class="sxs-lookup"><span data-stu-id="c4a98-1001">Payload Length</span></span> |<span data-ttu-id="c4a98-1002">Campo de 16 bits indicando a quantidade de dados nos bytes do pacote IPv6 após o cabeçalho de base IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1002">16-bit field indicating the amount of data in bytes of the IPv6 packet following the IPv6 base header.</span></span> <span data-ttu-id="c4a98-1003">Isto inclui todos os cabeçalhos e dados do protocolo encapsulados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1003">This includes all encapsulated protocol header and data.</span></span>|
|<span data-ttu-id="c4a98-1004">Próximo Cabeçalho</span><span class="sxs-lookup"><span data-stu-id="c4a98-1004">Next Header</span></span> | <span data-ttu-id="c4a98-1005">Campo de 8 bits indicando o tipo do cabeçalho de extensão que segue o cabeçalho base IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1005">8-bit field indicating the type of the extension header that follows the IPv6 base header.</span></span> <span data-ttu-id="c4a98-1006">Este campo substitui o campo *Protocolo* no IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1006">This field replaces the *Protocol* field in IPv4.</span></span>|
|<span data-ttu-id="c4a98-1007">Limite de lúpulo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1007">Hop Limit</span></span> |<span data-ttu-id="c4a98-1008">Campo de 8 bits que limita o número de routers que o pacote é permitido passar.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1008">8-bit field that limits the number of routers the packet is allowed to go through.</span></span> <span data-ttu-id="c4a98-1009">Este campo substitui o campo *TTL* no IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1009">This field replaces the *TTL* field in IPv4.</span></span>|
|<span data-ttu-id="c4a98-1010">Endereço de Origem</span><span class="sxs-lookup"><span data-stu-id="c4a98-1010">Source Address</span></span> |<span data-ttu-id="c4a98-1011">Campo de 128 bits que armazena o endereço IPv6 do remetente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1011">128-bit field that stores the IPv6 address of the sender.</span></span>|
|<span data-ttu-id="c4a98-1012">Endereço de destino</span><span class="sxs-lookup"><span data-stu-id="c4a98-1012">Destination Address</span></span> |<span data-ttu-id="c4a98-1013">Campo de 128 bits que faz nerv6 do destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1013">128-bit field that sores the IPv6 address of the destination.</span></span>|

### <a name="enabling-ipv6-in-netx-duo"></a><span data-ttu-id="c4a98-1014">Ativar o IPv6 em NetX Duo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1014">Enabling IPv6 in NetX Duo</span></span>    
<span data-ttu-id="c4a98-1015">Por padrão, o IPv6 está ativado no NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1015">By default IPv6 is enabled in NetX Duo.</span></span> <span data-ttu-id="c4a98-1016">Os serviços IPv6 estão ativados no NetX Duo se a opção configurável ***NX_DISABLE_IPV6** _ em _nx_user.h* não estiver definida.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1016">IPv6 services are enabled in NetX Duo if the configurable option ***NX_DISABLE_IPV6** _ in _nx_user.h* is not defined.</span></span> <span data-ttu-id="c4a98-1017">Se ***NX_DISABLE_IPV6*** estiver definido, o NetX Duo apenas oferecerá serviços IPv4, e todos os módulos e serviços relacionados com o IPv6 não estão integrados na biblioteca NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1017">If ***NX_DISABLE_IPV6*** is defined, NetX Duo will only offer IPv4 services, and all the IPv6-related modules and services are not built into NetX Duo library.</span></span>

<span data-ttu-id="c4a98-1018">O seguinte serviço é fornecido para aplicações para configurar o endereço IPv6 do dispositivo: ***nxd_ipv6_address_set***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1018">The following service is provided for applications to configure the device IPv6 address: ***nxd_ipv6_address_set***</span></span>

<span data-ttu-id="c4a98-1019">Além de configurar manualmente os endereços IPv6 do dispositivo, o sistema também pode utilizar a Configuração Automática de Endereços Apátridas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1019">In addition to manually setting the device's IPv6 addresses, the system may also use Stateless Address Autoconfiguration.</span></span> <span data-ttu-id="c4a98-1020">Para utilizar esta opção, a aplicação deve ligar \***nxd_ipv6_enable** _ para iniciar os serviços IPv6 no dispositivo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1020">To use this option, the application must call \***nxd_ipv6_enable** _ to start IPv6 services on the device.</span></span> <span data-ttu-id="c4a98-1021">Além disso, os serviços ICMPv6 devem ser iniciados ligando para _*_nxd_icmp_enable,_*_ o que permite à NetX Duo realizar serviços como Solicitação router, Neighbor Discovery e Duplicate Address Detection.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1021">In addition, ICMPv6 services must be started by calling _*_nxd_icmp_enable_*_, which enables NetX Duo to perform services such as Router Solicitation, Neighbor Discovery, and Duplicate Address Detection.</span></span> <span data-ttu-id="c4a98-1022">Note que _*_nx_icmp_enable_*_ só inicia o ICMP para os serviços IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1022">Note that _*_nx_icmp_enable_*_ only starts ICMP for IPv4 services.</span></span> <span data-ttu-id="c4a98-1023">_*_nxd_icmp_enable_*_ inicia serviços ICMP tanto para iPv4 como IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1023">_*_nxd_icmp_enable_*_ starts ICMP services for both IPv4 and IPv6.</span></span> <span data-ttu-id="c4a98-1024">Se o sistema não necessitar de serviços ICMPv6, então _ *_nx_icmp_enable_*\* pode ser utilizado para que o módulo ICMPv6 não esteja ligado ao sistema.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1024">If the system does not need ICMPv6 services, then _ *_nx_icmp_enable_*\* can be used so the ICMPv6 module is not linked into the system.</span></span>

<span data-ttu-id="c4a98-1025">O exemplo a seguir mostra um procedimento típico de inicialização NetX Duo IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1025">The following example shows a typical NetX Duo IPv6 initialization procedure.</span></span>

```c
/* Assume ip_0 has been created and IPv4 services (such as ARP,
   ICMP, have been enabled. */
#define SECONDARY_INTERFACE 1

/* Enable IPv6 */
status = nxd_ipv6_enable(&ip_0);

if(status != NX_SUCCESS)
{
    /* nxd_ipv6_enable failed. */
}

/* Enable ICMPv6 */
status = nxd_icmp_enable(&ip_0);
if(status != NX_SUCCESS)
{
    /* nxd_icmp_enable failed. */
}

/* Configure the link local address on the primary interface. */
status = nxd_ipv6_address_set(&ip_0, 0, NX_NULL, 10, NX_NULL);

/* Configure ip_0 primary interface global address. */
ip_address.nxd_ip_version = NX_IP_VERSION_V6
ip_address.nxd_ip_address.v6[0] = 0x20010db8;
ip_address.nxd_ip_address.v6[1] = 0x0000f101;
ip_address.nxd_ip_address.v6[2] = 0;
ip_address.nxd_ip_address.v6[3] = 0x202;

/* Configure global address of the primary interface. */
status = nxd_ipv6_address_set(&ip_0, SECONDARY_INTERFACE,
                              &ip_address, 64, NX_NULL);
```                              

<span data-ttu-id="c4a98-1026">Os protocolos de camada superior (como TCP e UDP) podem ser ativados antes ou depois do início do IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1026">Upper layer protocols (such as TCP and UDP) can be enabled either before or after IPv6 starts.</span></span>

> [!IMPORTANT]  
> <span data-ttu-id="c4a98-1027">*Os serviços IPv6 só estão disponíveis após a inicialção do fio IP e o dispositivo está ativado.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-1027">*IPv6 services are available only after IP thread is initialized and the device is enabled.*</span></span>

<span data-ttu-id="c4a98-1028">Depois de a interface estar ativada (ou seja, o controlador do dispositivo de interface está pronto para enviar e receber dados, e foi obtido um endereço local de ligação válido), o dispositivo poderá obter endereços IPv6 globais por um destes métodos:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1028">After the interface is enabled (i.e.,the interface device driver is ready to send and receive data, and a valid link local address has been obtained), the device may obtain global IPv6 addresses by one of the these methods:</span></span>

- <span data-ttu-id="c4a98-1029">Configuração de auto endereço apátrida;</span><span class="sxs-lookup"><span data-stu-id="c4a98-1029">Stateless Address Auto Configuration;</span></span>  
- <span data-ttu-id="c4a98-1030">Configuração manual do endereço IPv6;</span><span class="sxs-lookup"><span data-stu-id="c4a98-1030">Manual IPv6 address configuration;</span></span>  
- <span data-ttu-id="c4a98-1031">Configuração de endereço via DHCPv6 (com pacote opcional DHCPv6)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1031">Address configuration via DHCPv6 (with optional DHCPv6 package)</span></span>

<span data-ttu-id="c4a98-1032">Os dois primeiros métodos são descritos abaixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1032">The first two methods are described below.</span></span> <span data-ttu-id="c4a98-1033">O 3º método (DHCPv6) está descrito no pacote DHCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1033">The 3rd method (DHCPv6) is described in the DHCP package.</span></span>

### <a name="stateless-address-autoconfiguration-using-router-solicitation"></a><span data-ttu-id="c4a98-1034">Configuração automática de endereço apátrida usando solicitação do router</span><span class="sxs-lookup"><span data-stu-id="c4a98-1034">Stateless Address Autoconfiguration Using Router Solicitation</span></span>      
<span data-ttu-id="c4a98-1035">Os dispositivos NetX Duo podem configurar automaticamente as suas interfaces quando ligados a uma rede IPv6 com um router que fornece informações prefixos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1035">NetX Duo devices can configure their interfaces automatically when connected to an IPv6 network with a router that supplies prefix information.</span></span> <span data-ttu-id="c4a98-1036">Os dispositivos que requerem configuração automática de endereços apátridas enviam mensagens de solicitação de router (RS).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1036">Devices that require Stateless Address Autoconfiguration send out router solicitation (RS) messages.</span></span> <span data-ttu-id="c4a98-1037">Os routers na rede respondem com mensagens de publicidade de router solicitadas (RA).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1037">Routers on the network respond with solicited router advertisement (RA) messages.</span></span> <span data-ttu-id="c4a98-1038">As mensagens RA anunciam prefixos que identificam os endereços de rede associados a um link.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1038">RA messages advertise prefixes that identify the network addresses associated with a link.</span></span> <span data-ttu-id="c4a98-1039">Os dispositivos geram então um identificador único para a rede a que o dispositivo está ligado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1039">Devices then generate a unique identifier for the network the device is attached to.</span></span> <span data-ttu-id="c4a98-1040">O endereço é formado combinando o prefixo e o seu identificador único.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1040">The address is formed by combining the prefix and its unique identifier.</span></span> <span data-ttu-id="c4a98-1041">Desta forma, ao receber as mensagens RA, os anfitriões geram o seu endereço IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1041">In this manner on receiving the RA messages, hosts generate their IP address.</span></span> <span data-ttu-id="c4a98-1042">Os routers também podem enviar mensagens DE RA não solicitadas periódicas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1042">Routers may also send periodic unsolicited RA messages.</span></span> 

> [!WARNING]
> <span data-ttu-id="c4a98-1043">*O NetX Duo permite uma aplicação para ativar ou desativar a configuração automática do endereço apátrida no tempo de execução. Para ativar esta funcionalidade, a biblioteca NetX Duo deve ser compilada com **NX_IPV6_STATELESS_AUTOCONFIG_CONTROL** definida. Uma vez ativada esta funcionalidade, as aplicações podem utilizar **nxd_ipv6_stateless_address_autoconfigure_enable** e **nxd_ipv6_stateless_address_autocofigure_disable** para ativar ou desativar o endereço apátrida IPv6 automaticamente configurar*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1043">*NetX Duo allows an application to enable or disable Stateless Address Autoconfiguration at run time. To enable this feature, NetX Duo library must be compiled with **NX_IPV6_STATELESS_AUTOCONFIG_CONTROL** defined. Once this feature is enabled, applications may use **nxd_ipv6_stateless_address_autoconfigure_enable** and **nxd_ipv6_stateless_address_autocofigure_disable** to enable or disable IPv6 stateless address autoconfiguration*.</span></span>

### <a name="manual-ipv6-address-configuration"></a><span data-ttu-id="c4a98-1044">Configuração manual do endereço IPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-1044">Manual IPv6 Address Configuration</span></span>     
<span data-ttu-id="c4a98-1045">Se for necessário um endereço IPv6 específico, a aplicação poderá utilizar ***nxd_ipv6_address_set*** para configurar manualmente um endereço IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1045">If a specific IPv6 address is needed, the application may use ***nxd_ipv6_address_set*** to manually configure an IPv6 address.</span></span> <span data-ttu-id="c4a98-1046">Uma interface de rede pode ter vários endereços IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1046">A network interface may have multiple IPv6 addresses.</span></span> <span data-ttu-id="c4a98-1047">No entanto, tenha em mente que o número total de endereços IPv6 num sistema, obtido através da configuração automática do endereço apátrida, ou através da Configuração Manual, não pode exceder ***NX_MAX_IPV6_ADDRESSES***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1047">However keep in mind that the total number of IPv6 addresses in a system, either obtained through Stateless Address Autoconfiguration, or through the Manual Configuration, cannot exceed ***NX_MAX_IPV6_ADDRESSES***.</span></span>

<span data-ttu-id="c4a98-1048">O exemplo a seguir ilustra como configurar manualmente um endereço global na interface primária (dispositivo 0) em ip_0:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1048">The following example illustrates how to manually configure a global address on the primary interface (device 0) in ip_0:</span></span>

```c
NXD_ADDRESS global_address;
global_address.nxd_ip_version = NX_IP_VERSION_V6;
global_address.nxd_ip_address.v6[0] = 0x20010000;
global_address.nxd_ip_address.v6[1] = 0x00000000;
global_address.nxd_ip_address.v6[2] = 0x00000000;
global_address.nxd_ip_address.v6[3] = 0x0000ABCD;
```

<span data-ttu-id="c4a98-1049">Em seguida, o anfitrião chama o seguinte serviço NetX Duo para atribuir este endereço como o seu endereço IP global:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1049">The host then calls the following NetX Duo service to assign this address as its global IP address:</span></span>

```c
status = nxd_ipv6_address_set(&ip_0, 0,  
                              &global_address, 64
                              NX_NULL);
```

### <a name="duplicate-address-detection-dad"></a><span data-ttu-id="c4a98-1050">Deteção de endereços duplicado (DAD)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1050">Duplicate Address Detection (DAD)</span></span>    
<span data-ttu-id="c4a98-1051">Depois de um sistema configurar o seu endereço IPv6, o endereço é marcado como *PROVISÓRIO*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1051">After a system configures its IPv6 address, the address is marked as *TENTATIVE*.</span></span> <span data-ttu-id="c4a98-1052">Se a Duplicado Deteção de Endereços (DAD), descrita no RFC 4862, estiver ativada, a NetX Duo envia automaticamente mensagens de solicitação de vizinhos (NS) com este endereço provisório como destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1052">If Duplicate Address Detection (DAD), described in RFC 4862, is enabled, NetX Duo automatically sends neighbor solicitation (NS) messages with this tentative address as the destination.</span></span> <span data-ttu-id="c4a98-1053">Se nenhum anfitrião na rede responder a estas mensagens NS num determinado período de tempo, o endereço é assumido como único na ligação local, e o seu estado transita para o estado VÁLIDO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1053">If no hosts on the network respond to these NS messages within a given period of time, the address is assumed to be unique on the local link, and its state transits to the VALID state.</span></span> <span data-ttu-id="c4a98-1054">Neste momento, a aplicação pode começar a utilizar este endereço IP para comunicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1054">At this point the application may start using this IP address for communication.</span></span>  

<span data-ttu-id="c4a98-1055">A funcionalidade DAD faz parte do módulo ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1055">The DAD functionality is part of the ICMPv6 module.</span></span> <span data-ttu-id="c4a98-1056">Por isso, a aplicação deve permitir serviços ICMPv6 antes que um endereço recém-configurado possa passar pelo processo DAD.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1056">Therefore, the application must enable ICMPv6 services before a newly configured address can go through the DAD process.</span></span> <span data-ttu-id="c4a98-1057">Alternativamente, o processo DAD pode ser desligado definindo ***NX_DISABLE_IPV6_DAD** _ opção no ambiente de construção da biblioteca NetX Duo (definido como _*_nx_user.h)._\*_</span><span class="sxs-lookup"><span data-stu-id="c4a98-1057">Alternatively, the DAD process may be turned off by defining ***NX_DISABLE_IPV6_DAD** _ option in the NetX Duo library build environment (defined as _*_nx_user.h_\*_).</span></span> <span data-ttu-id="c4a98-1058">Durante o processo DAD, o parâmetro _*_NX_IPV6_DAD_TRANSMITS_*_ determina o número de mensagens NS enviadas pela NetX Duo sem receber uma resposta para determinar que o endereço é único.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1058">During the DAD process, the _*_NX_IPV6_DAD_TRANSMITS_*_ parameter determines the number of NS messages sent by NetX Duo without receiving a response to determine that the address is unique.</span></span> <span data-ttu-id="c4a98-1059">Por predefinição e recomendado pelo RFC 4862, _ *_NX_IPV6_DAD_TRANSMITS_*\* é definido em 3.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1059">By default and recommended by RFC 4862, _ *_NX_IPV6_DAD_TRANSMITS_*\* is set at 3.</span></span> <span data-ttu-id="c4a98-1060">Definir este símbolo a zero desativa eficazmente o PAI.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1060">Setting this symbol to zero effectively disables DAD.</span></span>

<span data-ttu-id="c4a98-1061">Se o ICMPv6 ou o DAD não estiverem ativados no momento em que a aplicação atribuir um endereço IPv6, o DAD não é realizado e o NetX Duo define imediatamente o estado do endereço IPv6 para VALID.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1061">If ICMPv6 or DAD is not enabled at the time the application assigns an IPv6 address, DAD is not performed and NetX Duo sets the state of the IPv6 address to VALID immediately.</span></span>

<span data-ttu-id="c4a98-1062">A NetX Duo não pode comunicar na rede IPv6 até que o seu endereço local e/ou global seja válido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1062">NetX Duo cannot communicate on the IPv6 network until its link local and/or global address is valid.</span></span> <span data-ttu-id="c4a98-1063">Após a obtenção de um endereço válido, o NetX Duo tenta combinar o endereço de destino de um pacote de entrada com um dos seus endereços IPv6 configurados ou um endereço multicast ativado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1063">After a valid address is obtained, NetX Duo attempts to match the destination address of an incoming packet against one of its configured IPv6 address or an enabled multicast address.</span></span> <span data-ttu-id="c4a98-1064">Se não forem encontrados fósforos, o pacote é retirado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1064">If no matches are found, the packet is dropped.</span></span> 

> [!WARNING]  
> <span data-ttu-id="c4a98-1065">\*Durante o processo DAD, o número de pacotes DAD NS a transmitir é definido por \***NX_IPV6_DAD_TRANSMITS,**_que não chega a 3, e por padrão há um atraso de um segundo entre cada mensagem DAD NS é enviado. Portanto, num sistema com o PAI ativado, depois de atribuído um endereço IPv6 (e assumindo que este não é um endereço duplicado), há aproximadamente 3 segundos de atraso antes do endereço IP estar em estado VÁLIDO e estar pronto para comunicação._</span><span class="sxs-lookup"><span data-stu-id="c4a98-1065">\*During the DAD process, the number of DAD NS packets to be transmitted is defined by \***NX_IPV6_DAD_TRANSMITS**_, which defaults to 3, and by default there is a one second delay between each DAD NS message is sent. Therefore, in a system with DAD enabled, after an IPv6 address is assigned (and assuming this is not a duplicated address), there is approximately 3 seconds delay before the IP address is in a VALID state and is ready for communication._</span></span>

<span data-ttu-id="c4a98-1066">As aplicações podem querer receber notificações quando os endereços IPv6 no sistema forem alterados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1066">Applications may want to receive notifications when IPv6 addresses in the system are changed.</span></span> <span data-ttu-id="c4a98-1067">Para ativar a funcionalidade de notificação de alteração de endereço IPv6, a biblioteca NetX Duo deve ser construída com o símbolo **NX_ENABLE_IPV6_ADDRESS_CHANGE_NOTIFY** definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1067">To enable the IPv6 address change notification feature, the NetX Duo library must be built with the symbol **NX_ENABLE_IPV6_ADDRESS_CHANGE_NOTIFY** defined.</span></span> <span data-ttu-id="c4a98-1068">Uma vez ativada a função, as aplicações podem instalar a função de retorno utilizando o serviço **_nxd_ipv6_address_change_notify._**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1068">Once the feature is enabled, applications may install the callback function by using the **_nxd_ipv6_address_change_notify_** service.</span></span>

<span data-ttu-id="c4a98-1069">Uma vez que um endereço IPv6 é alterado ou se torna inválido, a função de retorno fornecida pelo utilizador é invocada com as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1069">Once an IPv6 address is changed, or becomes invalid, the user-supplied callback function is invoked with the following information:</span></span>

| <span data-ttu-id="c4a98-1070">Função</span><span class="sxs-lookup"><span data-stu-id="c4a98-1070">Function</span></span>  | <span data-ttu-id="c4a98-1071">Descrição</span><span class="sxs-lookup"><span data-stu-id="c4a98-1071">Description</span></span>  |
|---|---|
|<span data-ttu-id="c4a98-1072">ip_ptr</span><span class="sxs-lookup"><span data-stu-id="c4a98-1072">ip_ptr</span></span> |<span data-ttu-id="c4a98-1073">Ponteiro para a instância IP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1073">Pointer to the IP instance</span></span>|
|<span data-ttu-id="c4a98-1074">interface_index</span><span class="sxs-lookup"><span data-stu-id="c4a98-1074">interface_index</span></span> |<span data-ttu-id="c4a98-1075">Índice para a interface de rede que este endereço IPv6 está associado</span><span class="sxs-lookup"><span data-stu-id="c4a98-1075">Index to the network interface that this IPv6 address is associated with</span></span>
|<span data-ttu-id="c4a98-1076">ipv6_addr_index</span><span class="sxs-lookup"><span data-stu-id="c4a98-1076">ipv6_addr_index</span></span> |<span data-ttu-id="c4a98-1077">Índice para a tabela de endereços IPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-1077">Index to the IPv6 address table</span></span>|
|<span data-ttu-id="c4a98-1078">ipv6_address</span><span class="sxs-lookup"><span data-stu-id="c4a98-1078">ipv6_address</span></span> |<span data-ttu-id="c4a98-1079">Ponteiro para o endereço IPv6, na forma de uma matriz de quatro inteiros ULONG.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1079">Pointer to the IPv6 address, in the form of an array of four ULONG integers.</span></span> <span data-ttu-id="c4a98-1080">Os endereços Pv6 são apresentados em ordem byte de anfitrião.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1080">Pv6 addresses are presented in host byte order.</span></span>|

### <a name="ipv6-multicast-support-in-netx-duo"></a><span data-ttu-id="c4a98-1081">Suporte multicast IPv6 na NetX Duo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1081">IPv6 Multicast Support In NetX Duo</span></span>      
<span data-ttu-id="c4a98-1082">Os endereços multicast especificam um grupo dinâmico de anfitriões na Internet.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1082">Multicast addresses specify a dynamic group of hosts on the Internet.</span></span> <span data-ttu-id="c4a98-1083">Os membros do grupo multicast podem juntar-se e sair quando quiserem.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1083">Members of the multicast group may join and leave whenever they wish.</span></span> <span data-ttu-id="c4a98-1084">A NetX Duo implementa vários protocolos ICMPv6, incluindo duplicado deteção de endereços, descoberta de vizinhos e discovery router, que requerem capacidade multicast IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1084">NetX Duo implements several ICMPv6 protocols, including Duplicate Address Detection, Neighbor Discovery, and Router Discovery, which require IP multicast capability.</span></span> <span data-ttu-id="c4a98-1085">Por isso, a NetX Duo espera que o controlador do dispositivo subjacente suporte operações multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1085">Therefore, NetX Duo expects the underlying device driver to support multicast operations.</span></span>

<span data-ttu-id="c4a98-1086">Quando o NetX Duo precisa de se juntar ou sair de um grupo multicast (como o endereço multicast all-node e o endereço multicast *de nó solicitado),* emite um comando do controlador ao controlador do dispositivo para se juntar ou deixar um endereço MAC multicast.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1086">When NetX Duo needs to join or leave a multicast group (such as the all-node multicast address, and the *solicited-node* multicast address), it issues a driver command to the device driver to join or leave a multicast MAC address.</span></span> <span data-ttu-id="c4a98-1087">O comando do controlador para se juntar ao endereço multicast é \***NX_LINK_MULTICAST_JOIN** _.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1087">The driver command for joining the multicast address is \***NX_LINK_MULTICAST_JOIN** _.</span></span> <span data-ttu-id="c4a98-1088">Para deixar um endereço multicast, a NetX Duo emite o comando do controlador _\*_NX_LINK_MULTICAST_LEAVE_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1088">To leave a multicast address, NetX Duo issues the driver command _\*_NX_LINK_MULTICAST_LEAVE_\*\*.</span></span> <span data-ttu-id="c4a98-1089">O controlador do dispositivo deve implementar estes dois comandos para que os protocolos ICMPv6 funcionem corretamente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1089">The device driver must implement these two commands for ICMPv6 protocols to work properly.</span></span>

<span data-ttu-id="c4a98-1090">As aplicações podem aderir a um grupo multicast IPv6 utilizando o serviço \***nxd_ipv6_multicast_interface_join\*.**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1090">Applications may join an IPv6 multicast group by using the service \***nxd_ipv6_multicast_interface_join\*.**</span></span> <span data-ttu-id="c4a98-1091">Este serviço regista o endereço multicast com a pilha IP e, em seguida, notifica o controlador de dispositivo especificado do endereço multicast IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1091">This service registers the multicast address with the IP stack, and then notifies the specified device driver of the IPv6 multicast address.</span></span> <span data-ttu-id="c4a98-1092">Para deixar um grupo multicast, as aplicações utilizam o ***serviço nxd_ipv6_multicast_interface_leave.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1092">To leave a multicast group, applications use the service ***nxd_ipv6_multicast_interface_leave.***</span></span>

### <a name="neighbor-discovery-nd"></a><span data-ttu-id="c4a98-1093">Neighbor Discovery (ND)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1093">Neighbor Discovery (ND)</span></span>    
<span data-ttu-id="c4a98-1094">Neighbor Discovery é um protocolo em redes IPv6 para mapear endereços físicos para os endereços IPv6 (endereço global ou endereço link-local).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1094">Neighbor Discovery is a protocol in IPv6 networks for mapping physical addresses to the IPv6 addresses (global address or link-local address).</span></span> <span data-ttu-id="c4a98-1095">Este mapeamento é mantido na Cache de Descoberta do Vizinho (Cache ND).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1095">This mapping is maintained in the Neighbor Discovery Cache (ND Cache).</span></span> <span data-ttu-id="c4a98-1096">O processo ND é o equivalente ao processo ARP no IPv4, e a Cache ND é semelhante à tabela ARP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1096">The ND process is the equivalent of the ARP process in IPv4, and the ND Cache is similar to the ARP table.</span></span> <span data-ttu-id="c4a98-1097">Um nó IPv6 pode obter o endereço MAC do seu vizinho usando o protocolo Neighbor Discovery (ND).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1097">An IPv6 node can obtain its neighbor's MAC address using the Neighbor Discovery (ND) protocol.</span></span> <span data-ttu-id="c4a98-1098">Envia uma mensagem de solicitação de vizinho (NS) para o endereço multicast de nó solicitado e aguarda uma mensagem de anúncio de vizinho correspondente (NA).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1098">It sends out a neighbor solicitation (NS) message to the all-node solicited node multicast address, and waits for a corresponding neighbor advertisement (NA) message.</span></span> <span data-ttu-id="c4a98-1099">O endereço MAC obtido através deste processo é armazenado na Cache ND.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1099">The MAC address obtained through this process is stored in the ND Cache.</span></span>

<span data-ttu-id="c4a98-1100">Cada instância IP tem uma cache ND.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1100">Each IP instance has one ND cache.</span></span> <span data-ttu-id="c4a98-1101">A Cache ND é mantida como um conjunto de entradas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1101">The ND Cache is maintained as an array of entries.</span></span> <span data-ttu-id="c4a98-1102">O tamanho da matriz é definido no tempo de compilação, definindo a opção ***NX_IPV6_NEIGHBOR_CACHE_SIZE** _ que em _*_nx_user.h\*\*._</span><span class="sxs-lookup"><span data-stu-id="c4a98-1102">The size of the array is defined at compilation time by setting the option ***NX_IPV6_NEIGHBOR_CACHE_SIZE** _ which in _*_nx_user.h_\*\*.</span></span> <span data-ttu-id="c4a98-1103">Note que todas as interfaces anexas a uma instância IP partilham a mesma cache ND.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1103">Note that all interfaces attached to an IP instance share the same ND cache.</span></span>

<span data-ttu-id="c4a98-1104">Toda a Cache ND está vazia quando o NetX Duo começar.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1104">The entire ND Cache is empty when NetX Duo starts up.</span></span> <span data-ttu-id="c4a98-1105">À medida que o sistema funciona, o NetX Duo atualiza automaticamente a Cache ND, adicionando e eliminando as entradas de acordo com o protocolo ND.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1105">As the system runs, NetX Duo automatically updates the ND Cache, adding and deleting entries as per ND protocol.</span></span> <span data-ttu-id="c4a98-1106">No entanto, uma aplicação também pode atualizar o Cache ND adicionando e eliminando manualmente as entradas de cache utilizando os seguintes serviços NetX Duo:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1106">However, an application may also update the ND Cache by manually adding and deleting cache entries using the following NetX Duo services:</span></span>

- <span data-ttu-id="c4a98-1107">***nxd_nd_cache_entry_delete***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1107">***nxd_nd_cache_entry_delete***</span></span>  
- <span data-ttu-id="c4a98-1108">***nxd_nd_cache_entry_set***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1108">***nxd_nd_cache_entry_set***</span></span>   
- <span data-ttu-id="c4a98-1109">***nxd_nd_cache_invalidate***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1109">***nxd_nd_cache_invalidate***</span></span>

<span data-ttu-id="c4a98-1110">Ao enviar e receber pacotes IPv6, o NetX Duo atualiza automaticamente a tabela ND Cache.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1110">When sending and receiving IPv6 packets, NetX Duo automatically updates the ND Cache table.</span></span>

## <a name="internet-control-message-protocol-in-ipv6-icmpv6"></a><span data-ttu-id="c4a98-1111">Protocolo de mensagem de controlo da Internet em IPv6 (ICMPv6)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1111">Internet Control Message Protocol in IPv6 (ICMPv6)</span></span>  

<span data-ttu-id="c4a98-1112">O papel do ICMPv6 no IPv6 foi amplamente expandido para apoiar o mapeamento de endereços IPv6 e a descoberta do router.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1112">The role of ICMPv6 in IPv6 has been greatly expanded to support IPv6 address mapping and router discovery.</span></span> <span data-ttu-id="c4a98-1113">Além disso, o NetX Duo ICMPv6 suporta pedido e resposta de eco, relatórios de erro ICMPv6 e mensagens de redirecionamento ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1113">In addition, NetX Duo ICMPv6 supports echo request and response, ICMPv6 error reports, and ICMPv6 redirect messages.</span></span>

### <a name="icmpv6-enable"></a><span data-ttu-id="c4a98-1114">ICMPv6 Ativar</span><span class="sxs-lookup"><span data-stu-id="c4a98-1114">ICMPv6 Enable</span></span>    
<span data-ttu-id="c4a98-1115">Antes de as mensagens ICMPv6 poderem ser processadas pela NetX Duo, a aplicação deve ligar para o serviço ***nxd_icmp_enable*** para permitir o processamento do ICMPv6, conforme explicado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1115">Before ICMPv6 messages can be processed by NetX Duo, the application must call the ***nxd_icmp_enable*** service to enable ICMPv6 processing as explained previously.</span></span> 

### <a name="icmpv6-messages"></a><span data-ttu-id="c4a98-1116">Mensagens ICMPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-1116">ICMPv6 Messages</span></span>     
<span data-ttu-id="c4a98-1117">A estrutura do cabeçalho ICMPv6 é semelhante à estrutura do cabeçalho ICMPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1117">The ICMPv6 header structure is similar to the ICMPv4 header structure.</span></span> <span data-ttu-id="c4a98-1118">Como mostrado abaixo, o cabeçalho básico ICMPv6 contém os três campos, tipo, código e checkum, além do comprimento variável dos dados de opção ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1118">As shown below, the basic ICMPv6 header contains the three fields, type, code, and checksum, plus variable length of ICMPv6 option data.</span></span> 

![Diagrama de um cabeçalho básico do ICMPv6.](./media/user-guide/image19.png)

<span data-ttu-id="c4a98-1120">**FIGURA 10. Cabeçalho Básico ICMPv6**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1120">**FIGURE 10. Basic ICMPv6 Header**</span></span>

|<span data-ttu-id="c4a98-1121">Campo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1121">Field</span></span> |<span data-ttu-id="c4a98-1122">Tamanho (bytes)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1122">Size(bytes)</span></span> |<span data-ttu-id="c4a98-1123">Descrição</span><span class="sxs-lookup"><span data-stu-id="c4a98-1123">Description</span></span> |
|-----|-----|-----|
|     | <span data-ttu-id="c4a98-1124">1</span><span class="sxs-lookup"><span data-stu-id="c4a98-1124">1</span></span>   |<span data-ttu-id="c4a98-1125">Identifica o tipo de mensagem ICMPv6;</span><span class="sxs-lookup"><span data-stu-id="c4a98-1125">Identifies the ICMPv6 message type;</span></span> |
|     |     |<span data-ttu-id="c4a98-1126">1 Destino Inacessível</span><span class="sxs-lookup"><span data-stu-id="c4a98-1126">1 Destination Unreachable</span></span> |
|     |     |<span data-ttu-id="c4a98-1127">2 Pacote Muito Grande</span><span class="sxs-lookup"><span data-stu-id="c4a98-1127">2 Packet Too Big</span></span> |
|     |     |<span data-ttu-id="c4a98-1128">3 Tempo Excedido</span><span class="sxs-lookup"><span data-stu-id="c4a98-1128">3 Time Exceeded</span></span> |
|     |     |<span data-ttu-id="c4a98-1129">4 Problema de parâmetros</span><span class="sxs-lookup"><span data-stu-id="c4a98-1129">4 Parameter Problem</span></span> |
|     |     |<span data-ttu-id="c4a98-1130">128 Pedido de Eco</span><span class="sxs-lookup"><span data-stu-id="c4a98-1130">128 Echo Request</span></span> |
|     |     |<span data-ttu-id="c4a98-1131">129 Resposta de Eco</span><span class="sxs-lookup"><span data-stu-id="c4a98-1131">129 Echo Reply</span></span> |
|     |     |<span data-ttu-id="c4a98-1132">133 Solicitação do Router</span><span class="sxs-lookup"><span data-stu-id="c4a98-1132">133 Router Solicitation</span></span> |
|     |     |<span data-ttu-id="c4a98-1133">134 Anúncio de Router</span><span class="sxs-lookup"><span data-stu-id="c4a98-1133">134 Router Advertisement</span></span> |
|     |     |<span data-ttu-id="c4a98-1134">135 Solicitação de Vizinhos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1134">135 Neighbor Solicitation</span></span> |
|     |     |<span data-ttu-id="c4a98-1135">136 Anúncio do Vizinho</span><span class="sxs-lookup"><span data-stu-id="c4a98-1135">136 Neighbor Advertisement</span></span> |
|     |     |<span data-ttu-id="c4a98-1136">137 Mensagem de Redirecionamento</span><span class="sxs-lookup"><span data-stu-id="c4a98-1136">137 Redirect Message</span></span> |
|<span data-ttu-id="c4a98-1137">Código</span><span class="sxs-lookup"><span data-stu-id="c4a98-1137">Code</span></span> | <span data-ttu-id="c4a98-1138">1</span><span class="sxs-lookup"><span data-stu-id="c4a98-1138">1</span></span>   |<span data-ttu-id="c4a98-1139">Qualifica ainda o tipo de mensagem ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1139">Further qualifies the ICMPv6 message type.</span></span> <span data-ttu-id="c4a98-1140">Geralmente usado com mensagens de erro.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1140">Generally used with error messages.</span></span> <span data-ttu-id="c4a98-1141">Se não for utilizado, está definido para zero.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1141">If not used, it is set to zero.</span></span> <span data-ttu-id="c4a98-1142">O pedido de eco/resposta e as mensagens NS não a utilizam.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1142">Echo request/reply and NS messages do not use it.</span></span>|
|<span data-ttu-id="c4a98-1143">Soma de verificação</span><span class="sxs-lookup"><span data-stu-id="c4a98-1143">Checksum</span></span> | <span data-ttu-id="c4a98-1144">2</span><span class="sxs-lookup"><span data-stu-id="c4a98-1144">2</span></span> |<span data-ttu-id="c4a98-1145">Campo de verificação de 16 bits para o cabeçalho ICMP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1145">16-bit checksum field for the ICMP Header.</span></span> <span data-ttu-id="c4a98-1146">Este é um complemento de 16 bits de toda a mensagem ICMPv6, incluindo o cabeçalho ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1146">This is a 16-bit complement of the entire ICMPv6 message, including the ICMPv6 header.</span></span> <span data-ttu-id="c4a98-1147">Também inclui um pseudo-cabeçalho do endereço de origem IPv6, endereço de destino e comprimento de carga útil do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1147">It also includes a pseudo-header of the IPv6 source address, destination address, and packet payload length.</span></span> |

<span data-ttu-id="c4a98-1148">Um exemplo do cabeçalho de solicitação do vizinho é mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1148">An example Neighbor Solicitation header is shown below.</span></span>

![Diagrama de um exemplo cabeçalho solicitação de vizinho.](./media/user-guide/image20.jpg)

<span data-ttu-id="c4a98-1150">**FIGURA 11. Cabeçalho ICMPv6 para uma mensagem de solicitação do vizinho**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1150">**FIGURE 11. ICMPv6 Header for a Neighbor Solicitation Message**</span></span>

|<span data-ttu-id="c4a98-1151">Campo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1151">Field</span></span> |<span data-ttu-id="c4a98-1152">Tamanho (bytes)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1152">Size(bytes)</span></span> |<span data-ttu-id="c4a98-1153">Descrição</span><span class="sxs-lookup"><span data-stu-id="c4a98-1153">Description</span></span> |
|-----|-----|-----|
|<span data-ttu-id="c4a98-1154">Tipo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1154">Type</span></span> | <span data-ttu-id="c4a98-1155">1</span><span class="sxs-lookup"><span data-stu-id="c4a98-1155">1</span></span>   |<span data-ttu-id="c4a98-1156">Identifica o tipo de mensagem ICMPv6 para mensagens de solicitação de vizinhos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1156">Identifies the ICMPv6 message type for neighbor solicitation messages.</span></span> <span data-ttu-id="c4a98-1157">O valor é 135.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1157">Value is 135.</span></span> |
|<span data-ttu-id="c4a98-1158">Código</span><span class="sxs-lookup"><span data-stu-id="c4a98-1158">Code</span></span> | <span data-ttu-id="c4a98-1159">1</span><span class="sxs-lookup"><span data-stu-id="c4a98-1159">1</span></span>   |<span data-ttu-id="c4a98-1160">Não usado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1160">Not used.</span></span> <span data-ttu-id="c4a98-1161">Pronto para 0.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1161">Set to 0.</span></span> |
|<span data-ttu-id="c4a98-1162">Soma de verificação</span><span class="sxs-lookup"><span data-stu-id="c4a98-1162">Checksum</span></span> | <span data-ttu-id="c4a98-1163">2</span><span class="sxs-lookup"><span data-stu-id="c4a98-1163">2</span></span>  |<span data-ttu-id="c4a98-1164">Campo de verificação de 16 bits para o cabeçalho ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1164">16-bit checksum field for the ICMPv6 header.</span></span> |
|<span data-ttu-id="c4a98-1165">Reservado</span><span class="sxs-lookup"><span data-stu-id="c4a98-1165">Reserved</span></span> | <span data-ttu-id="c4a98-1166">4</span><span class="sxs-lookup"><span data-stu-id="c4a98-1166">4</span></span>  |<span data-ttu-id="c4a98-1167">4 bytes reservados definidos para 0.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1167">4 reserved bytes set to 0.</span></span> |
|<span data-ttu-id="c4a98-1168">Endereço-alvo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1168">Target Address</span></span> | <span data-ttu-id="c4a98-1169">16</span><span class="sxs-lookup"><span data-stu-id="c4a98-1169">16</span></span>  |<span data-ttu-id="c4a98-1170">Endereço IPv6 do alvo da solicitação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1170">IPv6 address of target of the solicitation.</span></span> <span data-ttu-id="c4a98-1171">Para a resolução de endereços IPv6, este é o endereço IP unicast real do dispositivo cujo endereço de camada de ligação precisa de ser resolvido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1171">For IPv6 address resolution, this is the actual unicast IP address of the device whose link layer address needs to be resolved.</span></span> |
|<span data-ttu-id="c4a98-1172">Opções</span><span class="sxs-lookup"><span data-stu-id="c4a98-1172">Options</span></span> | <span data-ttu-id="c4a98-1173">Variável</span><span class="sxs-lookup"><span data-stu-id="c4a98-1173">Variable</span></span> |<span data-ttu-id="c4a98-1174">Informação opcional especificada pelo Protocolo de Descoberta do Vizinho.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1174">Optional information specified by the Neighbor Discovery Protocol.</span></span> |

### <a name="icmpv6-ping-request"></a><span data-ttu-id="c4a98-1175">Pedido de ping ICMPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-1175">ICMPv6 Ping Request</span></span>
<span data-ttu-id="c4a98-1176">Nas aplicações NetX Duo utilizam ***nxd_icmp_ping*** para emitir pedidos de ping IPv6 ou IPv4, com base no endereço IP de destino especificado nos parâmetros.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1176">In NetX Duo applications use ***nxd_icmp_ping*** to issue either IPv6 or IPv4 ping requests, based on the destination IP address specified in the parameters.</span></span>  

### <a name="icmpv6-ping-response"></a><span data-ttu-id="c4a98-1177">Resposta ao ping ICMPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-1177">ICMPv6 Ping Response</span></span>
<span data-ttu-id="c4a98-1178">Uma resposta de ping ICMPv6 é outro tipo de mensagem ICMPv6 que é gerada internamente pela componente ICMPv6 em resposta a um pedido externo de ping ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1178">An ICMPv6 ping response is another type of ICMPv6 message that is generated internally by the ICMPv6 component in response to an external ICMPv6 ping request.</span></span> <span data-ttu-id="c4a98-1179">Além do reconhecimento, a resposta ao ping ICMPv6 contém também uma cópia dos dados do utilizador fornecidos no pedido de ping do ICMPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1179">In additional to acknowledgement, the ICMPv6 ping response also contains a copy of the user data supplied in the ICMPv6 ping request.</span></span>  

### <a name="thread-suspension"></a><span data-ttu-id="c4a98-1180">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="c4a98-1180">Thread Suspension</span></span>
<span data-ttu-id="c4a98-1181">Os fios de aplicação podem ser suspensos enquanto tentam pingar outro membro da rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1181">Application threads can suspend while attempting to ping another network member.</span></span> <span data-ttu-id="c4a98-1182">Após a resposta ao ping ser recebida, a mensagem de resposta do ping é dada ao primeiro fio suspenso e esse fio é retomado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1182">After a ping response is received, the ping response message is given to the first thread suspended and that thread is resumed.</span></span> <span data-ttu-id="c4a98-1183">Como todos os serviços da NetX Duo, suspender um pedido de ping tem um tempo limite opcional.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1183">Like all NetX Duo services, suspending on a ping request has an optional timeout.</span></span>  

### <a name="other-icmpv6-messages"></a><span data-ttu-id="c4a98-1184">Outras mensagens ICMPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-1184">Other ICMPv6 Messages</span></span>
<span data-ttu-id="c4a98-1185">São necessárias mensagens ICMPv6 para as seguintes funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1185">ICMPv6 messages are required for the following features:</span></span>  

- <span data-ttu-id="c4a98-1186">Descoberta do Vizinho</span><span class="sxs-lookup"><span data-stu-id="c4a98-1186">Neighbor Discovery</span></span>  
- <span data-ttu-id="c4a98-1187">Autoconfiguação de endereço apátrida</span><span class="sxs-lookup"><span data-stu-id="c4a98-1187">Stateless Address Autoconfiguration</span></span> 
- <span data-ttu-id="c4a98-1188">Descoberta do Router</span><span class="sxs-lookup"><span data-stu-id="c4a98-1188">Router Discovery</span></span> 
- <span data-ttu-id="c4a98-1189">Deteção de Inacessibilidade do Vizinho</span><span class="sxs-lookup"><span data-stu-id="c4a98-1189">Neighbor Unreachability Detection</span></span>  

### <a name="neighbor-unreachability-router-and-prefix-discovery"></a><span data-ttu-id="c4a98-1190">Inalabilidade do vizinho, router e prefix discovery</span><span class="sxs-lookup"><span data-stu-id="c4a98-1190">Neighbor Unreachability, Router and Prefix Discovery</span></span>    
<span data-ttu-id="c4a98-1191">Neighbor Unreachability Detection, Router Discovery e Prefix Discovery são baseados no protocolo Neighbor Discovery e são descritos abaixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1191">Neighbor Unreachability Detection, Router Discovery, and Prefix Discovery are based on the Neighbor Discovery protocol and are described below.</span></span> 

<span data-ttu-id="c4a98-1192">***Deteção de Inacessibilidade do Vizinho:*** Um dispositivo IPv6 procura a cache da Neighbor Discovery (ND) para o endereço da camada de ligação de destino quando deseja enviar um pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1192">***Neighbor Unreachability Detection:*** An IPv6 device searches its Neighbor Discovery (ND) Cache for the destination link layer address when it wishes to send a packet.</span></span> <span data-ttu-id="c4a98-1193">O destino imediato, por vezes referido como o "próximo salto", pode ser o destino real no mesmo link ou pode ser um router se o destino estiver fora de ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1193">The immediate destination, sometimes referred to as the 'next hop,' may be the actual destination on the same link or it may be a router if the destination is off link.</span></span> <span data-ttu-id="c4a98-1194">Uma entrada de cache ND contém o estado na capacidade de alcance de um vizinho.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1194">An ND cache entry contains the status on a neighbor's reachability.</span></span>

<span data-ttu-id="c4a98-1195">Um estado de alcance indica que o vizinho é considerado acessível.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1195">A REACHABLE status indicates the neighbor is considered reachable.</span></span> <span data-ttu-id="c4a98-1196">Um vizinho está contactável se recebeu recentemente a confirmação de que os pacotes enviados para o vizinho foram recebidos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1196">A neighbor is reachable if it has recently received confirmation that packets sent to the neighbor have been received.</span></span> <span data-ttu-id="c4a98-1197">A confirmação no NetX Duo assume a forma de receber uma mensagem NA do vizinho em resposta a uma mensagem NS enviada pelo dispositivo NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1197">Confirmation in NetX Duo take the form of receiving an NA message from the neighbor in response to an NS message sent by the NetX Duo device.</span></span> <span data-ttu-id="c4a98-1198">A NetX Duo também alterará o estado do estado do vizinho para REACHABLE se a aplicação ligar para o serviço NetX Duo ***nxd_nd_cache_entry_set*** para introduzir manualmente um registo de cache.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1198">NetX Duo will also change the state of the neighbor status to REACHABLE if the application calls the NetX Duo service ***nxd_nd_cache_entry_set*** to manually enter a cache record.</span></span>

<span data-ttu-id="c4a98-1199">***Descoberta do Router:*** Um dispositivo IPv6 utiliza um router para encaminhar todos os pacotes destinados a destinos fora de ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1199">***Router Discovery:*** An IPv6 device uses a router to forward all packets intended for off link destinations.</span></span> <span data-ttu-id="c4a98-1200">Pode também utilizar informações enviadas pelo router, como mensagens de publicidade de router (RA), para configurar os seus endereços IPv6 globais.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1200">It may also use information sent by the router, such as router advertisement (RA) messages, to configure its global IPv6 addresses.</span></span>

<span data-ttu-id="c4a98-1201">Um dispositivo na rede pode iniciar o processo de Discovery router enviando uma mensagem de solicitação de router (RS) para o endereço multicast de todos os routers (FF01::2).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1201">A device on the network may initiate the Router Discovery process by sending a router solicitation (RS) message to the all-router multicast address (FF01::2).</span></span> <span data-ttu-id="c4a98-1202">Ou pode esperar no endereço multicast de todos os nós (FF::1) para um RA periódico dos routers.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1202">Or it can wait on the all-node multicast address (FF::1) for a periodic RA from the routers.</span></span>

<span data-ttu-id="c4a98-1203">Uma mensagem RA contém as informações de prefixo para configurar um endereço IPv6 para essa rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1203">An RA message contains the prefix information for configuring an IPv6 address for that network.</span></span> <span data-ttu-id="c4a98-1204">No NetX Duo, a solicitação do router está por defeito ativada e pode ser desativada definindo a opção de configuração ***NX_DISABLE_ICMPV6_ROUTER_SOLICITATION** _ em _*_nx_user.h_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1204">In NetX Duo, router solicitation is by default enabled and can be disabled by setting the configuration option ***NX_DISABLE_ICMPV6_ROUTER_SOLICITATION** _ in _*_nx_user.h_\*\*.</span></span> <span data-ttu-id="c4a98-1205">Consulte as opções de configuração no capítulo "Instalação e Utilização da NetX Duo" para obter mais detalhes sobre a definição dos parâmetros de solicitação do router.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1205">See Configuration Options in the "Installation and Use of NetX Duo" chapter for more details on setting Router Solicitation parameters.</span></span> 

<span data-ttu-id="c4a98-1206">***Prefix Discovery***: Um dispositivo IPv6 utiliza a descoberta do prefixo para saber quais os anfitriões-alvo que estão acessíveis diretamente sem passar por um router.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1206">***Prefix Discovery***: An IPv6 device uses prefix discovery to learn which target hosts are accessible directly without going through a router.</span></span> <span data-ttu-id="c4a98-1207">Estas informações são disponibilizadas ao dispositivo IPv6 a partir de mensagens RA do router.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1207">This information is made available to the IPv6 device from RA messages from the router.</span></span> <span data-ttu-id="c4a98-1208">O dispositivo IPv6 armazena a informação do prefixo numa tabela de prefixos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1208">The IPv6 device stores the prefix information in a prefix table.</span></span> <span data-ttu-id="c4a98-1209">A descoberta do prefixo corresponde a um prefixo do prefixo do dispositivo IPv6 com um endereço alvo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1209">Prefix discovery is matching a prefix from the IPv6 device prefix table to a target address.</span></span> <span data-ttu-id="c4a98-1210">Um prefixo corresponde a um endereço-alvo se todos os bits do prefixo corresponderem às partes mais significativas do endereço alvo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1210">A prefix matches a target address if all the bits in the prefix match the most significant bits of the target address.</span></span> <span data-ttu-id="c4a98-1211">Se mais de um prefixo cobrir um endereço, o prefixo mais longo é selecionado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1211">If more than one prefix covers an address, the longest prefix is selected.</span></span>

### <a name="icmpv6-error-messages"></a><span data-ttu-id="c4a98-1212">Mensagens de erro ICMPv6</span><span class="sxs-lookup"><span data-stu-id="c4a98-1212">ICMPv6 Error Messages</span></span>    
<span data-ttu-id="c4a98-1213">As seguintes mensagens de erro ICMPv6 são suportadas no NetX Duo:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1213">The following ICMPv6 error messages are supported in NetX Duo:</span></span>  

- <span data-ttu-id="c4a98-1214">Destino Inacessível</span><span class="sxs-lookup"><span data-stu-id="c4a98-1214">Destination Unreachable</span></span>  
- <span data-ttu-id="c4a98-1215">Pacote muito grande</span><span class="sxs-lookup"><span data-stu-id="c4a98-1215">Packet Too Big</span></span>  
- <span data-ttu-id="c4a98-1216">Exceder o tempo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1216">Time Exceed</span></span>  
- <span data-ttu-id="c4a98-1217">Problema de parâmetros</span><span class="sxs-lookup"><span data-stu-id="c4a98-1217">Parameter Problem</span></span>  

## <a name="user-datagram-protocol-udp"></a><span data-ttu-id="c4a98-1218">Protocolo de Datagrama do Utilizador (UDP)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1218">User Datagram Protocol (UDP)</span></span>

<span data-ttu-id="c4a98-1219">O Protocolo de Datagrama do Utilizador (UDP) fornece a forma mais simples de transferência de dados entre membros da rede (RFC 768).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1219">The User Datagram Protocol (UDP) provides the simplest form of data transfer between network members (RFC 768).</span></span> <span data-ttu-id="c4a98-1220">Os pacotes de dados da UDP são enviados de um membro da rede para outro da melhor forma de esforço; ou seja, não existe um mecanismo incorporado para reconhecimento pelo destinatário do pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1220">UDP data packets are sent from one network member to another in a best effort fashion; i.e., there is no built-in mechanism for acknowledgement by the packet recipient.</span></span> <span data-ttu-id="c4a98-1221">Além disso, o envio de um pacote UDP não requer qualquer ligação a ser estabelecida antecipadamente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1221">In addition, sending a UDP packet does not require any connection to be established in advance.</span></span> <span data-ttu-id="c4a98-1222">Por causa disso, a transmissão de pacotes da UDP é muito eficiente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1222">Because of this, UDP packet transmission is very efficient.</span></span>

<span data-ttu-id="c4a98-1223">Para os desenvolvedores que migram as suas aplicações NetX para o NetX Duo existem apenas algumas alterações básicas na funcionalidade UDP entre NetX e NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1223">For developers migrating their NetX applications to NetX Duo there are only a few basic changes in UDP functionality between NetX and NetX Duo.</span></span> <span data-ttu-id="c4a98-1224">Isto porque o IPv6 se preocupa principalmente com a camada ip subjacente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1224">This is because IPv6 is primarily concerned with the underlying IP layer.</span></span> <span data-ttu-id="c4a98-1225">Todos os serviços netx Duo UDP podem ser usados para conectividade IPv4 ou IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1225">All NetX Duo UDP services can be used for either IPv4 or IPv6 connectivity.</span></span>

### <a name="udp-header"></a><span data-ttu-id="c4a98-1226">Cabeçalho UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1226">UDP Header</span></span>       
<span data-ttu-id="c4a98-1227">A UDP coloca um simples cabeçalho de pacote na frente dos dados da aplicação sobre a transmissão, e remove um cabeçalho UDP semelhante do pacote na receção antes de entregar um pacote UDP recebido à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1227">UDP places a simple packet header in front of the application's data on transmission, and removes a similar UDP header from the packet on reception before delivering a received UDP packet to the application.</span></span> <span data-ttu-id="c4a98-1228">O UDP utiliza o protocolo IP para o envio e receção de pacotes, o que significa que há um cabeçalho IP em frente ao cabeçalho da UDP quando o pacote está na rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1228">UDP utilizes the IP protocol for sending and receiving packets, which means there is an IP header in front of the UDP header when the packet is on the network.</span></span> <span data-ttu-id="c4a98-1229">A figura 12 mostra o formato do cabeçalho UDP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1229">Figure 12 shows the format of the UDP header.</span></span>

![Diagrama do formato do cabeçalho da UDP.](./media/user-guide/image21.png)

### <a name="figure-12-udp-header"></a><span data-ttu-id="c4a98-1231">FIGURA 12.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1231">FIGURE 12.</span></span> <span data-ttu-id="c4a98-1232">Cabeçalho UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1232">UDP Header</span></span>

> [!NOTE]
> <span data-ttu-id="c4a98-1233">*Espera-se que todos os cabeçalhos na implementação UDP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-1233">*All headers in the UDP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

<span data-ttu-id="c4a98-1234">O seguinte descreve o formato do cabeçalho UDP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1234">The following describes the UDP header format:</span></span>

|<span data-ttu-id="c4a98-1235">Campo de Cabeçalho</span><span class="sxs-lookup"><span data-stu-id="c4a98-1235">Header Field</span></span> |<span data-ttu-id="c4a98-1236">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1236">Purpose</span></span> |
|---|---|
|<span data-ttu-id="c4a98-1237">**Número de porta de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1237">**16-bit source port number**</span></span> |<span data-ttu-id="c4a98-1238">Este campo contém a porta de onde o pacote UDP está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1238">This field contains the port on which the UDP packet is being sent from.</span></span> <span data-ttu-id="c4a98-1239">As portas UDP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1239">Valid UDP ports range from 1 through 0xFFFF.</span></span> |
|<span data-ttu-id="c4a98-1240">**Número da porta de destino de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1240">**16-bit destination port number**</span></span> |<span data-ttu-id="c4a98-1241">Este campo contém a porta UDP para a qual o pacote está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1241">This field contains the UDP port to which the packet is being sent to.</span></span> <span data-ttu-id="c4a98-1242">As portas UDP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1242">Valid UDP ports range from 1 through 0xFFFF.</span></span> |
|<span data-ttu-id="c4a98-1243">**Comprimento uDP de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1243">**16-bit UDP length**</span></span> |<span data-ttu-id="c4a98-1244">Este campo contém o número de bytes no pacote UDP, incluindo o tamanho do cabeçalho UDP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1244">This field contains the number of bytes in the UDP packet, including the size of the UDP header.</span></span> |
|<span data-ttu-id="c4a98-1245">**16 bits UDP checksum**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1245">**16-bit UDP checksum**</span></span> |<span data-ttu-id="c4a98-1246">Este campo contém a 16-bit checkum para o pacote, incluindo o cabeçalho UDP, a área de dados do pacote, e o cabeçalho pseudo IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1246">This field contains the 16-bit checksum for the packet, including the UDP header, the packet data area, and the pseudo IP header.</span></span> |

### <a name="udp-enable"></a><span data-ttu-id="c4a98-1247">Ativação uDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1247">UDP Enable</span></span>   
<span data-ttu-id="c4a98-1248">Antes de a transmissão de pacotes da UDP ser possível, a aplicação deve primeiro permitir a UDP, ligando para o serviço ***nx_udp_enable.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1248">Before UDP packet transmission is possible, the application must first enable UDP by calling the ***nx_udp_enable*** service.</span></span> <span data-ttu-id="c4a98-1249">Depois de ativado, a aplicação é gratuita para enviar e receber pacotes UDP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1249">After enabled, the application is free to send and receive UDP packets.</span></span>  

### <a name="udp-socket-create"></a><span data-ttu-id="c4a98-1250">Criação de tomada uDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1250">UDP Socket Create</span></span>    
<span data-ttu-id="c4a98-1251">As tomadas UDP são criadas durante a inicialização ou durante o tempo de funcionamento por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1251">UDP sockets are created either during initialization or during runtime by application threads.</span></span> <span data-ttu-id="c4a98-1252">O tipo inicial de serviço, tempo para viver e receber profundidade de fila são definidos pelo ***serviço nx_udp_socket_create.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1252">The initial type of service, time to live, and receive queue depth are defined by the ***nx_udp_socket_create*** service.</span></span> <span data-ttu-id="c4a98-1253">Não existem limites ao número de tomadas UDP numa aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1253">There are no limits on the number of UDP sockets in an application.</span></span>

### <a name="udp-checksum"></a><span data-ttu-id="c4a98-1254">UDP Checksum</span><span class="sxs-lookup"><span data-stu-id="c4a98-1254">UDP Checksum</span></span>   
<span data-ttu-id="c4a98-1255">O protocolo IPv6 requer um cálculo de verificação de cabeçalho UDP sobre os dados dos pacotes, enquanto no protocolo IPv4 é opcional.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1255">IPv6 protocol requires a UDP header checksum computation on packet data, whereas in the IPv4 protocol it is optional.</span></span>  

<span data-ttu-id="c4a98-1256">O UDP especifica a parte de verificação de 16 bits de um complemento que cobre o cabeçalho IP pseudo (composto pelo endereço IP de origem, endereço IP de destino e a palavra IP protocol/comprimento), o cabeçalho UDP e os dados do pacote UDP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1256">UDP specifies a one's complement 16-bit checksum that covers the IP pseudo header (consisting of the source IP address, destination IP address, and the protocol/length IP word), the UDP header, and the UDP packet data.</span></span> <span data-ttu-id="c4a98-1257">As únicas diferenças entre as verificações de cabeçalho de pacote IPv4 e IPv6 UDP são que os endereços IP de origem e destino são de 32 bits no IPv4 enquanto no IPv6 são 128 bits.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1257">The only differences between IPv4 and IPv6 UDP packet header checksums is that the source and destination IP addresses are 32 bit in IPv4 while in IPv6 they are 128 bit.</span></span> <span data-ttu-id="c4a98-1258">Se a úmis calculado da UDP for 0, é armazenada como todas (0xFFFF).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1258">If the calculated UDP checksum is 0, it is stored as all ones (0xFFFF).</span></span> <span data-ttu-id="c4a98-1259">Se a tomada de envio tiver a lógica de verificação UDP desativada, é colocado um zero no campo de verificação da UDP para indicar que a parte de verificação não foi calculada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1259">If the sending socket has the UDP checksum logic disabled, a zero is placed in the UDP checksum field to indicate the checksum was not calculated.</span></span>

<span data-ttu-id="c4a98-1260">Se a sala de verificação UDP não corresponder à parte de verificação calculada pelo recetor, o pacote UDP é simplesmente descartado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1260">If the UDP checksum does not match the computed checksum by the receiver, the UDP packet is simply discarded.</span></span>

<span data-ttu-id="c4a98-1261">Na rede IPv4, a UDP checksum é opcional.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1261">On the IPv4 network, UDP checksum is optional.</span></span> <span data-ttu-id="c4a98-1262">O NetX Duo permite que uma aplicação permita ou desative o cálculo do UDP checkum numa base por tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1262">NetX Duo allows an application to enable or disable UDP checksum calculation on a per-socket basis.</span></span> <span data-ttu-id="c4a98-1263">Por predefinição, a lógica de verificação da tomada UDP está ativada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1263">By default, the UDP socket checksum logic is enabled.</span></span> <span data-ttu-id="c4a98-1264">A aplicação pode desativar a lógica de checkum para uma determinada tomada UDP, chamando o serviço \***nx_udp_socket_checksum_disable** _ .</span><span class="sxs-lookup"><span data-stu-id="c4a98-1264">The application can disable checksum logic for a particular UDP socket by calling the \***nx_udp_socket_checksum_disable** _ service.</span></span> <span data-ttu-id="c4a98-1265">No entanto, na rede IPv6, a UDP checksum é obrigatória.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1265">On the IPv6 network, however, UDP checksum is mandatory.</span></span> <span data-ttu-id="c4a98-1266">Portanto, o serviço _ *_nx_udp_socket_checksum_disable_*\* não desativaria a lógica de verificação da UDP ao enviar um pacote através da rede IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1266">Therefore, the service _ *_nx_udp_socket_checksum_disable_*\* would not disable UDP checksum logic when sending a packet through the IPv6 network.</span></span>

<span data-ttu-id="c4a98-1267">Certos controladores Ethernet são capazes de gerar o checkum uDP em movimento.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1267">Certain Ethernet controllers are able to generate the UDP checksum on the fly.</span></span> <span data-ttu-id="c4a98-1268">Se o sistema for capaz de utilizar a funcionalidade de cálculo de checkum de hardware, a biblioteca NetX Duo pode ser construída sem a lógica de checkum.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1268">If the system is able to use hardware checksum computation feature, the NetX Duo library can be built without the checksum logic.</span></span> <span data-ttu-id="c4a98-1269">Para desativar a caixa de verificação de software UDP, a biblioteca NetX Duo deve ser construída com os seguintes símbolos definidos: ***NX_DISABLE_UDP_TX_CHECKSUM** _ e _*_NX_DISABLE_UDP_RX_CHECKSUM_\*_ (descritos no Capítulo dois).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1269">To disable UDP software checksum, the NetX Duo library must be built with the following symbols defined: ***NX_DISABLE_UDP_TX_CHECKSUM** _ and _*_NX_DISABLE_UDP_RX_CHECKSUM_\*_ (described in Chapter two).</span></span> <span data-ttu-id="c4a98-1270">As opções de configuração removem totalmente a lógica de verificação UDP do NetX Duo, enquanto o serviço _ *_nx_udp_socket_checksum_disable_*\* permite que a aplicação desative o processamento de checkum IPv4 UDP por tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1270">The configuration options remove UDP checksum logic from NetX Duo entirely, while calling the _ *_nx_udp_socket_checksum_disable_*\* service allows the application to disable IPv4 UDP checksum processing on a per socket basis.</span></span>

### <a name="udp-ports-and-binding"></a><span data-ttu-id="c4a98-1271">Portos da UDP e Encadernação</span><span class="sxs-lookup"><span data-stu-id="c4a98-1271">UDP Ports and Binding</span></span>      
<span data-ttu-id="c4a98-1272">Uma porta UDP é um ponto final lógico no protocolo UDP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1272">A UDP port is a logical end point in the UDP protocol.</span></span> <span data-ttu-id="c4a98-1273">Existem 65.535 portas válidas na componente UDP da NetX Duo, que variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1273">There are 65,535 valid ports in the UDP component of NetX Duo, ranging from 1 through 0xFFFF.</span></span> <span data-ttu-id="c4a98-1274">Para enviar ou receber dados da UDP, a aplicação deve primeiro criar uma tomada UDP e, em seguida, ligá-la a uma porta desejada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1274">To send or receive UDP data, the application must first create a UDP socket, then bind it to a desired port.</span></span> <span data-ttu-id="c4a98-1275">Depois de ligar uma tomada UDP a uma porta, o pedido pode enviar e receber dados sobre essa tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1275">After binding a UDP socket to a port, the application may send and receive data on that socket.</span></span>

### <a name="udp-fast-pathtrade"></a><span data-ttu-id="c4a98-1276">Caminho Rápido da UDP&trade;</span><span class="sxs-lookup"><span data-stu-id="c4a98-1276">UDP Fast Path&trade;</span></span>   
<span data-ttu-id="c4a98-1277">O UDP Fast Path &trade; é o nome para um caminho de sobrecarga de baixo pacote através da implementação do UDP NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1277">The UDP Fast Path&trade; is the name for a low packet overhead path through the NetX Duo UDP implementation.</span></span> <span data-ttu-id="c4a98-1278">O envio de um pacote UDP requer apenas algumas chamadas de função: ***nx_udp_socket_send** _, _*_nx_ip_packet_send_\*_, e a eventual chamada para o controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1278">Sending a UDP packet requires just a few function calls: ***nx_udp_socket_send** _, _*_nx_ip_packet_send_\*_, and the eventual call to the network driver.</span></span> <span data-ttu-id="c4a98-1279">_*_nx_udp_socket_send_*_ está disponível no NetX Duo para aplicações NetX existentes e só é aplicável para pacotes IPv4.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1279">_*_nx_udp_socket_send_*_ is available in NetX Duo for existing NetX applications and is only applicable for IPv4 packets.</span></span> <span data-ttu-id="c4a98-1280">O método preferido, no entanto, é usar o serviço _ *_nxd_udp_socket_send_*\* discutido abaixo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1280">The preferred method, however, is to use _ *_nxd_udp_socket_send_*\* service discussed below.</span></span> <span data-ttu-id="c4a98-1281">Na receção do pacote UDP, o pacote UDP é colocado na tomada UDP adequada receber fila ou entregue a um fio de aplicação suspenso numa única chamada de função do processamento de interrupção de receção do condutor da rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1281">On UDP packet reception, the UDP packet is either placed on the appropriate UDP socket receive queue or delivered to a suspended application thread in a single function call from the network driver's receive interrupt processing.</span></span> <span data-ttu-id="c4a98-1282">Esta lógica altamente otimizada para o envio e receção de pacotes UDP é a essência da tecnologia UDP Fast Path.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1282">This highly optimized logic for sending and receiving UDP packets is the essence of UDP Fast Path technology.</span></span>  

### <a name="udp-packet-send"></a><span data-ttu-id="c4a98-1283">Envio de pacote de UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1283">UDP Packet Send</span></span>    
<span data-ttu-id="c4a98-1284">O envio de dados UDP através das redes IPv6 ou IPv4 é facilmente realizado através da função \***nxd_udp_socket_send** _ .</span><span class="sxs-lookup"><span data-stu-id="c4a98-1284">Sending UDP data over IPv6 or IPv4 networks is easily accomplished by calling the \***nxd_udp_socket_send** _ function.</span></span> <span data-ttu-id="c4a98-1285">O chamador deve definir a versão IP no campo _nx_ip_version\* do parâmetro do ponteiro NXD_ADDRESS.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1285">The caller must set the IP version in the _nx_ip_version\* field of the NXD_ADDRESS pointer parameter.</span></span> <span data-ttu-id="c4a98-1286">A NetX Duo determinará o melhor endereço de origem para pacotes de UDP transmitidos com base no endereço IPv4/IPv6 de destino.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1286">NetX Duo will determine the best source address for transmitted UDP packets based on the destination IPv4/IPv6 address.</span></span> <span data-ttu-id="c4a98-1287">Este serviço coloca um cabeçalho UDP na frente dos dados do pacote e envia-o para a rede usando uma rotina interna de envio de IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1287">This service places a UDP header in front of the packet data and sends it out onto the network using an internal IP send routine.</span></span> <span data-ttu-id="c4a98-1288">Não existe suspensão de fio no envio de pacotes UDP porque todas as transmissões de pacotes UDP são processadas imediatamente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1288">There is no thread suspension on sending UDP packets because all UDP packet transmissions are processed immediately.</span></span> 

<span data-ttu-id="c4a98-1289">Para destinos multicast ou de difusão, a aplicação deve especificar o endereço IP de origem para utilizar se o dispositivo NetX Duo tiver vários endereços IP para escolher.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1289">For multicast or broadcast destinations, the application should specify the source IP address to use if the NetX Duo device has multiple IP addresses to choose from.</span></span> <span data-ttu-id="c4a98-1290">Isto pode ser feito com os serviços ***nxd_udp_socket_source_send.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1290">This can be done with the services ***nxd_udp_socket_source_send.***</span></span>

> [!IMPORTANT]    
> <span data-ttu-id="c4a98-1291">*Se **nx_udp_socket_send** for utilizado para transmitir pacotes multicast ou de transmissão, o endereço IP da primeira interface ativada é utilizado como endereço de origem*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1291">*If **nx_udp_socket_send** is used for transmitting multicast or broadcast packets, the IP address of the first enabled interface is used as source address*.</span></span>

> [!NOTE] 
> <span data-ttu-id="c4a98-1292">*Se a lógica de verificação da UDP estiver ativada para esta tomada, a operação de checkum é realizada no contexto da linha de chamada, sem bloquear o acesso às estruturas de dados UDP ou IP*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1292">*If UDP checksum logic is enabled for this socket, the checksum operation is performed in the context of the calling thread, without blocking access to the UDP or IP data structures*.</span></span> 

> [!WARNING]    
> <span data-ttu-id="c4a98-1293">*Os dados de carga útil da UDP que residem na estrutura NX_PACKET devem residir num limite de palavras longas. A aplicação precisa de deixar espaço suficiente entre o ponteiro pré-final e o ponteiro de início de dados para o NetX Duo colocar os cabeçalhos UDP, IP e meios de comunicação físicos*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1293">*The UDP payload data residing in the NX_PACKET structure should reside on a long-word boundary. The application needs to leave sufficient space between the prepend pointer and the data start pointer for NetX Duo to place the UDP, IP, and physical media headers*.</span></span>

### <a name="udp-packet-receive"></a><span data-ttu-id="c4a98-1294">Receber pacote da UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1294">UDP Packet Receive</span></span>    
<span data-ttu-id="c4a98-1295">Os fios de aplicação podem receber pacotes UDP de uma determinada tomada chamando ***nx_udp_socket_receive***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1295">Application threads may receive UDP packets from a particular socket by calling ***nx_udp_socket_receive***.</span></span> <span data-ttu-id="c4a98-1296">A função de receção da tomada fornece o pacote mais antigo da fila de receção da tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1296">The socket receive function delivers the oldest packet on the socket's receive queue.</span></span> <span data-ttu-id="c4a98-1297">Se não houver pacotes na fila de receção, o fio de chamada pode suspender (com um intervalo opcional) até chegar um pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1297">If there are no packets on the receive queue, the calling thread can suspend (with an optional timeout) until a packet arrives.</span></span>

<span data-ttu-id="c4a98-1298">O processamento de pacotes UDP (normalmente chamado do controlador de interrupção de receção do controlador de receção do condutor da rede) é responsável por colocar o pacote na fila de receção da tomada UDP ou entregá-lo ao primeiro fio suspenso à espera de um pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1298">The UDP receive packet processing (usually called from the network driver's receive interrupt handler) is responsible for either placing the packet on the UDP socket's receive queue or delivering it to the first suspended thread waiting for a packet.</span></span> <span data-ttu-id="c4a98-1299">Se o pacote estiver em fila, o processamento de receção também verifica a profundidade máxima de receção associada à tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1299">If the packet is queued, the receive processing also checks the maximum receive queue depth associated with the socket.</span></span> <span data-ttu-id="c4a98-1300">Se este pacote recém-em fila exceder a profundidade da fila, o pacote mais antigo da fila é descartado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1300">If this newly queued packet exceeds the queue depth, the oldest packet in the queue is discarded.</span></span>

### <a name="udp-receive-notify"></a><span data-ttu-id="c4a98-1301">Notificação de receção da UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1301">UDP Receive Notify</span></span>   
<span data-ttu-id="c4a98-1302">Se o fio de aplicação precisar de processar dados recebidos de mais de uma tomada, deve ser utilizada a função ***nx_udp_socket_receive_notify.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1302">If the application thread needs to process received data from more than one socket, the ***nx_udp_socket_receive_notify*** function should be used.</span></span> <span data-ttu-id="c4a98-1303">Esta função regista uma função de chamada de pacote de receção para a tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1303">This function registers a receive packet callback function for the socket.</span></span> <span data-ttu-id="c4a98-1304">Sempre que um pacote é recebido na tomada, a função de retorno é executada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1304">Whenever a packet is received on the socket, the callback function is executed.</span></span>

<span data-ttu-id="c4a98-1305">O conteúdo da função de retorno é específico da aplicação; no entanto, provavelmente conteria lógica para informar o fio de processamento de que um pacote está agora disponível na tomada correspondente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1305">The contents of the callback function is applicationspecific; however, it would most likely contain logic to inform the processing thread that a packet is now available on the corresponding socket.</span></span>

### <a name="peer-address-and-port"></a><span data-ttu-id="c4a98-1306">Endereço de pares e porto</span><span class="sxs-lookup"><span data-stu-id="c4a98-1306">Peer Address and Port</span></span>   
<span data-ttu-id="c4a98-1307">Ao receber um pacote UDP, a aplicação pode encontrar o endereço IP e o número de porta do remetente utilizando o ***serviço nx_udp_packet_info_extract***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1307">On receiving a UDP packet, application may find the sender's IP address and port number by using the service ***nx_udp_packet_info_extract***.</span></span> <span data-ttu-id="c4a98-1308">Na devolução bem sucedida, este serviço fornece informações sobre o endereço IP do remetente, o número de porta do remetente e a interface local através da qual o pacote foi recebido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1308">On successful return, this service provides information on the sender's IP address, sender's port number, and the local interface through which the packet was received.</span></span>  

### <a name="thread-suspension"></a><span data-ttu-id="c4a98-1309">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="c4a98-1309">Thread Suspension</span></span>   
<span data-ttu-id="c4a98-1310">Como mencionado anteriormente, os fios de aplicação podem suspender enquanto tentam receber um pacote UDP em uma determinada porta UDP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1310">As mentioned previously, application threads can suspend while attempting to receive a UDP packet on a particular UDP port.</span></span> <span data-ttu-id="c4a98-1311">Depois de recebido um pacote naquela porta, é dado ao primeiro fio suspenso e esse fio é retomado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1311">After a packet is received on that port, it is given to the first thread suspended and that thread is then resumed.</span></span> <span data-ttu-id="c4a98-1312">Um tempo limite opcional está disponível ao suspender um pacote de receção UDP, uma funcionalidade disponível para a maioria dos serviços NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1312">An optional timeout is available when suspending on a UDP receive packet, a feature available for most NetX Duo services.</span></span>  

### <a name="udp-socket-statistics-and-errors"></a><span data-ttu-id="c4a98-1313">Estatísticas e erros da tomada de UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1313">UDP Socket Statistics and Errors</span></span>     
<span data-ttu-id="c4a98-1314">Se ativado, o software de tomada UDP NetX Duo mantém o registo de várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1314">If enabled, the NetX Duo UDP socket software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-1315">As seguintes estatísticas e relatórios de erro são mantidos para cada instância IP/UDP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1315">The following statistics and error reports are maintained for each IP/UDP instance:</span></span>

- <span data-ttu-id="c4a98-1316">Total de pacotes UDP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1316">Total UDP Packets Sent</span></span>  
- <span data-ttu-id="c4a98-1317">Total de bytes UDP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1317">Total UDP Bytes Sent</span></span>  
- <span data-ttu-id="c4a98-1318">Total de pacotes UDP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1318">Total UDP Packets Received</span></span>   
- <span data-ttu-id="c4a98-1319">Total de bytes UDP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1319">Total UDP Bytes Received</span></span>  
- <span data-ttu-id="c4a98-1320">Total de pacotes inválidos da UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1320">Total UDP Invalid Packets</span></span>  
- <span data-ttu-id="c4a98-1321">Total de pacotes de receção udp caídos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1321">Total UDP Receive Packets Dropped</span></span>  
- <span data-ttu-id="c4a98-1322">Total da UDP recebe erros de checkum</span><span class="sxs-lookup"><span data-stu-id="c4a98-1322">Total UDP Receive Checksum Errors</span></span>  
- <span data-ttu-id="c4a98-1323">Pacotes de tomada udp enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1323">UDP Socket Packets Sent</span></span>  
- <span data-ttu-id="c4a98-1324">UDP Socket Bytes Enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1324">UDP Socket Bytes Sent</span></span>  
- <span data-ttu-id="c4a98-1325">Pacotes de tomada udp recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1325">UDP Socket Packets Received</span></span>   
- <span data-ttu-id="c4a98-1326">UDP Socket Bytes Recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1326">UDP Socket Bytes Received</span></span>  
- <span data-ttu-id="c4a98-1327">Pacotes de tomada uDP em fila</span><span class="sxs-lookup"><span data-stu-id="c4a98-1327">UDP Socket Packets Queued</span></span>  
- <span data-ttu-id="c4a98-1328">Tomada UDP receber pacotes caídos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1328">UDP Socket Receive Packets Dropped</span></span>  
- <span data-ttu-id="c4a98-1329">Erros de verificação da tomada da UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1329">UDP Socket Checksum Errors</span></span>  

<span data-ttu-id="c4a98-1330">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_udp_info_get** _ para estatísticas UDP acumulados em todas as tomadas UDP, e o serviço _ *_nx_udp_socket_info_get_** para estatísticas de UDP na tomada de UDP especificada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1330">All these statistics and error reports are available to the application with the ***nx_udp_info_get** _ service for UDP statistics amassed over all UDP sockets, and the _ *_nx_udp_socket_info_get_** service for UDP statistics on the specified UDP socket.</span></span>

### <a name="udp-socket-control-block-nx_udp_socket"></a><span data-ttu-id="c4a98-1331">NX_UDP_SOCKET do bloco de controlo da tomada UDP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1331">UDP Socket Control Block NX_UDP_SOCKET</span></span>
<span data-ttu-id="c4a98-1332">As características de cada tomada UDP encontram-se no bloco de controlo NX_UDP_SOCKET associado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1332">The characteristics of each UDP socket are found in the associated NX_UDP_SOCKET control block.</span></span> <span data-ttu-id="c4a98-1333">Contém informações úteis, tais como a ligação à estrutura de dados IP, a interface de rede para os caminhos de envio e receção, a porta vinculada e a fila de pacotes de receção.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1333">It contains useful information such as the link to the IP data structure, the network interface for the sending and receiving paths, the bound port, and the receive packet queue.</span></span> <span data-ttu-id="c4a98-1334">Esta estrutura é definida no ficheiro ***nx_api.h.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1334">This structure is defined in the ***nx_api.h*** file.</span></span>

## <a name="transmission-control-protocol-tcp"></a><span data-ttu-id="c4a98-1335">Protocolo de Controlo de Transmissão (TCP)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1335">Transmission Control Protocol (TCP)</span></span>

<span data-ttu-id="c4a98-1336">O Protocolo de Controlo de Transmissão (TCP) fornece transferência fiável de dados de fluxo entre dois membros da rede (RFC 793).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1336">The Transmission Control Protocol (TCP) provides reliable stream data transfer between two network members (RFC 793).</span></span> <span data-ttu-id="c4a98-1337">Todos os dados enviados de um membro da rede são verificados e reconhecidos pelo membro recetor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1337">All data sent from one network member are verified and acknowledged by the receiving member.</span></span> <span data-ttu-id="c4a98-1338">Além disso, os dois membros devem ter estabelecido uma ligação antes de qualquer transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1338">In addition, the two members must have established a connection prior to any data transfer.</span></span> <span data-ttu-id="c4a98-1339">Tudo isto resulta numa transferência de dados fiável; no entanto, requer substancialmente mais despesas do que a transferência de dados da UDP anteriormente descrita.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1339">All this results in reliable data transfer; however, it does require substantially more overhead than the previously described UDP data transfer.</span></span>

<span data-ttu-id="c4a98-1340">Exceto quando notados, não há alterações nos serviços de API do protocolo TCP entre NetX e NetX Duo porque o IPv6 está principalmente preocupado com a camada ip subjacente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1340">Except where noted, there are no changes in TCP protocol API services between NetX and NetX Duo because IPv6 is primarily concerned with the underlying IP layer.</span></span> <span data-ttu-id="c4a98-1341">Todos os serviços NetX Duo TCP podem ser utilizados para ligações IPv4 ou IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1341">All NetX Duo TCP services can be used for either IPv4 or IPv6 connections.</span></span>

### <a name="tcp-header"></a><span data-ttu-id="c4a98-1342">Cabeçalho TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1342">TCP Header</span></span>   
<span data-ttu-id="c4a98-1343">Na transmissão, o cabeçalho TCP é colocado na frente dos dados do utilizador.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1343">On transmission, TCP header is placed in front of the data from the user.</span></span> <span data-ttu-id="c4a98-1344">Na receção, o cabeçalho TCP é removido do pacote de entrada, deixando apenas os dados do utilizador disponíveis para a aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1344">On reception, TCP header is removed from the incoming packet, leaving only the user data available to the application.</span></span> <span data-ttu-id="c4a98-1345">A TCP utiliza o protocolo IP para enviar e receber pacotes, o que significa que há um cabeçalho IP em frente ao cabeçalho TCP quando o pacote está na rede.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1345">TCP utilizes the IP protocol to send and receive packets, which means there is an IP header in front of the TCP header when the packet is on the network.</span></span> <span data-ttu-id="c4a98-1346">A figura 13 mostra o formato do cabeçalho TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1346">Figure 13 shows the format of the TCP header.</span></span>

![Diagrama do formato do cabeçalho TCP.](./media/user-guide/image22.png)

### <a name="figure-13-tcp-header"></a><span data-ttu-id="c4a98-1348">FIGURA 13.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1348">FIGURE 13.</span></span> <span data-ttu-id="c4a98-1349">Cabeçalho TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1349">TCP Header</span></span>

<span data-ttu-id="c4a98-1350">O seguinte descreve o formato do cabeçalho TCP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1350">The following describes the TCP header format:</span></span>

|<span data-ttu-id="c4a98-1351">Campo de Cabeçalho &nbsp;</span><span class="sxs-lookup"><span data-stu-id="c4a98-1351">Header&nbsp;Field</span></span> |<span data-ttu-id="c4a98-1352">Objetivo</span><span class="sxs-lookup"><span data-stu-id="c4a98-1352">Purpose</span></span> |
|------|------|
| <span data-ttu-id="c4a98-1353">**Número de porta de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1353">**16-bit source port number**</span></span> | <span data-ttu-id="c4a98-1354">Este campo contém a porta onde o pacote TCP está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1354">This field contains the port the TCP packet is being sent out on.</span></span> <span data-ttu-id="c4a98-1355">As portas TCP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1355">Valid TCP ports range from 1 through 0xFFFF.</span></span> |
| <span data-ttu-id="c4a98-1356">**Porto de destino de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1356">**16-bit destination port**</span></span> | <span data-ttu-id="c4a98-1357">Este campo contém a porta TCP para onde o pacote está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1357">This field contains the TCP port the packet is being sent to.</span></span> <span data-ttu-id="c4a98-1358">As portas TCP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1358">Valid TCP ports range from 1 through 0xFFFF.</span></span> |
| <span data-ttu-id="c4a98-1359">**Número de sequência de 32 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1359">**32-bit sequence number**</span></span> | <span data-ttu-id="c4a98-1360">Este campo contém o número de sequência para os dados enviados a partir desta extremidade da ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1360">This field contains the sequence number for data sent from this end of the connection.</span></span> <span data-ttu-id="c4a98-1361">A sequência original é estabelecida durante a sequência de ligação inicial entre dois nós TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1361">The original sequence is established during the initial connection sequence between two TCP nodes.</span></span> <span data-ttu-id="c4a98-1362">Cada transferência de dados a partir desse ponto resulta num incremento do número de sequência pelo número de bytes enviados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1362">Every data transfer from that point results in an increment of the sequence number by the amount bytes sent.</span></span> |
| <span data-ttu-id="c4a98-1363">**Número de reconhecimento de 32 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1363">**32-bit acknowledgement number**</span></span> | <span data-ttu-id="c4a98-1364">Este campo contém o número de sequência correspondente ao último byte recebido por este lado da ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1364">This field contains the sequence number corresponding to the last byte received by this side of the connection.</span></span> <span data-ttu-id="c4a98-1365">Isto é usado para determinar se os dados anteriormente enviados foram recebidos com sucesso pela outra extremidade da ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1365">This is used to determine whether or not data previously sent has successfully been received by the other end of the connection.</span></span> |
| <span data-ttu-id="c4a98-1366">**Comprimento do cabeçalho de 4 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1366">**4-bit header length**</span></span> | <span data-ttu-id="c4a98-1367">Este campo contém o número de palavras de 32 bits no cabeçalho TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1367">This field contains the number of 32-bit words in the TCP header.</span></span> <span data-ttu-id="c4a98-1368">Se não houver opções no cabeçalho TCP, este campo é 5.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1368">If no options are present in the TCP header, this field is 5.</span></span> |
| <span data-ttu-id="c4a98-1369">**Bits de código de 6 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1369">**6-bit code bits**</span></span> |<span data-ttu-id="c4a98-1370">Este campo contém os seis bits de código diferentes utilizados para indicar várias informações de controlo associadas à ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1370">This field contains the six different code bits used to indicate various control information associated with the connection.</span></span> <span data-ttu-id="c4a98-1371">As bits de controlo são definidas da seguinte forma:<br \> - URG (21): Presen de dados urgentes<br \> - ACK (20): O número de reconhecimento é válido<br - PSH (19): Lidar com estes dados imediatamente<br - ACK (20): O número de reconhecimento é válido<br \> - PSH (19): Lidar com estes dados imediatamente<<<br \> - RST (18): Repor a ligação<br \> - SYN (17): Sincronizar os números de sequência (utilizados para estabelecer a ligação)<br \> - FIN (16): O remetente é terminado com transmissão (utilizada para fechar a ligação)</span><span class="sxs-lookup"><span data-stu-id="c4a98-1371">The control bits are defined as follows:<br \> - URG (21): Urgent data presen<br \> - ACK (20): Acknowledgement number is valid<br \> - PSH (19): Handle this data immediately<br \> - RST (18): Reset the connection<br \> - SYN (17): Synchronize sequence numbers (used to establish connection)<br \> - FIN (16): Sender is finished with transmit (used to close connection)</span></span> |
|<span data-ttu-id="c4a98-1372">**Janela de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1372">**16-bit window**</span></span> |<span data-ttu-id="c4a98-1373">Este campo é utilizado para o controlo de fluxos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1373">This field is used for flow control.</span></span> <span data-ttu-id="c4a98-1374">Contém a quantidade de bytes que a tomada pode receber atualmente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1374">It contains the amount of bytes the socket can currently receive.</span></span> <span data-ttu-id="c4a98-1375">Isto é basicamente usado para o controlo de fluxo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1375">This basically is used for flow control.</span></span> <span data-ttu-id="c4a98-1376">O remetente é responsável por se certificar de que os dados a enviar se encaixam na janela anunciada do recetor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1376">The sender is responsible for making sure the data to send will fit into the receiver's advertised window.</span></span> |
|<span data-ttu-id="c4a98-1377">**Cheque TCP de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1377">**16-bit TCP checksum**</span></span> |<span data-ttu-id="c4a98-1378">Este campo contém a 16-bit checkum para o pacote, incluindo o cabeçalho TCP, a área de dados do pacote e o cabeçalho pseudo IP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1378">This field contains the 16-bit checksum for the packet including the TCP header, the packet data area, and the pseudo IP header.</span></span> |
|<span data-ttu-id="c4a98-1379">**Ponteiro urgente de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1379">**16-bit urgent pointer**</span></span> |<span data-ttu-id="c4a98-1380">Este campo contém a compensação positiva do último byte dos dados urgentes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1380">This field contains the positive offset of the last byte of the urgent data.</span></span> <span data-ttu-id="c4a98-1381">Este campo só é válido se a broca de código urg estiver definida no cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1381">This field is only valid if the URG code bit is set in the header.</span></span> |

> [!NOTE]  
> <span data-ttu-id="c4a98-1382">*Espera-se que todos os cabeçalhos na implementação TCP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1382">*All headers in the TCP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address*.</span></span>

### <a name="tcp-enable"></a><span data-ttu-id="c4a98-1383">Ativar TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1383">TCP Enable</span></span>       
<span data-ttu-id="c4a98-1384">Antes de as ligações TCP e as transmissões de pacotes serem possíveis, a aplicação deve primeiro permitir a TCP, ligando para o ***serviço nx_tcp_enable.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1384">Before TCP connections and packet transmissions are possible, the application must first enable TCP by calling the ***nx_tcp_enable*** service.</span></span> <span data-ttu-id="c4a98-1385">Depois de ativado, a aplicação é gratuita para aceder a todos os serviços TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1385">After enabled, the application is free to access all TCP services.</span></span>  

### <a name="tcp-socket-create"></a><span data-ttu-id="c4a98-1386">Criação de tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1386">TCP Socket Create</span></span>    
<span data-ttu-id="c4a98-1387">As tomadas TCP são criadas durante a inicialização ou durante o tempo de funcionamento por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1387">TCP sockets are created either during initialization or during runtime by application threads.</span></span> <span data-ttu-id="c4a98-1388">O tipo inicial de serviço, tempo para viver e tamanho da janela são definidos pelo ***serviço nx_tcp_socket_create.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1388">The initial type of service, time to live, and window size are defined by the ***nx_tcp_socket_create*** service.</span></span> <span data-ttu-id="c4a98-1389">Não existem limites ao número de tomadas TCP numa aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1389">There are no limits on the number of TCP sockets in an application.</span></span>  

### <a name="tcp-checksum"></a><span data-ttu-id="c4a98-1390">TCP Checksum</span><span class="sxs-lookup"><span data-stu-id="c4a98-1390">TCP Checksum</span></span>     
<span data-ttu-id="c4a98-1391">A TCP especifica a parte de verificação de 16 bits de um complemento que cobre o cabeçalho IP pseudo (composto pelo endereço IP de origem, endereço IP de destino e a palavra IP protocol/comprimento), o cabeçalho TCP e os dados do pacote TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1391">TCP specifies a one's complement 16-bit checksum that covers the IP pseudo header, (consisting of the source IP address, destination IP address, and the protocol/length IP word), the TCP header, and the TCP packet data.</span></span> <span data-ttu-id="c4a98-1392">A única diferença entre as contas de cabeçalho de pacote IPv4 e IPv6 TCP é que os endereços IP de origem e destino são de 32 bits em IPv4 e 128 bits no IPv6.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1392">The only difference between IPv4 and IPv6 TCP packet header checksums is that the source and destination IP addresses are 32 bit in IPv4 and 128 bit in IPv6.</span></span> 

<span data-ttu-id="c4a98-1393">Certos controladores de rede são capazes de realizar cálculo e validação de verificação de TCP em hardware.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1393">Certain network controllers are able to perform TCP checksum computation and validation in hardware.</span></span> <span data-ttu-id="c4a98-1394">Para estes sistemas, as aplicações podem pretender utilizar a lógica de hardware checksum tanto quanto possível para reduzir a sobrecarga de tempo de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1394">For such systems, applications may want to use hardware checksum logic as much as possible to reduce runtime overhead.</span></span> <span data-ttu-id="c4a98-1395">As aplicações podem desativar a lógica de cálculo de verificação TCP da biblioteca NetX Duo completamente no tempo de construção, definindo ***NX_DISABLE_TCP_TX_CHECKSUM** _ e _*_NX_DISABLE_TCP_RX_CHECKSUM_\*\*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1395">Applications may disable TCP checksum computation logic from the NetX Duo library altogether at build time by defining ***NX_DISABLE_TCP_TX_CHECKSUM** _ and _*_NX_DISABLE_TCP_RX_CHECKSUM_\*\*.</span></span> <span data-ttu-id="c4a98-1396">Desta forma, o código de verificação TCP não é compilado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1396">This way, the TCP checksum code is not compiled in.</span></span> <span data-ttu-id="c4a98-1397">No entanto, deve ter cuidado se o pacote Opcional NetX Duo IPsec for instalado, e a ligação TCP pode ter de atravessar através de um canal seguro.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1397">However one should exercise caution if the optional NetX Duo IPsec package is installed, and the TCP connection may need to traverse through a secure channel.</span></span> <span data-ttu-id="c4a98-1398">Neste caso, os dados em pacotes pertencentes à ligação TCP já estão encriptados, e a maioria dos módulos de verificação TCP de hardware presentes no controlador de rede não conseguem gerar o valor correto da carga útil da TCP encriptada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1398">In this case, data in packets belonging to the TCP connection is already encrypted, and most hardware TCP checksum modules present in the network driver are unable to generate correct checksum value from the encrypted TCP payload.</span></span>

<span data-ttu-id="c4a98-1399">Para resolver este problema, a aplicação deve manter a lógica de checkum TCP disponível na biblioteca e utilizar a funcionalidade de capacidade de interface.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1399">To address this issue, application shall keep the TCP checksum logic available in the library and use the interface capability feature.</span></span> <span data-ttu-id="c4a98-1400">Com a funcionalidade de capacidade de interface ativada, o módulo TCP sabe como manusear corretamente a conta de verificação TCP se o controlador também for capaz de calcular o valor da caixa de verificação:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1400">With interface capability feature enabled, the TCP module knows how to properly handle the TCP checksum if the driver is also able to compute the checksum value:</span></span>

1) <span data-ttu-id="c4a98-1401">Se o pacote TCP não estiver sujeito ao processo IPsec, o hardware de interface de rede é capaz de calcular a sala de verificação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1401">If the TCP packet is not subject to IPsec process, the network interface hardware is able to compute the checksum.</span></span> <span data-ttu-id="c4a98-1402">Por conseguinte, o módulo TCP não tenta calcular a caixa de verificação;</span><span class="sxs-lookup"><span data-stu-id="c4a98-1402">Therefore the TCP module does not attempt to compute the checksum;</span></span>

2) <span data-ttu-id="c4a98-1403">Se o pacote IPsec for instalado e o pacote TCP estiver sujeito ao processo IPsec, o módulo TCP calcula a parte de verificação em software antes de enviar o pacote para a camada IPsec.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1403">If IPsec package is installed, and the TCP packet is subject to IPsec process, the TCP module computes checksum in software before sending the packet to IPsec layer.</span></span>

### <a name="tcp-port"></a><span data-ttu-id="c4a98-1404">Porta TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1404">TCP Port</span></span>     
<span data-ttu-id="c4a98-1405">Uma porta TCP é um ponto de ligação lógico no protocolo TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1405">A TCP port is a logical connection point in the TCP protocol.</span></span> <span data-ttu-id="c4a98-1406">Existem 65.535 portas válidas na componente TCP da NetX Duo, que variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1406">There are 65,535 valid ports in the TCP component of NetX Duo, ranging from 1 through 0xFFFF.</span></span> <span data-ttu-id="c4a98-1407">Ao contrário da UDP em que os dados de uma porta podem ser enviados para qualquer outra porta de destino, uma porta TCP está ligada a outra porta TCP específica, e só quando esta ligação é estabelecida pode ocorrer qualquer transferência de dados — e apenas entre as duas portas que compõem a ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1407">Unlike UDP in which data from one port can be sent to any other destination port, a TCP port is connected to another specific TCP port, and only when this connection is established can any data transfer take place—and only between the two ports making up the connection.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-1408">*As portas TCP são completamente separadas das portas UDP; por exemplo, a porta UDP número 1 não tem qualquer relação com o número da porta TCP 1*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1408">*TCP ports are completely separate from UDP ports; e.g., UDP port number 1 has no relation to TCP port number 1*.</span></span>

### <a name="client-server-model"></a><span data-ttu-id="c4a98-1409">Modelo Client-Server</span><span class="sxs-lookup"><span data-stu-id="c4a98-1409">Client-Server Model</span></span>     
<span data-ttu-id="c4a98-1410">Para utilizar o TCP para transferência de dados, deve primeiro ser estabelecida uma ligação entre as duas tomadas TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1410">To use TCP for data transfer, a connection must first be established between the two TCP sockets.</span></span> <span data-ttu-id="c4a98-1411">O estabelecimento da ligação é feito de forma cliente-servidor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1411">The establishment of the connection is done in a client-server fashion.</span></span> <span data-ttu-id="c4a98-1412">O lado cliente da ligação é o lado que inicia a ligação, enquanto o lado do servidor simplesmente aguarda os pedidos de ligação do cliente antes de qualquer processamento ser feito.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1412">The client side of the connection is the side that initiates the connection, while the server side simply waits for client connection requests before any processing is done.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c4a98-1413">*Para dispositivos multihomes, o NetX Duo determina automaticamente o endereço de origem a utilizar para a ligação e o próximo endereço de lúpulo baseado no endereço IP de destino da ligação. Uma vez que a TCP se limita a enviar pacotes para endereços de destino unicast (por exemplo, não transmitidos), a NetX Duo não requer uma "dica" para escolher o endereço IPv6 de origem*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1413">*For multihome devices, NetX Duo automatically determines the source address to use for the connection, and the next hop address based on the destination IP address of the connection. Because TCP is limited to sending packets to unicast (e.g.nonbroadcast) destination addresses, NetX Duo does not require a "hint" for choosing the source IPv6 address*.</span></span>

### <a name="tcp-socket-state-machine"></a><span data-ttu-id="c4a98-1414">Máquina de estado de tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1414">TCP Socket State Machine</span></span>      
<span data-ttu-id="c4a98-1415">A ligação entre duas tomadas TCP (um cliente e um servidor) é complexa e é gerida de forma estatal.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1415">The connection between two TCP sockets (one client and one server) is complex and is managed in a state machine manner.</span></span> <span data-ttu-id="c4a98-1416">Cada tomada TCP começa em estado fechado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1416">Each TCP socket starts in a CLOSED state.</span></span> <span data-ttu-id="c4a98-1417">Através de eventos de ligação, a máquina estatal de cada tomada migra para o estado ESTABELECIDO, que é onde ocorre a maior parte da transferência de dados em TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1417">Through connection events each socket's state machine migrates into the ESTABLISHED state, which is where the bulk of the data transfer in TCP takes place.</span></span> <span data-ttu-id="c4a98-1418">Quando um dos lados da ligação já não deseja enviar dados, desliga-se.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1418">When one side of the connection no longer wishes to send data, it disconnects.</span></span> <span data-ttu-id="c4a98-1419">Depois de o outro lado desligar, eventualmente a tomada TCP volta ao estado fechado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1419">After the other side disconnects, eventually the TCP socket returns to the CLOSED state.</span></span> <span data-ttu-id="c4a98-1420">Este processo repete-se sempre que um cliente e servidor TCP estabelecem e fecham uma ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1420">This process repeats each time a TCP client and server establish and close a connection.</span></span> <span data-ttu-id="c4a98-1421">A figura 14 mostra os vários estados da máquina estatal TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1421">Figure 14 shows the various states of the TCP state machine.</span></span>

### <a name="tcp-client-connection"></a><span data-ttu-id="c4a98-1422">Conexão ao cliente TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1422">TCP Client Connection</span></span>       
<span data-ttu-id="c4a98-1423">Como mencionado anteriormente, o lado cliente da ligação TCP inicia um pedido de ligação a um servidor TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1423">As mentioned previously, the client side of the TCP connection initiates a connection request to a TCP server.</span></span> <span data-ttu-id="c4a98-1424">Antes de um pedido de ligação ser feito, o TCP deve ser ativado na instância IP do cliente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1424">Before a connection request can be made, TCP must be enabled on the client IP instance.</span></span> <span data-ttu-id="c4a98-1425">Além disso, a tomada TCP do cliente deve ser criada em seguida com o serviço ***nx_tcp_socket_create** _ e ligada a uma porta através do serviço _ *_nx_tcp_client_socket_bind_** .</span><span class="sxs-lookup"><span data-stu-id="c4a98-1425">In addition, the client TCP socket must next be created with the ***nx_tcp_socket_create** _ service and bound to a port via the _ *_nx_tcp_client_socket_bind_** service.</span></span>

<span data-ttu-id="c4a98-1426">Depois de a tomada do cliente estar ligada, o serviço ***nxd_tcp_client_socket_connect*** é utilizado para estabelecer uma ligação com um servidor TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1426">After the client socket is bound, the ***nxd_tcp_client_socket_connect*** service is used to establish a connection with a TCP server.</span></span> <span data-ttu-id="c4a98-1427">Note que a tomada deve estar num estado fechado para iniciar uma tentativa de ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1427">Note the socket must be in a CLOSED state to initiate a connection attempt.</span></span> <span data-ttu-id="c4a98-1428">O estabelecimento da ligação começa com o NetX Duo a emitir um pacote SYN e, em seguida, a aguardar um pacote SYN ACK de volta do servidor, o que significa a aceitação do pedido de ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1428">Establishing the connection starts with NetX Duo issuing a SYN packet and then waiting for a SYN ACK packet back from the server, which signifies acceptance of the connection request.</span></span> <span data-ttu-id="c4a98-1429">Após a receção do SYN ACK, a NetX Duo responde com um pacote ACK e promove a tomada do cliente para o estado estabelecido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1429">After the SYN ACK is received, NetX Duo responds with an ACK packet and promotes the client socket to the ESTABLISHED state.</span></span>

![Diagrama dos estados da máquina estatal TCP.](./media/user-guide/image24.png)   

<span data-ttu-id="c4a98-1431">**FIGURA 14. Estados da Máquina Estatal TCP**</span><span class="sxs-lookup"><span data-stu-id="c4a98-1431">**FIGURE 14. States of the TCP State Machine**</span></span>


> [!WARNING]
> <span data-ttu-id="c4a98-1432">*As aplicações devem utilizar **nxd_tcp_client_socket_connect** para as ligações IPv4 e IPv6 TCP. As aplicações ainda podem usar **nx_tcp_client_socket_connect** para ligações IPv4 TCP, mas os desenvolvedores são encorajados a usar **nxd_tcp_client_socket_connect** uma vez **nx_tcp_client_socket_connect** acabará por ser depreciada.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-1432">*Applications should use **nxd_tcp_client_socket_connect** for either IPv4 and IPv6 TCP connections. Applications can still use **nx_tcp_client_socket_connect** for IPv4 TCP connections, but developers are encouraged to use **nxd_tcp_client_socket_connect** since **nx_tcp_client_socket_connect** will eventually be deprecated*.</span></span>

<span data-ttu-id="c4a98-1433">*Da mesma forma, **nxd_tcp_socket_peer_info_get** funciona com ligações IPv4 ou IPv6 TCP. No entanto, **nx_tcp_socket_peer_info_get** ainda está disponível para aplicações antigas. Os desenvolvedores são encorajados a usar **nxd_tcp_socket_peer_info_get** a seguir em frente.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-1433">*Similarly, **nxd_tcp_socket_peer_info_get** works with either IPv4 or IPv6 TCP connections. However, **nx_tcp_socket_peer_info_get** is still available for legacy applications. Developers are encouraged to use **nxd_tcp_socket_peer_info_get** going forward*.</span></span>

### <a name="tcp-client-disconnection"></a><span data-ttu-id="c4a98-1434">Desconexão do cliente TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1434">TCP Client Disconnection</span></span>    
<span data-ttu-id="c4a98-1435">O fecho da ligação é realizado chamando ***nx_tcp_socket_disconnect***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1435">Closing the connection is accomplished by calling ***nx_tcp_socket_disconnect***.</span></span> <span data-ttu-id="c4a98-1436">Se não for especificada qualquer suspensão, a tomada do cliente envia um pacote RST para a tomada do servidor e coloca a tomada no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1436">If no suspension is specified, the client socket sends a RST packet to the server socket and places the socket in the CLOSED state.</span></span> <span data-ttu-id="c4a98-1437">Caso contrário, se for solicitada uma suspensão, é executada a completa do protocolo de desconexão TCP, da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1437">Otherwise, if a suspension is requested, the full TCP disconnect protocol is performed, as follows:</span></span> 

- <span data-ttu-id="c4a98-1438">Se o servidor já tinha iniciado um pedido de desconexão (a tomada do cliente já recebeu um pacote FIN, respondeu com um ACK, e está no estado CLOSE WAIT), a NetX Duo promove o estado de tomada TCP do cliente para o estado de ÚLTIMA ACK e envia um pacote FIN.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1438">If the server previously initiated a disconnect request (the client socket has already received a FIN packet, responded with an ACK, and is in the CLOSE WAIT state), NetX Duo promotes the client TCP socket state to the LAST ACK state and sends a FIN packet.</span></span> <span data-ttu-id="c4a98-1439">Em seguida, aguarda um ACK do servidor antes de completar a desconexão e entrar no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1439">It then waits for an ACK from the server before completing the disconnect and entering the CLOSED state.</span></span>

- <span data-ttu-id="c4a98-1440">Se, por outro lado, o cliente for o primeiro a iniciar um pedido de desconexão (o servidor não foi desligado e a tomada ainda se encontra no estado ESTABELECIDO), o NetX Duo envia um pacote FIN para iniciar a desconexão e espera receber uma FIN e um ACK do servidor antes de completar a desconexão e colocar a tomada num estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1440">If on the other hand, the client is the first to initiate a disconnect request (the server has not disconnected and the socket is still in the ESTABLISHED state), NetX Duo sends a FIN packet to initiate the disconnect and waits to receive a FIN and an ACK from the server before completing the disconnect and placing the socket in a CLOSED state.</span></span>

<span data-ttu-id="c4a98-1441">Se ainda existirem pacotes na fila de transmissão da tomada, o NetX Duo suspende o tempo limite especificado para permitir o reconhecimento dos pacotes.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1441">If there are still packets on the socket transmit queue, NetX Duo suspends for the specified timeout to allow the packets to be acknowledged.</span></span> <span data-ttu-id="c4a98-1442">Se o tempo limite expirar, o NetX Duo esvazia a fila de transmissão da tomada do cliente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1442">If the timeout expires, NetX Duo empties the transmit queue of the client socket.</span></span> 

<span data-ttu-id="c4a98-1443">Para desvindia a porta da tomada do cliente, a aplicação chama ***nx_tcp_client_socket_unbind***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1443">To unbind the port from the client socket, the application calls ***nx_tcp_client_socket_unbind***.</span></span> <span data-ttu-id="c4a98-1444">A tomada deve estar num estado fechado ou em processo de desconexão (isto é, estado de espera TIMED) antes de a porta ser libertada; caso contrário, um erro é devolvido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1444">The socket must be in a CLOSED state or in the process of disconnecting (i.e., TIMED WAIT state) before the port is released; otherwise, an error is returned.</span></span>

<span data-ttu-id="c4a98-1445">Finalmente, se a aplicação já não necessitar da tomada do cliente, chama ***nx_tcp_socket_delete*** para apagar a tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1445">Finally, if the application no longer needs the client socket, it calls ***nx_tcp_socket_delete*** to delete the socket.</span></span>

### <a name="tcp-server-connection"></a><span data-ttu-id="c4a98-1446">Conexão do servidor TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1446">TCP Server Connection</span></span>      
<span data-ttu-id="c4a98-1447">O lado do servidor de uma ligação TCP é passivo; ou seja, o servidor aguarda que um cliente inicie o pedido de ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1447">The server side of a TCP connection is passive; i.e., the server waits for a client to initiate connection request.</span></span> <span data-ttu-id="c4a98-1448">Para aceitar uma ligação ao cliente, a TCP deve primeiro ser ativada na instância IP, ligando para o serviço \***nx_tcp_enable** _.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1448">To accept a client connection, TCP must first be enabled on the IP instance by calling the service \***nx_tcp_enable** _.</span></span> <span data-ttu-id="c4a98-1449">Em seguida, a aplicação deve criar uma tomada TCP utilizando o serviço _ *_nx_tcp_socket_create_*\* .</span><span class="sxs-lookup"><span data-stu-id="c4a98-1449">Next, the application must create a TCP socket using the _ *_nx_tcp_socket_create_*\* service.</span></span>  

<span data-ttu-id="c4a98-1450">A tomada do servidor também deve ser configurada para ouvir pedidos de ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1450">The server socket must also be set up for listening for connection requests.</span></span> <span data-ttu-id="c4a98-1451">Isto é conseguido utilizando o serviço ***nx_tcp_server_socket_listen.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1451">This is achieved by using the ***nx_tcp_server_socket_listen*** service.</span></span> <span data-ttu-id="c4a98-1452">Este serviço coloca a tomada do servidor no estado LISTEN e liga a porta do servidor especificada à tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1452">This service places the server socket in the LISTEN state and binds the specified server port to the socket.</span></span>

> [!NOTE] 
> <span data-ttu-id="c4a98-1453">*Para definir uma rotina de chamada de chamada de tomada, a aplicação especifica a função de retorno adequada para o argumento tcp_listen_callback do serviço **nx_tcp_server_socket_listen.** Esta função de chamada de aplicação é então executada pela NetX Duo sempre que uma nova ligação é solicitada nesta porta do servidor. O processamento na chamada está sob controlo de aplicação.*</span><span class="sxs-lookup"><span data-stu-id="c4a98-1453">*To set a socket listen callback routine the application specifies the appropriate callback function for the tcp_listen_callback argument of the **nx_tcp_server_socket_listen** service. This application callback function is then executed by NetX Duo whenever a new connection is requested on this server port. The processing in the callback is under application control.*</span></span>

<span data-ttu-id="c4a98-1454">Para aceitar pedidos de ligação ao cliente, a aplicação liga para o serviço \***nx_tcp_server_socket_accept** _ .</span><span class="sxs-lookup"><span data-stu-id="c4a98-1454">To accept client connection requests, the application calls the \***nx_tcp_server_socket_accept** _ service.</span></span> <span data-ttu-id="c4a98-1455">A tomada do servidor deve estar num estado DE ESCUTA ou num estado SYN RECEIVED (ou seja, o servidor está no estado LISTEN e recebeu um pacote SYN de um cliente que solicita uma ligação) para ligar para o serviço de aceitação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1455">The server socket must either be in a LISTEN state or a SYN RECEIVED state (i.e., the server is in the LISTEN state and has received a SYN packet from a client requesting a connection) to call the accept service.</span></span> <span data-ttu-id="c4a98-1456">Um estado de retorno bem sucedido de _ *_nx_tcp_server_socket_accept_*\* indica que a ligação foi configurada e a tomada do servidor está no estado ESTABELECIDO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1456">A successful return status from _ *_nx_tcp_server_socket_accept_*\* indicates the connection has been set up and the server socket is in the ESTABLISHED state.</span></span>

<span data-ttu-id="c4a98-1457">Depois de a tomada do servidor ter uma ligação válida, os pedidos adicionais de ligação ao cliente são colocados na fila até à profundidade especificada pelo *listen_queue_size, transmitidos para o* serviço  \* **nx_tcp_server_socket_listen** _ .</span><span class="sxs-lookup"><span data-stu-id="c4a98-1457">After the server socket has a valid connection, additional client connection requests are queued up to the depth specified by the *listen_queue_size, passed into the* \***nx_tcp_server_socket_listen** _ service.</span></span> <span data-ttu-id="c4a98-1458">Para processar as ligações subsequentes numa porta do servidor, a aplicação deve ligar para _ *_nx_tcp_server_socket_relisten_*\* com uma tomada disponível (ou seja, uma tomada em estado fechado).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1458">In order to process subsequent connections on a server port, the application must call _ *_nx_tcp_server_socket_relisten_*\* with an available socket (i.e., a socket in a CLOSED state).</span></span> <span data-ttu-id="c4a98-1459">Note que a mesma tomada do servidor pode ser utilizada se a ligação anterior associada à tomada estiver concluída e a tomada estiver no estado fechado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1459">Note that the same server socket could be used if the previous connection associated with the socket is now finished and the socket is in the CLOSED state.</span></span>

### <a name="tcp-server-disconnection"></a><span data-ttu-id="c4a98-1460">Desconexão do servidor TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1460">TCP Server Disconnection</span></span>     
<span data-ttu-id="c4a98-1461">O fecho da ligação é realizado chamando ***nx_tcp_socket_disconnect***.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1461">Closing the connection is accomplished by calling ***nx_tcp_socket_disconnect***.</span></span> <span data-ttu-id="c4a98-1462">Se não for especificada qualquer suspensão, a tomada do servidor envia um pacote RST para a tomada do cliente e coloca a tomada no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1462">If no suspension is specified, the server socket sends a RST packet to the client socket and places the socket in the CLOSED state.</span></span> <span data-ttu-id="c4a98-1463">Caso contrário, se for solicitada uma suspensão, é executada a completa do protocolo de desconexão TCP, da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1463">Otherwise, if a suspension is requested, the full TCP disconnect protocol is performed, as follows:</span></span>

- <span data-ttu-id="c4a98-1464">Se o cliente já tinha iniciado um pedido de desconexão (a tomada do servidor já recebeu um pacote FIN, respondeu com um ACK, e está no estado CLOSE WAIT), a NetX Duo promove o estado de tomada TCP para o estado de ÚLTIMA ACK e envia um pacote FIN.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1464">If the client previously initiated a disconnect request (the server socket has already received a FIN packet, responded with an ACK, and is in the CLOSE WAIT state), NetX Duo promotes the TCP socket state to the LAST ACK state and sends a FIN packet.</span></span> <span data-ttu-id="c4a98-1465">Em seguida, aguarda um ACK do cliente antes de completar a desconexão e entrar no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1465">It then waits for an ACK from the client before  completing the disconnect and entering the CLOSED state.</span></span>

- <span data-ttu-id="c4a98-1466">Se, por outro lado, o servidor for o primeiro a iniciar um pedido de desconexão (o cliente não se desligou e a tomada ainda se encontra no estado ESTABELECIDO), a NetX Duo envia um pacote FIN para iniciar a desconexão e espera receber uma FIN e um ACK do cliente antes de completar a desconexão e colocar a tomada num estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1466">If on the other hand, the server is the first to initiate a disconnect request (the client has not disconnected and the socket is still in the ESTABLISHED state), NetX Duo sends a FIN packet to initiate the disconnect and waits to receive a FIN and an ACK from the client before completing the disconnect and placing the socket in a CLOSED state.</span></span>

<span data-ttu-id="c4a98-1467">Se ainda existirem pacotes na fila de transmissão da tomada, o NetX Duo suspende o tempo limite especificado para permitir que esses pacotes sejam reconhecidos.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1467">If there are still packets on the socket transmit queue, NetX Duo suspends for the specified timeout to allow those packets to be acknowledged.</span></span> <span data-ttu-id="c4a98-1468">Se o tempo limite expirar, o NetX Duo descarrega a fila de transmissão da tomada do servidor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1468">If the timeout expires, NetX Duo flushes the transmit queue of the server socket.</span></span>

<span data-ttu-id="c4a98-1469">Após o processamento da desconexão estar concluído e a tomada do servidor estiver no estado FECHADO, a aplicação deve chamar o serviço \***nx_tcp_server_socket_unaccept** _ para terminar a associação desta tomada com a porta do servidor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1469">After the disconnect processing is complete and the server socket is in the CLOSED state, the application must call the \***nx_tcp_server_socket_unaccept** _ service to end the association of this socket with the server port.</span></span> <span data-ttu-id="c4a98-1470">Note que este serviço deve ser chamado pela aplicação mesmo _*_que nx_tcp_socket_disconnect_*_ ou _*_nx_tcp_server_socket_accept_*_ devolva um estado de erro.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1470">Note this service must be called by the application even if _*_nx_tcp_socket_disconnect_*_ or _*_nx_tcp_server_socket_accept_*_ return an error status.</span></span> <span data-ttu-id="c4a98-1471">Após a _*_nx_tcp_server_socket_unaccept_*_ retornar, a tomada pode ser usada como cliente ou tomada de servidor, ou mesmo eliminada se já não for necessária.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1471">After the _*_nx_tcp_server_socket_unaccept_*_ returns, the socket can be used as a client or server socket, or even deleted if it is no longer needed.</span></span> <span data-ttu-id="c4a98-1472">Se aceitar outra ligação ao cliente na mesma porta do servidor, o serviço _ *_nx_tcp_server_socket_relisten_*\* deve ser chamado nesta tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1472">If accepting another client connection on the same server port is desired, the _ *_nx_tcp_server_socket_relisten_*\* service should be called on this socket.</span></span>

<span data-ttu-id="c4a98-1473">O seguinte segmento de código ilustra a sequência de chamadas que um servidor típico de TCP utiliza:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1473">The following code segment illustrates the sequence of calls a typical TCP server uses:</span></span>

```c
/* Set up a previously created TCP socket to
   listen on port 12 */
nx_tcp_server_socket_listen()

/* Loop to make a (another) connection. */
while(1)
{
    /* Wait for a client socket connection request
       for 100 ticks. */
    nx_tcp_server_socket_accept();

    /* (Send and receive TCP messages with the TCP
       client) */

    /* Disconnect the server socket. */
    nx_tcp_socket_disconnect();

    /* Remove this server socket from listening on
       the port. */
    nx_tcp_server_socket_unaccept(&server_socket);
    /* Set up server socket to relisten on the
       same port for the next client. */
    nx_tcp_server_socket_relisten();
}
```

### <a name="mss-validation"></a><span data-ttu-id="c4a98-1474">Validação mss</span><span class="sxs-lookup"><span data-stu-id="c4a98-1474">MSS Validation</span></span>      
<span data-ttu-id="c4a98-1475">O Tamanho Máximo do Segmento (MSS) é a quantidade máxima de bytes que um hospedeiro TCP pode receber sem ser fragmentado pela camada IP subjacente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1475">The Maximum Segment Size (MSS) is the maximum amount of bytes a TCP host can receive without being fragmented by the underlying IP layer.</span></span> <span data-ttu-id="c4a98-1476">Durante a fase de estabelecimento de ligação TCP, ambas as extremidades trocam o seu próprio valor de MSS TCP, de modo que o remetente não envie um segmento de dados TCP maior do que o MSS do recetor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1476">During TCP connection establishment phase, both ends exchanges its own TCP MSS value, so that the sender does not send a TCP data segment that is larger than the receiver's MSS.</span></span> <span data-ttu-id="c4a98-1477">O módulo NetX Duo TCP validará opcionalmente o valor mss anunciado do seu pares antes de estabelecer uma ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1477">NetX Duo TCP module will optionally validate its peer's advertised MSS value before establishing a connection.</span></span> <span data-ttu-id="c4a98-1478">Por predefinição, o NetX Duo não permite tal verificação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1478">By default NetX Duo does not enable such a check.</span></span> <span data-ttu-id="c4a98-1479">As candidaturas que desejem realizar a validação do MSS devem definir ***NX_ENABLE_TCP_MSS_CHECK** _ na construção da biblioteca NetX Duo, e o valor mínimo será definido em _*_NX_TCP_MSS_MINIMUM_\*_.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1479">Applications wishing to perform MSS validation shall define ***NX_ENABLE_TCP_MSS_CHECK** _ when building the NetX Duo library, and the minimum value shall be defined in _*_NX_TCP_MSS_MINIMUM_\*_.</span></span> <span data-ttu-id="c4a98-1480">As ligações TCP recebidas com valores DESS abaixo _ *_NX_TCP_MSS_MINIMUM_*\* são largadas.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1480">Incoming TCP connections with MSS values below _ *_NX_TCP_MSS_MINIMUM_*\* are dropped.</span></span>

### <a name="stop-listening-on-a-server-port"></a><span data-ttu-id="c4a98-1481">Pare de ouvir numa porta do servidor</span><span class="sxs-lookup"><span data-stu-id="c4a98-1481">Stop Listening on a Server Port</span></span>    
<span data-ttu-id="c4a98-1482">Se a aplicação já não pretender ouvir os pedidos de ligação ao cliente numa porta de servidor que foi previamente especificada por uma chamada para o serviço ***nx_tcp_server_socket_listen** _ , a aplicação simplesmente liga para o serviço _ *_nx_tcp_server_socket_unlisten_** .</span><span class="sxs-lookup"><span data-stu-id="c4a98-1482">If the application no longer wishes to listen for client connection requests on a server port that was previously specified by a call to the ***nx_tcp_server_socket_listen** _ service, the application simply calls the _ *_nx_tcp_server_socket_unlisten_** service.</span></span> <span data-ttu-id="c4a98-1483">Este serviço coloca qualquer tomada à espera de uma ligação no estado FECHADO e liberta quaisquer pacotes de pedido de ligação ao cliente em fila.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1483">This service places any socket waiting for a connection back in the CLOSED state and releases any queued client connection request packets.</span></span> 

### <a name="tcp-window-size"></a><span data-ttu-id="c4a98-1484">Tamanho da janela TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1484">TCP Window Size</span></span>   
<span data-ttu-id="c4a98-1485">Durante as fases de configuração e transferência de dados da ligação, cada porta reporta a quantidade de dados que pode manusear, que é chamado de tamanho da janela.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1485">During both the setup and data transfer phases of the connection, each port reports the amount of data it can handle, which is called its window size.</span></span> <span data-ttu-id="c4a98-1486">À medida que os dados são recebidos e processados, este tamanho da janela é ajustado dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1486">As data are received and processed, this window size is adjusted dynamically.</span></span> <span data-ttu-id="c4a98-1487">Em TCP, um remetente só pode enviar uma quantidade de dados que se encaixem na janela do recetor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1487">In TCP, a sender can only send an amount of data that fits into the receiver's window.</span></span> <span data-ttu-id="c4a98-1488">Na essência, o tamanho da janela fornece controlo de fluxo para transferência de dados em cada direção da ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1488">In essence, the window size provides flow control for data transfer in each direction of the connection.</span></span>   

### <a name="tcp-packet-send"></a><span data-ttu-id="c4a98-1489">Envio de pacote TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1489">TCP Packet Send</span></span>     
<span data-ttu-id="c4a98-1490">O envio de dados TCP é facilmente realizado através da chamada ***de nx_tcp_socket_send*** função.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1490">Sending TCP data is easily accomplished by calling the ***nx_tcp_socket_send*** function.</span></span> <span data-ttu-id="c4a98-1491">Se o tamanho dos dados transmitidos for maior do que o valor MSS da tomada ou o atual par receber o tamanho da janela, o que for menor, a lógica interna da TCP esculpe os dados que se encaixam em min (MSS, peer receive Window) para transmissão.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1491">If the size of the data being transmitted is larger than the MSS value of the socket or the current peer receive window size, whichever is smaller, TCP internal logic carves off the data that fits into min (MSS, peer receive Window) for transmission.</span></span> <span data-ttu-id="c4a98-1492">Este serviço constrói então um cabeçalho TCP em frente ao pacote (incluindo o cálculo da caixa de verificação).</span><span class="sxs-lookup"><span data-stu-id="c4a98-1492">This service then builds a TCP header in front of the packet (including the checksum calculation).</span></span> <span data-ttu-id="c4a98-1493">Se o tamanho da janela do recetor não for zero, o chamador enviará o máximo de dados possível para preencher o tamanho da janela do recetor.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1493">If the receiver's window size is not zero, the caller will send as much data as it can to fill up the receiver window size.</span></span> <span data-ttu-id="c4a98-1494">Se a janela de receção se tornar zero, o chamador pode suspender e esperar que o tamanho da janela do recetor aumente o suficiente para que este pacote seja enviado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1494">If the receive window becomes zero, the caller may suspend and wait for the receiver's window size to increase enough for this packet to be sent.</span></span> <span data-ttu-id="c4a98-1495">A qualquer momento, vários fios podem suspender-se enquanto tentam enviar dados através da mesma tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1495">At any given time, multiple threads may suspend while trying to send data through the same socket.</span></span> 

> [!WARNING]  
> <span data-ttu-id="c4a98-1496">*Os dados da TCP que residem na estrutura NX_PACKET devem residir num limite de palavras longas. Além disso, deve haver espaço suficiente entre o ponteiro pré-conjunto e o ponteiro de início de dados para colocar os cabeçalhos TCP, IP e meios de comunicação físicos*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1496">*The TCP data residing in the NX_PACKET structure should reside on a long-word boundary. In addition, there needs to be sufficient space between the prepend pointer and the data start pointer to place the TCP, IP, and physical media headers*.</span></span>

### <a name="tcp-packet-retransmit"></a><span data-ttu-id="c4a98-1497">Retransmissão de pacotes TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1497">TCP Packet Retransmit</span></span>      
<span data-ttu-id="c4a98-1498">Pacotes TCP previamente transmitidos enviados realmente armazenados internamente até que um ACK seja devolvido do outro lado da ligação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1498">Previously transmitted TCP packets sent actually stored internally until an ACK is returned from the other side of the connection.</span></span> <span data-ttu-id="c4a98-1499">Se os dados transmitidos não forem reconhecidos dentro do período de tempo limite, o pacote armazenado é reencaminhado e o período de tempo seguinte é definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1499">If transmitted data is not acknowledged within the timeout period, the stored packet is re-sent and the next timeout period is set.</span></span> <span data-ttu-id="c4a98-1500">Quando um ACK é recebido, todos os pacotes cobertos pelo número de reconhecimento na fila de transmissão interna são finalmente libertados.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1500">When an ACK is received, all packets covered by the acknowledgement number in the internal transmit queue are finally released.</span></span>  

> [!WARNING]   
> <span data-ttu-id="c4a98-1501">*A aplicação não reutilizar o pacote nem alterar o conteúdo do pacote após nx_tcp_socket_send NX_SUCCESS. O pacote transmitido é eventualmente lançado pelo tratamento interno da NetX Duo após os dados são reconhecidos pelo outro extremo*.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1501">*Application shall not reuse the packet or alter the contents of the packet after nx_tcp_socket_send() returns with NX_SUCCESS. The transmitted packet is eventually released by NetX Duo internal processing after the data is acknowledged by the other end*.</span></span>

### <a name="tcp-keepalive"></a><span data-ttu-id="c4a98-1502">TCP Keepalive</span><span class="sxs-lookup"><span data-stu-id="c4a98-1502">TCP Keepalive</span></span>     
<span data-ttu-id="c4a98-1503">A função TCP Keepalive permite que uma tomada detete se o seu par desliga ou não sem uma terminação adequada (por exemplo, o par se despenhou), ou para impedir que certas instalações de monitorização da rede cessem uma ligação por longos períodos de inatividade.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1503">TCP Keepalive feature allows a socket to detect whether or not its peer disconnects without proper termination (for example, the peer crashed), or to prevent certain network monitoring facilities to terminate a connection for long periods of idle.</span></span> <span data-ttu-id="c4a98-1504">A TCP Keepalive funciona enviando periodicamente uma moldura TCP sem dados, e o número de sequência definido para um a menos do que o número atual da sequência.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1504">TCP Keepalive works by periodically sending a TCP frame with no data, and the sequence number set to one less than the current sequence number.</span></span> <span data-ttu-id="c4a98-1505">Ao receber tal moldura de resalamento TCP, o destinatário, se ainda estiver vivo, responde com um ACK para o seu número de sequência atual.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1505">On receiving such TCP Keepalive frame, the recipient, if still alive, responses with an ACK for its current sequence number.</span></span> <span data-ttu-id="c4a98-1506">Isto completa a transação de manter.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1506">This completes the keepalive transaction.</span></span>  

<span data-ttu-id="c4a98-1507">Por predefinição, a função keepalive não está ativada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1507">By default the keepalive feature is not enabled.</span></span> <span data-ttu-id="c4a98-1508">Para utilizar esta funcionalidade, a biblioteca NetX Duo deve ser construída com \***NX_ENABLE_TCP_KEEPALIVE** _ definido.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1508">To use this feature, NetX Duo library must be built with \***NX_ENABLE_TCP_KEEPALIVE** _ defined.</span></span> <span data-ttu-id="c4a98-1509">O símbolo _ *_NX_TCP_KEEPALIVE_INITIAL_*\* especifica o número de segundos de inatividade antes do início da estrutura de manter.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1509">The symbol _ *_NX_TCP_KEEPALIVE_INITIAL_*\* specifies the number of seconds of inactivity before the keepalive frame is initiated.</span></span>  

### <a name="tcp-packet-receive"></a><span data-ttu-id="c4a98-1510">Receber pacote TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1510">TCP Packet Receive</span></span>   
<span data-ttu-id="c4a98-1511">O processamento de pacotes de receção de TCP (chamado a partir do fio do ajudante IP) é responsável pelo manuseamento de várias ações de ligação e desconexão, bem como pelo processamento de reconhecimento de transmissão.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1511">The TCP receive packet processing (called from the IP helper thread) is responsible for handling various connection and disconnection actions as well as transmit acknowledge processing.</span></span> <span data-ttu-id="c4a98-1512">Além disso, o processamento de pacotes de receção de TCP é responsável pela colocação de pacotes com dados de receção da fila de receção da tomada TCP adequada ou entregando o pacote ao primeiro fio suspenso à espera de um pacote.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1512">In addition, the TCP receive packet processing is responsible for placing packets with receive data on the appropriate TCP socket's receive queue or delivering the packet to the first suspended thread waiting for a packet.</span></span>

### <a name="tcp-receive-notify"></a><span data-ttu-id="c4a98-1513">Notificação de receção de TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1513">TCP Receive Notify</span></span>     
<span data-ttu-id="c4a98-1514">Se o fio de aplicação precisar de processar dados recebidos de mais de uma tomada, deve ser utilizada a função ***nx_tcp_socket_receive_notify.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1514">If the application thread needs to process received data from more than one socket, the ***nx_tcp_socket_receive_notify*** function should be used.</span></span> <span data-ttu-id="c4a98-1515">Esta função regista uma função de chamada de pacote de receção para a tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1515">This function registers a receive packet callback function for the socket.</span></span> <span data-ttu-id="c4a98-1516">Sempre que um pacote é recebido na tomada, a função de retorno é executada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1516">Whenever a packet is received on the socket, the callback function is executed.</span></span>  

<span data-ttu-id="c4a98-1517">O conteúdo da função de retorno são específicos das aplicações; no entanto, a função provavelmente conteria lógica para informar o fio de processamento de que um pacote está disponível na tomada correspondente.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1517">The contents of the callback function are applicationspecific; however, the function would most likely contain logic to inform the processing thread that a packet is available on the corresponding socket.</span></span> 

### <a name="thread-suspension"></a><span data-ttu-id="c4a98-1518">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="c4a98-1518">Thread Suspension</span></span>      
<span data-ttu-id="c4a98-1519">Como mencionado anteriormente, os fios de aplicação podem suspender enquanto tentam receber dados de uma determinada porta TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1519">As mentioned previously, application threads can suspend while attempting to receive data from a particular TCP port.</span></span> <span data-ttu-id="c4a98-1520">Depois de recebido um pacote naquela porta, é dado ao primeiro fio suspenso e esse fio é retomado.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1520">After a packet is received on that port, it is given to the first thread suspended and that thread is then resumed.</span></span> <span data-ttu-id="c4a98-1521">Um tempo limite opcional está disponível ao suspender um pacote de receção TCP, uma funcionalidade disponível para a maioria dos serviços NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1521">An optional timeout is available when suspending on a TCP receive packet, a feature available for most NetX Duo services.</span></span>  

<span data-ttu-id="c4a98-1522">A suspensão thread também está disponível para serviços de ligação (cliente e servidor), ligação ao cliente e serviços de desconexão.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1522">Thread suspension is also available for connection (both client and server), client binding, and disconnection services.</span></span>  

### <a name="tcp-socket-statistics-and-errors"></a><span data-ttu-id="c4a98-1523">Estatísticas e erros da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1523">TCP Socket Statistics and Errors</span></span>     
<span data-ttu-id="c4a98-1524">Se ativado, o software de tomada TCP NetX Duo regista várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1524">If enabled, the NetX Duo TCP socket software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="c4a98-1525">São mantidas as seguintes estatísticas e relatórios de erro para cada instância IP/TCP:</span><span class="sxs-lookup"><span data-stu-id="c4a98-1525">The following statistics and error reports are maintained for each IP/TCP instance:</span></span>   

- <span data-ttu-id="c4a98-1526">Total de pacotes TCP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1526">Total TCP Packets Sent</span></span>  
- <span data-ttu-id="c4a98-1527">Total de bytes TCP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1527">Total TCP Bytes Sent</span></span>  
- <span data-ttu-id="c4a98-1528">Total de pacotes TCP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1528">Total TCP Packets Received</span></span>   
- <span data-ttu-id="c4a98-1529">Total de bytes TCP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1529">Total TCP Bytes Received</span></span>   
- <span data-ttu-id="c4a98-1530">Total de pacotes inválidos TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1530">Total TCP Invalid Packets</span></span>   
- <span data-ttu-id="c4a98-1531">Total de pacotes de receção TCP caídos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1531">Total TCP Receive Packets Dropped</span></span>    
- <span data-ttu-id="c4a98-1532">Total de erros de receção de TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1532">Total TCP Receive Checksum Errors</span></span>   
- <span data-ttu-id="c4a98-1533">Total de ligações TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1533">Total TCP Connections</span></span>   
- <span data-ttu-id="c4a98-1534">Total de desconexões TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1534">Total TCP Disconnections</span></span>   
- <span data-ttu-id="c4a98-1535">Total de ligações TCP caídas</span><span class="sxs-lookup"><span data-stu-id="c4a98-1535">Total TCP Connections Dropped</span></span>    
- <span data-ttu-id="c4a98-1536">Retransmissão total de pacotes TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1536">Total TCP Packet Retransmits</span></span>   
- <span data-ttu-id="c4a98-1537">Pacotes de tomada TCP enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1537">TCP Socket Packets Sent</span></span>   
- <span data-ttu-id="c4a98-1538">TCP Socket Bytes Enviados</span><span class="sxs-lookup"><span data-stu-id="c4a98-1538">TCP Socket Bytes Sent</span></span>   
- <span data-ttu-id="c4a98-1539">Pacotes de tomada TCP recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1539">TCP Socket Packets Received</span></span>   
- <span data-ttu-id="c4a98-1540">TCP Socket Bytes Recebidos</span><span class="sxs-lookup"><span data-stu-id="c4a98-1540">TCP Socket Bytes Received</span></span>   
- <span data-ttu-id="c4a98-1541">Retransmissão do pacote de tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1541">TCP Socket Packet Retransmits</span></span>    
- <span data-ttu-id="c4a98-1542">Pacotes de tomada TCP em fila</span><span class="sxs-lookup"><span data-stu-id="c4a98-1542">TCP Socket Packets Queued</span></span>    
- <span data-ttu-id="c4a98-1543">Erros de verificação da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1543">TCP Socket Checksum Errors</span></span>    
- <span data-ttu-id="c4a98-1544">Estado da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1544">TCP Socket State</span></span>    
- <span data-ttu-id="c4a98-1545">Órbita de transmissão da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1545">TCP Socket Transmit Queue Depth</span></span>    
- <span data-ttu-id="c4a98-1546">Tamanho da janela de transmissão da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1546">TCP Socket Transmit Window Size</span></span>    
- <span data-ttu-id="c4a98-1547">Tomada TCP receber tamanho da janela</span><span class="sxs-lookup"><span data-stu-id="c4a98-1547">TCP Socket Receive Window Size</span></span>    

<span data-ttu-id="c4a98-1548">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_tcp_info_get** _ para o total das estatísticas TCP e o serviço _ *_nx_tcp_socket_info_get_** para as estatísticas de TCP por tomada.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1548">All these statistics and error reports are available to the application with the ***nx_tcp_info_get** _ service for total TCP statistics and the _ *_nx_tcp_socket_info_get_** service for TCP statistics per socket.</span></span>

### <a name="tcp-socket-control-block-nx_tcp_socket"></a><span data-ttu-id="c4a98-1549">NX_TCP_SOCKET do bloco de controlo da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="c4a98-1549">TCP Socket Control Block NX_TCP_SOCKET</span></span>      
<span data-ttu-id="c4a98-1550">As características de cada tomada TCP encontram-se no bloco de controlo *NX_TCP_SOCKET* associado, que contém informações úteis, tais como a ligação à estrutura de dados IP, a interface de ligação à rede, a porta vinculada e a fila do pacote de receção.</span><span class="sxs-lookup"><span data-stu-id="c4a98-1550">The characteristics of each TCP socket are found in the associated *NX_TCP_SOCKET* control block, which contains useful information such as the link to the IP data structure, the network connection interface, the bound port, and the receive packet queue.</span></span> <span data-ttu-id="c4a98-1551">Esta estrutura é definida no ficheiro ***nx_api.h.***</span><span class="sxs-lookup"><span data-stu-id="c4a98-1551">This structure is defined in the ***nx_api.h*** file.</span></span>