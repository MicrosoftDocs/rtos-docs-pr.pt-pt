---
title: Capítulo 1 - Introdução ao Azure RTOS NetX Duo MQTT
description: O pacote de clientes NetX Duo MQTT requer que o NetX Duo (versão 5.10 ou posterior) seja instalado, devidamente configurado, e a instância IP foi criada.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 2e13b997f987e2fd82569bcb1904218908313d70
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104825910"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-mqtt"></a><span data-ttu-id="ef055-103">Capítulo 1 - Introdução ao Azure RTOS NetX Duo MQTT</span><span class="sxs-lookup"><span data-stu-id="ef055-103">Chapter 1 - Introduction to Azure RTOS NetX Duo MQTT</span></span>

## <a name="netx-duo-mqtt-requirements"></a><span data-ttu-id="ef055-104">Requisitos de MQTT duo NetX</span><span class="sxs-lookup"><span data-stu-id="ef055-104">NetX Duo MQTT Requirements</span></span>

<span data-ttu-id="ef055-105">O pacote de clientes Azure RTOS NetX Duo MQTT exige que o NetX Duo (versão 5.10 ou posterior) seja instalado, devidamente configurado, e a instância IP tenha sido criada.</span><span class="sxs-lookup"><span data-stu-id="ef055-105">The Azure RTOS NetX Duo MQTT client package requires that NetX Duo (version 5.10 or later) be installed, properly configured, and the IP instance has been created.</span></span> <span data-ttu-id="ef055-106">O módulo TCP deve ser ativado no sistema.</span><span class="sxs-lookup"><span data-stu-id="ef055-106">The TCP module must be enabled in the system.</span></span> <span data-ttu-id="ef055-107">Além disso, se for necessária a segurança TLS, o módulo NetX Secure TLS tem de ser configurado de acordo com o parâmetro de segurança exigido pelo corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-107">In addition, if TLS security is required, the NetX Secure TLS module needs to be configured according to the security parameter required by the broker.</span></span>

## <a name="netx-duo-mqtt-specification"></a><span data-ttu-id="ef055-108">Especificação MQTT duo netx</span><span class="sxs-lookup"><span data-stu-id="ef055-108">NetX Duo MQTT Specification</span></span>

<span data-ttu-id="ef055-109">O implementação do cliente NetX Duo MQTT está em conformidade com a versão OASIS MQTT 3.1.1 out<sup>29 th</sup> 2014.</span><span class="sxs-lookup"><span data-stu-id="ef055-109">NetX Duo MQTT client implement is compliant with OASIS MQTT Version 3.1.1 Oct 29<sup>th</sup> 2014.</span></span> <span data-ttu-id="ef055-110">A especificação pode ser encontrada em:</span><span class="sxs-lookup"><span data-stu-id="ef055-110">The specification can be found at:</span></span>

- [http://mqtt.org/](http://mqtt.org/)

## <a name="netx-duo-mqtt-basic-operation"></a><span data-ttu-id="ef055-111">Operação Básica NetX Duo MQTT</span><span class="sxs-lookup"><span data-stu-id="ef055-111">NetX Duo MQTT Basic Operation</span></span>

<span data-ttu-id="ef055-112">O MQTT (Message Queue Telemetry Transport) baseia-se no modelo de assinante-editor.</span><span class="sxs-lookup"><span data-stu-id="ef055-112">MQTT (Message Queue Telemetry Transport) is based on publisher-subscriber model.</span></span> <span data-ttu-id="ef055-113">Um cliente pode publicar informações a outros clientes através de um corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-113">A client can publish information to other clients through a broker.</span></span> <span data-ttu-id="ef055-114">Um cliente, se estiver interessado num tópico, pode subscrever o tópico através do corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-114">A client, if interested in a topic, can subscribe to the topic through the broker.</span></span> <span data-ttu-id="ef055-115">Um corretor é responsável pela entrega de mensagens publicadas aos seus clientes que subscrevem o tema.</span><span class="sxs-lookup"><span data-stu-id="ef055-115">A broker is responsible for delivering published messages to its clients who subscribe to the topic.</span></span> <span data-ttu-id="ef055-116">Neste modelo de assinante-editor, vários clientes podem publicar dados com o mesmo tópico.</span><span class="sxs-lookup"><span data-stu-id="ef055-116">In this publisher-subscriber model, multiple clients may publish data with the same topic.</span></span> <span data-ttu-id="ef055-117">Um cliente receberá uma mensagem que publica se o cliente subscrever o mesmo tópico.</span><span class="sxs-lookup"><span data-stu-id="ef055-117">A client will receive a message it publishes if the client subscribes to the same topic.</span></span>

<span data-ttu-id="ef055-118">Dependendo do caso de utilização, um cliente pode escolher um dos 3 níveis QoS ao publicar uma mensagem:</span><span class="sxs-lookup"><span data-stu-id="ef055-118">Depending on the use case, a client may choose one of the 3 QoS levels when publishing a message:</span></span>

- <span data-ttu-id="ef055-119">**QoS 0**: A mensagem é entregue no máximo uma vez.</span><span class="sxs-lookup"><span data-stu-id="ef055-119">**QoS 0**: The message is delivered at most once.</span></span> <span data-ttu-id="ef055-120">As mensagens enviadas com o QoS 0 podem perder-se.</span><span class="sxs-lookup"><span data-stu-id="ef055-120">Messages sent with QoS 0 may be lost.</span></span>
- <span data-ttu-id="ef055-121">**QoS 1**: A mensagem é entregue pelo menos uma vez.</span><span class="sxs-lookup"><span data-stu-id="ef055-121">**QoS 1**: The message is delivered at least once.</span></span> <span data-ttu-id="ef055-122">As mensagens enviadas com o QoS 1 podem ser entregues mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="ef055-122">Messages sent with QoS 1 may be delivered more than once.</span></span>
- <span data-ttu-id="ef055-123">**QoS 2**: A mensagem é entregue exatamente uma vez.</span><span class="sxs-lookup"><span data-stu-id="ef055-123">**QoS 2**: The message is delivered exactly once.</span></span> <span data-ttu-id="ef055-124">As mensagens enviadas com o QoS 2 estão garantidamente entregues, sem duplicação.</span><span class="sxs-lookup"><span data-stu-id="ef055-124">Messages sent with QoS 2 is guaranteed to be delivered, with no duplication.</span></span>

> [!NOTE]
> <span data-ttu-id="ef055-125">Esta implementação do cliente MQTT não suporta mensagens QoS de nível 2.</span><span class="sxs-lookup"><span data-stu-id="ef055-125">This implementation of MQTT client does not support QoS level 2 messages.</span></span>

<span data-ttu-id="ef055-126">Uma vez que o QoS 1 e o QoS 2 estão garantidos para serem entregues, o corretor mantém o estado das mensagens QoS 1 e QoS 2 enviadas a cada cliente.</span><span class="sxs-lookup"><span data-stu-id="ef055-126">Since QoS 1 and QoS 2 are guaranteed to be delivered, the broker keeps track the state of QoS 1 and QoS 2 messages sent to each client.</span></span> <span data-ttu-id="ef055-127">Isto é particularmente importante para os clientes que esperam mensagens QoS1 ou QoS 2.</span><span class="sxs-lookup"><span data-stu-id="ef055-127">This is particularly important for clients that expect QoS1 or QoS 2 messages.</span></span> <span data-ttu-id="ef055-128">O cliente pode ser desligado do corretor (por exemplo, quando o cliente reinicia ou o link de comunicação é temporariamente perdido).</span><span class="sxs-lookup"><span data-stu-id="ef055-128">The client may be disconnected from the broker (for example when the client reboots, or the communication link is temporarily lost).</span></span> <span data-ttu-id="ef055-129">O corretor deve armazenar mensagens QoS 1 e QoS 2 para que as mensagens possam ser entregues mais tarde assim que o cliente estiver novamente ligado ao corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-129">The broker must store QoS 1 and QoS 2 messages so the messages can be delivered later once the client is reconnected to the broker.</span></span> <span data-ttu-id="ef055-130">No entanto, o cliente pode optar por não receber nenhuma mensagem velha do corretor após a reconexão.</span><span class="sxs-lookup"><span data-stu-id="ef055-130">However, the client may choose not to receive any stale messages from the broker after reconnection.</span></span> <span data-ttu-id="ef055-131">O cliente pode fazê-lo iniciando a ligação com a bandeira *clean_session* definida para \***NX_TRUE** _.</span><span class="sxs-lookup"><span data-stu-id="ef055-131">The client can do so by initiating the connection with the *clean_session* flag set to \***NX_TRUE** _.</span></span> <span data-ttu-id="ef055-132">Neste caso, ao receber a mensagem MQTT CONNECT, o corretor descartará qualquer informação de sessão associada a este cliente, incluindo mensagens QoS 1 ou QoS 2 não entregues ou não confirmadas.</span><span class="sxs-lookup"><span data-stu-id="ef055-132">In this case, upon receiving the MQTT CONNECT message, the broker shall discard any session information associated with this client, including undelivered or unconfirmed QoS 1 or QoS 2 messages.</span></span> <span data-ttu-id="ef055-133">Se a _bandeira clean_session\* for para \***NX_FALSE,**_ o servidor reensificará as mensagens QoS 1 e QoS 2.</span><span class="sxs-lookup"><span data-stu-id="ef055-133">If the _clean_session\* flag is to \***NX_FALSE**_, the server shall resend the QoS 1 and QoS 2 messages.</span></span> <span data-ttu-id="ef055-134">O Cliente MQTT também reencamende quaisquer mensagens não reconhecidas se _clean_session\* estiver definido para \***NX_TRUE\*.**</span><span class="sxs-lookup"><span data-stu-id="ef055-134">The MQTT Client also resends any un-acknowledged messages if _clean_session\* is set to \***NX_TRUE\*.**</span></span> <span data-ttu-id="ef055-135">Este reconhecimento é diferente da camada TCP ACK, embora isso também aconteça.</span><span class="sxs-lookup"><span data-stu-id="ef055-135">This acknowledgment is different from the TCP layer ACK, although that happens as well.</span></span> <span data-ttu-id="ef055-136">O cliente MQTT envia um reconhecimento ao corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-136">The MQTT client sends an acknowledgment to the broker.</span></span>

<span data-ttu-id="ef055-137">Uma aplicação cria uma instância de cliente MQTT ligando \***nxd_mqtt_client_create()** _.</span><span class="sxs-lookup"><span data-stu-id="ef055-137">An application creates an MQTT client instance by calling \***nxd_mqtt_client_create()** _.</span></span> <span data-ttu-id="ef055-138">Uma vez criado o cliente, a aplicação pode ligar-se ao corretor chamando _*_nxd_mqtt_client_connect()_*_.</span><span class="sxs-lookup"><span data-stu-id="ef055-138">Once the client is created, the application can connect to the broker by calling _*_nxd_mqtt_client_connect()_*_.</span></span> <span data-ttu-id="ef055-139">Depois de ligar ao corretor, o cliente pode subscrever um tópico chamando _*_nxd_mqtt_client_subscribe()_*_, ou publicar um tópico chamando _\*_nxd_mqtt_client_publish()_\*\*.</span><span class="sxs-lookup"><span data-stu-id="ef055-139">After connecting to the broker, the client can subscribe to a topic by calling _*_nxd_mqtt_client_subscribe()_*_, or publish a topic by calling _\*_nxd_mqtt_client_publish()_\*\*.</span></span>

<span data-ttu-id="ef055-140">As mensagens MQTT recebidas são armazenadas na fila de receção na instância do cliente MQTT.</span><span class="sxs-lookup"><span data-stu-id="ef055-140">Incoming MQTT messages are stored in the receive queue in the MQTT client instance.</span></span> <span data-ttu-id="ef055-141">A aplicação recupera esta mensagem chamando ***nxd_mqtt_client_message_get()***.</span><span class="sxs-lookup"><span data-stu-id="ef055-141">Application retrieves these message by calling ***nxd_mqtt_client_message_get()***.</span></span> <span data-ttu-id="ef055-142">Se houver mensagens na fila de receção, a primeira mensagem (por exemplo, a mais antiga) da fila é devolvida ao chamador.</span><span class="sxs-lookup"><span data-stu-id="ef055-142">If there are messages in the receive queue, the first message (e.g. the oldest) from the queue is returned to the caller.</span></span> <span data-ttu-id="ef055-143">O tópico da mensagem também é devolvido.</span><span class="sxs-lookup"><span data-stu-id="ef055-143">The topic string from the message is also returned.</span></span>

> [!NOTE]
> <span data-ttu-id="ef055-144">A função \***nxd_mqtt_client_message_get()** _ não bloqueia se a fila de receção do cliente MQTT estiver vazia.</span><span class="sxs-lookup"><span data-stu-id="ef055-144">The function \***nxd_mqtt_client_message_get()** _ does not block if the MQTT client receive queue is empty.</span></span> <span data-ttu-id="ef055-145">A função retorna imediatamente com o código de devolução _\*_NXD_MQTT_NO_MESSAGE_\*\*.</span><span class="sxs-lookup"><span data-stu-id="ef055-145">The function returns immediately with the return code _\*_NXD_MQTT_NO_MESSAGE_\*\*.</span></span> <span data-ttu-id="ef055-146">O pedido deve tratar este valor de devolução como uma indicação de que a fila de receção está vazia, não um erro.</span><span class="sxs-lookup"><span data-stu-id="ef055-146">The application shall treat this return value as an indication that the receive queue is empty, not an error.</span></span>

<span data-ttu-id="ef055-147">Para evitar a sondagem da fila de receção de mensagens recebidas, a aplicação pode registar uma função de retorno com o cliente MQTT chamando ***nxd_mqtt_client_recieve_notify_set()***.</span><span class="sxs-lookup"><span data-stu-id="ef055-147">To avoid polling the receive queue for incoming messages, the application can register a callback function with the MQTT client by calling ***nxd_mqtt_client_recieve_notify_set()***.</span></span> <span data-ttu-id="ef055-148">A função de retorno é declarada como:</span><span class="sxs-lookup"><span data-stu-id="ef055-148">The callback function is declared as:</span></span>

```c
VOID (*receive_notify_callback)(NXD_MQTT_CLIENT *client_ptr, 
    UINT message_count);
```

<span data-ttu-id="ef055-149">Como o cliente MQTT recebe mensagens do corretor, invoca a função de retorno se a função estiver definida.</span><span class="sxs-lookup"><span data-stu-id="ef055-149">As the MQTT client receives messages from the broker, it invokes the callback function if the function is set.</span></span> <span data-ttu-id="ef055-150">A função de retorno passa o ponteiro para o bloco de controlo do cliente e um valor de contagem de mensagens.</span><span class="sxs-lookup"><span data-stu-id="ef055-150">The callback function passes the pointer to the client control block and a message count value.</span></span> <span data-ttu-id="ef055-151">O valor da contagem de mensagens indica o número de mensagens MQTT na fila de receção.</span><span class="sxs-lookup"><span data-stu-id="ef055-151">The message count value indicates the number of MQTT messages in the receive queue.</span></span> <span data-ttu-id="ef055-152">Note que esta função de retorno executa no contexto do fio do cliente MQTT.</span><span class="sxs-lookup"><span data-stu-id="ef055-152">Note that this callback function executes in the MQTT client thread context.</span></span> <span data-ttu-id="ef055-153">Portanto, a função de retorno não deve executar quaisquer procedimentos que possam bloquear o fio do cliente MQTT.</span><span class="sxs-lookup"><span data-stu-id="ef055-153">Therefore, the callback function should not execute any procedures that may block the MQTT client thread.</span></span> <span data-ttu-id="ef055-154">A função de retorno deve acionar o fio de aplicação para chamar ***nxd_mqtt_client_message_get para*** recuperar as mensagens.</span><span class="sxs-lookup"><span data-stu-id="ef055-154">The callback function should trigger the application thread to call ***nxd_mqtt_client_message_get()*** to retrieve the messages.</span></span>

<span data-ttu-id="ef055-155">Para desligar e encerrar o serviço de cliente MQTT, o pedido utilizará o serviço ***nxd_mqtt_client_disconnect()** e _*_nxd_mqtt_client_delete()._\*_</span><span class="sxs-lookup"><span data-stu-id="ef055-155">To disconnect and terminate the MQTT client service, the application shall use the service ***nxd_mqtt_client_disconnect()** _ and _*_nxd_mqtt_client_delete()._\*_</span></span> <span data-ttu-id="ef055-156">Chamar _*_nxd_mqtt_client_disconnect simplesmente_*_ desliga a ligação TCP ao corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-156">Calling _*_nxd_mqtt_client_disconnect()_*_ simply disconnects the TCP connection to the broker.</span></span> <span data-ttu-id="ef055-157">Lança mensagens já recebidas e armazenadas na fila de receção.</span><span class="sxs-lookup"><span data-stu-id="ef055-157">It releases messages already received and stored in the receive queue.</span></span> <span data-ttu-id="ef055-158">No entanto, não liberta mensagens QoS de nível 1 na fila de transmissão.</span><span class="sxs-lookup"><span data-stu-id="ef055-158">However, it does not release QoS level 1 messages in the transmit queue.</span></span> <span data-ttu-id="ef055-159">As mensagens qoS nível 1 são retransmitidas após a ligação, assumindo que a bandeira _*_clean_session_*_ está definida para _ *_NX_FALSE._*\*</span><span class="sxs-lookup"><span data-stu-id="ef055-159">QoS level 1 messages are retransmitted upon connection, assuming the _*_clean_session_*_ flag is set to _ *_NX_FALSE._*\*</span></span>

<span data-ttu-id="ef055-160">O corretor também pode desligar-se do cliente.</span><span class="sxs-lookup"><span data-stu-id="ef055-160">The broker may also disconnect from the client.</span></span> <span data-ttu-id="ef055-161">Quando a ligação TCP entre o cliente e o corretor é encerrada, o pedido pode ser notificado pela função de notificação de desconexão.</span><span class="sxs-lookup"><span data-stu-id="ef055-161">When the TCP connection between the client and the broker is terminated, the application can be notified by the disconnect notify function.</span></span> <span data-ttu-id="ef055-162">Para utilizar o mecanismo de notificação, a aplicação instala a função de notificação de desconexão chamando \***nxd_mqtt_client_disconnect_notify_set\*.**</span><span class="sxs-lookup"><span data-stu-id="ef055-162">To use the notification mechanism, application installs the disconnect notify function by calling \***nxd_mqtt_client_disconnect_notify_set\*.**</span></span> <span data-ttu-id="ef055-163">Uma vez observada uma desconexão TCP e a sessão MQTT foi criada, a função de notificação é invocada.</span><span class="sxs-lookup"><span data-stu-id="ef055-163">Once a TCP disconnect is observed and the MQTT session has been created, the notification function is invoked.</span></span>

<span data-ttu-id="ef055-164">Chamar ***nxd_mqtt_client_delete()*** liberta todos os blocos de mensagens na fila de transmissão e na fila de receção.</span><span class="sxs-lookup"><span data-stu-id="ef055-164">Calling ***nxd_mqtt_client_delete()*** releases all message blocks in the transmit queue and the receive queue.</span></span> <span data-ttu-id="ef055-165">As mensagens QoS de nível 1 não reconhecidas também são eliminadas.</span><span class="sxs-lookup"><span data-stu-id="ef055-165">Unacknowledged QoS level 1 messages are also deleted.</span></span>

## <a name="secure-mqtt-connection"></a><span data-ttu-id="ef055-166">Ligação MQTT segura</span><span class="sxs-lookup"><span data-stu-id="ef055-166">Secure MQTT Connection</span></span>

<span data-ttu-id="ef055-167">O cliente MQTT faz uma ligação segura ao corretor utilizando o módulo NetX Secure TLS.</span><span class="sxs-lookup"><span data-stu-id="ef055-167">The MQTT client makes a secure connection to the broker using the NetX Secure TLS module.</span></span> <span data-ttu-id="ef055-168">O número de porta padrão para MQTT com segurança TLS é 8883, definido em ***NXD_MQTT_TLS_PORT***.</span><span class="sxs-lookup"><span data-stu-id="ef055-168">The default port number for MQTT with TLS security is 8883, defined in ***NXD_MQTT_TLS_PORT***.</span></span>

<span data-ttu-id="ef055-169">Para criar uma ligação MQTT segura ao corretor, uma sessão TLS precisa de ser negociada após a criação de uma ligação TCP, antes de as mensagens MQTT CONNECT poderem ser enviadas para o corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-169">To create a secure MQTT connection to the broker, a TLS session needs to be negotiated after a TCP connection is established, before MQTT CONNECT messages can be sent to the broker.</span></span> <span data-ttu-id="ef055-170">A sessão TLS configurada é realizada chamando ***nxd_mqtt_client_secure_connect()*** e passando numa função de chamada de configuração TLS definida pelo utilizador.</span><span class="sxs-lookup"><span data-stu-id="ef055-170">The TLS session set up is accomplished by calling ***nxd_mqtt_client_secure_connect()*** and passing in a user-defined TLS setup callback function.</span></span> <span data-ttu-id="ef055-171">Durante a fase de ligação MQTT, uma vez estabelecida a ligação TCP, o cliente invoca a função de chamada de configuração TLS para iniciar um processo de aperto de mão TLS adequado.</span><span class="sxs-lookup"><span data-stu-id="ef055-171">During the MQTT connection phase, once the TCP connection is established, the client invokes the TLS setup callback function to start a proper TLS handshake process.</span></span> <span data-ttu-id="ef055-172">Após a sessão TLS ser estabelecida, o cliente continua a mensagem MQTT CONNECT sobre o canal seguro.</span><span class="sxs-lookup"><span data-stu-id="ef055-172">After the TLS session is established, the client continues the MQTT CONNECT message over the secure channel.</span></span>

<span data-ttu-id="ef055-173">A função de retorno definido pelo utilizador tem cinco valores de entrada e é declarada como:</span><span class="sxs-lookup"><span data-stu-id="ef055-173">The user defined callback function takes five input values and is declared as:</span></span>

```c
UINT tls_Setup_callback(NXD_MQTT_CLIENT *client_ptr,
    NX_SECURE_TLS_SESSION *session_ptr,
    NX_SECURE_TLS_CERTIFICATE *certificate_ptr,
    NX_SECURE_TLS_CERTIFICATE *trusted_cerfiticate);
```

<span data-ttu-id="ef055-174">Abaixo está uma descrição dos parâmetros de entrada:</span><span class="sxs-lookup"><span data-stu-id="ef055-174">Below is a description of the input parameters:</span></span>

- <span data-ttu-id="ef055-175">**client_ptr**: Ponter para o bloco de controlo do cliente MQTT.</span><span class="sxs-lookup"><span data-stu-id="ef055-175">**client_ptr**: Pointer to the MQTT client control block.</span></span>
- <span data-ttu-id="ef055-176">**session_ptr**: Ponteiro para o bloco de controlo de sessão TLS.</span><span class="sxs-lookup"><span data-stu-id="ef055-176">**session_ptr**: Pointer to the TLS session control block.</span></span>
- <span data-ttu-id="ef055-177">**certificate_ptr**: Ponteiro para o bloco de controlo do certificado.</span><span class="sxs-lookup"><span data-stu-id="ef055-177">**certificate_ptr**: Pointer to the certificate control block.</span></span> <span data-ttu-id="ef055-178">A função de configuração configura este certificado antes de enviá-lo para o corretor.</span><span class="sxs-lookup"><span data-stu-id="ef055-178">The setup function configures this certificate before sending it to the broker.</span></span>
- <span data-ttu-id="ef055-179">**trusted_certificate_ptr**: Ponter para o certificado de confiança.</span><span class="sxs-lookup"><span data-stu-id="ef055-179">**trusted_certificate_ptr**: Pointer to the trusted certificate.</span></span> <span data-ttu-id="ef055-180">A função de configuração TLS configura o certificado fidedigno para autenticar o servidor.</span><span class="sxs-lookup"><span data-stu-id="ef055-180">TLS setup function configures the trusted certificate to authenticate the server.</span></span>

<span data-ttu-id="ef055-181">Na função de configuração TLS, a aplicação é responsável pela criação de uma sessão TLS e configurar a sessão com um certificado adequado.</span><span class="sxs-lookup"><span data-stu-id="ef055-181">In the TLS setup function, the application is responsible for creating a TLS session, and configuring the session with a proper certificate.</span></span> <span data-ttu-id="ef055-182">O seguinte código pseudo descreve um procedimento típico de arranque de sessão TLS.</span><span class="sxs-lookup"><span data-stu-id="ef055-182">The following pseudo code outlines a typical TLS session start up procedure.</span></span> <span data-ttu-id="ef055-183">O leitor é encaminhado para o Guia de Utilizador NetX Secure TLS para obter detalhes sobre a utilização de APIs TLS.</span><span class="sxs-lookup"><span data-stu-id="ef055-183">The reader is referred to the NetX Secure TLS User Guide for details on using TLS APIs.</span></span>

<span data-ttu-id="ef055-184">Abaixo está um exemplo de chamada de configuração TLS:</span><span class="sxs-lookup"><span data-stu-id="ef055-184">Below is an example TLS setup callback:</span></span>

```c
UINT tls_setup_callback(NXD_MQTT_CLIENT *client_pt
    NX_SECURE_TLS_SESSION *session_ptr,
    NX_SECURE_TLS_CERTIFICATE *certrifcate_ptr,
    NX_SECURE_TLS_CERTIFICATE *trusted_certificate_ptr)
{
    /* Initialize TLS module */
    nx_secure_tls_initialize();

    /* Create a TLS session */
    nx_secure_tls_session_create(session_ptr, …);

    /* Need to allocate space for the certificate coming in from the broker. */
    memset(certificate_ptr), 0, sizeof(NX_SECURE_TLS_CERTIFICATE));

    nx_secure_tls_remote_certificate_allocate(session_ptr, certificate_ptr);

    /* Add a CA Certificate to our trusted store for verifying incomingserver certificates. */
    nx_secure_tls_certificate_initialize(
        trusted_certificate_ptr,
        ca_cert_der,
        ca_cert_der_len, NULL, 0);
    nx_secure_tls_trusted_certificate_add(session_ptr,
        trusted_certificate));
}
```

## <a name="known-limitations-of-the-netx-duo-mqtt-client"></a><span data-ttu-id="ef055-185">Limitações conhecidas do Cliente MQTT Duo NetX</span><span class="sxs-lookup"><span data-stu-id="ef055-185">Known Limitations of the NetX Duo MQTT Client</span></span>

- <span data-ttu-id="ef055-186">NetX Duo MQTT não suporta o envio ou receção de mensagens QoS de nível 2.</span><span class="sxs-lookup"><span data-stu-id="ef055-186">NetX Duo MQTT does not support sending or receiving QoS level 2 messages.</span></span>
- <span data-ttu-id="ef055-187">NetX Duo MQTT não suporta pacotes acorrentados.</span><span class="sxs-lookup"><span data-stu-id="ef055-187">NetX Duo MQTT does not support chained-packets.</span></span>
