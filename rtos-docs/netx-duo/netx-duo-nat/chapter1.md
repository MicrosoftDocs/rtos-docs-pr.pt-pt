---
title: Capítulo 1 - Introdução à Tradução de Endereços de Rede
description: A tradução de endereços de rede IP (NAT) foi originalmente desenvolvida para resolver o problema de um número limitado de endereços IPv4 da Internet.
author: philmea
ms.author: philmea
ms.date: 07/14/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 3d01aa6f68e21ea82f65a59a19c4f5c7958a6b92
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104825868"
---
# <a name="chapter-1---an-introduction-to-network-address-translation"></a><span data-ttu-id="c0cb8-103">Capítulo 1 - Introdução à Tradução de Endereços de Rede</span><span class="sxs-lookup"><span data-stu-id="c0cb8-103">Chapter 1 - An introduction to Network Address Translation</span></span>

## <a name="the-need-for-network-address-translation"></a><span data-ttu-id="c0cb8-104">A necessidade de tradução de endereço de rede</span><span class="sxs-lookup"><span data-stu-id="c0cb8-104">The Need for Network Address Translation</span></span>

<span data-ttu-id="c0cb8-105">A tradução de endereços de rede IP (NAT) foi originalmente desenvolvida para resolver o problema de um número limitado de endereços IPv4 da Internet.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-105">IP Network Address Translation (NAT) was originally developed to solve the problem of a limited number of Internet IPv4 addresses.</span></span> <span data-ttu-id="c0cb8-106">A necessidade de NAT surge quando vários dispositivos precisam de aceder à Internet, mas apenas um endereço de Internet IPv4 é atribuído pelo Fornecedor de Serviços de Internet (ISP).</span><span class="sxs-lookup"><span data-stu-id="c0cb8-106">The need for NAT arises when multiple devices need to access the Internet but only one IPv4 Internet address is assigned by the Internet Service Provider (ISP).</span></span>

<span data-ttu-id="c0cb8-107">Há outros benefícios de usar o NAT também.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-107">There are other benefits of using NAT as well.</span></span> <span data-ttu-id="c0cb8-108">A topologia da rede fora do domínio local pode mudar de muitas maneiras.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-108">Network topology outside the local domain can change in many ways.</span></span> <span data-ttu-id="c0cb8-109">Os clientes podem mudar de fornecedor, as espinhas traseiras da empresa podem ser reorganizadas, ou os fornecedores podem fundir-se ou dividir-se.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-109">Customers may change providers, company backbones may be reorganized, or providers may merge or split.</span></span> <span data-ttu-id="c0cb8-110">Sempre que a topologia externa mudar, as atribuições de endereços para anfitriões dentro do domínio local também devem ser alteradas para refletir estas alterações externas.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-110">Whenever the external topology changes, address assignments for hosts within the local domain must also change to reflect these external changes.</span></span> <span data-ttu-id="c0cb8-111">As alterações deste tipo podem ser ocultadas dos utilizadores dentro do domínio, centralizando alterações num router de tradução de endereço único.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-111">Changes of this type can be hidden from users within the domain by centralizing changes to a single address translation router.</span></span> <span data-ttu-id="c0cb8-112">O NAT permite o acesso dos anfitriões locais à Internet pública e protege-os do acesso direto do exterior.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-112">NAT enables access for local hosts to the public Internet and protects them from direct access from the outside.</span></span> <span data-ttu-id="c0cb8-113">As organizações com uma rede criada predominantemente para uso interno, com necessidade de acesso externo ocasional são bons candidatos a este esquema.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-113">Organizations with a network setup predominantly for internal use, with a need for occasional external access are good candidates for this scheme.</span></span>

## <a name="basic-nat-and-network-address-port-translation"></a><span data-ttu-id="c0cb8-114">Tradução portuária de endereços de nat básico e endereço de rede</span><span class="sxs-lookup"><span data-stu-id="c0cb8-114">Basic NAT and Network Address Port Translation</span></span>

<span data-ttu-id="c0cb8-115">Um router ativado pela NAT é instalado entre a rede pública e a rede privada.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-115">A NAT-enabled router is installed between the public network and the private network.</span></span> <span data-ttu-id="c0cb8-116">O papel do router ativado pelo NAT é traduzir entre os endereços IPv4 privados internos e o endereço IPv4 público atribuído, para que todos os dispositivos da rede privada possam partilhar o mesmo endereço público IPv4.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-116">The role of the NAT-enabled router is to translate between the internal private IPv4 addresses and the assigned public IPv4 address, so all the devices on the private network are able to share the same public IPv4 address.</span></span>

<span data-ttu-id="c0cb8-117">Na implementação básica do NAT, o router NAT 'detém' um ou mais endereços IP registados globalmente diferentes do seu próprio endereço IP.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-117">In the basic implementation of NAT, the NAT router ‘owns’ one or more globally registered IP addresses different from its own IP address.</span></span> <span data-ttu-id="c0cb8-118">Estes endereços globais estão disponíveis para atribuir aos anfitriões na sua rede privada, quer estática quer dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-118">These global addresses are available to assign to hosts on its private network either statically or dynamically.</span></span> <span data-ttu-id="c0cb8-119">NAPT, ou Tradução Portuária de Endereço de Rede, é uma variação do NAT básico, onde a tradução de endereços de rede é estendida para incluir um identificador de "transporte".</span><span class="sxs-lookup"><span data-stu-id="c0cb8-119">NAPT, or Network Address Port Translation, is a variation of basic NAT, where network address translation is extended to include a ‘transport’ identifier.</span></span> <span data-ttu-id="c0cb8-120">Normalmente, este é o número de porta para pacotes TCP e UDP, e o ID de consulta para pacotes ICMP.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-120">Most typically this is the port number for TCP and UDP packets, and the Query ID for ICMP packets.</span></span>

<span data-ttu-id="c0cb8-121">As ligações através da fronteira NAT são normalmente iniciadas por anfitriões na rede privada enviando pacotes de saída para um hospedeiro externo.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-121">Connections across the NAT boundary are typically initiated by hosts on the private network sending outbound packets to an external host.</span></span> <span data-ttu-id="c0cb8-122">Estes anfitriões são geralmente designados endereços IP *dinâmicos* (temporários) para este fim.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-122">These hosts are usually assigned *dynamic* (temporary) IP addresses for this purpose.</span></span> <span data-ttu-id="c0cb8-123">No entanto, também é possível ter ligações iniciadas na direção oposta se a rede privada tiver 'servidores' por exemplo, servidores HTTP ou FTP que aceitarão pedidos do Cliente a partir da rede externa.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-123">However, it is also possible to have connections initiated in the opposite direction if the private network has ‘servers’ e.g. HTTP or FTP servers that will accept Client requests from the external network.</span></span> <span data-ttu-id="c0cb8-124">A NAT irá normalmente atribuir a estes anfitriões locais um endereço IP *estático* (permanente): porta.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-124">NAT will typically assign these local hosts a *static* (permanent) IP address:port.</span></span>

## <a name="how-network-address-translation-works"></a><span data-ttu-id="c0cb8-125">Como funciona a tradução de endereços de rede</span><span class="sxs-lookup"><span data-stu-id="c0cb8-125">How Network Address Translation Works</span></span>

<span data-ttu-id="c0cb8-126">Uma configuração típica da rede com um router ativado pelo NAT é ilustrada na Figura 1.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-126">A typical network setup with a NAT-enabled router is illustrated in Figure 1.</span></span>

![Uma configuração típica de rede com um router ativado pelo NAT](media/image2.png)

<span data-ttu-id="c0cb8-128">**Figura 1 - Uma configuração típica da rede com um router ativado pelo NAT**</span><span class="sxs-lookup"><span data-stu-id="c0cb8-128">**Figure 1 - A typical network setup with a NAT-enabled router**</span></span>

<span data-ttu-id="c0cb8-129">Um router ativado pelo NAT normalmente tem duas interfaces de rede.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-129">A NAT-enabled router typically has two network interfaces.</span></span> <span data-ttu-id="c0cb8-130">Uma interface está ligada à Internet pública; o outro está ligado à rede privada.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-130">One interface is connected to the public Internet; the other is connected to the private network.</span></span> <span data-ttu-id="c0cb8-131">Um router típico nesta configuração é responsável pelo encaminhamento de datagramas ip entre a rede privada e a rede pública com base no endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-131">A typical router in this setup is responsible for routing IP datagrams between the private network and the public network based on destination IP address.</span></span> <span data-ttu-id="c0cb8-132">Um router ativado pelo NAT realiza a tradução de endereços antes de encaminhar um datagrama IPv4 entre o público e a interface privada.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-132">A NAT-enabled router performs address translation before routing an IPv4 datagram between the public and the private interface.</span></span> <span data-ttu-id="c0cb8-133">É estabelecida uma tradução para cada sessão de TCP ou UDP, com base no endereço de origem interna, número de porta de origem e endereço de destino externo e número de porta de destino.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-133">A translation is established for each TCP or UDP session, based the internal source address, source port number, and external destination address and destination port number.</span></span> <span data-ttu-id="c0cb8-134">Para o pedido de eco ICMP e para o datagrama de resposta, o ID de consulta ICMP é utilizado em vez do número da porta.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-134">For ICMP echo request and response datagram, the ICMP query ID is used instead of the port number.</span></span>

<span data-ttu-id="c0cb8-135">Para ilustrar uma implementação típica da Tradução de Endereços de Rede, consideremos uma configuração de rede na Figura 2.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-135">To illustrate a typical implementation of Network Address Translation, let us consider a network setup in Figure 2.</span></span>

![Uma implementação típica da Tradução de Endereços de Rede](media/image3.png)

<span data-ttu-id="c0cb8-137">**Figura 2 - Uma implementação típica da Tradução de Endereços de Rede**</span><span class="sxs-lookup"><span data-stu-id="c0cb8-137">**Figure 2 - A typical implementation of Network Address Translation**</span></span>

<span data-ttu-id="c0cb8-138">Neste cenário, o router NAT liga a rede privada à esquerda e a rede pública à direita.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-138">In this scenario, the NAT router connects the private network to the left, and the public network to the right.</span></span> <span data-ttu-id="c0cb8-139">Vamos assumir no lado da rede pública, o endereço IP interface de router NAT é 202.151.25.14; na interface de rede privada, o router NAT utiliza o endereço IP 192.168.1.254.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-139">Let’s assume on the public network side, the NAT router interface IP address is 202.151.25.14; on the private network interface, the NAT router uses the IP address 192.168.1.254.</span></span> <span data-ttu-id="c0cb8-140">Um nó na rede privada inicia uma ligação TCP com um servidor web na Internet.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-140">A node on the private network initiates a TCP connection with a web server on the Internet.</span></span>

<span data-ttu-id="c0cb8-141">A figura 3 mostra uma visão de alto nível do processo de tradução de endereços de rede.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-141">Figure 3 shows a high-level view of the Network Address Translation process.</span></span>

![Uma visão de alto nível do processo de tradução de endereços de rede](media/image4.png)

<span data-ttu-id="c0cb8-143">**Figura 3 - Uma visão de alto nível do processo de tradução de endereços de rede**</span><span class="sxs-lookup"><span data-stu-id="c0cb8-143">**Figure 3 - A high-level view of the Network Address Translation process**</span></span>

1. <span data-ttu-id="c0cb8-144">O cliente transmite uma mensagem TCP SYN para o servidor web.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-144">Client transmits a TCP SYN message to the web server.</span></span> <span data-ttu-id="c0cb8-145">O endereço do remetente é 192.168.1.15, porta número 6732; o endereço de destino é 128.15.54.3, porta número 80.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-145">The sender address is 192.168.1.15, port number 6732; the destination address is 128.15.54.3, port number 80.</span></span>
1. <span data-ttu-id="c0cb8-146">O pacote do Cliente é recebido na interface de rede privada pelo router NAT.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-146">The packet from the Client is received on the private network interface by the NAT router.</span></span> <span data-ttu-id="c0cb8-147">A regra de tráfego de saída aplica-se ao pacote: o endereço do remetente (Cliente) é traduzido para o endereço IP público do router NAT 202.15.25.14, e o número de porta de origem do remetente (Cliente) é traduzido para o número da porta TCP 2015 na interface pública.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-147">The outbound traffic rule applies to the packet: the sender’s (Client’s) address is translated to the NAT router’s public IP address 202.15.25.14, and sender (Client) source port number is translated to the TCP port number 2015 on the public interface.</span></span>
1. <span data-ttu-id="c0cb8-148">O pacote é então transmitido através da Internet e, em última análise, atinge o seu anfitrião de destino 128.15.54.3.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-148">The packet is then transmitted over the Internet and ultimately reaches its destination host 128.15.54.3.</span></span> <span data-ttu-id="c0cb8-149">Note que do lado recetor, com base no endereço de fonte de camada IP e no número da porta da camada TCP, o pacote parece ter sido originário de 202.151.24.14, número da porta 2015.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-149">Notice that on the receiving side, based on the IP layer source address and TCP layer port number, the packet appears to have originated from 202.151.24.14, port number 2015.</span></span>
   <span data-ttu-id="c0cb8-150">A figura 4 mostra o processo NAT no caminho de retorno.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-150">Figure 4 shows the NAT process on the return path.</span></span>

   ![Processo NAT no caminho de retorno](media/image5.png)

   <span data-ttu-id="c0cb8-152">**Figura 4 - Processo NAT no caminho de retorno**</span><span class="sxs-lookup"><span data-stu-id="c0cb8-152">**Figure 4 - NAT process on the return path**</span></span>
1. <span data-ttu-id="c0cb8-153">Neste cenário, o anfitrião da Internet 128.15.54.3 envia um pacote de resposta com o endereço de Internet do router NAT como destino.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-153">In this scenario, the Internet host 128.15.54.3 sends a response packet with the NAT router’s Internet address as its destination.</span></span>
1. <span data-ttu-id="c0cb8-154">O pacote chega ao router NAT.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-154">The packet reaches the NAT router.</span></span> <span data-ttu-id="c0cb8-155">Uma vez que se trata de um pacote in-bound, aplicam-se as regras de tradução in-bound: o endereço de destino é alterado de volta para o endereço IP do remetente original ( Cliente) endereço IP: 192.168.1.15, porta de destino número 6732.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-155">Since this is an in-bound packet, the in-bound translation rules apply: the destination address is changed back to the original sender’s (Client’s) IP address: 192.168.1.15, destination port number 6732.</span></span>
1. <span data-ttu-id="c0cb8-156">O pacote é então encaminhado para o Cliente através da interface que está ligada à rede interna.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-156">The packet is then forwarded to the Client through the interface that is connected to the internal network.</span></span>

<span data-ttu-id="c0cb8-157">Desta forma, o endereço da rede de internet e o número de porta do remetente não estão expostos a outros anfitriões na Internet pública.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-157">In this manner the internet network address and port number of the sender is not exposed to other hosts on the public Internet.</span></span>

## <a name="netx-duo-nat-features"></a><span data-ttu-id="c0cb8-158">Recursos do Duo NETX NAT</span><span class="sxs-lookup"><span data-stu-id="c0cb8-158">NetX Duo NAT Features</span></span>

<span data-ttu-id="c0cb8-159">Quando a instância NAT é criada usando *nx_nat_create* chamada, a tabela de tradução NAT é criada.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-159">When the NAT instance is created using *nx_nat_create* call, the NAT translation table is created.</span></span>

```C
UINT nx_nat_create(NX_NAT_DEVICE *nat_ptr, NX_IP *ip_ptr,
    UINT global_interface_index,
    VOID *dynamic_cache_memory,
    UINT dynamic_cache_size);
```

<span data-ttu-id="c0cb8-160">Para acompanhar as traduções de endereços de rede para todas as ligações ativas entre redes locais e externas, o router ativado pelo NetX Duo NAT mantém uma tabela de tradução com informações sobre cada ligação privada de anfitrião que inclui endereço IP de origem e destino e número de porta.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-160">To keep track of the network address translations for all active connections between local and external networks, the NetX Duo NAT-enabled router maintains a translation table with information about each private host connection which includes source and destination IP address and port number.</span></span>

<span data-ttu-id="c0cb8-161">A localização desta tabela de tradução ("cache") é definida com o ponteiro dynamic_cache_memory.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-161">The location of this translation table (“cache”) is set with the dynamic_cache_memory pointer.</span></span> <span data-ttu-id="c0cb8-162">Esta área deve ser um espaço tampão alinhado 4 byte.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-162">This area must be a 4 byte aligned buffer space.</span></span> <span data-ttu-id="c0cb8-163">O tamanho da tabela (ou número de entradas) é determinado dividindo o tamanho da cache dynamic_cache_size pelo tamanho de uma entrada de mesa NAT.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-163">The size of the table (or number of entries) is determined by dividing the cache size dynamic_cache_size by the size of a NAT table entry.</span></span> <span data-ttu-id="c0cb8-164">O quadro deve ser suficientemente grande para o número mínimo de entradas especificadas por **NX_NAT_MIN_ENTRY_COUNT definidas em *nx_nat.h*. O valor predefinido é 3.**</span><span class="sxs-lookup"><span data-stu-id="c0cb8-164">The table must be large enough for the minimal number of entries specified by **NX_NAT_MIN_ENTRY_COUNT which is defined in *nx_nat.h*. The default value is 3.**</span></span>

<span data-ttu-id="c0cb8-165">O tempo limite para todas as entradas dinâmicas na tabela de tradução NetX Duo NAT é inicializado para NX_NAT_ENTRY_RESPONSE_TIMEOUT que é definido em *nx_nat.h*.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-165">The timeout for all dynamic entries in the NetX Duo NAT translation table are initialized to NX_NAT_ENTRY_RESPONSE_TIMEOUT which is defined in *nx_nat.h*.</span></span> <span data-ttu-id="c0cb8-166">O valor predefinido é de 4 minutos (ou 240 carraças de sistema para um processador de 100 mHz) como recomendado pelo RFC 2663.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-166">The default value is 4 minutes (or 240 system ticks for a 100 mHz processor) as recommended by RFC 2663.</span></span> <span data-ttu-id="c0cb8-167">Cada vez que o NetX Duo NAT recebe ou envia um pacote correspondente a uma entrada dinâmica na tabela, repõe que o tempo de entrada sai para NX_NAT_ENTRY_RESPONSE_TIMEOUT.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-167">Each time NetX Duo NAT receives or sends a packet matching a dynamic entry in the table it resets that entry’s time out to NX_NAT_ENTRY_RESPONSE_TIMEOUT.</span></span> <span data-ttu-id="c0cb8-168">Ao pesquisar a tabela, o NetX Duo NAT também verificará a tabela para obter entradas expiradas e eliminá-las-á.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-168">When searching the table, NetX Duo NAT will also check the table for expired entries and delete them.</span></span>

<span data-ttu-id="c0cb8-169">Para criar entradas de entrada como estáticas na tabela, por exemplo, para servidores na rede local, o NetX Duo NAT fornece o serviço *nx_nat_inbound_entry_create.*</span><span class="sxs-lookup"><span data-stu-id="c0cb8-169">To create inbound entries as static in the table e.g. for servers on the local network, NetX Duo NAT provides the *nx_nat_inbound_entry_create* service.</span></span> <span data-ttu-id="c0cb8-170">Se uma entrada de mesa definir a ligação do anfitrião local como estática, nunca expira.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-170">If a table entry defines the local host connection as static, it never expires.</span></span>

```C
UINT nx_nat_inbound_entry_create(NX_NAT_DEVICE *nat_ptr,
    NX_NAT_TRANSLATION_ENTRY *entry_ptr,
    ULONG local_ip_address, USHORT external_port,
    USHORT local_port, UCHAR protocol);
```

<span data-ttu-id="c0cb8-171">Este serviço é descrito mais detalhadamente no [Capítulo 4 - Descrição dos Serviços](chapter4.md)</span><span class="sxs-lookup"><span data-stu-id="c0cb8-171">This service is described in more detail in [Chapter 4 - Description of Services](chapter4.md)</span></span>

<span data-ttu-id="c0cb8-172">Durante o tempo de funcionamento, se a tabela de tradução estiver cheia e não puderem ser adicionadas mais entradas, a NetX Duo NAT notificará a aplicação NAT com uma chamada completa de cache se uma estiver registada na instância NAT.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-172">During runtime, if the translation table is full and no more entries can be added, NetX Duo NAT will notify the NAT application with a cache full callback if one is registered with the NAT instance.</span></span> <span data-ttu-id="c0cb8-173">Isto é feito usando o serviço *nx_nat_cache_notify_set:*</span><span class="sxs-lookup"><span data-stu-id="c0cb8-173">This is done using the *nx_nat_cache_notify_set* service:</span></span>

```C
UINT nx_nat_cache_notify_set(NX_NAT_DEVICE *nat_ptr,
    VOID (*cache_full_notify_cb)(NX_NAT_DEVICE *nat_ptr));
```

<span data-ttu-id="c0cb8-174">Consulte [o Capítulo 4 - Descrição dos Serviços](chapter4.md) para mais informações sobre este serviço.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-174">See [Chapter 4 - Description of Services](chapter4.md) for more details about this service.</span></span>

## <a name="nat-packet-processing-in-netx-duo"></a><span data-ttu-id="c0cb8-175">Processamento de pacotes NAT em NetX Duo</span><span class="sxs-lookup"><span data-stu-id="c0cb8-175">NAT Packet Processing in NetX Duo</span></span>

<span data-ttu-id="c0cb8-176">NetX Duo NAT destina-se a ser utilizado num router IPv4.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-176">NetX Duo NAT is intended for use on an IPv4 router.</span></span> <span data-ttu-id="c0cb8-177">Para que o NAT funcione, o NetX Duo tem de ser configurado para encaminhar pacotes para o servidor NAT.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-177">For NAT to work, NetX Duo must be configured for forwarding packets to the NAT server.</span></span> <span data-ttu-id="c0cb8-178">Consulte o Capítulo 2 na instalação NetX Duo NAT para saber como fazê-lo.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-178">See Chapter 2 on NetX Duo NAT installation for how to do so.</span></span> <span data-ttu-id="c0cb8-179">O servidor NAT indica então se irá 'consumir' (tentativa de encaminhar) o pacote para um anfitrião em qualquer uma das suas redes.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-179">The NAT server then indicates if it will ‘consume’ (attempt to forward) the packet to a host on either of its networks.</span></span> <span data-ttu-id="c0cb8-180">Se não consumir o pacote, o pacote é 'devolvido' ao NetX Duo para processar o pacote como normalmente faria.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-180">If it will not consume the packet, the packet is ‘returned’ to NetX Duo to process the packet as it normally would.</span></span>

<span data-ttu-id="c0cb8-181">Quando o servidor NAT recebe um pacote para encaminhar a partir do NetX Duo, determina se o pacote está de entrada ou saída.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-181">When the NAT server receives a packet to forward from NetX Duo, it determines if the packet is inbound or outbound.</span></span>

<span data-ttu-id="c0cb8-182">Para pacotes de saída, o servidor NAT verifica o endereço de origem e porta do cabeçalho IP do pacote.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-182">For outbound packets, the NAT server checks the packet IP header source address and port.</span></span> <span data-ttu-id="c0cb8-183">Se a tabela de tradução não contiver uma entrada para um pacote previamente enviado por este anfitrião para o mesmo destino, a NAT criará uma nova entrada que conterá um endereço IP de origem global único:porta para a ligação, e modificará os cabeçalhos do pacote com este novo endereço IP:porta antes de enviá-lo para a rede externa.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-183">If the translation table does not contain an entry for a packet previously sent by this host for the same destination, NAT will create a new entry which will contain a unique global source IP address:port for the connection, and modify the packet headers with this new IP address:port before sending it onto the external network.</span></span>

<span data-ttu-id="c0cb8-184">Para pacotes de entrada, o servidor NAT procura uma entrada anterior na sua tabela de tradução com um endereço IP externo: porta que corresponde ao endereço IP do destino do pacote: porta.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-184">For inbound packets, the NAT server looks for a previous entry in its translation table with an external IP address: port matching the packet destination IP address: port.</span></span> <span data-ttu-id="c0cb8-185">Se não for encontrada correspondência, descartará o pacote a menos que o endereço de destino: a porta é o endereço externo do servidor na rede local.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-185">If no match is found, it will discard the packet unless the destination address: port is the external address for server on the local network.</span></span> <span data-ttu-id="c0cb8-186">Se encontrar uma correspondência, substituirá o endereço IP de destino externo do porta-pacotes: porta com o endereço IP privado: porta e enviará o pacote para a rede local para o anfitrião privado pretendido.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-186">If it does find a match, it will replace the packet header’s external destination IP address: port with the private IP address: port and send the packet onto the local network to the intended private host.</span></span>

<span data-ttu-id="c0cb8-187">NetX Duo NAT utiliza uma gama de portas de tradução TCP, UDP e ICMP para criar endereço local único: ligações portuárias para anfitriões locais conectando-se com anfitriões externos.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-187">NetX Duo NAT uses a range of TCP, UDP and ICMP translation ports for creating unique local address: port connections for local hosts connecting with outside hosts.</span></span> <span data-ttu-id="c0cb8-188">As seguintes opções configuráveis do utilizador, definidas em *nx_nat.h,* definem a gama para cada protocolo:</span><span class="sxs-lookup"><span data-stu-id="c0cb8-188">The following user configurable options, defined in *nx_nat.h,* define the range for each protocol:</span></span>

```C
NX_NAT_START_TCP_PORT

NX_NAT_END_TCP_PORT

NX_NAT_START_UDP_PORT

NX_NAT_END_UDP_PORT

NX_NAT_START_ICMP_QUERY_ID

NX_NAT_END_ICMP_QUERY_ID
```

## <a name="nat-requirements-and-constraints"></a><span data-ttu-id="c0cb8-189">Requisitos e restrições do NAT</span><span class="sxs-lookup"><span data-stu-id="c0cb8-189">NAT Requirements and Constraints</span></span>

<span data-ttu-id="c0cb8-190">NetX Duo NAT requer NetX Duo 5.8 ou mais tarde.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-190">NetX Duo NAT requires NetX Duo 5.8 or later.</span></span> <span data-ttu-id="c0cb8-191">A aplicação NAT requer a criação de uma única instância IP e uma interface para a rede física interna e externa.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-191">The NAT application requires creation of a single IP instance and an interface to the internal and external physical network.</span></span>

<span data-ttu-id="c0cb8-192">Constrangimentos:</span><span class="sxs-lookup"><span data-stu-id="c0cb8-192">Constraints:</span></span>

- <span data-ttu-id="c0cb8-193">NetX Duo NAT suporta TCP, UDP e ICMP.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-193">NetX Duo NAT supports TCP, UDP and ICMP.</span></span> <span data-ttu-id="c0cb8-194">O IGMP não é suportado.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-194">IGMP is not supported.</span></span>
- <span data-ttu-id="c0cb8-195">NetX Duo NAT não suporta endereço iPv6.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-195">NetX Duo NAT does not support IPv6 addressing.</span></span>
- <span data-ttu-id="c0cb8-196">O NetX Duo NAT não inclui serviços DNS ou DHCP, embora o NetX Duo NAT possa integrar esses serviços com as suas operações NAT.</span><span class="sxs-lookup"><span data-stu-id="c0cb8-196">NetX Duo NAT does not include DNS or DHCP services, although NetX Duo NAT can integrate those services with its NAT operations.</span></span>

## <a name="rfcs-supported-by-netx-duo-nat"></a><span data-ttu-id="c0cb8-197">RFCs Suportados por NetX Duo NAT</span><span class="sxs-lookup"><span data-stu-id="c0cb8-197">RFCs Supported by NetX Duo NAT</span></span>

<span data-ttu-id="c0cb8-198">A implementação do NetX Duo NAT baseia-se em informações apresentadas nos seguintes RFCs:</span><span class="sxs-lookup"><span data-stu-id="c0cb8-198">NetX Duo NAT implementation is based on information presented in the following RFCs:</span></span>

- <span data-ttu-id="c0cb8-199">RFC 2663: Tradutor de Endereço de Rede IP (NAT) Terminologia e Considerações</span><span class="sxs-lookup"><span data-stu-id="c0cb8-199">RFC 2663: IP Network Address Translator (NAT) Terminology and Considerations</span></span>
- <span data-ttu-id="c0cb8-200">RFC 3022: Tradutor de Endereços IP Netowrk tradicional (NAT tradicional)</span><span class="sxs-lookup"><span data-stu-id="c0cb8-200">RFC 3022: Traditional IP Netowrk Address Translator (Traditional NAT)</span></span>
- <span data-ttu-id="c0cb8-201">RFC 4787: Prescrições comportamentais de tradução de endereços de rede (NAT) para UDP Unicast</span><span class="sxs-lookup"><span data-stu-id="c0cb8-201">RFC 4787: Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</span></span>
