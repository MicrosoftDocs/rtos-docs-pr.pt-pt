---
title: Capítulo 6 - Módulo tolerante a falhas Azure RTOS FileX
description: Este capítulo contém uma descrição do Módulo Tolerante a Falhas de Falhas Azure RTOS FileX que foi concebido para manter a integridade do sistema de ficheiros se os meios de comunicação perderem energia ou forem ejetados no meio de uma operação de escrita de ficheiros.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 68a24f0345a2c4d3e824270699b00a2daab32f8e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104826504"
---
# <a name="chapter-6---azure-rtos-filex-fault-tolerant-module"></a><span data-ttu-id="c5780-103">Capítulo 6 - Módulo tolerante a falhas Azure RTOS FileX</span><span class="sxs-lookup"><span data-stu-id="c5780-103">Chapter 6 - Azure RTOS FileX fault tolerant module</span></span>

<span data-ttu-id="c5780-104">Este capítulo contém uma descrição do Módulo Tolerante a Falhas de Falhas Azure RTOS FileX que foi concebido para manter a integridade do sistema de ficheiros se os meios de comunicação perderem energia ou forem ejetados no meio de uma operação de escrita de ficheiros.</span><span class="sxs-lookup"><span data-stu-id="c5780-104">This chapter contains a description of the Azure RTOS FileX Fault Tolerant Module that is designed to maintain file system integrity if the media loses power or is ejected in the middle of a file write operation.</span></span>

## <a name="filex-fault-tolerant-module-overview"></a><span data-ttu-id="c5780-105">Visão geral do módulo tolerante com falhas de filex</span><span class="sxs-lookup"><span data-stu-id="c5780-105">FileX Fault Tolerant Module Overview</span></span>

<span data-ttu-id="c5780-106">Quando uma aplicação escreve dados num ficheiro, o FileX atualiza os clusters de dados e as informações do sistema.</span><span class="sxs-lookup"><span data-stu-id="c5780-106">When an application writes data into a file, FileX updates both data clusters and system information.</span></span> <span data-ttu-id="c5780-107">Estas atualizações devem ser concluídas como uma operação atómica para manter a informação no sistema de ficheiros coerente.</span><span class="sxs-lookup"><span data-stu-id="c5780-107">These updates must be completed as an atomic operation to keep information in the file system coherent.</span></span> <span data-ttu-id="c5780-108">Por exemplo, ao anexar dados a um ficheiro, o FileX precisa de encontrar um cluster disponível nos meios de comunicação, atualizar a cadeia FAT, atualizar o comprimento arquivado na entrada do diretório e, possivelmente, atualizar o número de agrupamento inicial na entrada do diretório.</span><span class="sxs-lookup"><span data-stu-id="c5780-108">For example, when appending data to a file, FileX needs to find an available cluster in the media, update the FAT chain, update the length filed in the directory entry, and possibly update the starting cluster number in the directory entry.</span></span> <span data-ttu-id="c5780-109">Uma falha de energia ou uma ejeção mediática podem interromper a sequência de atualizações, o que deixará o sistema de ficheiros num estado inconsistente.</span><span class="sxs-lookup"><span data-stu-id="c5780-109">Either a power failure or media ejection can interrupt the sequence of updates, which will leave the file system in an inconsistent state.</span></span> <span data-ttu-id="c5780-110">Se o estado inconsistente não for corrigido, os dados que estão a ser atualizados podem ser perdidos e, devido a danos nas informações do sistema, a operação subsequente do sistema de ficheiros pode danificar outros ficheiros ou diretórios nos meios de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c5780-110">If the inconsistent state is not corrected, the data being updated can be lost, and because of damage to the system information, subsequent file system operation may damage other files or directories on the media.</span></span>

<span data-ttu-id="c5780-111">O Módulo Tolerante a Falhas FileX funciona através de etapas de diário necessárias para atualizar um ficheiro *antes* de estes passos serem aplicados no sistema de ficheiros.</span><span class="sxs-lookup"><span data-stu-id="c5780-111">The FileX Fault Tolerant Module works by journaling steps required to update a file *before* these steps are applied to the file system.</span></span> <span data-ttu-id="c5780-112">Se a atualização do ficheiro for bem sucedida, estas entradas de registo serão removidas.</span><span class="sxs-lookup"><span data-stu-id="c5780-112">If the file update is successful, these log entries are removed.</span></span> <span data-ttu-id="c5780-113">No entanto, se a atualização do ficheiro for interrompida, as entradas de registo são armazenadas no meio de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c5780-113">However, if the file update is interrupted, the log entries are stored on the media.</span></span> <span data-ttu-id="c5780-114">Da próxima vez que o suporte é montado, o FileX deteta estas entradas de registo da operação de escrita anterior (inacabada).</span><span class="sxs-lookup"><span data-stu-id="c5780-114">Next time the media is mounted, FileX detects these log entries from the previous (unfinished) write operation.</span></span> <span data-ttu-id="c5780-115">Nesses casos, o FileX pode recuperar de uma falha, revendo as alterações já efetuadas no sistema de ficheiros, quer recandidatando as alterações necessárias para completar a operação anterior.</span><span class="sxs-lookup"><span data-stu-id="c5780-115">In such cases, FileX can recover from a failure by either rolling back the changes already made to the file system, or by reapplying the required changes to complete the previous operation.</span></span> <span data-ttu-id="c5780-116">Desta forma, o Módulo Tolerante a Falhas FileX mantém a integridade do sistema de ficheiros se os meios de comunicação perderem energia durante uma operação de atualização.</span><span class="sxs-lookup"><span data-stu-id="c5780-116">In this way, the FileX Fault Tolerant Module maintains file system integrity if the media loses power during an update operation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5780-117">*O Módulo Tolerante com Falhas FileX não foi concebido para prevenir a corrupção do sistema de ficheiros causada por corrupção física dos meios de comunicação com dados válidos no mesmo.*</span><span class="sxs-lookup"><span data-stu-id="c5780-117">*The FileX Fault Tolerant Module is not designed to prevent file system corruption caused by physical media corruption with valid data in it.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5780-118">*Depois de o módulo tolerante a falhas FileX proteger um suporte, os meios de comunicação não devem ser montados por outra coisa que não o FileX com o Tolerante de Falha ativado. Ao fazê-lo, as entradas de registo no sistema de ficheiros são inconsistentes com as informações do sistema nos meios de comunicação. Se o módulo tolerante a falhas FileX tentar processar as entradas de registo após a atualização do sistema de ficheiros por outro sistema de ficheiros, o procedimento de recuperação poderá falhar, deixando todo o sistema de ficheiros num estado imprevisível.*</span><span class="sxs-lookup"><span data-stu-id="c5780-118">*After the FileX Fault Tolerant module protects a media, the media must not be mounted by anything other than FileX with Fault Tolerant enabled. Doing so can cause the log entries in the file system to be inconsistent with system information on the media. If the FileX Fault Tolerant module attempts to process log entries after the media is updated by another file system, the recovery procedure may fail, leaving the entire file system in an unpredictable state.*</span></span>

## <a name="use-of-the-fault-tolerant-module"></a><span data-ttu-id="c5780-119">Utilização do Módulo Tolerante a Falhas</span><span class="sxs-lookup"><span data-stu-id="c5780-119">Use of the Fault Tolerant Module</span></span>

<span data-ttu-id="c5780-120">A função FileX Fault Tolerant está disponível para todos os sistemas de ficheiros FAT suportados pelo FileX, incluindo FAT12, FAT16, FAT32 e exFAT.</span><span class="sxs-lookup"><span data-stu-id="c5780-120">The FileX Fault Tolerant feature is available to all FAT file systems supported by FileX, including FAT12, FAT16, FAT32, and exFAT.</span></span> <span data-ttu-id="c5780-121">Para ativar a função tolerante a falhas, o FileX deve ser construído com o símbolo **FX_ENABLE_FAULT_TOLERANT** definido.</span><span class="sxs-lookup"><span data-stu-id="c5780-121">To enable the fault tolerant feature, FileX must be built with the symbol **FX_ENABLE_FAULT_TOLERANT** defined.</span></span> <span data-ttu-id="c5780-122">Na hora de execução, a aplicação inicia o serviço tolerante a falhas, ligando **_para fx_fault_tolerant_enable_*_ imediatamente após a chamada para _*_fx_media_open_**.</span><span class="sxs-lookup"><span data-stu-id="c5780-122">At run time, application starts fault tolerant service by calling **_fx_fault_tolerant_enable_*_ immediately after the call to _*_fx_media_open_**.</span></span> <span data-ttu-id="c5780-123">Após a ativação do tolerante a falhas, todas as operações de escrita de ficheiros para os meios designados estão protegidas.</span><span class="sxs-lookup"><span data-stu-id="c5780-123">After fault tolerant is enabled, all file write operations to the designated media are protected.</span></span> <span data-ttu-id="c5780-124">Por predefinição, o módulo tolerante a falhas não está ativado.</span><span class="sxs-lookup"><span data-stu-id="c5780-124">By default the fault tolerant module is not enabled.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5780-125">\*A aplicação tem de se certificar de que o sistema de ficheiros não está a ser acedido antes de \***fx_fault_tolerant_enable** _ ser chamado.</span><span class="sxs-lookup"><span data-stu-id="c5780-125">\*Application needs to make sure the file system is not being accessed prior to \***fx_fault_tolerant_enable** _ being called.</span></span> <span data-ttu-id="c5780-126">Se a aplicação escrever dados para o sistema de ficheiros antes de permitir a ativação tolerante a falhas, a operação de escrita poderá corromper os meios de comunicação se as operações de escrita prévia não forem concluídas e o sistema de ficheiros não tiver sido restaurado utilizando registo tolerante a falhas entries._</span><span class="sxs-lookup"><span data-stu-id="c5780-126">If application writes data to the file system prior to fault tolerant enable, the write operation could corrupt the media if prior write operations were not completed, and the file system was not restored using fault tolerant log entries._</span></span>

## <a name="filex-fault-tolerant-module-log"></a><span data-ttu-id="c5780-127">Registo do módulo tolerante com falhas de FicheiroX</span><span class="sxs-lookup"><span data-stu-id="c5780-127">FileX Fault Tolerant Module Log</span></span>

<span data-ttu-id="c5780-128">O registo tolerante a falhas filex ocupa um aglomerado lógico em flash.</span><span class="sxs-lookup"><span data-stu-id="c5780-128">The FileX fault tolerant log takes up one logical cluster in flash.</span></span> <span data-ttu-id="c5780-129">O índice para o número inicial do cluster desse cluster é registado no sector das arranques dos meios de comunicação social, com uma compensação especificada pelo símbolo **FX_FAULT_TOLERANT_BOOT_INDEX**.</span><span class="sxs-lookup"><span data-stu-id="c5780-129">The index to the starting cluster number of that cluster is recorded in the boot sector of the media, with an offset specified by the symbol **FX_FAULT_TOLERANT_BOOT_INDEX**.</span></span> <span data-ttu-id="c5780-130">Por predefinição, este símbolo é definido como sendo 116.</span><span class="sxs-lookup"><span data-stu-id="c5780-130">By default this symbol is defined to be 116.</span></span> <span data-ttu-id="c5780-131">Esta localização é escolhida porque está marcada como reservada na especificação FAT12/ 16/32 e exFAT.</span><span class="sxs-lookup"><span data-stu-id="c5780-131">This location is chosen because it is marked as reserved in FAT12/ 16/32 and exFAT specification.</span></span>

<span data-ttu-id="c5780-132">A figura 5, "Log Structure Layout", mostra o layout geral da estrutura do tronco.</span><span class="sxs-lookup"><span data-stu-id="c5780-132">Figure 5, "Log Structure Layout," shows the general layout of the log structure.</span></span> <span data-ttu-id="c5780-133">A estrutura de registo contém três secções: Cabeçalho de Registo, Corrente FAT e Entradas de Registo.</span><span class="sxs-lookup"><span data-stu-id="c5780-133">The log structure contains three sections: Log Header, FAT Chain, and Log Entries.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5780-134">*Todos os valores de vários bytes armazenados nas entradas de registo estão no formato Little Endian.*</span><span class="sxs-lookup"><span data-stu-id="c5780-134">*All multi-byte values stored in the log entries are in Little Endian format.*</span></span>

![Layout da estrutura de registo](./media/user-guide/log-structure-layout.png)

<span data-ttu-id="c5780-136">**Figura 5. Layout da estrutura de registo**</span><span class="sxs-lookup"><span data-stu-id="c5780-136">**Figure 5. Log Structure Layout**</span></span>

<span data-ttu-id="c5780-137">A área do cabeçalho de registo contém informações que descrevem toda a estrutura do registo e explica cada campo em detalhe.</span><span class="sxs-lookup"><span data-stu-id="c5780-137">The Log Header area contains information that describes the entire log structure and explains each field in detail.</span></span>

<span data-ttu-id="c5780-138">**MESA 8. Área do cabeçalho de registo**</span><span class="sxs-lookup"><span data-stu-id="c5780-138">**TABLE 8. Log Header Area**</span></span>

|<span data-ttu-id="c5780-139">Campo</span><span class="sxs-lookup"><span data-stu-id="c5780-139">Field</span></span>|<span data-ttu-id="c5780-140">Tamanho (in bytes)</span><span class="sxs-lookup"><span data-stu-id="c5780-140">Size(in bytes)</span></span>|<span data-ttu-id="c5780-141">Description</span><span class="sxs-lookup"><span data-stu-id="c5780-141">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="c5780-142">ID</span><span class="sxs-lookup"><span data-stu-id="c5780-142">ID</span></span>|<span data-ttu-id="c5780-143">4</span><span class="sxs-lookup"><span data-stu-id="c5780-143">4</span></span>|<span data-ttu-id="c5780-144">Identifica uma estrutura de registo tolerante a falha de FicheiroX.</span><span class="sxs-lookup"><span data-stu-id="c5780-144">Identifies a FileX Fault Tolerant Log structure.</span></span> <span data-ttu-id="c5780-145">A estrutura de registo é considerada inválida se o valor de ID não for 0x46544C52.</span><span class="sxs-lookup"><span data-stu-id="c5780-145">The log structure is considered invalid if the ID value is not 0x46544C52.</span></span>|
|<span data-ttu-id="c5780-146">Tamanho total</span><span class="sxs-lookup"><span data-stu-id="c5780-146">Total Size</span></span>|<span data-ttu-id="c5780-147">2</span><span class="sxs-lookup"><span data-stu-id="c5780-147">2</span></span>|<span data-ttu-id="c5780-148">Indica o tamanho total (em bytes) de toda a estrutura de log.</span><span class="sxs-lookup"><span data-stu-id="c5780-148">Indicates the total size (in bytes) of the entire log structure.</span></span>|
|<span data-ttu-id="c5780-149">Checkum de cabeçalho</span><span class="sxs-lookup"><span data-stu-id="c5780-149">Header Checksum</span></span>|<span data-ttu-id="c5780-150">2</span><span class="sxs-lookup"><span data-stu-id="c5780-150">2</span></span>|<span data-ttu-id="c5780-151">Checksum que converte a área do cabeçalho de registo.</span><span class="sxs-lookup"><span data-stu-id="c5780-151">Checksum that converts the log header area.</span></span> <span data-ttu-id="c5780-152">A estrutura de registo é considerada inválida se os campos do cabeçalho falharem na verificação da conta.</span><span class="sxs-lookup"><span data-stu-id="c5780-152">The log structure is considered invalid if the header fields fail the checksum verification.</span></span>|
|<span data-ttu-id="c5780-153">Número da Versão</span><span class="sxs-lookup"><span data-stu-id="c5780-153">Version Number</span></span>|<span data-ttu-id="c5780-154">2</span><span class="sxs-lookup"><span data-stu-id="c5780-154">2</span></span>|<span data-ttu-id="c5780-155">Números de versão tolerantes a falhas filex e menores.</span><span class="sxs-lookup"><span data-stu-id="c5780-155">FileX Fault Tolerant major and minor version numbers.</span></span>|
|<span data-ttu-id="c5780-156">Reservado</span><span class="sxs-lookup"><span data-stu-id="c5780-156">Reserved</span></span>|<span data-ttu-id="c5780-157">2</span><span class="sxs-lookup"><span data-stu-id="c5780-157">2</span></span>|<span data-ttu-id="c5780-158">Para a expansão futura.</span><span class="sxs-lookup"><span data-stu-id="c5780-158">For future expansion.</span></span>|

<span data-ttu-id="c5780-159">A área do cabeçalho de log é seguida pela área de log de corrente FAT.</span><span class="sxs-lookup"><span data-stu-id="c5780-159">The Log Header area is followed by the FAT Chain Log area.</span></span> <span data-ttu-id="c5780-160">A figura 9 contém informações que descrevem como a cadeia FAT deve ser modificada.</span><span class="sxs-lookup"><span data-stu-id="c5780-160">Figure 9 contains information that describes how the FAT chain should be modified.</span></span> <span data-ttu-id="c5780-161">Esta área de registo contém informações sobre os clusters que estão a ser atribuídos a um ficheiro, os clusters a serem removidos de um ficheiro, e onde deve ser a inserção/eliminação e descreve cada campo na área do Registo de Corrente FAT.</span><span class="sxs-lookup"><span data-stu-id="c5780-161">This log area contains information on the clusters being allocated to a file, the clusters being removed from a file, and where the insertion/deletion should be and describes each field in the FAT Chain Log area.</span></span>

<span data-ttu-id="c5780-162">**MESA 9. Área de log de cadeia de gordura**</span><span class="sxs-lookup"><span data-stu-id="c5780-162">**TABLE 9. FAT Chain Log Area**</span></span>

|<span data-ttu-id="c5780-163">Campo</span><span class="sxs-lookup"><span data-stu-id="c5780-163">Field</span></span>|<span data-ttu-id="c5780-164">Tamanho (in bytes)</span><span class="sxs-lookup"><span data-stu-id="c5780-164">Size(in bytes)</span></span>|<span data-ttu-id="c5780-165">Descrição</span><span class="sxs-lookup"><span data-stu-id="c5780-165">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="c5780-166">Cheques de registo de cadeia de gordura</span><span class="sxs-lookup"><span data-stu-id="c5780-166">FAT Chain Log Checksum</span></span>|<span data-ttu-id="c5780-167">2</span><span class="sxs-lookup"><span data-stu-id="c5780-167">2</span></span>|<span data-ttu-id="c5780-168">Checkum de toda a área de log de corrente fat.</span><span class="sxs-lookup"><span data-stu-id="c5780-168">Checksum of the entire FAT Chain Log area.</span></span> <span data-ttu-id="c5780-169">A área de Log de corrente FAT é considerada inválida se falhar na verificação da parte de verificação.</span><span class="sxs-lookup"><span data-stu-id="c5780-169">The FAT Chain Log area is considered invalid if the it fails the checksum verification.</span></span>|
|<span data-ttu-id="c5780-170">Sinalizador</span><span class="sxs-lookup"><span data-stu-id="c5780-170">Flag</span></span>|<span data-ttu-id="c5780-171">1</span><span class="sxs-lookup"><span data-stu-id="c5780-171">1</span></span>|<span data-ttu-id="c5780-172">Os valores de bandeira válidos são:</span><span class="sxs-lookup"><span data-stu-id="c5780-172">Valid flag values are:</span></span><br/><span data-ttu-id="c5780-173">cadeia fat 0x01 válida</span><span class="sxs-lookup"><span data-stu-id="c5780-173">0x01 FAT Chain Valid</span></span><br /><span data-ttu-id="c5780-174">0x02 BITMAP está a ser usado</span><span class="sxs-lookup"><span data-stu-id="c5780-174">0x02 BITMAP is being used</span></span>|
|<span data-ttu-id="c5780-175">Reservado</span><span class="sxs-lookup"><span data-stu-id="c5780-175">Reserved</span></span>|<span data-ttu-id="c5780-176">1</span><span class="sxs-lookup"><span data-stu-id="c5780-176">1</span></span>|<span data-ttu-id="c5780-177">Reservado para uso futuro</span><span class="sxs-lookup"><span data-stu-id="c5780-177">Reserved for future use</span></span>|
|<span data-ttu-id="c5780-178">Ponto de inserção – Frente</span><span class="sxs-lookup"><span data-stu-id="c5780-178">Insertion Point – Front</span></span>|<span data-ttu-id="c5780-179">4</span><span class="sxs-lookup"><span data-stu-id="c5780-179">4</span></span>|<span data-ttu-id="c5780-180">O cluster (que pertence à cadeia fat original) onde a cadeia recém-criada vai ser anexada.</span><span class="sxs-lookup"><span data-stu-id="c5780-180">The cluster (that belongs to the original FAT chain) where the newly created chain is going to be attached to.</span></span>|
|<span data-ttu-id="c5780-181">Aglomerado de cabeça da nova cadeia fat</span><span class="sxs-lookup"><span data-stu-id="c5780-181">Head Cluster of New FAT Chain</span></span>|<span data-ttu-id="c5780-182">4</span><span class="sxs-lookup"><span data-stu-id="c5780-182">4</span></span>|<span data-ttu-id="c5780-183">O primeiro aglomerado da recém-criada Cadeia FAT</span><span class="sxs-lookup"><span data-stu-id="c5780-183">The first cluster of the newly created FAT Chain</span></span>|
|<span data-ttu-id="c5780-184">Aglomerado de cabeça da cadeia de gordura original</span><span class="sxs-lookup"><span data-stu-id="c5780-184">Head Cluster of Original FAT Chain</span></span>|<span data-ttu-id="c5780-185">4</span><span class="sxs-lookup"><span data-stu-id="c5780-185">4</span></span>|<span data-ttu-id="c5780-186">O primeiro aglomerado da parte da cadeia fat original que deve ser removido.</span><span class="sxs-lookup"><span data-stu-id="c5780-186">The first cluster of the portion of the original FAT Chain that is to be removed.</span></span>|
|<span data-ttu-id="c5780-187">Ponto de inserção – Volta</span><span class="sxs-lookup"><span data-stu-id="c5780-187">Insertion Point – Back</span></span>|<span data-ttu-id="c5780-188">4</span><span class="sxs-lookup"><span data-stu-id="c5780-188">4</span></span>|<span data-ttu-id="c5780-189">O cluster original onde a recém-criada cadeia FAT se junta.</span><span class="sxs-lookup"><span data-stu-id="c5780-189">The original cluster where the newly created FAT chain joins at.</span></span>|
|<span data-ttu-id="c5780-190">Próximo ponto de eliminação</span><span class="sxs-lookup"><span data-stu-id="c5780-190">Next Deletion Point</span></span>|<span data-ttu-id="c5780-191">4</span><span class="sxs-lookup"><span data-stu-id="c5780-191">4</span></span>|<span data-ttu-id="c5780-192">Este campo ajuda o procedimento de limpeza da cadeia FAT.</span><span class="sxs-lookup"><span data-stu-id="c5780-192">This field assists the FAT chain cleanup procedure.</span></span>|

<span data-ttu-id="c5780-193">A Área de Entradas de Registo contém entradas de registo que descrevem as alterações necessárias para recuperar de uma falha.</span><span class="sxs-lookup"><span data-stu-id="c5780-193">The Log Entries Area contains log entries that describe the changes needed to recover from a failure.</span></span> <span data-ttu-id="c5780-194">Existem três tipos de entrada de registo suportados no módulo tolerante a falhas FileX: ENTRADA DE Registo DE GORDURA; Entrada de Registo de Diretório; e Entrada de Registo bitmap.</span><span class="sxs-lookup"><span data-stu-id="c5780-194">There are three types of log entry supported in the FileX fault tolerant module: FAT Log Entry; Directory Log Entry; and Bitmap Log Entry.</span></span>

<span data-ttu-id="c5780-195">As três figuras e três tabelas seguintes descrevem estas entradas de registo em detalhe.</span><span class="sxs-lookup"><span data-stu-id="c5780-195">The following three figures and three tables describe these log entries in detail.</span></span>

![Entrada de registo fat](./media/user-guide/fat-log-entry.png)

<span data-ttu-id="c5780-197">**Figura 6. Entrada de registo fat**</span><span class="sxs-lookup"><span data-stu-id="c5780-197">**Figure 6. FAT Log Entry**</span></span>

<span data-ttu-id="c5780-198">**MESA 10. Entrada de registo fat**</span><span class="sxs-lookup"><span data-stu-id="c5780-198">**TABLE 10. FAT Log Entry**</span></span>

|<span data-ttu-id="c5780-199">Campo</span><span class="sxs-lookup"><span data-stu-id="c5780-199">Field</span></span>|<span data-ttu-id="c5780-200">Tamanho (in bytes)</span><span class="sxs-lookup"><span data-stu-id="c5780-200">Size(in bytes)</span></span>|<span data-ttu-id="c5780-201">Descrição</span><span class="sxs-lookup"><span data-stu-id="c5780-201">Description</span></span>|
|-----|--------------|-----------|
<span data-ttu-id="c5780-202">Tipo</span><span class="sxs-lookup"><span data-stu-id="c5780-202">Type</span></span>|<span data-ttu-id="c5780-203">2</span><span class="sxs-lookup"><span data-stu-id="c5780-203">2</span></span>|<span data-ttu-id="c5780-204">Tipo de Entrada, deve ser FX_FAULT_TOLERANT_FAT_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="c5780-204">Type of Entry, must be FX_FAULT_TOLERANT_FAT_LOG_TYPE</span></span>|
|<span data-ttu-id="c5780-205">Tamanho</span><span class="sxs-lookup"><span data-stu-id="c5780-205">Size</span></span>|<span data-ttu-id="c5780-206">2</span><span class="sxs-lookup"><span data-stu-id="c5780-206">2</span></span>|<span data-ttu-id="c5780-207">Tamanho desta entrada</span><span class="sxs-lookup"><span data-stu-id="c5780-207">Size of this entry</span></span>|
|<span data-ttu-id="c5780-208">Número de cluster</span><span class="sxs-lookup"><span data-stu-id="c5780-208">Cluster Number</span></span>|<span data-ttu-id="c5780-209">4</span><span class="sxs-lookup"><span data-stu-id="c5780-209">4</span></span>|<span data-ttu-id="c5780-210">Número de cluster</span><span class="sxs-lookup"><span data-stu-id="c5780-210">Cluster number</span></span>|
|<span data-ttu-id="c5780-211">Valor</span><span class="sxs-lookup"><span data-stu-id="c5780-211">Value</span></span>|<span data-ttu-id="c5780-212">4</span><span class="sxs-lookup"><span data-stu-id="c5780-212">4</span></span>|<span data-ttu-id="c5780-213">Valor a ser escrito na entrada FAT</span><span class="sxs-lookup"><span data-stu-id="c5780-213">Value to be written into the FAT entry</span></span>|

![Entrada de registo de diretório](./media/user-guide/directory-log-entry.png)

<span data-ttu-id="c5780-215">**Figura 7. Entrada de registo de diretório**</span><span class="sxs-lookup"><span data-stu-id="c5780-215">**Figure 7. Directory Log Entry**</span></span>

<span data-ttu-id="c5780-216">**MESA 11. Entrada de registo de diretório**</span><span class="sxs-lookup"><span data-stu-id="c5780-216">**TABLE 11. Directory Log Entry**</span></span>

|<span data-ttu-id="c5780-217">Campo</span><span class="sxs-lookup"><span data-stu-id="c5780-217">Field</span></span>|<span data-ttu-id="c5780-218">Tamanho (in bytes)</span><span class="sxs-lookup"><span data-stu-id="c5780-218">Size(in bytes)</span></span>|<span data-ttu-id="c5780-219">Descrição</span><span class="sxs-lookup"><span data-stu-id="c5780-219">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="c5780-220">Tipo</span><span class="sxs-lookup"><span data-stu-id="c5780-220">Type</span></span>|<span data-ttu-id="c5780-221">2</span><span class="sxs-lookup"><span data-stu-id="c5780-221">2</span></span>|<span data-ttu-id="c5780-222">Tipo de Entrada, deve ser FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="c5780-222">Type of Entry, must be FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span></span>|
|<span data-ttu-id="c5780-223">Tamanho</span><span class="sxs-lookup"><span data-stu-id="c5780-223">Size</span></span>|<span data-ttu-id="c5780-224">2</span><span class="sxs-lookup"><span data-stu-id="c5780-224">2</span></span>|<span data-ttu-id="c5780-225">Tamanho desta entrada</span><span class="sxs-lookup"><span data-stu-id="c5780-225">Size of this entry</span></span>|
|<span data-ttu-id="c5780-226">Compensação do Sector</span><span class="sxs-lookup"><span data-stu-id="c5780-226">Sector Offset</span></span>|<span data-ttu-id="c5780-227">4</span><span class="sxs-lookup"><span data-stu-id="c5780-227">4</span></span>|<span data-ttu-id="c5780-228">Offset (in bytes) no sector onde este diretório está localizado.</span><span class="sxs-lookup"><span data-stu-id="c5780-228">Offset (in bytes) into the sector where this directory is located.</span></span>|
|<span data-ttu-id="c5780-229">Setor de Registos</span><span class="sxs-lookup"><span data-stu-id="c5780-229">Log Sector</span></span>|<span data-ttu-id="c5780-230">4</span><span class="sxs-lookup"><span data-stu-id="c5780-230">4</span></span>|<span data-ttu-id="c5780-231">O sector onde se situa a entrada no diretório</span><span class="sxs-lookup"><span data-stu-id="c5780-231">The sector where the directory entry is located</span></span>|
|<span data-ttu-id="c5780-232">Dados de Registo</span><span class="sxs-lookup"><span data-stu-id="c5780-232">Log Data</span></span>|<span data-ttu-id="c5780-233">Variável</span><span class="sxs-lookup"><span data-stu-id="c5780-233">Variable</span></span>|<span data-ttu-id="c5780-234">Conteúdo da entrada no diretório</span><span class="sxs-lookup"><span data-stu-id="c5780-234">Content of the directory entry</span></span>|

![Entrada de registo bitmap](./media/user-guide/bitmap-log-entry.png)

<span data-ttu-id="c5780-236">**Figura 8. Entrada de registo bitmap**</span><span class="sxs-lookup"><span data-stu-id="c5780-236">**Figure 8. Bitmap Log Entry**</span></span>

<span data-ttu-id="c5780-237">**MESA 12. Entrada de registo bitmap**</span><span class="sxs-lookup"><span data-stu-id="c5780-237">**TABLE 12. Bitmap Log Entry**</span></span>

|<span data-ttu-id="c5780-238">Campo</span><span class="sxs-lookup"><span data-stu-id="c5780-238">Field</span></span>|<span data-ttu-id="c5780-239">Tamanho (in bytes)</span><span class="sxs-lookup"><span data-stu-id="c5780-239">Size(in bytes)</span></span>|<span data-ttu-id="c5780-240">Descrição</span><span class="sxs-lookup"><span data-stu-id="c5780-240">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="c5780-241">Tipo</span><span class="sxs-lookup"><span data-stu-id="c5780-241">Type</span></span>|<span data-ttu-id="c5780-242">2</span><span class="sxs-lookup"><span data-stu-id="c5780-242">2</span></span>|<span data-ttu-id="c5780-243">Tipo de Entrada, deve ser FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="c5780-243">Type of Entry, must be FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span></span>|
|<span data-ttu-id="c5780-244">Tamanho</span><span class="sxs-lookup"><span data-stu-id="c5780-244">Size</span></span>|<span data-ttu-id="c5780-245">2</span><span class="sxs-lookup"><span data-stu-id="c5780-245">2</span></span>|<span data-ttu-id="c5780-246">Tamanho desta entrada</span><span class="sxs-lookup"><span data-stu-id="c5780-246">Size of this entry</span></span>|
|<span data-ttu-id="c5780-247">Número de cluster</span><span class="sxs-lookup"><span data-stu-id="c5780-247">Cluster Number</span></span>|<span data-ttu-id="c5780-248">4</span><span class="sxs-lookup"><span data-stu-id="c5780-248">4</span></span>|<span data-ttu-id="c5780-249">Número de cluster</span><span class="sxs-lookup"><span data-stu-id="c5780-249">Cluster number</span></span>|
|<span data-ttu-id="c5780-250">Valor</span><span class="sxs-lookup"><span data-stu-id="c5780-250">Value</span></span>|<span data-ttu-id="c5780-251">4</span><span class="sxs-lookup"><span data-stu-id="c5780-251">4</span></span>|<span data-ttu-id="c5780-252">Valor a ser escrito na entrada FAT</span><span class="sxs-lookup"><span data-stu-id="c5780-252">Value to be written into the FAT entry</span></span>|

## <a name="fault-tolerant-protection"></a><span data-ttu-id="c5780-253">Proteção tolerante a falhas</span><span class="sxs-lookup"><span data-stu-id="c5780-253">Fault Tolerant Protection</span></span>

<span data-ttu-id="c5780-254">Após o início do Módulo Tolerante a Falhas FileX, procura pela primeira vez um ficheiro de registo tolerante a falhas existente nos meios de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c5780-254">After the FileX Fault Tolerant Module starts, it first searches for an existing fault tolerant log file in the media.</span></span> <span data-ttu-id="c5780-255">Se não for possível encontrar um ficheiro de registo válido, o FileX considera os meios de comunicação desprotegidos.</span><span class="sxs-lookup"><span data-stu-id="c5780-255">If a valid log file cannot be found, FileX considers the media unprotected.</span></span> <span data-ttu-id="c5780-256">Neste caso, o FileX criará um ficheiro de registo tolerante a falhas nos meios de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c5780-256">In this case FileX will create a fault tolerant log file on the media.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5780-257">\*O FileX não é capaz de proteger um sistema de ficheiros se foi corrompido antes do módulo tolerante de falha FileX começar.</span><span class="sxs-lookup"><span data-stu-id="c5780-257">\*FileX is not able to protect a file system if it was corrupted before the FileX Fault Tolerant Module starts.</span></span> *

<span data-ttu-id="c5780-258">Se estiver localizado um ficheiro de registo tolerante a falhas, o FileX verifica as entradas de registo existentes.</span><span class="sxs-lookup"><span data-stu-id="c5780-258">If a fault tolerant log file is located, FileX checks for existing log entries.</span></span> <span data-ttu-id="c5780-259">Um ficheiro de registo sem entrada de registo indica que a operação de ficheiro prévia foi bem sucedida e todas as entradas de registo foram removidas.</span><span class="sxs-lookup"><span data-stu-id="c5780-259">A log file with no log entry indicates prior file operation was successful, and all log entries were removed.</span></span> <span data-ttu-id="c5780-260">Neste caso, a aplicação pode começar a utilizar o sistema de ficheiros com proteção tolerante a falhas.</span><span class="sxs-lookup"><span data-stu-id="c5780-260">In this case the application can start using the file system with fault tolerant protection.</span></span>

<span data-ttu-id="c5780-261">No entanto, se as entradas de registo estiverem localizadas, o FileX precisa de completar a operação de ficheiros anteriores ou reverter as alterações já aplicadas no sistema de ficheiros, desfazendo efetivamente as alterações.</span><span class="sxs-lookup"><span data-stu-id="c5780-261">However if log entries are located, FileX needs to either complete the prior file operation, or revert the changes already applied to the file system, effectively undo the changes.</span></span> <span data-ttu-id="c5780-262">Em qualquer dos casos, após a aplicação das entradas de registo no sistema de ficheiros, o sistema de ficheiros é restaurado num estado coerente, e a aplicação pode começar a utilizar novamente o sistema de ficheiros.</span><span class="sxs-lookup"><span data-stu-id="c5780-262">In either case, after the log entries are applied to the file system, the file system is restored into a coherent state, and application can start using the file system again.</span></span>

<span data-ttu-id="c5780-263">Para os meios de comunicação protegidos pelo FileX, durante a operação de atualização de ficheiros, a parte dos dados é escrita diretamente para os meios de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c5780-263">For media protected by FileX, during file update operation, the data portion is written directly to the media.</span></span> <span data-ttu-id="c5780-264">Como o FileX escreve dados, também regista quaisquer alterações necessárias para serem aplicadas às entradas de diretório, tabela FAT.</span><span class="sxs-lookup"><span data-stu-id="c5780-264">As FileX writes data, it also records any changes needed to be applied to directory entries, FAT table.</span></span> <span data-ttu-id="c5780-265">Esta informação está registada nas entradas de registo tolerantes ao ficheiro.</span><span class="sxs-lookup"><span data-stu-id="c5780-265">This information is recorded in the file tolerant log entries.</span></span> <span data-ttu-id="c5780-266">Esta abordagem garante que as atualizações para o sistema de ficheiros ocorrem após a escrita dos dados para os meios de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c5780-266">This approach guarantees that updates to the file system occur after the data is written to the media.</span></span> <span data-ttu-id="c5780-267">Se os meios de comunicação forem ejetados durante a fase de escrita de dados, as informações cruciais do sistema de ficheiros ainda não foram alteradas.</span><span class="sxs-lookup"><span data-stu-id="c5780-267">If the media is ejected during the data-write phase, crucial file system information has not been changed yet.</span></span> <span data-ttu-id="c5780-268">Portanto, o sistema de ficheiros não é afetado pela interrupção.</span><span class="sxs-lookup"><span data-stu-id="c5780-268">Therefore the file system is not affected by the interruption.</span></span>

<span data-ttu-id="c5780-269">Depois de todos os dados terem sido escritos com sucesso para os meios de comunicação, o FileX segue então as informações nas entradas de registo para aplicar as alterações à informação do sistema, uma entrada de cada vez.</span><span class="sxs-lookup"><span data-stu-id="c5780-269">After all the data is successfully written to the media, FileX then follows information in the log entries to applies the changes to system information, one entry at a time.</span></span> <span data-ttu-id="c5780-270">Depois de todas as informações do sistema serem comprometidas com os meios de comunicação, as entradas de registo são removidas do registo tolerante de avaria.</span><span class="sxs-lookup"><span data-stu-id="c5780-270">After all the system information is committed to the media, the log entries are removed from the fault tolerant log.</span></span> <span data-ttu-id="c5780-271">Neste ponto, o FileX completa a operação de atualização de ficheiros.</span><span class="sxs-lookup"><span data-stu-id="c5780-271">At this point, FileX completes the file update operation.</span></span>

<span data-ttu-id="c5780-272">Durante a operação de atualização de ficheiros, os ficheiros não são atualizados no local.</span><span class="sxs-lookup"><span data-stu-id="c5780-272">During file update operation, files are not updated in place.</span></span> <span data-ttu-id="c5780-273">O módulo tolerante a falhas atribui um sector para os dados para escrever os novos dados e, em seguida, remover o sector que contém os dados a serem substituídos, atualizando as entradas de FAT relacionadas para ligar o novo sector ao chian.</span><span class="sxs-lookup"><span data-stu-id="c5780-273">The fault tolerant module allocates a sector for the data to write the new data into, and then remove the sector that contains the data to be overwritten, updating related FAT entries to link the new sector into the chian.</span></span> <span data-ttu-id="c5780-274">Para situações em que os dados parciais num cluster precisam de ser modificados, o FileX atribui sempre novos clusters, escreve todos os dados dos antigos clusters com dados atualizados para os novos clusters e, em seguida, liberta os antigos clusters.</span><span class="sxs-lookup"><span data-stu-id="c5780-274">For situations in which partial data in a cluster needs to be modified, FileX always allocates new clusters, writes the entire data from the old clusters with updated data into the new clusters, then frees up the old clusters.</span></span> <span data-ttu-id="c5780-275">Isto garante que, se a atualização do ficheiro for interrompida, o ficheiro original está intacto.</span><span class="sxs-lookup"><span data-stu-id="c5780-275">This guarantees that if the file update is interrupted, the original file is intact.</span></span> <span data-ttu-id="c5780-276">A aplicação deve estar ciente de que, no âmbito da proteção tolerante a falhas do FileX, a atualização de dados num ficheiro requer que os meios de comunicação tenham espaço livre suficiente para reter novos dados antes de os setores com dados antigos poderem ser divulgados.</span><span class="sxs-lookup"><span data-stu-id="c5780-276">The application needs to be aware that under FileX fault tolerant protection, updating data in a file requires the media to have enough free space to hold new data before sectors with old data can be released.</span></span> <span data-ttu-id="c5780-277">Se os meios de comunicação não tiverem espaço suficiente para conter novos dados, a operação de atualização falha.</span><span class="sxs-lookup"><span data-stu-id="c5780-277">If the media doesn't have enough space to hold new data, the update operation fails.</span></span>
