---
title: Capítulo 3 - Componentes funcionais do Azure RTOS NetX
description: Este capítulo contém uma descrição da pilha Azure RTOS NetX TCP/IP de alto desempenho de uma perspetiva funcional.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: db23aa152b2765ac7cc9be098723fc5df0947484
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104826887"
---
# <a name="chapter-3---functional-components-of-azure-rtos-netx"></a><span data-ttu-id="daf05-103">Capítulo 3 - Componentes funcionais do Azure RTOS NetX</span><span class="sxs-lookup"><span data-stu-id="daf05-103">Chapter 3 - Functional Components of Azure RTOS NetX</span></span>

<span data-ttu-id="daf05-104">Este capítulo contém uma descrição da pilha Azure RTOS NetX TCP/IP de alto desempenho de uma perspetiva funcional.</span><span class="sxs-lookup"><span data-stu-id="daf05-104">This chapter contains a description of the high-performance Azure RTOS NetX TCP/IP stack from a functional perspective.</span></span> 

## <a name="execution-overview"></a><span data-ttu-id="daf05-105">Visão geral da execução</span><span class="sxs-lookup"><span data-stu-id="daf05-105">Execution Overview</span></span>

<span data-ttu-id="daf05-106">Existem cinco tipos de execução de programas dentro de uma aplicação NetX: inicialização, chamadas de interface de aplicação, fio IP interno, temporizadores periódicos IP e o controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-106">There are five types of program execution within a NetX application: initialization, application interface calls, internal IP thread, IP periodic timers, and the network driver.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-107">A NetX requer a instalação da ThreadX e depende da sua execução de fios, suspensão, temporizadores periódicos e instalações de exclusão mútua.</span><span class="sxs-lookup"><span data-stu-id="daf05-107">NetX requires the installation of ThreadX and depends on its thread execution, suspension, periodic timers, and mutual exclusion facilities.</span></span>

### <a name="initialization"></a><span data-ttu-id="daf05-108">Inicialização</span><span class="sxs-lookup"><span data-stu-id="daf05-108">Initialization</span></span>

<span data-ttu-id="daf05-109">O serviço \***nx_system_initialize** _ deve ser chamado antes de qualquer outro serviço NetX ser chamado.</span><span class="sxs-lookup"><span data-stu-id="daf05-109">The service \***nx_system_initialize** _ must be called before any other NetX service is called.</span></span> <span data-ttu-id="daf05-110">A inicialização do sistema pode ser chamada a partir da rotina ThreadX _ *_tx_application_define_*\* ou a partir de fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-110">System initialization can be called either from the ThreadX _ *_tx_application_define_*\* routine or from application threads.</span></span>

<span data-ttu-id="daf05-111">Depois de \***nx_system_initialize** _ devoluções, o sistema está pronto para criar pacotes de piscinas e instâncias IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-111">After \***nx_system_initialize** _ returns, the system is ready to create packet pools and IP instances.</span></span> <span data-ttu-id="daf05-112">Como a criação de uma instância IP requer um pacote de pacotes predefinidos, pelo menos um conjunto de pacotes NetX deve existir antes de criar uma instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-112">Because creating an IP instance requires a default packet pool, at least one NetX packet pool must exist prior to creating an IP instance.</span></span> <span data-ttu-id="daf05-113">A criação de piscinas de pacotes e instâncias IP são permitidas a partir da função de inicialização ThreadX _ *_tx_application_define_*\* e a partir de fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-113">Creating packet pools and IP instances are allowed from the ThreadX initialization function _ *_tx_application_define_*\* and from application threads.</span></span>

<span data-ttu-id="daf05-114">Internamente, a criação de um caso IP é realizada em duas partes.</span><span class="sxs-lookup"><span data-stu-id="daf05-114">Internally, creating an IP instance is accomplished in two parts.</span></span> <span data-ttu-id="daf05-115">A primeira parte é feita no contexto do chamador, quer a partir de ***tx_application_define*** quer do contexto de um fio de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-115">The first part is done within the context of the caller, either from ***tx_application_define*** or from an application thread's context.</span></span> <span data-ttu-id="daf05-116">Isto inclui a criação da estrutura de dados IP e a criação de vários recursos IP, incluindo o fio IP interno.</span><span class="sxs-lookup"><span data-stu-id="daf05-116">This includes setting up the IP data structure and creating various IP resources, including the internal IP thread.</span></span> <span data-ttu-id="daf05-117">A segunda parte é executada durante a execução inicial a partir do fio IP interno.</span><span class="sxs-lookup"><span data-stu-id="daf05-117">The second part is performed during the initial execution from the internal IP thread.</span></span> <span data-ttu-id="daf05-118">É aqui que o controlador de rede, fornecido durante a primeira parte da criação de IP, é chamado pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="daf05-118">This is where the network driver, supplied during the first part of IP creation, is first called.</span></span> <span data-ttu-id="daf05-119">A chamada do controlador de rede a partir da linha IP interna permite ao condutor efetuar E/S e suspender durante o processamento de inicialização.</span><span class="sxs-lookup"><span data-stu-id="daf05-119">Calling the network driver from the internal IP thread enables the driver to perform I/O and suspend during its initialization processing.</span></span> <span data-ttu-id="daf05-120">Quando o controlador de rede regressa do seu processamento de inicialização, a criação ip fica completa.</span><span class="sxs-lookup"><span data-stu-id="daf05-120">When the network driver returns from its initialization processing, the IP creation is complete.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-121">O **nx_ip_status_check** de serviço NetX está disponível para obter informações sobre a instância IP e o seu estado de interface primária.</span><span class="sxs-lookup"><span data-stu-id="daf05-121">The NetX service **nx_ip_status_check** is available to obtain information on the IP instance and its primary interface status.</span></span> <span data-ttu-id="daf05-122">Essas informações de estado incluem se o link é ou não inicializado, ativado e o endereço IP é resolvido.</span><span class="sxs-lookup"><span data-stu-id="daf05-122">Such status information includes whether or not the link is initialized, enabled, and IP address is resolved.</span></span> <span data-ttu-id="daf05-123">Estas informações são utilizadas para sincronizar os fios de aplicação que precisam de utilizar uma instância IP recém-criada.</span><span class="sxs-lookup"><span data-stu-id="daf05-123">This information is used to synchronize application threads needing to use a newly created IP instance.</span></span> <span data-ttu-id="daf05-124">Para sistemas multihomes, consulte "Multihome Support" abaixo.</span><span class="sxs-lookup"><span data-stu-id="daf05-124">For multihome systems, see "Multihome Support" below.</span></span> <span data-ttu-id="daf05-125">**nx_ip_interface_status_check** está disponível para obter informações sobre a interface especificada.</span><span class="sxs-lookup"><span data-stu-id="daf05-125">**nx_ip_interface_status_check** is available to obtain information on the specified interface.</span></span>

### <a name="application-interface-calls"></a><span data-ttu-id="daf05-126">Chamadas de Interface de Aplicação</span><span class="sxs-lookup"><span data-stu-id="daf05-126">Application Interface Calls</span></span>

<span data-ttu-id="daf05-127">As chamadas da aplicação são feitas em grande parte a partir de fios de aplicação que estão a ser geridos sob o ThreadX RTOS.</span><span class="sxs-lookup"><span data-stu-id="daf05-127">Calls from the application are largely made from application threads running under the ThreadX RTOS.</span></span> <span data-ttu-id="daf05-128">No entanto, algumas inicializaçãos, criar e permitir serviços podem ser chamados a partir de ***tx_application_define***.</span><span class="sxs-lookup"><span data-stu-id="daf05-128">However, some initialization, create, and enable services may be called from ***tx_application_define***.</span></span> <span data-ttu-id="daf05-129">As secções "Allowed From" do Capítulo 4 indicam a partir da qual cada serviço NetX pode ser chamado.</span><span class="sxs-lookup"><span data-stu-id="daf05-129">The "Allowed From" sections in Chapter 4 indicate from which each NetX service can be called.</span></span>

<span data-ttu-id="daf05-130">Na maior parte das vezes, o processamento de atividades intensivas, como as despesas de computação, é feito dentro do contexto do fio de chamada , sem bloquear o acesso de outros fios à instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-130">For the most part, processing intensive activities such as computing checksums is done within the calling thread's context—without blocking the access of other threads to the IP instance.</span></span> <span data-ttu-id="daf05-131">Por exemplo, na transmissão, o cálculo da UDP checksum é realizado dentro do serviço ***nx_udp_socket_send,*** antes de ligar para a função de envio IP subjacente.</span><span class="sxs-lookup"><span data-stu-id="daf05-131">For example, on transmission, the UDP checksum calculation is performed inside the ***nx_udp_socket_send*** service, prior to calling the underlying IP send function.</span></span> <span data-ttu-id="daf05-132">Num pacote recebido, a conta de verificação da UDP é calculada no serviço ***nx_udp_socket_receive,*** executado no contexto do fio de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-132">On a received packet, the UDP checksum is calculated in the ***nx_udp_socket_receive*** service, executed in the context of the application thread.</span></span> <span data-ttu-id="daf05-133">Isto ajuda a prevenir o bloqueio de pedidos de rede de fios de maior prioridade devido ao processamento de cálculo intensivo de checkum em fios de menor prioridade.</span><span class="sxs-lookup"><span data-stu-id="daf05-133">This helps prevent stalling network requests of higher-priority threads because of processing intensive checksum computation in lower-priority threads.</span></span>

<span data-ttu-id="daf05-134">Valores, como endereços IP e números de porta, são passados para funções API na ordem byte de anfitrião.</span><span class="sxs-lookup"><span data-stu-id="daf05-134">Values, such as IP addresses and port numbers, are passed to API functions in host byte order.</span></span> <span data-ttu-id="daf05-135">Internamente, estes valores também são armazenados na ordem byte de anfitrião.</span><span class="sxs-lookup"><span data-stu-id="daf05-135">Internally these values are stored in host byte order as well.</span></span> <span data-ttu-id="daf05-136">Isto permite que os desenvolvedores vejam facilmente os valores através de um depurar.</span><span class="sxs-lookup"><span data-stu-id="daf05-136">This enables developers to easily view the values via a debugger.</span></span> <span data-ttu-id="daf05-137">Quando estes valores são programados num quadro para transmissão, são convertidos para ordem byte de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-137">When these values are programmed into a frame for transmission, they are converted to network byte order.</span></span>

### <a name="internal-ip-thread"></a><span data-ttu-id="daf05-138">Fio IP interno</span><span class="sxs-lookup"><span data-stu-id="daf05-138">Internal IP Thread</span></span>

<span data-ttu-id="daf05-139">Como mencionado, cada instância IP no NetX tem o seu próprio fio.</span><span class="sxs-lookup"><span data-stu-id="daf05-139">As mentioned, each IP instance in NetX has its own thread.</span></span> <span data-ttu-id="daf05-140">A prioridade e o tamanho da pilha do fio IP interno é definido no serviço ***nx_ip_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-140">The priority and stack size of the internal IP thread is defined in the ***nx_ip_create*** service.</span></span> <span data-ttu-id="daf05-141">O fio IP interno é criado num modo pronto a executar.</span><span class="sxs-lookup"><span data-stu-id="daf05-141">The internal IP thread is created in a ready-to-execute mode.</span></span> <span data-ttu-id="daf05-142">Se o fio IP tiver uma prioridade maior do que o fio de chamada, a pré-substituição pode ocorrer dentro da chamada de criação IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-142">If the IP thread has a higher priority than the calling thread, preemption may occur inside the IP create call.</span></span>

<span data-ttu-id="daf05-143">O ponto de entrada do fio IP interno encontra-se na função interna ***_nx_ip_thread_entry***.</span><span class="sxs-lookup"><span data-stu-id="daf05-143">The entry point of the internal IP thread is at the internal function ***_nx_ip_thread_entry***.</span></span> <span data-ttu-id="daf05-144">Quando iniciado, o fio IP interno completa primeiro a inicialização do controlador de rede, que consiste em fazer três chamadas para o controlador de rede específico da aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-144">When started, the internal IP thread first completes network driver initialization, which consists of making three calls to the application-specific network driver.</span></span> <span data-ttu-id="daf05-145">A primeira chamada é anexar o controlador de rede à instância IP, seguida de uma chamada de inicialização, que permite ao controlador de rede passar pelo processo de inicialização.</span><span class="sxs-lookup"><span data-stu-id="daf05-145">The first call is to attach the network driver to the IP instance, followed by an initialization call, which allows the network driver to go through the initialization process.</span></span> <span data-ttu-id="daf05-146">Após o retorno do controlador de rede da inicialização (pode suspender-se enquanto aguarda a instalação correta do hardware), o fio IP interno volta a ligar para o controlador de rede para ativar a ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-146">After the network driver returns from initialization (it may suspend while waiting for the hardware to be properly set up), the internal IP thread calls the network driver again to enable the link.</span></span> 

<span data-ttu-id="daf05-147">Após a retorna do controlador de rede a partir da chamada de ativação de ligação, o fio IP interno introduz uma verificação interminável de loop para vários eventos que precisam de ser processados para esta instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-147">After the network driver returns from the link enable call, the internal IP thread enters an endless loop checking for various events that need processing for this IP instance.</span></span> <span data-ttu-id="daf05-148">Os eventos processados neste ciclo incluem receção de pacotes IP diferidos, montagem de fragmentos de pacote IP, processamento de ping ICMP, processamento de IGMP, processamento de fila de pacotes TCP, processamento periódico de TCP, intervalos de montagem de fragmentos IP e processamento periódico IGMP.</span><span class="sxs-lookup"><span data-stu-id="daf05-148">Events processed in this loop include deferred IP packet reception, IP packet fragment assembly, ICMP ping processing, IGMP processing, TCP packet queue processing, TCP periodic processing, IP fragment assembly timeouts, and IGMP periodic processing.</span></span> <span data-ttu-id="daf05-149">Os eventos incluem também atividades de resolução de endereços: processamento de pacotes ARP e processamento periódico ARP na rede IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-149">Events also include address resolution activities: ARP packet processing and ARP periodic processing in the IP network.</span></span>

> [!NOTE]
> <span data-ttu-id="daf05-150">*As funções de retorno NetX, incluindo chamadas de escuta e desconexão, são chamadas a partir do fio IP interno - e não do fio de chamada original. A aplicação deve ter o cuidado de não suspender dentro de qualquer função de retorno NetX.*</span><span class="sxs-lookup"><span data-stu-id="daf05-150">*The NetX callback functions, including listen and disconnect callbacks, are called from the internal IP thread—not the original calling thread. The application must take care not to suspend inside any NetX callback function.*</span></span>

### <a name="ip-periodic-timers"></a><span data-ttu-id="daf05-151">Temporizadores periódicos IP</span><span class="sxs-lookup"><span data-stu-id="daf05-151">IP Periodic Timers</span></span>
<span data-ttu-id="daf05-152">Existem dois temporizadores periódicos ThreadX utilizados para cada instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-152">There are two ThreadX periodic timers used for each IP instance.</span></span> <span data-ttu-id="daf05-153">O primeiro é um temporizador de um segundo para ARP, IGMP, TCP timeout, e também impulsiona o processamento de remontagem de fragmentos IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-153">The first one is a one-second timer for ARP, IGMP, TCP timeout, and it also drives IP fragment reassemble processing.</span></span> <span data-ttu-id="daf05-154">O segundo temporizador é um temporizador de 100ms para conduzir o tempo limite de retransmissão TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-154">The second timer is a 100ms timer to drive the TCP retransmission timeout.</span></span>

### <a name="network-driver"></a><span data-ttu-id="daf05-155">Controlador de rede</span><span class="sxs-lookup"><span data-stu-id="daf05-155">Network Driver</span></span>
<span data-ttu-id="daf05-156">Cada instância IP no NetX tem uma interface primária, que é identificada pelo seu controlador de dispositivos especificado no serviço ***nx_ip_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-156">Each IP instance in NetX has a primary interface, which is identified by its device driver specified in the ***nx_ip_create*** service.</span></span> <span data-ttu-id="daf05-157">O controlador da rede é responsável pelo tratamento de vários pedidos NetX, incluindo transmissão de pacotes, receção de pacotes e pedidos de estado e controlo.</span><span class="sxs-lookup"><span data-stu-id="daf05-157">The network driver is responsible for handling various NetX requests, including packet transmission, packet reception, and requests for status and control.</span></span>

<span data-ttu-id="daf05-158">Para um sistema multi-casa, a instância IP tem múltiplas interfaces, cada uma com um controlador de rede associado que executa estas tarefas para a respetiva interface.</span><span class="sxs-lookup"><span data-stu-id="daf05-158">For a multi-home system, the IP instance has multiple interfaces, each with an associated network driver that performs these tasks for the respective interface.</span></span>

<span data-ttu-id="daf05-159">O controlador da rede também deve lidar com eventos assíncronos que ocorrem nos meios de comunicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-159">The network driver must also handle asynchronous events occurring on the media.</span></span> <span data-ttu-id="daf05-160">Eventos assíncronos dos meios de comunicação incluem receção de pacotes, conclusão da transmissão de pacotes e alterações de estado.</span><span class="sxs-lookup"><span data-stu-id="daf05-160">Asynchronous events from the media include packet reception, packet transmission completion, and status changes.</span></span> <span data-ttu-id="daf05-161">A NetX fornece ao controlador de rede várias funções de acesso para lidar com vários eventos.</span><span class="sxs-lookup"><span data-stu-id="daf05-161">NetX provides the network driver with several access functions to handle various events.</span></span> <span data-ttu-id="daf05-162">Estas funções foram concebidas para serem chamadas a partir da parte de rotina de serviço de interrupção do controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-162">These functions are designed to be called from the interrupt service routine portion of the network driver.</span></span> <span data-ttu-id="daf05-163">Para as redes IP, o controlador de rede deve encaminhar todos os pacotes ARP recebidos para a função interna \***_nx_arp_packet_deferred_receive** _ .</span><span class="sxs-lookup"><span data-stu-id="daf05-163">For IP networks, the network driver should forward all ARP packets received to the \***_nx_arp_packet_deferred_receive** _ internal function.</span></span> <span data-ttu-id="daf05-164">Todos os pacotes RARP devem ser encaminhados para _ *_nx_rarp_packet_deferred_receive_* _ função interna.</span><span class="sxs-lookup"><span data-stu-id="daf05-164">All RARP packets should be forwarded to _ *_ _nx_rarp_packet_deferred_receive_* _ internal function.</span></span> <span data-ttu-id="daf05-165">Existem duas opções para pacotes IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-165">There are two options for IP packets.</span></span> <span data-ttu-id="daf05-166">Se for necessária uma expedição rápida dos pacotes IP, os pacotes IP de entrada devem ser encaminhados para _ *_nx_ip_packet_receive_* _ para processamento imediato.</span><span class="sxs-lookup"><span data-stu-id="daf05-166">If fast dispatch of IP packets is required, incoming IP packets should be forwarded to _ *_ _nx_ip_packet_receive_* _ for immediate processing.</span></span> <span data-ttu-id="daf05-167">Isto melhora consideravelmente o desempenho do NetX no manuseamento de pacotes IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-167">This greatly improves NetX performance in handling IP packets.</span></span> <span data-ttu-id="daf05-168">Caso contrário, o controlador de rede deve encaminhar os pacotes IP para _\*_ _nx_ip_packet_deferred_receive_\*\*.</span><span class="sxs-lookup"><span data-stu-id="daf05-168">Otherwise, the network driver should forward IP packets to _\*_ _nx_ip_packet_deferred_receive_\*\*.</span></span> <span data-ttu-id="daf05-169">Este serviço coloca o pacote IP na fila de processamento diferida, onde é depois manuseado pela linha IP interna, o que resulta na menor quantidade de tempo de processamento do ISR.</span><span class="sxs-lookup"><span data-stu-id="daf05-169">This service places the IP packet in the deferred processing queue where it is then handled by the internal IP thread, which results in the least amount of ISR processing time.</span></span>

<span data-ttu-id="daf05-170">O controlador de rede também pode adiar o processamento de interrupção para ficar sem o contexto do fio IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-170">The network driver can also defer interrupt processing to run out of the context of the IP thread.</span></span> <span data-ttu-id="daf05-171">Neste modo, o ISR deve guardar as informações necessárias, ligar para a função interna ***_nx_ip_driver_deferred_processing***, e reconhecer o controlador de interrupção.</span><span class="sxs-lookup"><span data-stu-id="daf05-171">In this mode, the ISR shall save the necessary information, call the internal function ***_nx_ip_driver_deferred_processing***, and acknowledge the interrupt controller.</span></span> <span data-ttu-id="daf05-172">Este serviço notifica a linha IP para agendar uma chamada ao controlador do dispositivo para completar o processamento do evento que causa a interrupção.</span><span class="sxs-lookup"><span data-stu-id="daf05-172">This service notifies IP thread to schedule a callback to the device driver to complete the processing of the event that causes the interrupt.</span></span>

<span data-ttu-id="daf05-173">Alguns controladores de rede são capazes de executar a computação e validação de checkum de cabeçalho TCP/IP em hardware, sem ocupar recursos valiosos da CPU.</span><span class="sxs-lookup"><span data-stu-id="daf05-173">Some network controllers are capable of performing TCP/IP header checksum computation and validation in hardware, without taking up valuable CPU resources.</span></span> <span data-ttu-id="daf05-174">Para tirar partido da funcionalidade de capacidade de hardware, o NetX fornece opções para ativar ou desativar vários cálculos de checkum de software no momento da compilação, bem como ligar ou desligar a computação checkum no tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="daf05-174">To take advantage of the hardware capability feature, NetX provides options to enable or disable various software checksum computation at compilation time, as well as turning on or off checksum computation at run time.</span></span> <span data-ttu-id="daf05-175">Consulte "[Chapter 5 NetX Network Drivers](chapter5.md)" para obter informações mais detalhadas sobre a escrita de controladores de rede NetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-175">See "[Chapter 5 NetX Network Drivers](chapter5.md)" for more detailed information on writing NetX network drivers.</span></span>

### <a name="multihome-support"></a><span data-ttu-id="daf05-176">Suporte Multihome</span><span class="sxs-lookup"><span data-stu-id="daf05-176">Multihome Support</span></span>
<span data-ttu-id="daf05-177">O NetX suporta sistemas ligados a múltiplos dispositivos físicos utilizando uma única instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-177">NetX supports systems connected to multiple physical devices using a single IP instance.</span></span> <span data-ttu-id="daf05-178">Cada interface física é atribuída a um bloco de controlo de interface na instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-178">Each physical interface is assigned to an interface control block in the IP instance.</span></span> <span data-ttu-id="daf05-179">As aplicações que desejem utilizar um sistema multihome devem definir o valor para **NX_MAX_PHSYCIAL_INTERFACES** ao número de dispositivos físicos ligados ao sistema e reconstruir a biblioteca NetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-179">Applications wishing to use a multihome system must define the value for **NX_MAX_PHSYCIAL_INTERFACES** to the number of physical devices attached to the system, and rebuild NetX library.</span></span> <span data-ttu-id="daf05-180">Por **predefinição, NX_MAX_PHYSICAL_INTERFACES** é definido para um, criando um bloco de controlo de interface na instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-180">By default **NX_MAX_PHYSICAL_INTERFACES** is set to one, creating one interface control block in the IP instance.</span></span>

<span data-ttu-id="daf05-181">A aplicação NetX cria uma única instância IP para o dispositivo primário utilizando o serviço \***nx_ip_create** _ .</span><span class="sxs-lookup"><span data-stu-id="daf05-181">The NetX application creates a single IP instance for the primary device using the \***nx_ip_create** _ service.</span></span> <span data-ttu-id="daf05-182">Para cada dispositivo de rede adicional, a aplicação liga o dispositivo à instância IP utilizando o serviço _ *_nx_ip_interface_attach_*\* .</span><span class="sxs-lookup"><span data-stu-id="daf05-182">For each additional network devices, the application attaches the device to the IP instance using the _ *_nx_ip_interface_attach_*\* service.</span></span>

<span data-ttu-id="daf05-183">Cada estrutura de interface de rede contém um subconjunto de informações de rede sobre a interface de rede que está contida no bloco de controlo IP, incluindo endereço IP de interface, máscara de sub-rede, tamanho IP MTU e informações de endereço de camada MAC.</span><span class="sxs-lookup"><span data-stu-id="daf05-183">Each network interface structure contains a subset of network information about the network interface that is contained in the IP control block, including interface IP address, subnet mask, IP MTU size, and MAC-layer address information.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-184">*NetX com suporte multihome é compatível com versões anteriores do NetX. Serviços que não levam informações de interface explícitas padrão ao dispositivo de rede primária.*</span><span class="sxs-lookup"><span data-stu-id="daf05-184">*NetX with multihome support is backward compatible with earlier versions of NetX. Services that do not take explicit interface information default to the primary network device.*</span></span>

<span data-ttu-id="daf05-185">A interface primária tem índice zero na lista de instâncias IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-185">The primary interface has index zero in the IP instance list.</span></span> <span data-ttu-id="daf05-186">Cada dispositivo subsequente ligado à instância IP é atribuído o próximo índice.</span><span class="sxs-lookup"><span data-stu-id="daf05-186">Each subsequent device attached to the IP instance is assigned the next index.</span></span>

<span data-ttu-id="daf05-187">Todos os serviços de protocolo de camada superior para os quais a instância IP está ativada, incluindo TCP, UDP, ICMP e IGMP, estão disponíveis para todos os dispositivos anexos.</span><span class="sxs-lookup"><span data-stu-id="daf05-187">All upper layer protocol services for which the IP instance is enabled, including TCP, UDP, ICMP, and IGMP, are available to all the attached devices.</span></span>

<span data-ttu-id="daf05-188">Na maioria dos casos, o NetX pode determinar o melhor endereço de origem a utilizar ao transmitir um pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-188">In most cases, NetX can determine the best source address to use when transmitting a packet.</span></span> <span data-ttu-id="daf05-189">A seleção do endereço de origem baseia-se no endereço de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-189">The source address selection is based on the destination address.</span></span> <span data-ttu-id="daf05-190">Os serviços NetX são fornecidos para permitir que as aplicações especifiquem um endereço de origem específico para utilizar, nos casos em que o mais adequado não possa ser determinado pelo endereço de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-190">NetX services are provided to allow applications to specify a specific source address to use, in cases where the most suitable one cannot be determined by the destination address.</span></span> <span data-ttu-id="daf05-191">Um exemplo seria num sistema multihome, uma aplicação precisa enviar um pacote para uma transmissão IP ou endereços de destino multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-191">An example would be in a multihome system, an application needs to send a packet to an IP broadcast or multicast destination addresses.</span></span>

<span data-ttu-id="daf05-192">Os serviços especificamente para o desenvolvimento de aplicações multihomes incluem:</span><span class="sxs-lookup"><span data-stu-id="daf05-192">Services specifically for developing multihome applications include the following:</span></span>

<span data-ttu-id="daf05-193">*nx_igmp_multicast_interface_join nx_ip_driver_interface_direct_command nx_ip_interface_address_get nx_ip_interface_address_set nx_ip_interface_attach nx_ip_interface_info_get nx_ip_interface_status_check nx_ip_raw_packet_interface_send nx_udp_socket_interface_send*</span><span class="sxs-lookup"><span data-stu-id="daf05-193">*nx_igmp_multicast_interface_join nx_ip_driver_interface_direct_command nx_ip_interface_address_get nx_ip_interface_address_set nx_ip_interface_attach nx_ip_interface_info_get nx_ip_interface_status_check nx_ip_raw_packet_interface_send nx_udp_socket_interface_send*</span></span>

<span data-ttu-id="daf05-194">Estes serviços são explicados em maior detalhe no capítulo[4 - Descrição dos Serviços Azure RTOS NetX](chapter4.md)".</span><span class="sxs-lookup"><span data-stu-id="daf05-194">These services are explained in greater detail in "[Chapter 4 - Description of Azure RTOS NetX Services](chapter4.md)".</span></span>

### <a name="loopback-interface"></a><span data-ttu-id="daf05-195">Loopback Interface</span><span class="sxs-lookup"><span data-stu-id="daf05-195">Loopback Interface</span></span>
<span data-ttu-id="daf05-196">A interface loopback é uma interface de rede especial sem uma ligação física anexada.</span><span class="sxs-lookup"><span data-stu-id="daf05-196">The loopback interface is a special network interface without an physical link attached to.</span></span> <span data-ttu-id="daf05-197">A interface loopback permite que as aplicações comuniquem através do endereço IP loopback 127.0.0.1</span><span class="sxs-lookup"><span data-stu-id="daf05-197">The loopback interface allows applications to communicate using the IP loopback address 127.0.0.1</span></span>

<span data-ttu-id="daf05-198">Para utilizar uma interface lógico de loopback, certifique-se de que a opção configurável ***NX_DISABLE_LOOPBACK_INTERFACE*** não está definida.</span><span class="sxs-lookup"><span data-stu-id="daf05-198">To utilize a logical loopback interface, ensure the configurable option ***NX_DISABLE_LOOPBACK_INTERFACE*** is not set.</span></span>

### <a name="interface-control-blocks"></a><span data-ttu-id="daf05-199">Blocos de controlo de interface</span><span class="sxs-lookup"><span data-stu-id="daf05-199">Interface Control Blocks</span></span>
<span data-ttu-id="daf05-200">O número de blocos de controlo de interface na instância IP é o número de interfaces físicas (definidas por \***NX_MAX_PHYSICAL_INTERFACES** _) mais a interface loopback se estiver ativada.</span><span class="sxs-lookup"><span data-stu-id="daf05-200">The number of interface control blocks in the IP instance is the number of physical interfaces (defined by \***NX_MAX_PHYSICAL_INTERFACES** _) plus the loopback interface if it is enabled.</span></span> <span data-ttu-id="daf05-201">O número total de interfaces é definido em _\*_NX_MAX_IP_INTERFACES_\*\*.</span><span class="sxs-lookup"><span data-stu-id="daf05-201">The total number of interfaces is defined in _\*_NX_MAX_IP_INTERFACES_\*\*.</span></span>

## <a name="protocol-layering"></a><span data-ttu-id="daf05-202">Camada de protocolo</span><span class="sxs-lookup"><span data-stu-id="daf05-202">Protocol Layering</span></span>

<span data-ttu-id="daf05-203">O TCP/IP implementado pela NetX é um protocolo em camadas, o que significa que protocolos mais complexos são construídos em cima de protocolos subjacentes mais simples.</span><span class="sxs-lookup"><span data-stu-id="daf05-203">The TCP/IP implemented by NetX is a layered protocol, which means more complex protocols are built on top of simpler underlying protocols.</span></span> <span data-ttu-id="daf05-204">Em TCP/IP, o protocolo de camada mais baixa está na *camada de ligação* e é manuseado pelo controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-204">In TCP/ IP, the lowest layer protocol is at the *link Layer* and is handled by the network driver.</span></span> <span data-ttu-id="daf05-205">Este nível é tipicamente direcionado para Ethernet, mas também pode ser fibra, série ou praticamente qualquer meio físico.</span><span class="sxs-lookup"><span data-stu-id="daf05-205">This level is typically targeted towards Ethernet, but it could also be fiber, serial, or virtually any physical media.</span></span>

<span data-ttu-id="daf05-206">Em cima da camada de ligação está a *camada de Rede.*</span><span class="sxs-lookup"><span data-stu-id="daf05-206">On top of the link layer is the *Network layer*.</span></span> <span data-ttu-id="daf05-207">No TCP/IP, este é o IP, que é basicamente responsável pelo envio e receção de pacotes simples, de forma de melhor esforço, em toda a rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-207">In TCP/IP, this is the IP, which is basically responsible for sending and receiving simple packets, in a best-effort manner, across the network.</span></span> <span data-ttu-id="daf05-208">Os protocolos de tipo de gestão como o ICMP e o IGMP são tipicamente também categorizados como camadas de rede, mesmo que dependam de IP para envio e receção.</span><span class="sxs-lookup"><span data-stu-id="daf05-208">Management type protocols like ICMP and IGMP are typically also categorized as network layers, even though they rely on IP for sending and receiving.</span></span>

<span data-ttu-id="daf05-209">A *camada de transporte* assenta em cima da camada de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-209">The *Transport layer* rests on top of the network layer.</span></span> <span data-ttu-id="daf05-210">Esta camada é responsável pela gestão do fluxo de dados entre os anfitriões na rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-210">This layer is responsible for managing the flow of data between hosts on the network.</span></span> <span data-ttu-id="daf05-211">Existem dois tipos de serviços de transporte apoiados pela NetX: UDP e TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-211">There are two types of transport services supported by NetX: UDP and TCP.</span></span> <span data-ttu-id="daf05-212">Os serviços da UDP fornecem o melhor esforço de envio e receção de dados entre dois anfitriões de forma sem ligação, enquanto a TCP fornece um serviço fiável orientado para a ligação entre duas entidades hospedeiras.</span><span class="sxs-lookup"><span data-stu-id="daf05-212">UDP services provide best-effort sending and receiving of data between two hosts in a connectionless manner, while TCP provides reliable connection-oriented service between two host entities.</span></span>

<span data-ttu-id="daf05-213">Esta camada reflete-se nos pacotes de dados de rede reais.</span><span class="sxs-lookup"><span data-stu-id="daf05-213">This layering is reflected in the actual network data packets.</span></span> <span data-ttu-id="daf05-214">Cada camada em TCP/IP contém um bloco de informação chamado cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="daf05-214">Each layer in TCP/IP contains a block of information called a header.</span></span> <span data-ttu-id="daf05-215">Esta técnica de dados circundantes (e possivelmente informações protocolares) com um cabeçalho é tipicamente chamada de encapsulamento de dados.</span><span class="sxs-lookup"><span data-stu-id="daf05-215">This technique of surrounding data (and possibly protocol information) with a header is typically called data encapsulation.</span></span> <span data-ttu-id="daf05-216">A figura 1 mostra um exemplo de camadas NetX e a Figura 2 mostra o encapsulamento de dados resultante para os dados da UDP que estão a ser enviados.</span><span class="sxs-lookup"><span data-stu-id="daf05-216">Figure 1 shows an example of NetX layering and Figure 2 shows the resulting data encapsulation for UDP data being sent.</span></span>

![Camada de protocolo](./media/user-guide/protocol-layering.png)

<span data-ttu-id="daf05-218">**FIGURA 1. Camada de protocolo**</span><span class="sxs-lookup"><span data-stu-id="daf05-218">**FIGURE 1. Protocol Layering**</span></span>

![Encapsulamento de Dados da UDP](./media/user-guide/udp-data-encapsulation.png)

<span data-ttu-id="daf05-220">**FIGURA 2. Encapsulamento de Dados da UDP**</span><span class="sxs-lookup"><span data-stu-id="daf05-220">**FIGURE 2. UDP Data Encapsulation**</span></span>

## <a name="packet-pools"></a><span data-ttu-id="daf05-221">Piscinas de Pacotes</span><span class="sxs-lookup"><span data-stu-id="daf05-221">Packet Pools</span></span>

<span data-ttu-id="daf05-222">A atribuição de pacotes de forma rápida e determinística é sempre um desafio nas aplicações de networking em tempo real.</span><span class="sxs-lookup"><span data-stu-id="daf05-222">Allocating packets in a fast and deterministic manner is always a challenge in real-time networking applications.</span></span> <span data-ttu-id="daf05-223">Com isto em mente, o NetX fornece a capacidade de criar e gerir várias piscinas de pacotes de rede de tamanho fixo.</span><span class="sxs-lookup"><span data-stu-id="daf05-223">With this in mind, NetX provides the ability to create and manage multiple pools of fixed-size network packets.</span></span>

<span data-ttu-id="daf05-224">Como as piscinas de pacotes NetX consistem em blocos de memória de tamanho fixo, nunca existem problemas de fragmentação interna.</span><span class="sxs-lookup"><span data-stu-id="daf05-224">Because NetX packet pools consist of fixed-size memory blocks, there are never any internal fragmentation problems.</span></span> <span data-ttu-id="daf05-225">Claro, a fragmentação causa comportamentos que não são inerentemente indeterminados.</span><span class="sxs-lookup"><span data-stu-id="daf05-225">Of course, fragmentation causes behavior that is inherently nondeterministic.</span></span>

<span data-ttu-id="daf05-226">Além disso, o tempo necessário para alocar e libertar um pacote NetX equivale a uma simples manipulação de listas ligadas.</span><span class="sxs-lookup"><span data-stu-id="daf05-226">In addition, the time required to allocate and free a NetX packet amounts to simple linked-list manipulation.</span></span> <span data-ttu-id="daf05-227">Além disso, a atribuição de pacotes e alocação de acordos são feitas no chefe da lista disponível.</span><span class="sxs-lookup"><span data-stu-id="daf05-227">Furthermore, packet allocation and deallocation is done at the head of the available list.</span></span> <span data-ttu-id="daf05-228">Isto fornece o processamento de listas mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="daf05-228">This provides the fastest possible linked list processing.</span></span>

<span data-ttu-id="daf05-229">A falta de flexibilidade é tipicamente a principal desvantagem das piscinas de pacotes de tamanho fixo.</span><span class="sxs-lookup"><span data-stu-id="daf05-229">Lack of flexibility is typically the main drawback of fixed-size packet pools.</span></span> <span data-ttu-id="daf05-230">Determinar o tamanho ideal da carga útil do pacote que também lida com o pacote de entrada na pior das hipóteses é uma tarefa difícil.</span><span class="sxs-lookup"><span data-stu-id="daf05-230">Determining the optimal packet payload size that also handles the worst-case incoming packet is a difficult task.</span></span> <span data-ttu-id="daf05-231">Os pacotes NetX abordam este problema com uma funcionalidade opcional chamada *chaining de pacotes*.</span><span class="sxs-lookup"><span data-stu-id="daf05-231">NetX packets address this problem with an optional feature called *packet chaining*.</span></span> <span data-ttu-id="daf05-232">Um pacote de rede real pode ser feito de um ou mais pacotes NetX ligados entre si.</span><span class="sxs-lookup"><span data-stu-id="daf05-232">An actual network packet can be made of one or more NetX packets linked together.</span></span> <span data-ttu-id="daf05-233">Além disso, o cabeçalho do pacote mantém um ponteiro para a parte superior do pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-233">In addition, the packet header maintains a pointer to the top of the packet.</span></span> <span data-ttu-id="daf05-234">À medida que os protocolos adicionais são adicionados, este ponteiro é simplesmente movido para trás e o novo cabeçalho é escrito diretamente na frente dos dados.</span><span class="sxs-lookup"><span data-stu-id="daf05-234">As additional protocols are added, this pointer is simply moved backwards and the new header is written directly in front of the data.</span></span> <span data-ttu-id="daf05-235">Sem a tecnologia de pacote flexível, a pilha teria de alocar outro tampão e copiar os dados para um novo tampão com o novo cabeçalho, que está a processar intensivamente.</span><span class="sxs-lookup"><span data-stu-id="daf05-235">Without the flexible packet technology, the stack would have to allocate another buffer and copy the data into a new buffer with the new header, which is processing intensive.</span></span>

<span data-ttu-id="daf05-236">Uma vez que cada tamanho de carga útil do pacote é fixado para um determinado pacote, os dados de aplicação maiores do que o tamanho da carga útil requer vários pacotes acorrentados juntos.</span><span class="sxs-lookup"><span data-stu-id="daf05-236">Since each packet payload size is fixed for a given packet pool, application data larger than the payload size  requires multiple packets chained together.</span></span> <span data-ttu-id="daf05-237">Ao preencher um pacote com dados do utilizador, a aplicação deve utilizar o serviço ***nx_packet_data_append***.</span><span class="sxs-lookup"><span data-stu-id="daf05-237">When filling a packet with user data, the application must use the service ***nx_packet_data_append***.</span></span> <span data-ttu-id="daf05-238">Este serviço move os dados da aplicação para um pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-238">This service moves application data into a packet.</span></span> <span data-ttu-id="daf05-239">Em situações em que um pacote não é suficiente para guardar os dados dos utilizadores, os pacotes adicionais são atribuídos para armazenar dados do utilizador.</span><span class="sxs-lookup"><span data-stu-id="daf05-239">In situations where a packet is not enough to hold user data, additional packets are allocated to store user data.</span></span> <span data-ttu-id="daf05-240">Para utilizar acorrentado de pacotes, o condutor deve poder receber ou transmitir a partir de pacotes acorrentados.</span><span class="sxs-lookup"><span data-stu-id="daf05-240">To use packet chaining, the driver must be able to receive into or transmit from chained packets.</span></span>

<span data-ttu-id="daf05-241">Cada conjunto de memórias de pacotes NetX é um recurso público.</span><span class="sxs-lookup"><span data-stu-id="daf05-241">Each NetX packet memory pool is a public resource.</span></span> <span data-ttu-id="daf05-242">A NetX não coloca constrangimentos na forma como as piscinas de pacotes são utilizadas.</span><span class="sxs-lookup"><span data-stu-id="daf05-242">NetX places no constraints on how packet pools are used.</span></span>

### <a name="packet-pool-memory-area"></a><span data-ttu-id="daf05-243">Área de memória da piscina de pacotes</span><span class="sxs-lookup"><span data-stu-id="daf05-243">Packet Pool Memory Area</span></span>
<span data-ttu-id="daf05-244">A área de memória para a piscina de pacotes é especificada durante a criação.</span><span class="sxs-lookup"><span data-stu-id="daf05-244">The memory area for the packet pool is specified during creation.</span></span> <span data-ttu-id="daf05-245">Tal como outras áreas de memória para objetos ThreadX e NetX, pode ser localizado em qualquer lugar do espaço de endereço do alvo.</span><span class="sxs-lookup"><span data-stu-id="daf05-245">Like other memory areas for ThreadX and NetX objects, it can be located anywhere in the target's address space.</span></span> <span data-ttu-id="daf05-246">Esta é uma característica importante devido à considerável flexibilidade que confere à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-246">This is an important feature because of the considerable flexibility it gives the application.</span></span> <span data-ttu-id="daf05-247">Por exemplo, suponha que um produto de comunicação tem uma área de memória de alta velocidade para tampão de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-247">For example, suppose that a communication product has a high-speed memory area for network buffers.</span></span> <span data-ttu-id="daf05-248">Esta área de memória é facilmente utilizada transformando-a num conjunto de memórias de pacotes NetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-248">This memory area is easily utilized by making it into a NetX packet memory pool.</span></span>

### <a name="creating-packet-pools"></a><span data-ttu-id="daf05-249">Criação de piscinas de pacotes</span><span class="sxs-lookup"><span data-stu-id="daf05-249">Creating Packet Pools</span></span>
<span data-ttu-id="daf05-250">As piscinas de pacotes são criadas durante a inicialização ou durante o tempo de execução por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-250">Packet pools are created either during initialization or during runtime by application threads.</span></span> <span data-ttu-id="daf05-251">Não existem limites no número de conjuntos de memória de pacotes numa aplicação NetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-251">There are no limits on the number of packet memory pools in a NetX application.</span></span>

### <a name="packet-header-nx_packet"></a><span data-ttu-id="daf05-252">NX_PACKET cabeçalho do pacote</span><span class="sxs-lookup"><span data-stu-id="daf05-252">Packet Header NX_PACKET</span></span>
<span data-ttu-id="daf05-253">Por predefinição, o NetX coloca o cabeçalho do pacote imediatamente antes da área de carga do pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-253">By default, NetX places the packet header immediately before the packet payload area.</span></span> <span data-ttu-id="daf05-254">O conjunto de memórias do pacote é basicamente uma série de pacotes — cabeçalhos seguidos imediatamente pela carga útil do pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-254">The packet memory pool is basically a series of packets—headers followed immediately by the packet payload.</span></span> <span data-ttu-id="daf05-255">O cabeçalho do pacote ***(NX_PACKET)*** e o layout da piscina do pacote estão representados na Figura 3.</span><span class="sxs-lookup"><span data-stu-id="daf05-255">The packet header (***NX_PACKET***) and the layout of the packet pool are pictured in Figure 3.</span></span>

<span data-ttu-id="daf05-256">Para o controlador de dispositivos de rede que seja capaz de realizar operações de cópia zero, normalmente o endereço inicial da área de carga útil do pacote está programado na lógica DMA.</span><span class="sxs-lookup"><span data-stu-id="daf05-256">For network devices driver that are able to perform zero copy operations, typically the starting address of the packet payload area is programmed into the DMA logic.</span></span> <span data-ttu-id="daf05-257">Certos motores DMA têm requisitos de alinhamento na área de carga útil.</span><span class="sxs-lookup"><span data-stu-id="daf05-257">Certain DMA engines have alignment requirement on the payload area.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-258">\*O controlador de rede deve ligar para a função \***nx_packet_transmit_release** _ quando a transmissão de um pacote estiver completa.</span><span class="sxs-lookup"><span data-stu-id="daf05-258">\*The network driver to must call the \***nx_packet_transmit_release** _ function when the transmission of a packet is complete.</span></span> <span data-ttu-id="daf05-259">Esta função verifica se o pacote não faz parte de uma fila de saída TCP antes de ser realmente colocado de volta na piscina disponível.</span><span class="sxs-lookup"><span data-stu-id="daf05-259">This function checks to make sure the packet is not part of a TCP output queue before it is actually placed back in the available pool.</span></span> <span data-ttu-id="daf05-260">A não chamada desta função pode resultar em behavior._ imprevisíveis</span><span class="sxs-lookup"><span data-stu-id="daf05-260">Failure to call this function can result in unpredictable behavior._</span></span>

![Cabeçalho de pacote e layout de piscina de pacote](./media/user-guide/packet-header-packet-pool-layout.png)

<span data-ttu-id="daf05-262">**FIGURA 3. Cabeçalho de pacote e layout de piscina de pacote**</span><span class="sxs-lookup"><span data-stu-id="daf05-262">**FIGURE 3. Packet Header and Packet Pool Layout**</span></span>

<span data-ttu-id="daf05-263">Os campos do cabeçalho do pacote são definidos como mostrado na tabela seguinte.</span><span class="sxs-lookup"><span data-stu-id="daf05-263">The fields of the packet header are defined as shown in the following table.</span></span> <span data-ttu-id="daf05-264">Note que esta tabela não é uma lista completa de todos os membros da estrutura *NX_PACKET.*</span><span class="sxs-lookup"><span data-stu-id="daf05-264">Note that this table is not a comprehensive list of all the members in the *NX_PACKET* structure.</span></span>

| <span data-ttu-id="daf05-265">Cabeçalho de pacote</span><span class="sxs-lookup"><span data-stu-id="daf05-265">Packet header</span></span>          | <span data-ttu-id="daf05-266">Objetivo</span><span class="sxs-lookup"><span data-stu-id="daf05-266">Purpose</span></span>                                                                                                                                                                                                                                                                                                                            |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="daf05-267">*nx_packet_pool_owner*</span><span class="sxs-lookup"><span data-stu-id="daf05-267">*nx_packet_pool_owner*</span></span>   | <span data-ttu-id="daf05-268">Este campo aponta para a piscina de pacotes que detém este pacote em particular.</span><span class="sxs-lookup"><span data-stu-id="daf05-268">This field points to the packet pool that owns this particular packet.</span></span> <span data-ttu-id="daf05-269">Quando o pacote é lançado, é libertado para esta piscina em particular.</span><span class="sxs-lookup"><span data-stu-id="daf05-269">When the packet is released, it is released to this particular pool.</span></span> <span data-ttu-id="daf05-270">Com a propriedade da piscina dentro de cada pacote, é possível que um datagrama abra por vários pacotes de várias piscinas de pacotes.</span><span class="sxs-lookup"><span data-stu-id="daf05-270">With the pool ownership inside each packet, it is possible for a datagram to span multiple packets from multiple packet pools.</span></span>                                                         |
| <span data-ttu-id="daf05-271">*nx_packet_next*</span><span class="sxs-lookup"><span data-stu-id="daf05-271">*nx_packet_next*</span></span>         | <span data-ttu-id="daf05-272">Este campo aponta para o próximo pacote dentro do mesmo quadro.</span><span class="sxs-lookup"><span data-stu-id="daf05-272">This field points to the next packet within the same frame.</span></span> <span data-ttu-id="daf05-273">Se o NU, não existem pacotes adicionais que fazem parte da moldura.</span><span class="sxs-lookup"><span data-stu-id="daf05-273">If NULL, there are no additional packets that are part of the frame.</span></span> |
| <span data-ttu-id="daf05-274">*nx_packet_last*</span><span class="sxs-lookup"><span data-stu-id="daf05-274">*nx_packet_last*</span></span>         | <span data-ttu-id="daf05-275">Este campo aponta para o último pacote dentro do mesmo pacote de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-275">This field points to the last packet within the same network packet.</span></span> <span data-ttu-id="daf05-276">Se o NU, este pacote representa todo o pacote de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-276">If NULL, this packet represents the entire network packet.</span></span>  |
| <span data-ttu-id="daf05-277">*nx_packet_length*</span><span class="sxs-lookup"><span data-stu-id="daf05-277">*nx_packet_length*</span></span>       | <span data-ttu-id="daf05-278">Este campo contém o número total de bytes em todo o pacote de rede, incluindo o total de todos os bytes em todos os pacotes acorrentados pelo membro *nx_packet_next.*</span><span class="sxs-lookup"><span data-stu-id="daf05-278">This field contains the total number of bytes in the entire network packet, including the total of all bytes in all packets chained together by the *nx_packet_next* member.</span></span> |
| <span data-ttu-id="daf05-279">*nx_packet_ip_interface*</span><span class="sxs-lookup"><span data-stu-id="daf05-279">*nx_packet_ip_interface*</span></span> | <span data-ttu-id="daf05-280">Este campo é o bloco de controlo de interface que é atribuído ao pacote quando é recebido pelo controlador de interface, e pelo NetX para pacotes de saída.</span><span class="sxs-lookup"><span data-stu-id="daf05-280">This field is the interface control block which is assigned to the packet when it is received by the interface driver, and by NetX for outgoing packets.</span></span> <span data-ttu-id="daf05-281">Um bloco de controlo de interface descreve a interface, por exemplo, endereço de rede, endereço MAC, endereço IP e estado de interface, como ligação ativada e mapeamento físico necessário.</span><span class="sxs-lookup"><span data-stu-id="daf05-281">An interface control block describes the interface e.g. network address, MAC address, IP address and interface status such as link enabled and physical mapping required.</span></span> |
| <span data-ttu-id="daf05-282">*nx_packet_data_start*</span><span class="sxs-lookup"><span data-stu-id="daf05-282">*nx_packet_data_start*</span></span>   | <span data-ttu-id="daf05-283">Este campo aponta para o início da área de carga física deste pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-283">This field points to the start of the physical payload area of this packet.</span></span> <span data-ttu-id="daf05-284">Não tem de ser imediatamente a seguir o cabeçalho NX_PACKET, mas é o padrão para o serviço ***nx_packet_pool_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-284">It does not have to be immediately following the NX_PACKET header, but that is the default for the ***nx_packet_pool_create*** service.</span></span> |
| <span data-ttu-id="daf05-285">*nx_packet_data_end*</span><span class="sxs-lookup"><span data-stu-id="daf05-285">*nx_packet_data_end*</span></span>     | <span data-ttu-id="daf05-286">Este campo aponta para o fim da área de carga física deste pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-286">This field points to the end of the physical payload area of this packet.</span></span> <span data-ttu-id="daf05-287">A diferença entre este campo e o campo nx_packet_data_start representa o tamanho da carga útil.</span><span class="sxs-lookup"><span data-stu-id="daf05-287">The difference between this field and the nx_packet_data_start field represents the payload size.</span></span> |
| <span data-ttu-id="daf05-288">*nx_packet_prepend_ptr*</span><span class="sxs-lookup"><span data-stu-id="daf05-288">*nx_packet_prepend_ptr*</span></span>  | <span data-ttu-id="daf05-289">Este campo aponta para a localização de onde os dados do pacote, quer o cabeçalho do protocolo, quer os dados reais, são adicionados à frente dos dados do pacote existentes (se houver) na área de carga útil do pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-289">This field points to the location of where packet data, either protocol header or actual data, is added in front of the existing packet data (if any) in the packet payload area.</span></span> <span data-ttu-id="daf05-290">Deve ser maior ou igual ao local do ponteiro *nx_packet_data_start* e inferior ou igual ao *ponteiro nx_packet_append_ptr.*</span><span class="sxs-lookup"><span data-stu-id="daf05-290">It must be greater than or equal to the *nx_packet_data_start* pointer location and less than or equal to the *nx_packet_append_ptr* pointer.</span></span>  <span data-ttu-id="daf05-291">*Por razões de desempenho, a NetX assume que quando o pacote é passado para os serviços NetX para transmissão, o ponteiro pré-end aponta para um endereço alinhado com palavras longas.*</span><span class="sxs-lookup"><span data-stu-id="daf05-291">*For performance reasons, NetX assumes that when the packet is passed into NetX services for transmission, the prepend pointer points to long word aligned address.*</span></span> |
| <span data-ttu-id="daf05-292">*nx_packet_append_ptr*</span><span class="sxs-lookup"><span data-stu-id="daf05-292">*nx_packet_append_ptr*</span></span>    | <span data-ttu-id="daf05-293">Este campo aponta para o fim dos dados atualmente na área de carga útil do pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-293">This field points to the end of the data currently in the packet payload area.</span></span> <span data-ttu-id="daf05-294">Deve estar entre o local de memória apontado por *nx_packet_prepend_ptr* e *nx_packet_data_end*.</span><span class="sxs-lookup"><span data-stu-id="daf05-294">It must be in between the memory location pointed to by *nx_packet_prepend_ptr* and *nx_packet_data_end*.</span></span> <span data-ttu-id="daf05-295">A diferença entre este campo e o campo *nx_packet_prepend_ptr* representa a quantidade de dados neste pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-295">The difference between this field and the *nx_packet_prepend_ptr* field represents the amount of data in this packet.</span></span> |
| <span data-ttu-id="daf05-296">*nx_packet_fragment_next*</span><span class="sxs-lookup"><span data-stu-id="daf05-296">*nx_packet_fragment_next*</span></span> | <span data-ttu-id="daf05-297">Este campo é utilizado para conter pacotes fragmentados até que todo o pacote possa ser remontado.</span><span class="sxs-lookup"><span data-stu-id="daf05-297">This field is used to hold fragmented packets until the entire packet can be re-assembled.</span></span> |
| <span data-ttu-id="daf05-298">*nx_packet_pad*</span><span class="sxs-lookup"><span data-stu-id="daf05-298">*nx_packet_pad*</span></span>           | <span data-ttu-id="daf05-299">Estes campos definem o comprimento do acolchoamento em 4 palavras byte para alcançar o requisito de alinhamento desejado.</span><span class="sxs-lookup"><span data-stu-id="daf05-299">This fields defines the length of padding in 4- byte words to achieve the desired alignment requirement.</span></span> <span data-ttu-id="daf05-300">Este campo é removido se *NX_PACKET_HEADER_PAD* não estiver definido.</span><span class="sxs-lookup"><span data-stu-id="daf05-300">This field is removed if *NX_PACKET_HEADER_PAD* is not defined.</span></span> |
|  |  |

### <a name="packet-header-offsets"></a><span data-ttu-id="daf05-301">Compensações do cabeçalho do pacote</span><span class="sxs-lookup"><span data-stu-id="daf05-301">Packet Header Offsets</span></span>

<span data-ttu-id="daf05-302">O tamanho do cabeçalho do pacote é definido para permitir espaço suficiente para acomodar o tamanho do cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="daf05-302">Packet header size is defined to allow enough room to accommodate the size of the header.</span></span> <span data-ttu-id="daf05-303">O serviço *nx_packet_allocate* é utilizado para alocar um pacote e ajusta o ponteiro pré-final no pacote de acordo com o tipo de pacote especificado.</span><span class="sxs-lookup"><span data-stu-id="daf05-303">The *nx_packet_allocate* service is used to allocate a packet and adjusts the prepend pointer in the packet according to the type of packet specified.</span></span> <span data-ttu-id="daf05-304">O tipo de pacote diz ao NetX a compensação necessária para inserir o cabeçalho do protocolo (como UDP, TCP ou ICMP) em frente aos dados do protocolo.</span><span class="sxs-lookup"><span data-stu-id="daf05-304">The packet type tells NetX the offset required for inserting the protocol header (such as UDP, TCP, or ICMP) in front of the protocol data.</span></span>

<span data-ttu-id="daf05-305">Os seguintes tipos são definidos no NetX para ter em conta o cabeçalho IP e a camada física (Ethernet) no pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-305">The following types are defined in NetX to take into account the IP header and physical layer (Ethernet) header in the packet.</span></span> <span data-ttu-id="daf05-306">Neste último caso, presume-se que sejam 16 bytes tendo em consideração o alinhamento de 4 bytes necessário.</span><span class="sxs-lookup"><span data-stu-id="daf05-306">In the latter case, it is assumed to be 16 bytes taking the required 4-byte alignment into consideration.</span></span> <span data-ttu-id="daf05-307">Os pacotes IP ainda estão definidos no NetX para aplicações para alocar pacotes para redes IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-307">IP packets are still defined in NetX for applications to allocate packets for IP networks.</span></span> <span data-ttu-id="daf05-308">A tabela a seguir mostra símbolos definidos:</span><span class="sxs-lookup"><span data-stu-id="daf05-308">The following table shows symbols defined:</span></span>

| <span data-ttu-id="daf05-309">Tipo de pacote</span><span class="sxs-lookup"><span data-stu-id="daf05-309">Packet Type</span></span>   | <span data-ttu-id="daf05-310">Valor</span><span class="sxs-lookup"><span data-stu-id="daf05-310">Value</span></span> |
|---------------|-------|
| <span data-ttu-id="daf05-311">NX_IP_PACKET</span><span class="sxs-lookup"><span data-stu-id="daf05-311">NX_IP_PACKET</span></span>  | <span data-ttu-id="daf05-312">0x24</span><span class="sxs-lookup"><span data-stu-id="daf05-312">0x24</span></span>  |
| <span data-ttu-id="daf05-313">NX_UDP_PACKET</span><span class="sxs-lookup"><span data-stu-id="daf05-313">NX_UDP_PACKET</span></span> | <span data-ttu-id="daf05-314">0x2c</span><span class="sxs-lookup"><span data-stu-id="daf05-314">0x2c</span></span>  |
| <span data-ttu-id="daf05-315">NX_TCP_PACKET</span><span class="sxs-lookup"><span data-stu-id="daf05-315">NX_TCP_PACKET</span></span> | <span data-ttu-id="daf05-316">0x38</span><span class="sxs-lookup"><span data-stu-id="daf05-316">0x38</span></span>  |
|               |       |

### <a name="pool-capacity"></a><span data-ttu-id="daf05-317">Capacidade da Piscina</span><span class="sxs-lookup"><span data-stu-id="daf05-317">Pool Capacity</span></span>
<span data-ttu-id="daf05-318">O número de pacotes numa piscina de pacotes é uma função do tamanho da carga útil e do número total de bytes na área de memória fornecida à piscina de pacotes criar serviço.</span><span class="sxs-lookup"><span data-stu-id="daf05-318">The number of packets in a packet pool is a function of the payload size and the total number of bytes in the memory area supplied to the packet pool create service.</span></span> <span data-ttu-id="daf05-319">A capacidade da piscina é calculada dividindo o tamanho do pacote (incluindo o tamanho do cabeçalho NX_PACKET, o tamanho da carga útil e o alinhamento adequado) no número total de bytes na área de memória fornecida.</span><span class="sxs-lookup"><span data-stu-id="daf05-319">The capacity of the pool is calculated by dividing the packet size (including the size of the NX_PACKET header, the payload size, and proper alignment) into the total number of bytes in the supplied memory area.</span></span>

### <a name="thread-suspension"></a><span data-ttu-id="daf05-320">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="daf05-320">Thread Suspension</span></span>
<span data-ttu-id="daf05-321">Os fios de aplicação podem suspender enquanto esperam por um pacote de uma piscina vazia.</span><span class="sxs-lookup"><span data-stu-id="daf05-321">Application threads can suspend while waiting for a packet from an empty pool.</span></span> <span data-ttu-id="daf05-322">Quando um pacote é devolvido à piscina, o fio suspenso é dado este pacote e retomado.</span><span class="sxs-lookup"><span data-stu-id="daf05-322">When a packet is returned to the pool, the suspended thread is given this packet and resumed.</span></span>

<span data-ttu-id="daf05-323">Se várias linhas forem suspensas na mesma piscina de pacotes, são retomadas na ordem em que foram suspensas (FIFO).</span><span class="sxs-lookup"><span data-stu-id="daf05-323">If multiple threads are suspended on the same packet pool, they are resumed in the order they were suspended (FIFO).</span></span>

### <a name="pool-statistics-and-errors"></a><span data-ttu-id="daf05-324">Estatísticas e erros da piscina</span><span class="sxs-lookup"><span data-stu-id="daf05-324">Pool Statistics and Errors</span></span>
<span data-ttu-id="daf05-325">Se ativado, o software de gestão de **pacotes** NetX Errors regista várias estatísticas e erros que podem ser úteis para a aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-325">If enabled, the NetX packet management software **Errors** keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-326">São mantidas as seguintes estatísticas e relatórios de erro para os pools de pacotes:</span><span class="sxs-lookup"><span data-stu-id="daf05-326">The following statistics and error reports are maintained for packet pools:</span></span>

* <span data-ttu-id="daf05-327">Pacotes totais em piscina</span><span class="sxs-lookup"><span data-stu-id="daf05-327">Total Packets in Pool</span></span>
* <span data-ttu-id="daf05-328">Pacotes gratuitos na piscina</span><span class="sxs-lookup"><span data-stu-id="daf05-328">Free Packets in Pool</span></span>
* <span data-ttu-id="daf05-329">Pedidos de atribuição vazios da piscina</span><span class="sxs-lookup"><span data-stu-id="daf05-329">Pool Empty Allocation Requests</span></span>
* <span data-ttu-id="daf05-330">Suspensões de atribuição vazias da piscina</span><span class="sxs-lookup"><span data-stu-id="daf05-330">Pool Empty Allocation Suspensions</span></span>
* <span data-ttu-id="daf05-331">Lançamentos de pacotes inválidos</span><span class="sxs-lookup"><span data-stu-id="daf05-331">Invalid Packet Releases</span></span>

<span data-ttu-id="daf05-332">Todas estas estatísticas e relatórios de erro, com exceção da contagem total e gratuita de pacotes na piscina, são incorporados na biblioteca NetX, a menos que \***NX_DISABLE_PACKET_INFO** _ seja definido.</span><span class="sxs-lookup"><span data-stu-id="daf05-332">All of these statistics and error reports, except for total and free packet count in pool, are built into NetX library unless \***NX_DISABLE_PACKET_INFO** _ is defined.</span></span> <span data-ttu-id="daf05-333">Estes dados estão disponíveis para a aplicação com o serviço _ *_nx_packet_pool_info_get*_\*</span><span class="sxs-lookup"><span data-stu-id="daf05-333">This data is available to the application with the _ *_nx_packet_pool_info_get_*\* service.</span></span>

### <a name="packet-pool-control-block-nx_packet_pool"></a><span data-ttu-id="daf05-334">Bloco de controlo de piscina de pacote NX_PACKET_POOL</span><span class="sxs-lookup"><span data-stu-id="daf05-334">Packet Pool Control Block NX_PACKET_POOL</span></span>

<span data-ttu-id="daf05-335">As características de cada conjunto de memória de pacotes encontram-se no seu bloco de controlo.</span><span class="sxs-lookup"><span data-stu-id="daf05-335">The characteristics of each packet memory pool are found in its control block.</span></span> <span data-ttu-id="daf05-336">Contém informações úteis, tais como a lista ligada de pacotes gratuitos, o número de pacotes gratuitos e o tamanho da carga útil para pacotes nesta piscina.</span><span class="sxs-lookup"><span data-stu-id="daf05-336">It contains useful information such as the linked list of free packets, the number of free packets, and the payload size for packets in this pool.</span></span> <span data-ttu-id="daf05-337">Esta estrutura é definida no ficheiro *nx_api.h.*</span><span class="sxs-lookup"><span data-stu-id="daf05-337">This structure is defined in the *nx_api.h* file.</span></span>

<span data-ttu-id="daf05-338">Os blocos de controlo da piscina de pacote podem ser localizados em qualquer lugar da memória, mas é mais comum fazer do bloco de controlo uma estrutura global definindo-o fora do âmbito de qualquer função.</span><span class="sxs-lookup"><span data-stu-id="daf05-338">Packet pool control blocks can be located anywhere in memory, but it is most common to make the control block a global structure by defining it outside the scope of any function.</span></span>

## <a name="ip-protocol"></a><span data-ttu-id="daf05-339">Protocolo IP</span><span class="sxs-lookup"><span data-stu-id="daf05-339">IP Protocol</span></span>

<span data-ttu-id="daf05-340">O componente de Protocolo de Internet (IP) do NetX é responsável pelo envio e receção de pacotes IP na Internet.</span><span class="sxs-lookup"><span data-stu-id="daf05-340">The Internet Protocol (IP) component of NetX is responsible for sending and receiving IP packets on the Internet.</span></span> <span data-ttu-id="daf05-341">Na NetX, é o componente em última instância responsável pelo envio e receção de mensagens TCP, UDP, ICMP e IGMP, utilizando o controlador de rede subjacente.</span><span class="sxs-lookup"><span data-stu-id="daf05-341">In NetX, it is the component ultimately responsible for sending and receiving TCP, UDP, ICMP, and IGMP messages, utilizing the underlying network driver.</span></span>

<span data-ttu-id="daf05-342">NetX suporta protocolo IP (RFC 791)</span><span class="sxs-lookup"><span data-stu-id="daf05-342">NetX supports IP protocol (RFC 791)</span></span>

### <a name="ip-addresses"></a><span data-ttu-id="daf05-343">Endereços IP</span><span class="sxs-lookup"><span data-stu-id="daf05-343">IP Addresses</span></span>

<span data-ttu-id="daf05-344">Cada anfitrião na Internet tem um identificador único de 32 bits chamado endereço IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-344">Each host on the Internet has a unique 32-bit identifier called an IP address.</span></span> <span data-ttu-id="daf05-345">Existem cinco classes de endereços IP, conforme descrito na Figura 4.</span><span class="sxs-lookup"><span data-stu-id="daf05-345">There are five classes of IP addresses as described in Figure 4.</span></span> <span data-ttu-id="daf05-346">As gamas das cinco classes de endereços IP são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="daf05-346">The ranges of the five IP address classes are as follows:</span></span>

| <span data-ttu-id="daf05-347">Classe</span><span class="sxs-lookup"><span data-stu-id="daf05-347">Class</span></span> | <span data-ttu-id="daf05-348">Intervalo</span><span class="sxs-lookup"><span data-stu-id="daf05-348">Range</span></span>                        |
|-------|------------------------------|
| <span data-ttu-id="daf05-349">A</span><span class="sxs-lookup"><span data-stu-id="daf05-349">A</span></span>     | <span data-ttu-id="daf05-350">0.0.0.0 para 127.255.255.255</span><span class="sxs-lookup"><span data-stu-id="daf05-350">0.0.0.0 to 127.255.255.255</span></span>   |
| <span data-ttu-id="daf05-351">B</span><span class="sxs-lookup"><span data-stu-id="daf05-351">B</span></span>     | <span data-ttu-id="daf05-352">128.0.0.0 para 191.255.255.255</span><span class="sxs-lookup"><span data-stu-id="daf05-352">128.0.0.0 to 191.255.255.255</span></span> |
| <span data-ttu-id="daf05-353">C</span><span class="sxs-lookup"><span data-stu-id="daf05-353">C</span></span>     | <span data-ttu-id="daf05-354">192.0.0.0 para 223.255.255.255</span><span class="sxs-lookup"><span data-stu-id="daf05-354">192.0.0.0 to 223.255.255.255</span></span> |
| <span data-ttu-id="daf05-355">D</span><span class="sxs-lookup"><span data-stu-id="daf05-355">D</span></span>     | <span data-ttu-id="daf05-356">224.0.0.0 para 239.255.255.255</span><span class="sxs-lookup"><span data-stu-id="daf05-356">224.0.0.0 to 239.255.255.255</span></span> |
| <span data-ttu-id="daf05-357">E</span><span class="sxs-lookup"><span data-stu-id="daf05-357">E</span></span>     | <span data-ttu-id="daf05-358">240.0.0.0 para 247.255.255.255</span><span class="sxs-lookup"><span data-stu-id="daf05-358">240.0.0.0 to 247.255.255.255</span></span> |

<span data-ttu-id="daf05-359">**7 bits 24 bits**</span><span class="sxs-lookup"><span data-stu-id="daf05-359">**7 bits 24 bits**</span></span>

![Estrutura de endereços IP](./media/user-guide/ip-address-structure.png)

<span data-ttu-id="daf05-361">**FIGURA 4. Estrutura de endereços IP**</span><span class="sxs-lookup"><span data-stu-id="daf05-361">**FIGURE 4. IP Address Structure**</span></span>

<span data-ttu-id="daf05-362">Existem também três tipos de especificações de endereços: *unicast,* *transmissão* e *multicast.*</span><span class="sxs-lookup"><span data-stu-id="daf05-362">There are also three types of address specifications: *unicast*, *broadcast*, and *multicast*.</span></span> <span data-ttu-id="daf05-363">Os endereços unicast são os endereços IP que identificam um anfitrião específico na Internet.</span><span class="sxs-lookup"><span data-stu-id="daf05-363">Unicast addresses are those IP addresses that identify a specific host on the Internet.</span></span> <span data-ttu-id="daf05-364">Os endereços Unicast podem ser uma fonte ou um endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-364">Unicast addresses can be either a source or a destination IP address.</span></span> <span data-ttu-id="daf05-365">Um endereço de transmissão identifica todos os anfitriões numa rede ou sub-rede específica e só pode ser usado como endereços de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-365">A broadcast address identifies all hosts on a specific network or sub-network and can only be used as destination addresses.</span></span> <span data-ttu-id="daf05-366">Os endereços de transmissão são especificados tendo a parte de identificação do anfitrião do endereço definida para os outros.</span><span class="sxs-lookup"><span data-stu-id="daf05-366">Broadcast addresses are specified by having the host ID portion of the address set to ones.</span></span> <span data-ttu-id="daf05-367">Endereços multicast (Classe D) especificam um grupo dinâmico de anfitriões na Internet.</span><span class="sxs-lookup"><span data-stu-id="daf05-367">Multicast addresses (Class D) specify a dynamic group of hosts on the Internet.</span></span> <span data-ttu-id="daf05-368">Os membros do grupo multicast podem juntar-se e sair quando quiserem.</span><span class="sxs-lookup"><span data-stu-id="daf05-368">Members of the multicast group may join and leave whenever they wish.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-369">*Apenas protocolos sem ligação como uDP sobre IP podem utilizar a difusão e a capacidade de transmissão limitada do grupo multicast.*</span><span class="sxs-lookup"><span data-stu-id="daf05-369">*Only connectionless protocols like UDP over IP can utilize broadcast and the limited broadcast capability of the multicast group.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-370">*A macro* IP_ADDRESS é *definido em*  \* **nx_api.h_.**</span><span class="sxs-lookup"><span data-stu-id="daf05-370">*The macro* IP_ADDRESS *is defined in* \***nx_api.h** _.</span></span> <span data-ttu-id="daf05-371">Permite uma especificação fácil dos endereços IP utilizando vírgulas em vez de um período.</span><span class="sxs-lookup"><span data-stu-id="daf05-371">It allows easy specification of IP addresses using commas instead of a periods.</span></span> <span data-ttu-id="daf05-372">Por exemplo, IP_ADDRESS (128,0,0,0) _specifies o endereço da primeira classe B mostrado na Figura 4.\*</span><span class="sxs-lookup"><span data-stu-id="daf05-372">For example, IP_ADDRESS(128,0,0,0) _specifies the first class B address shown in Figure 4.\*</span></span>

### <a name="ip-gateway-address"></a><span data-ttu-id="daf05-373">Endereço IP Gateway</span><span class="sxs-lookup"><span data-stu-id="daf05-373">IP Gateway Address</span></span>

<span data-ttu-id="daf05-374">Os gateways de rede ajudam os anfitriões nas suas redes a transmitir pacotes destinados a destinos fora do domínio local.</span><span class="sxs-lookup"><span data-stu-id="daf05-374">Network gateways assist hosts on their networks to relay packets destined to destinations outside the local domain.</span></span> <span data-ttu-id="daf05-375">Cada nó tem algum conhecimento de qual próximo salto enviar para, seja o destino de um dos seus vizinhos, ou através de uma mesa de encaminhamento estático pré-programada.</span><span class="sxs-lookup"><span data-stu-id="daf05-375">Each node has some knowledge of which next hop to send to, either the destination one of its neighbors, or through a pre-programmed static routing table.</span></span> <span data-ttu-id="daf05-376">No entanto, se estas abordagens falharem, o nó deve encaminhar o pacote para o seu gateway predefinido, que tem mais informações sobre como encaminhar o pacote para o seu destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-376">However if these approaches fail, the node should forward the packet to its default gateway which has more information on how to route the packet to its destination.</span></span> <span data-ttu-id="daf05-377">Note que o gateway predefinido deve ser diretamente acessível através de uma das interfaces físicas anexas à instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-377">Note that the default gateway must be directly accessible through one of the physical interfaces attached to the IP instance.</span></span> <span data-ttu-id="daf05-378">A aplicação chama ***nx_ip_gateway_address_set*** para configurar o endereço de gateway ip predefinido.</span><span class="sxs-lookup"><span data-stu-id="daf05-378">The application calls ***nx_ip_gateway_address_set*** to configure IP default gateway address.</span></span>

### <a name="ip-header"></a><span data-ttu-id="daf05-379">Cabeçalho IP</span><span class="sxs-lookup"><span data-stu-id="daf05-379">IP Header</span></span>

<span data-ttu-id="daf05-380">Para que qualquer pacote IP seja enviado na Internet, deve ter um cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-380">For any IP packet to be sent on the Internet, it must have an IP header.</span></span> <span data-ttu-id="daf05-381">Quando os protocolos de nível superior (UDP, TCP, ICMP ou IGMP) ligam para o componente IP para enviar um pacote, o módulo de transmissão IP coloca um cabeçalho IP na frente dos dados.</span><span class="sxs-lookup"><span data-stu-id="daf05-381">When higher-level protocols (UDP, TCP, ICMP, or IGMP) call the IP component to send a packet, the IP transmit module places an IP header in front of the data.</span></span> <span data-ttu-id="daf05-382">Inversamente, quando os pacotes IP são recebidos da rede, o componente IP remove o cabeçalho IP do pacote antes da entrega aos protocolos de nível superior.</span><span class="sxs-lookup"><span data-stu-id="daf05-382">Conversely, when IP packets are received from the network, the IP component removes the IP header from the packet before delivery to the higher-level protocols.</span></span> <span data-ttu-id="daf05-383">A figura 5 mostra o formato do cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-383">Figure 5 shows the format of the IP header.</span></span>

![Formato de cabeçalho IP](./media/user-guide/ip-header-format.png)

<span data-ttu-id="daf05-385">**FIGURA 5. Formato de cabeçalho IP**</span><span class="sxs-lookup"><span data-stu-id="daf05-385">**FIGURE 5. IP Header Format**</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-386">*Espera-se que todos os cabeçalhos na implementação TCP/IP estejam em grande formato endiano. Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo. Por exemplo, a versão de 4 bits e o comprimento do cabeçalho de 4 bits do cabeçalho IP devem ser localizados no primeiro byte do cabeçalho.*</span><span class="sxs-lookup"><span data-stu-id="daf05-386">*All headers in the TCP/IP implementation are expected to be in big endian format. In this format, the most significant byte of the word resides at the lowest byte address. For example, the 4-bit version and the 4-bit header length of the IP header must be located on the first byte of the header.*</span></span>

<span data-ttu-id="daf05-387">Os campos do cabeçalho IP são definidos da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="daf05-387">The fields of the IP header are defined as follows:</span></span>

<span data-ttu-id="daf05-388">**Finalidade do campo do cabeçalho IP**</span><span class="sxs-lookup"><span data-stu-id="daf05-388">**IP Header Field Purpose**</span></span>

<span data-ttu-id="daf05-389">***Versão de 4 bits*** Este campo contém a versão de IP que este cabeçalho representa.</span><span class="sxs-lookup"><span data-stu-id="daf05-389">***4-bit version*** This field contains the version of IP this header represents.</span></span> <span data-ttu-id="daf05-390">Para a versão IP 4, que é o que o NetX suporta, o valor deste campo é 4.</span><span class="sxs-lookup"><span data-stu-id="daf05-390">For IP version 4, which is what NetX supports, the value of this field is 4.</span></span>

<span data-ttu-id="daf05-391">***Comprimento do cabeçalho de 4 bits*** Este campo especifica o número de palavras de 32 bits no cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-391">***4-bit header length*** This field specifies the number of 32-bit words in the IP header.</span></span> <span data-ttu-id="daf05-392">Se não houver palavras de opção, o valor para este campo é 5.</span><span class="sxs-lookup"><span data-stu-id="daf05-392">If no option words are present, the value for this field is 5.</span></span>

<span data-ttu-id="daf05-393">***Tipo de serviço de 8 bits (TOS)*** Este campo especifica o tipo de serviço solicitado para este pacote IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-393">***8-bit type of service (TOS)*** This field specifies the type of service requested for this IP packet.</span></span> <span data-ttu-id="daf05-394">Os pedidos válidos são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="daf05-394">Valid requests are as follows:</span></span>

| <span data-ttu-id="daf05-395">**Pedido de TOS**</span><span class="sxs-lookup"><span data-stu-id="daf05-395">**TOS Request**</span></span>     | <span data-ttu-id="daf05-396">**Valor**</span><span class="sxs-lookup"><span data-stu-id="daf05-396">**Value**</span></span> |
| ------------------- | --------- |
| <span data-ttu-id="daf05-397">Normal</span><span class="sxs-lookup"><span data-stu-id="daf05-397">Normal</span></span>              | <span data-ttu-id="daf05-398">0x00</span><span class="sxs-lookup"><span data-stu-id="daf05-398">0x00</span></span>      |
| <span data-ttu-id="daf05-399">Atraso Mínimo</span><span class="sxs-lookup"><span data-stu-id="daf05-399">Minimum Delay</span></span>       | <span data-ttu-id="daf05-400">0x10</span><span class="sxs-lookup"><span data-stu-id="daf05-400">0x10</span></span>      |
| <span data-ttu-id="daf05-401">Dados Máximos</span><span class="sxs-lookup"><span data-stu-id="daf05-401">Maximum Data</span></span>        | <span data-ttu-id="daf05-402">0x08</span><span class="sxs-lookup"><span data-stu-id="daf05-402">0x08</span></span>      |
| <span data-ttu-id="daf05-403">Fiabilidade máxima</span><span class="sxs-lookup"><span data-stu-id="daf05-403">Maximum Reliability</span></span> | <span data-ttu-id="daf05-404">0x04</span><span class="sxs-lookup"><span data-stu-id="daf05-404">0x04</span></span>      |
| <span data-ttu-id="daf05-405">Custo Mínimo</span><span class="sxs-lookup"><span data-stu-id="daf05-405">Minimum Cost</span></span>        | <span data-ttu-id="daf05-406">0x02</span><span class="sxs-lookup"><span data-stu-id="daf05-406">0x02</span></span>      |

<span data-ttu-id="daf05-407">***Comprimento total de 16 bits*** Este campo contém o comprimento total do datagrama IP em bytes, incluindo o cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-407">***16-bit total length*** This field contains the total length of the IP datagram in bytes, including the IP header.</span></span> <span data-ttu-id="daf05-408">Um datagrama IP é a unidade básica de informação encontrada numa Internet TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-408">An IP datagram is the basic unit of information found on a TCP/IP Internet.</span></span> <span data-ttu-id="daf05-409">Contém um endereço de destino e origem para além dos dados.</span><span class="sxs-lookup"><span data-stu-id="daf05-409">It contains a destination and source address in addition to data.</span></span> <span data-ttu-id="daf05-410">Por ser um campo de 16 bits, o tamanho máximo de um datagrama IP é de 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="daf05-410">Because it is a 16-bit field, the maximum size of an IP datagram is 65,535 bytes.</span></span>

<span data-ttu-id="daf05-411">***Identificação de 16 bits*** O campo é um número usado para identificar exclusivamente cada datagrama IP enviado de um anfitrião.</span><span class="sxs-lookup"><span data-stu-id="daf05-411">***16-bit identification*** The field is a number used to uniquely identify each IP datagram sent from a host.</span></span> <span data-ttu-id="daf05-412">Este número é tipicamente incrementado após o envio de um datagrama IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-412">This number is typically incremented after an IP datagram is sent.</span></span> <span data-ttu-id="daf05-413">É especialmente útil na montagem de fragmentos de pacotes IP recebidos.</span><span class="sxs-lookup"><span data-stu-id="daf05-413">It is especially useful in assembling received IP packet fragments.</span></span>

<span data-ttu-id="daf05-414">***Bandeiras de 3 bits*** Este campo contém informações de fragmentação IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-414">***3-bit flags*** This field contains IP fragmentation information.</span></span> <span data-ttu-id="daf05-415">O bit 14 é a parte do "não se fragmentar".</span><span class="sxs-lookup"><span data-stu-id="daf05-415">Bit 14 is the "don't fragment" bit.</span></span> <span data-ttu-id="daf05-416">Se esta bit estiver definida, o datagrama ip de saída não será fragmentado.</span><span class="sxs-lookup"><span data-stu-id="daf05-416">If this bit is set, the outgoing IP datagram will not be fragmented.</span></span> <span data-ttu-id="daf05-417">O bit 13 é a parte "mais fragmentos".</span><span class="sxs-lookup"><span data-stu-id="daf05-417">Bit 13 is the "more fragments" bit.</span></span> <span data-ttu-id="daf05-418">Se esta parte estiver definida, há mais fragmentos.</span><span class="sxs-lookup"><span data-stu-id="daf05-418">If this bit is set, there are more fragments.</span></span> <span data-ttu-id="daf05-419">Se esta parte estiver clara, este é o último fragmento do pacote IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-419">If this bit is clear, this is the last fragment of the IP packet.</span></span>

<span data-ttu-id="daf05-420">**Finalidade do campo do cabeçalho IP**</span><span class="sxs-lookup"><span data-stu-id="daf05-420">**IP Header Field Purpose**</span></span>

<span data-ttu-id="daf05-421">***Compensação de fragmentos de 13 bits*** Este campo contém os 13 bits superiores da offset do fragmento.</span><span class="sxs-lookup"><span data-stu-id="daf05-421">***13-bit fragment offset*** This field contains the upper 13-bits of the fragment offset.</span></span> <span data-ttu-id="daf05-422">Por causa disso, as compensações de fragmentos só são permitidas em limites de 8 bytes.</span><span class="sxs-lookup"><span data-stu-id="daf05-422">Because of this, fragment offsets are only allowed on 8-byte boundaries.</span></span> <span data-ttu-id="daf05-423">O primeiro fragmento de um datagrama ip fragmentado terá o conjunto de bits "mais fragmentos" e terá uma compensação de 0.</span><span class="sxs-lookup"><span data-stu-id="daf05-423">The first fragment of a fragmented IP datagram will have the “more fragments” bit set and have an offset of 0.</span></span>

<span data-ttu-id="daf05-424">***8 bits de tempo para viver (TTL)*** Este campo contém o número de routers que este datagrama pode passar, o que limita o tempo de vida útil do datagrama.</span><span class="sxs-lookup"><span data-stu-id="daf05-424">***8-bit time to live (TTL)*** This field contains the number of routers this datagram can pass, which limits the lifetime of the datagram.</span></span>

<span data-ttu-id="daf05-425">***Protocolo de 8 bits*** Este campo especifica qual o protocolo que está a utilizar o datagrama IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-425">***8-bit protocol*** This field specifies which protocol is using the IP datagram.</span></span> <span data-ttu-id="daf05-426">Segue-se uma lista de protocolos válidos e seus valores:</span><span class="sxs-lookup"><span data-stu-id="daf05-426">The following is a list of valid protocols and their values:</span></span>

| <span data-ttu-id="daf05-427">Protocolo</span><span class="sxs-lookup"><span data-stu-id="daf05-427">Protocol</span></span> | <span data-ttu-id="daf05-428">Valor</span><span class="sxs-lookup"><span data-stu-id="daf05-428">Value</span></span> |
|----------|-------|
| <span data-ttu-id="daf05-429">ICMP</span><span class="sxs-lookup"><span data-stu-id="daf05-429">ICMP</span></span>     | <span data-ttu-id="daf05-430">0x01</span><span class="sxs-lookup"><span data-stu-id="daf05-430">0x01</span></span>  |
| <span data-ttu-id="daf05-431">IGMP</span><span class="sxs-lookup"><span data-stu-id="daf05-431">IGMP</span></span>     | <span data-ttu-id="daf05-432">0x02</span><span class="sxs-lookup"><span data-stu-id="daf05-432">0x02</span></span>  |
| <span data-ttu-id="daf05-433">TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-433">TCP</span></span>      | <span data-ttu-id="daf05-434">0X06</span><span class="sxs-lookup"><span data-stu-id="daf05-434">0X06</span></span>  |
| <span data-ttu-id="daf05-435">UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-435">UDP</span></span>      | <span data-ttu-id="daf05-436">0X11</span><span class="sxs-lookup"><span data-stu-id="daf05-436">0X11</span></span>  |
|          |       |


<span data-ttu-id="daf05-437">***Cheque de 16 bits*** Este campo contém a parte de verificação de 16 bits que cobre apenas o cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-437">***16-bit checksum*** This field contains the 16-bit checksum that covers the IP header only.</span></span> <span data-ttu-id="daf05-438">Existem despesas de verificação adicionais nos protocolos de nível superior que cobrem a carga útil ip.</span><span class="sxs-lookup"><span data-stu-id="daf05-438">There are additional checksums in the higher level protocols that cover the IP payload.</span></span>

<span data-ttu-id="daf05-439">***Endereço IP de origem de 32 bits*** Este campo contém o endereço IP do remetente e é sempre um endereço de anfitrião.</span><span class="sxs-lookup"><span data-stu-id="daf05-439">***32-bit source IP address*** This field contains the IP address of the sender and is always a host address.</span></span>

<span data-ttu-id="daf05-440">***Endereço IP de destino de 32 bits*** Este campo contém o endereço IP do recetor ou dos recetores se o endereço for um endereço transmitido ou multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-440">***32-bit destination IP address*** This field contains the IP address of the receiver or receivers if the address is a broadcast or multicast address.</span></span>

### <a name="creating-ip-instances"></a><span data-ttu-id="daf05-441">Criação de Instâncias IP</span><span class="sxs-lookup"><span data-stu-id="daf05-441">Creating IP Instances</span></span>

<span data-ttu-id="daf05-442">As instâncias IP são criadas durante a inicialização ou durante o tempo de execução por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-442">IP instances are created either during initialization or during runtime by application threads.</span></span> <span data-ttu-id="daf05-443">O endereço IP inicial, máscara de rede, conjunto de pacotes predefinidos, controlador de mídia e memória e prioridade do fio IP interno são definidos pelo serviço *nx_ip_create.*</span><span class="sxs-lookup"><span data-stu-id="daf05-443">The initial IP address, network mask, default packet pool, media driver, and memory and priority of the internal IP thread are defined by the *nx_ip_create* service.</span></span> <span data-ttu-id="daf05-444">Se a aplicação rubricar a instância IP com o seu endereço IP definido para um endereço inválido (0.0.0.0), presume-se que o endereço de interface será resolvido por configuração manual mais tarde, via RARP, ou através de DHCP ou protocolos semelhantes.</span><span class="sxs-lookup"><span data-stu-id="daf05-444">If the application initializes the IP instance with its IP address set to an invalid address(0.0.0.0), it is assumed that the interface address is going to resolved by manual configuration later, via RARP, or through DHCP or similar protocols.</span></span>

<span data-ttu-id="daf05-445">Para sistemas com múltiplas interfaces de rede, a interface principal é designada quando se chama *nx_ip_create*.</span><span class="sxs-lookup"><span data-stu-id="daf05-445">For systems with multiple network interfaces, the primary interface is designated when calling *nx_ip_create*.</span></span> <span data-ttu-id="daf05-446">Cada interface adicional pode ser anexada à mesma instância IP, chamando *nx_ip_interface_attach*.</span><span class="sxs-lookup"><span data-stu-id="daf05-446">Each additional interface can be attached to the same IP instance by calling *nx_ip_interface_attach*.</span></span> <span data-ttu-id="daf05-447">Este serviço armazena informações sobre a interface de rede (como endereço IP, máscara de rede) no bloco de controlo de interface, e associa a instância do condutor ao bloco de controlo de interface na instância IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-447">This service stores information about the network interface (such as IP address, network mask) in the interface control block, and associates the driver instance with the interface control block in the IP instance.</span></span> <span data-ttu-id="daf05-448">Como o condutor recebe um pacote de dados, precisa de armazenar a informação da interface na estrutura NX_PACKET antes de reencaminhar para a lógica de receção IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-448">As the driver receives a data packet, it needs to store the interface information in the NX_PACKET structure before forwarding it to the IP receive logic.</span></span> <span data-ttu-id="daf05-449">Note que uma instância IP já deve ser criada antes de anexar quaisquer interfaces.</span><span class="sxs-lookup"><span data-stu-id="daf05-449">Note an IP instance must already be created before attaching any interfaces.</span></span>

 ### <a name="ip-send"></a><span data-ttu-id="daf05-450">IP Enviar</span><span class="sxs-lookup"><span data-stu-id="daf05-450">IP Send</span></span>
 <span data-ttu-id="daf05-451">O processamento de envio IP no NetX é muito simplificado.</span><span class="sxs-lookup"><span data-stu-id="daf05-451">The IP send processing in NetX is very streamlined.</span></span>

<span data-ttu-id="daf05-452">O ponteiro pré-final do pacote é movido para trás para acomodar o cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-452">The prepend pointer in the packet is moved backwards to accommodate the IP header.</span></span> <span data-ttu-id="daf05-453">O cabeçalho IP é preenchido (com todas as opções especificadas pela camada do protocolo de chamada), a estação de verificação IP é calculada em linha e o pacote é enviado para o controlador de rede associado.</span><span class="sxs-lookup"><span data-stu-id="daf05-453">The IP header is completed (with all the options specified by the calling protocol layer), the IP checksum is computed in-line, and the packet is dispatched to the associated network driver.</span></span> <span data-ttu-id="daf05-454">Além disso, a fragmentação de saída também é coordenada a partir do processamento de envio de IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-454">In addition, outgoing fragmentation is also coordinated from within the IP send processing.</span></span>

<span data-ttu-id="daf05-455">Para IP, o NetX inicia pedidos de ARP se for necessário mapeamento físico para o endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-455">For IP, NetX initiates ARP requests if physical mapping is needed for the destination IP address.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-456">*Para a conectividade IP, os pacotes que requerem resolução de endereço IP (isto é, mapeamento físico) são encadeados na fila ARP até que o número de pacotes em fila exceda a profundidade da fila ARP (definida pelo* *símbolo **NX_ARP_MAX_QUEUE_DEPTH).** Se a* profundidade da *fila for alcançada, o NetX removerá o pacote mais antigo da fila e continuará à espera da resolução de endereços para os restantes pacotes encadeados. Por outro lado, se uma entrada ARP não for resolvida, os pacotes pendentes na entrada ARP são lançados após o tempo de entrada do ARP.*</span><span class="sxs-lookup"><span data-stu-id="daf05-456">*For IP connectivity, packets that require IP address resolution (i.e., physical mapping) are enqueued on the ARP queue until the number of packets queued exceeds the ARP queue depth (defined by the* *symbol **NX_ARP_MAX_QUEUE_DEPTH**). If the* *queue depth is reached, NetX will remove the oldest packet on the queue and continue waiting for address resolution for the remaining packets enqueued. On the other hand, if an ARP entry is not resolved, the pending packets on the ARP entry are released upon ARP entry timeout.*</span></span>

<span data-ttu-id="daf05-457">Para sistemas com múltiplas interfaces de rede, o NetX escolhe uma interface com base no endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-457">For systems with multiple network interfaces, NetX chooses an interface based on the destination IP address.</span></span> <span data-ttu-id="daf05-458">Aplica-se o seguinte procedimento ao processo de seleção:</span><span class="sxs-lookup"><span data-stu-id="daf05-458">The following procedure applies to the selection process:</span></span>

1. <span data-ttu-id="daf05-459">Se um endereço de destino for transmitido IP ou multicast, e se for especificada uma interface de saída válida, utilize essa interface.</span><span class="sxs-lookup"><span data-stu-id="daf05-459">If a destination address is IP broadcast or multicast, and if a valid outgoing interface is specified, use that interface.</span></span> <span data-ttu-id="daf05-460">Caso contrário, a primeira interface física é usada.</span><span class="sxs-lookup"><span data-stu-id="daf05-460">Otherwise, the first physical interface is used.</span></span>

2. <span data-ttu-id="daf05-461">Se o endereço de destino for encontrado na tabela de encaminhamento estático, a interface associada ao gateway é utilizada.</span><span class="sxs-lookup"><span data-stu-id="daf05-461">If the destination address is found in the static routing table, the interface associated with the gateway is used.</span></span>

3. <span data-ttu-id="daf05-462">Se o destino estiver ligado, a interface on-link é utilizada.</span><span class="sxs-lookup"><span data-stu-id="daf05-462">If the destination is on-link, the on-link interface is used.</span></span>

4. <span data-ttu-id="daf05-463">Se o endereço de destino for um endereço de retorno 127.0.0.1, a interface loopback é utilizada.</span><span class="sxs-lookup"><span data-stu-id="daf05-463">If the destination address is a loopback address 127.0.0.1, the loopback interface is used.</span></span>

5. <span data-ttu-id="daf05-464">Se o gateway predefinido estiver corretamente configurado, utilize a interface associada ao gateway predefinido para transmitir o pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-464">If the default gateway is properly configured, use the interface associated with the default gateway to transmit the packet.</span></span>

6. <span data-ttu-id="daf05-465">O pacote de saída é retirado se tudo o que precede falhar.</span><span class="sxs-lookup"><span data-stu-id="daf05-465">The output packet is dropped if all the above fails.</span></span>

### <a name="ip-receive"></a><span data-ttu-id="daf05-466">IP Receber</span><span class="sxs-lookup"><span data-stu-id="daf05-466">IP Receive</span></span>

<span data-ttu-id="daf05-467">O processamento de receção IP é chamado do controlador de rede ou do fio IP interno (para processamento de pacotes na fila de pacotes recebidos diferidos).</span><span class="sxs-lookup"><span data-stu-id="daf05-467">The IP receive processing is either called from the network driver or the internal IP thread (for processing packets on the deferred received packet queue).</span></span> <span data-ttu-id="daf05-468">O processamento de receção IP examina o campo do protocolo e tenta enviar o pacote para o componente de protocolo adequado.</span><span class="sxs-lookup"><span data-stu-id="daf05-468">The IP receive processing examines the protocol field and attempts to dispatch the packet to the proper protocol component.</span></span> <span data-ttu-id="daf05-469">Antes de o pacote ser realmente despachado, o cabeçalho IP é removido avançando o ponteiro pré-final para além do cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-469">Before the packet is actually dispatched, the IP header is removed by advancing the prepend pointer past the IP header.</span></span>

<span data-ttu-id="daf05-470">O processamento de receção IP também deteta pacotes IP fragmentados e executa as medidas necessárias para os remontar se a fragmentação estiver ativada.</span><span class="sxs-lookup"><span data-stu-id="daf05-470">IP receive processing also detects fragmented IP packets and performs the necessary steps to reassemble them if fragmentation is enabled.</span></span> <span data-ttu-id="daf05-471">Se for necessária fragmentação, mas não ativada, o pacote é largado.</span><span class="sxs-lookup"><span data-stu-id="daf05-471">If fragmentation is needed but not enabled, the packet is dropped.</span></span>

<span data-ttu-id="daf05-472">O NetX determina a interface de rede adequada com base na interface especificada no pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-472">NetX determines the appropriate network interface based on the interface specified in the packet.</span></span> <span data-ttu-id="daf05-473">Se a interface do pacote for NU, o NetX desrescumula a interface primária.</span><span class="sxs-lookup"><span data-stu-id="daf05-473">If the packet interface is NULL, NetX defaults to the primary interface.</span></span> <span data-ttu-id="daf05-474">Isto é feito para garantir compatibilidade com os condutores legados NetX Ethernet.</span><span class="sxs-lookup"><span data-stu-id="daf05-474">This is done to guarantee compatibility with legacy NetX Ethernet drivers.</span></span>

### <a name="raw-ip-send"></a><span data-ttu-id="daf05-475">Envio de IP cru</span><span class="sxs-lookup"><span data-stu-id="daf05-475">Raw IP Send</span></span>

<span data-ttu-id="daf05-476">Um pacote IP cru é um quadro IP que contém carga útil do protocolo de camada superior não suportado diretamente (e processado) pelo NetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-476">A raw IP packet is an IP frame that contains upper layer protocol payload not directly supported (and processed) by NetX.</span></span> <span data-ttu-id="daf05-477">Um pacote cru permite que os desenvolvedores definam as suas próprias aplicações baseadas em IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-477">A raw packet allows developers to define their own IP-based applications.</span></span> <span data-ttu-id="daf05-478">Uma aplicação pode enviar pacotes IP crus diretamente utilizando o serviço ***nx_ip_raw_packet_send** _ se o processamento de pacotes IP crus tiver sido ativado com o serviço _*_nx_ip_raw_packet_enabled._\*_</span><span class="sxs-lookup"><span data-stu-id="daf05-478">An application may send raw IP packets directly using the ***nx_ip_raw_packet_send** _ service if raw IP packet processing has been enabled with the _*_nx_ip_raw_packet_enabled_\*_ service.</span></span> <span data-ttu-id="daf05-479">Se o endereço de destino for um endereço multicast ou de transmissão, no entanto, o NetX desrescume da primeira interface (primária).</span><span class="sxs-lookup"><span data-stu-id="daf05-479">If the destination address is a multicast or broadcast address, however, NetX defaults to the first (primary) interface.</span></span> <span data-ttu-id="daf05-480">Portanto, para enviar esses pacotes em interfaces secundárias, a aplicação deve utilizar o serviço _ *_nx_ip_raw_packet_interface_send_*\* para especificar o endereço de origem a utilizar para o pacote de saída.</span><span class="sxs-lookup"><span data-stu-id="daf05-480">Therefore, to send such packets out on secondary interfaces, the application must use the _ *_nx_ip_raw_packet_interface_send_*\* service to specify the source address to use for the outgoing packet.</span></span>

### <a name="raw-ip-receive"></a><span data-ttu-id="daf05-481">Receber IP cru</span><span class="sxs-lookup"><span data-stu-id="daf05-481">Raw IP Receive</span></span>

<span data-ttu-id="daf05-482">Se o processamento de pacotes IP cru estiver ativado, a aplicação pode receber pacotes IP crus através do serviço \***nx_ip_raw_packet_receive** _ .</span><span class="sxs-lookup"><span data-stu-id="daf05-482">If raw IP packet processing is enabled, the application may receive raw IP packets through the \***nx_ip_raw_packet_receive** _ service.</span></span> <span data-ttu-id="daf05-483">Todos os pacotes de entrada são processados de acordo com o protocolo especificado no cabeçalho IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-483">All incoming packets are processed according to the protocol specified in the IP header.</span></span> <span data-ttu-id="daf05-484">Se o protocolo especificar UDP, TCP, IGMP ou ICMP, a NetX processará o pacote utilizando o manipulador apropriado para o tipo de protocolo de pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-484">If the protocol specifies UDP, TCP, IGMP or ICMP, NetX will process the packet using the appropriate handler for the packet protocol type.</span></span> <span data-ttu-id="daf05-485">Se o protocolo não for um destes protocolos, e a receção ip bruta estiver ativada, o pacote de entrada será colocado na fila de pacotes brutos à espera que a aplicação o receba através do serviço _ *_nx_ip_raw_packet_receive*_\*.</span><span class="sxs-lookup"><span data-stu-id="daf05-485">If the protocol is not one of these protocols, and raw IP receive is enabled, the incoming packet will be put into the raw packet queue waiting for the application to receive it via the _ *_nx_ip_raw_packet_receive_*\* service.</span></span> <span data-ttu-id="daf05-486">Além disso, os fios de aplicação podem suspender com um intervalo opcional enquanto aguardam um pacote IP cru.</span><span class="sxs-lookup"><span data-stu-id="daf05-486">In addition, application threads may suspend with an optional timeout while waiting for a raw IP packet.</span></span>

### <a name="default-packet-pool"></a><span data-ttu-id="daf05-487">Piscina de pacotes predefinidos</span><span class="sxs-lookup"><span data-stu-id="daf05-487">Default Packet Pool</span></span>

<span data-ttu-id="daf05-488">Cada instância IP recebe um pacote de pacote padrão durante a criação.</span><span class="sxs-lookup"><span data-stu-id="daf05-488">Each IP instance is given a default packet pool during creation.</span></span> <span data-ttu-id="daf05-489">Este pacote de piscina é utilizado para alocar pacotes para ARP, RARP, ICMP, IGMP, vários pacotes de controlo TCP (tais como SYN, ACK).</span><span class="sxs-lookup"><span data-stu-id="daf05-489">This packet pool is used to allocate packets for ARP, RARP, ICMP, IGMP, various TCP control packets (such as SYN, ACK).</span></span> <span data-ttu-id="daf05-490">Se o pacote predefinido estiver vazio quando o NetX precisar de alocar um pacote, o NetX poderá ter de abortar a operação em particular e devolver uma mensagem de erro se possível.</span><span class="sxs-lookup"><span data-stu-id="daf05-490">If the default packet pool is empty when NetX needs to allocate a packet, NetX may have to abort the particular operation, and will return an error message if possible.</span></span>

### <a name="ip-helper-thread"></a><span data-ttu-id="daf05-491">Fio de ajudante IP</span><span class="sxs-lookup"><span data-stu-id="daf05-491">IP Helper Thread</span></span>

<span data-ttu-id="daf05-492">Cada instância IP tem um fio de ajuda.</span><span class="sxs-lookup"><span data-stu-id="daf05-492">Each IP instance has a helper thread.</span></span> <span data-ttu-id="daf05-493">Este fio é responsável pelo manuseamento de todo o processamento de pacotes diferidos e de todo o processamento periódico.</span><span class="sxs-lookup"><span data-stu-id="daf05-493">This thread is responsible for handling all deferred packet processing and all periodic processing.</span></span> <span data-ttu-id="daf05-494">O fio do ajudante IP é criado em ***nx_ip_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-494">The IP helper thread is created in ***nx_ip_create.***</span></span> <span data-ttu-id="daf05-495">É aqui que o fio é dado a sua pilha e prioridade.</span><span class="sxs-lookup"><span data-stu-id="daf05-495">This is where the thread is given its stack and priority.</span></span> <span data-ttu-id="daf05-496">Note que o primeiro processamento na linha de ajuda IP é terminar a inicialização do controlador de rede associada ao serviço de criação IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-496">Note that the first processing in the IP helper thread is to finish the network driver initialization associated with the IP create service.</span></span> <span data-ttu-id="daf05-497">Após a inicialização do controlador de rede estar concluída, o fio do ajudante inicia um ciclo interminável para processar pacotes e pedidos periódicos.</span><span class="sxs-lookup"><span data-stu-id="daf05-497">After the network driver initialization is complete, the helper thread starts an endless loop to process packet and periodic requests.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-498">*Se o comportamento inexplicável for visto dentro do fio do ajudante IP, aumentar o tamanho da pilha durante o serviço de criação IP é o primeiro passo de depurar. Se a pilha for muito pequena, o fio do ajudante IP pode estar a sobrepor-se à memória, o que pode causar problemas incomuns.*</span><span class="sxs-lookup"><span data-stu-id="daf05-498">*If unexplained behavior is seen within the IP helper thread, increasing its stack size during the IP create service is the first debugging step. If the stack is too small, the IP helper thread could possibly be overwriting memory, which may cause unusual problems.*</span></span>

### <a name="thread-suspension"></a><span data-ttu-id="daf05-499">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="daf05-499">Thread Suspension</span></span>

<span data-ttu-id="daf05-500">Os fios de aplicação podem suspender enquanto tentam receber pacotes IP crus.</span><span class="sxs-lookup"><span data-stu-id="daf05-500">Application threads can suspend while attempting to receive raw IP packets.</span></span> <span data-ttu-id="daf05-501">Depois de recebido um pacote cru, o novo pacote é dado ao primeiro fio suspenso e esse fio é retomado.</span><span class="sxs-lookup"><span data-stu-id="daf05-501">After a raw packet is received, the new packet is given to the first thread suspended and that thread is resumed.</span></span> <span data-ttu-id="daf05-502">Os serviços NetX para receber pacotes têm um tempo de suspensão opcional.</span><span class="sxs-lookup"><span data-stu-id="daf05-502">NetX services for receiving packets all have an optional suspension timeout.</span></span> <span data-ttu-id="daf05-503">Quando um pacote é recebido ou o tempo limite expira, o fio de aplicação é retomado com o estado de conclusão adequado.</span><span class="sxs-lookup"><span data-stu-id="daf05-503">When a packet is received or the timeout expires, the application thread is resumed with the appropriate completion status.</span></span>

### <a name="ip-statistics-and-errors"></a><span data-ttu-id="daf05-504">Estatísticas e erros ip</span><span class="sxs-lookup"><span data-stu-id="daf05-504">IP Statistics and Errors</span></span>

<span data-ttu-id="daf05-505">Se ativado, o NetX regista várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-505">If enabled, the NetX keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-506">As seguintes estatísticas e relatórios de erro são mantidos para cada instância DEP:</span><span class="sxs-lookup"><span data-stu-id="daf05-506">The following statistics and error reports are maintained for each IP instance:</span></span>

- <span data-ttu-id="daf05-507">Total de pacotes IP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-507">Total IP Packets Sent</span></span>
- <span data-ttu-id="daf05-508">Total de bytes IP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-508">Total IP Bytes Sent</span></span>
- <span data-ttu-id="daf05-509">Total de pacotes IP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-509">Total IP Packets Received</span></span>
- <span data-ttu-id="daf05-510">Total de bytes IP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-510">Total IP Bytes Received</span></span>
- <span data-ttu-id="daf05-511">Total de pacotes inválidos IP</span><span class="sxs-lookup"><span data-stu-id="daf05-511">Total IP Invalid Packets</span></span>
- <span data-ttu-id="daf05-512">Total de pacotes de receção IP abandonados</span><span class="sxs-lookup"><span data-stu-id="daf05-512">Total IP Receive Packets Dropped</span></span>
- <span data-ttu-id="daf05-513">Total IP Receber Erros de Checkum</span><span class="sxs-lookup"><span data-stu-id="daf05-513">Total IP Receive Checksum Errors</span></span>
- <span data-ttu-id="daf05-514">Total IP Enviar Pacotes Abandonados</span><span class="sxs-lookup"><span data-stu-id="daf05-514">Total IP Send Packets Dropped</span></span>
- <span data-ttu-id="daf05-515">Total de fragmentos ip enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-515">Total IP Fragments Sent</span></span>
- <span data-ttu-id="daf05-516">Total de fragmentos ip recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-516">Total IP Fragments Received</span></span>

<span data-ttu-id="daf05-517">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_ip_info_get.***</span><span class="sxs-lookup"><span data-stu-id="daf05-517">All of these statistics and error reports are available to the application with the ***nx_ip_info_get*** service.</span></span>

### <a name="ip-control-block-nx_ip"></a><span data-ttu-id="daf05-518">NX_IP do Bloco de Controlo IP</span><span class="sxs-lookup"><span data-stu-id="daf05-518">IP Control Block NX_IP</span></span>

<span data-ttu-id="daf05-519">As características de cada instância IP encontram-se no seu bloco de controlo.</span><span class="sxs-lookup"><span data-stu-id="daf05-519">The characteristics of each IP instance are found in its control block.</span></span> <span data-ttu-id="daf05-520">Contém informações úteis, tais como endereços IP e máscaras de rede de cada dispositivo de rede, e uma tabela de IP vizinho e mapeamento de endereços de hardware físico.</span><span class="sxs-lookup"><span data-stu-id="daf05-520">It contains useful information such as the IP addresses and network masks of each network device, and a table of neighbor IP and physical hardware address mapping.</span></span> <span data-ttu-id="daf05-521">Esta estrutura é definida nos blocos de controlo de instância ip ***nx_api.h*** podem ser localizados em qualquer lugar da memória, mas é mais comum fazer do bloco de controlo uma estrutura global definindo-o fora do âmbito de qualquer função.</span><span class="sxs-lookup"><span data-stu-id="daf05-521">This structure is defined in the ***nx_api.h*** IP instance control blocks can be located anywhere in memory, but it is most common to make the control block a global structure by defining it outside the scope of any function.</span></span>

### <a name="static-ip-routing"></a><span data-ttu-id="daf05-522">Encaminhamento IP estático</span><span class="sxs-lookup"><span data-stu-id="daf05-522">Static IP Routing</span></span>

<span data-ttu-id="daf05-523">A funcionalidade de encaminhamento estático permite que uma aplicação especifique uma rede IP e o próximo endereço de lúpulo para endereços IP específicos fora da rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-523">The static routing feature allows an application to specify an IP network and next hop address for specific out of network destination IP addresses.</span></span> <span data-ttu-id="daf05-524">Se o encaminhamento estático estiver ativado, o NetX procura através da tabela de encaminhamento estático para uma entrada correspondente ao endereço de destino do pacote a enviar.</span><span class="sxs-lookup"><span data-stu-id="daf05-524">If static routing is enabled, NetX searches through the static routing table for an entry matching the destination address of the packet to send.</span></span> <span data-ttu-id="daf05-525">Se não for encontrado qualquer correspondência, o NetX procura através da lista de interfaces físicas e escolhe um endereço IP de origem e próximo endereço de lúpulo baseado no endereço IP de destino e na máscara de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-525">If no match is found, NetX searches through the list of physical interfaces and chooses a source IP address and next hop address based on the destination IP address and the network mask.</span></span> <span data-ttu-id="daf05-526">Se o destino não corresponder a nenhum dos endereços IP dos controladores de rede ligados à instância IP, o NetX escolhe uma interface que está diretamente ligada ao gateway predefinido e utiliza o endereço IP da interface como endereço de origem e o gateway predefinido como o próximo salto.</span><span class="sxs-lookup"><span data-stu-id="daf05-526">If the destination does not match any of the IP addresses of the network drivers attached to the IP instance, NetX chooses an interface that is directly connected to the default gateway, and uses the IP address of the interface as source address, and the default gateway as the next hop.</span></span>

<span data-ttu-id="daf05-527">As entradas podem ser adicionadas e removidas da tabela de encaminhamento estático utilizando os serviços ***nx_ip_static_route_add*** e \***nx_ip_static_route_delete** _, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="daf05-527">Entries can be added and removed from the static routing table using the ***nx_ip_static_route_add*** and \***nx_ip_static_route_delete** _ services, respectively.</span></span> <span data-ttu-id="daf05-528">Para utilizar o encaminhamento estático, a aplicação do anfitrião deve ativar esta função definindo _ *_NX_ENABLE_IP_STATIC_ROUTING_*.\*</span><span class="sxs-lookup"><span data-stu-id="daf05-528">To use static routing, the host application must enable this feature by defining _ *_NX_ENABLE_IP_STATIC_ROUTING_*.\*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-529">*Ao adicionar uma entrada na tabela de encaminhamento estático, o NetX verifica uma entrada correspondente para o endereço de destino especificado já na tabela. Se existir, dá preferência à entrada com a rede mais pequena (prefixo mais longo) na máscara de rede.*</span><span class="sxs-lookup"><span data-stu-id="daf05-529">*When adding an entry to the static routing table, NetX checks for a matching entry for the specified destination address already in the table. If one exists, it gives preference to the entry with the smaller network (longer prefix) in the network mask.*</span></span>

### <a name="ip-fragmentation"></a><span data-ttu-id="daf05-530">Fragmentação ip</span><span class="sxs-lookup"><span data-stu-id="daf05-530">IP Fragmentation</span></span>

<span data-ttu-id="daf05-531">O dispositivo de rede pode ter limites no tamanho dos pacotes de saída.</span><span class="sxs-lookup"><span data-stu-id="daf05-531">The network device may have limits on the size of outgoing packets.</span></span> <span data-ttu-id="daf05-532">Este limite é chamado de unidade de transmissão máxima (MTU).</span><span class="sxs-lookup"><span data-stu-id="daf05-532">This limit is called the maximum transmission unit (MTU).</span></span> <span data-ttu-id="daf05-533">IP MTU é o maior tamanho de quadro IP que o controlador de camada de ligação é capaz de transmitir sem fragmentar o pacote IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-533">IP MTU is the largest IP frame size a link layer driver is able to transmit without fragmenting the IP packet.</span></span> <span data-ttu-id="daf05-534">Durante uma fase de inicialização do controlador do dispositivo, o módulo do condutor deve configurar o seu tamanho IP MTU através do serviço \***nx_ip_interface_mtu_set**.\*</span><span class="sxs-lookup"><span data-stu-id="daf05-534">During a device driver initialization phase, the driver module must configure its IP MTU size via the service \***nx_ip_interface_mtu_set**.\*</span></span>

<span data-ttu-id="daf05-535">Embora não recomendado, a aplicação pode gerar datagramas maiores do que o IP MTU subjacente suportado pelo dispositivo.</span><span class="sxs-lookup"><span data-stu-id="daf05-535">Although not recommended, the application may generate datagrams larger than the underlying IP MTU supported by the device.</span></span> <span data-ttu-id="daf05-536">Antes de transmitir tais datagramas de IP, a camada IP deve fragmentar estes pacotes.</span><span class="sxs-lookup"><span data-stu-id="daf05-536">Before transmitting such IP datagram, the IP layer must fragment these packets.</span></span> <span data-ttu-id="daf05-537">Ao receber quadros IP fragmentados, a extremidade recetora deve armazenar todos os quadros IP fragmentados com o mesmo ID de fragmentação e montá-los em ordem.</span><span class="sxs-lookup"><span data-stu-id="daf05-537">On receiving fragmented IP frames, the receiving end must store all fragmented IP frames with the same fragmentation ID, and reassemble them in order.</span></span> <span data-ttu-id="daf05-538">Se a lógica de receção ip não for capaz de recolher todos os fragmentos para restaurar o quadro IP original no tempo, todos os fragmentos são libertados.</span><span class="sxs-lookup"><span data-stu-id="daf05-538">If the IP receive logic is unable to collect all the fragments to restore the original IP frame in time, all the fragments are released.</span></span> <span data-ttu-id="daf05-539">Cabe ao protocolo da camada superior detetar tal perda de pacote e recuperá-la.</span><span class="sxs-lookup"><span data-stu-id="daf05-539">It is up to the upper layer protocol to detect such packet loss and recover from it.</span></span>

<span data-ttu-id="daf05-540">Para suportar a fragmentação e o funcionamento da fragmentação ip, o designer de sistema deve ativar a função de fragmentação IP no NetX utilizando o serviço ***nx_ip_fragment_enable.***</span><span class="sxs-lookup"><span data-stu-id="daf05-540">In order to support IP fragmentation and reassembly operation, the system designer must enable the IP fragmentation feature in NetX using the ***nx_ip_fragment_enable*** service.</span></span> <span data-ttu-id="daf05-541">Se esta função não estiver ativada, os pacotes IP fragmentados de entrada são descartados, bem como pacotes que excedam o MTU do controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-541">If this feature is not enabled, incoming fragmented IP packets are discarded, as well as packets that exceed the network driver's MTU.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-542">*A lógica de fragmentação IP pode ser completamente removida definindo*  \* **NX_DISABLE_FRAGMENTATION** _ _when construindo a bibliotecaNetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-542">*The IP Fragmentation logic can be removed completely by defining* \***NX_DISABLE_FRAGMENTATION** _ _when building theNetX library.</span></span> <span data-ttu-id="daf05-543">Fazê-lo ajuda a reduzir o tamanho do código do NetX.\*</span><span class="sxs-lookup"><span data-stu-id="daf05-543">Doing so helps reduce the code size of NetX.\*</span></span>

## <a name="address-resolution-protocol-arp-in-ip"></a><span data-ttu-id="daf05-544">Protocolo de Resolução de Endereços (ARP) em IP</span><span class="sxs-lookup"><span data-stu-id="daf05-544">Address Resolution Protocol (ARP) in IP</span></span>

<span data-ttu-id="daf05-545">O Protocolo de Resolução de Endereços (ARP) é responsável por mapear dinamicamente endereços IP de 32 bits aos dos meios físicos subjacentes (RFC 826).</span><span class="sxs-lookup"><span data-stu-id="daf05-545">The Address Resolution Protocol (ARP) is responsible for dynamically mapping 32-bit IP addresses to those of the underlying physical media (RFC 826).</span></span> <span data-ttu-id="daf05-546">Ethernet é o meio físico mais típico, e suporta endereços de 48 bits.</span><span class="sxs-lookup"><span data-stu-id="daf05-546">Ethernet is the most typical physical media, and it supports 48-bit addresses.</span></span> <span data-ttu-id="daf05-547">A necessidade de ARP é determinada pelo controlador de rede fornecido ao serviço ***nx_ip_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-547">The need for ARP is determined by the network driver supplied to the ***nx_ip_create*** service.</span></span> <span data-ttu-id="daf05-548">Se for necessário um mapeamento físico, o controlador da rede deve definir a bandeira ***nx_interface_address_mapping_needed*** no strcuture da interface.</span><span class="sxs-lookup"><span data-stu-id="daf05-548">If physical mapping is required, the network driver must set the flag ***nx_interface_address_mapping_needed*** in the interface strcuture.</span></span>

### <a name="arp-enable"></a><span data-ttu-id="daf05-549">Ativar a ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-549">ARP Enable</span></span>
<span data-ttu-id="daf05-550">Para que a ARP funcione corretamente, deve primeiro ser ativada pela aplicação com o serviço ***nx_arp_enable.***</span><span class="sxs-lookup"><span data-stu-id="daf05-550">For ARP to function properly, it must first be enabled by the application with the ***nx_arp_enable*** service.</span></span> <span data-ttu-id="daf05-551">Este serviço estabelece várias estruturas de dados para o processamento de ARP, incluindo a criação de uma área de cache ARP a partir da memória fornecida ao serviço de ativação ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-551">This service sets up various data structures for ARP processing, including the creation of an ARP cache area from the memory supplied to the ARP enable service.</span></span>

### <a name="arp-cache"></a><span data-ttu-id="daf05-552">ARP Cache</span><span class="sxs-lookup"><span data-stu-id="daf05-552">ARP Cache</span></span>
<span data-ttu-id="daf05-553">A cache ARP pode ser vista como uma matriz de estruturas internas de dados de mapeamento ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-553">The ARP cache can be viewed as an array of internal ARP mapping data structures.</span></span> <span data-ttu-id="daf05-554">Cada estrutura interna é capaz de manter a relação entre um endereço IP e um endereço de hardware físico.</span><span class="sxs-lookup"><span data-stu-id="daf05-554">Each internal structure is capable of maintaining the relationship between an IP address and a physical hardware address.</span></span> <span data-ttu-id="daf05-555">Além disso, cada estrutura de dados tem ponteiros de ligação para que possa fazer parte de várias listas ligadas.</span><span class="sxs-lookup"><span data-stu-id="daf05-555">In addition, each data structure has link pointers so it can be part of multiple linked lists.</span></span>

<span data-ttu-id="daf05-556">A aplicação pode procurar um endereço IP a partir da cache ARP fornecendo o endereço MAC de hardware usando o serviço \***nx_arp_ip_address_find** _ se o mapeamento existir na tabela ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-556">Application can look up an IP address from the ARP cache by supplying hardware MAC address using the service \***nx_arp_ip_address_find** _ if the mapping exists in the ARP table.</span></span> <span data-ttu-id="daf05-557">Da mesma forma, o serviço _ *_nx_arp_hardware_address_find_*\* devolve o endereço MAC para um determinado endereço IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-557">Similarly, the service _ *_nx_arp_hardware_address_find_*\* returns the MAC address for a given IP address.</span></span>


### <a name="arp-dynamic-entries"></a><span data-ttu-id="daf05-558">Entradas dinâmicas ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-558">ARP Dynamic Entries</span></span>

<span data-ttu-id="daf05-559">Por predefinição, o ARP permite que todas as entradas na cache ARP na lista de entradas ARP dinâmicas disponíveis.</span><span class="sxs-lookup"><span data-stu-id="daf05-559">By default, the ARP enable service places all entries in the ARP cache on the list of available dynamic ARP entries.</span></span> <span data-ttu-id="daf05-560">Uma entrada dinâmica de ARP é atribuída a partir desta lista pelo NetX quando é detetado um pedido de envio para um endereço IP não mapeado.</span><span class="sxs-lookup"><span data-stu-id="daf05-560">A dynamic ARP entry is allocated from this list by NetX when a send request to an unmapped IP address is detected.</span></span> <span data-ttu-id="daf05-561">Após a atribuição, a entrada ARP é configurada e um pedido ARP é enviado para os meios físicos.</span><span class="sxs-lookup"><span data-stu-id="daf05-561">After allocation, the ARP entry is set up and an ARP request is sent to the physical media.</span></span>

<span data-ttu-id="daf05-562">Uma entrada dinâmica também pode ser criada pelo serviço ***nx_arp_dynamic_entry_set***.</span><span class="sxs-lookup"><span data-stu-id="daf05-562">A dynamic entry can also be created by the service ***nx_arp_dynamic_entry_set***.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-563">*Se todas as entradas ARP dinâmicas estiverem a ser utilizadas, a entrada ARP menos utilizada é substituída por um novo mapeamento.*</span><span class="sxs-lookup"><span data-stu-id="daf05-563">*If all dynamic ARP entries are in use, the least recently used ARP entry is replaced with a new mapping.*</span></span>

### <a name="arp-static-entries"></a><span data-ttu-id="daf05-564">Entradas Estáticas ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-564">ARP Static Entries</span></span>
<span data-ttu-id="daf05-565">A aplicação também pode configurar mapeamento ARP estático utilizando o serviço ***nx_arp_static_entry_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-565">The application can also set up static ARP mapping by using the ***nx_arp_static_entry_create*** service.</span></span> <span data-ttu-id="daf05-566">Este serviço atribui uma entrada ARP da lista dinâmica de entrada ARP e coloca-a na lista estática com as informações de mapeamento fornecidas pela aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-566">This service allocates an ARP entry from the dynamic ARP entry list and places it on the static list with the mapping information supplied by the application.</span></span> <span data-ttu-id="daf05-567">As entradas ARP estáticas não estão sujeitas a reutilização ou envelhecimento.</span><span class="sxs-lookup"><span data-stu-id="daf05-567">Static ARP entries are not subject to reuse or aging.</span></span> <span data-ttu-id="daf05-568">A aplicação pode eliminar uma entrada estática utilizando o serviço ***nx_arp_static_entry_delete***.</span><span class="sxs-lookup"><span data-stu-id="daf05-568">The application can delete a static entry by using the service ***nx_arp_static_entry_delete***.</span></span>
<span data-ttu-id="daf05-569">Para remover todas as entradas estáticas na tabela ARP, a aplicação pode utilizar o serviço ***nx_arp_static_entries_delete***.</span><span class="sxs-lookup"><span data-stu-id="daf05-569">To remove all static entries in the ARP table, the application may use the service ***nx_arp_static_entries_delete***.</span></span>

### <a name="automatic-arp-entry"></a><span data-ttu-id="daf05-570">Entrada Automática de ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-570">Automatic ARP Entry</span></span>
<span data-ttu-id="daf05-571">NetX regista o mapeamento IP/MAC do par após as respostas dos pares ao pedido de ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-571">NetX records the peer's IP/MAC mapping after the peer responses to the ARP request.</span></span> <span data-ttu-id="daf05-572">O NetX também implementa a funcionalidade de entrada automática de ARP onde regista o mapeamento de endereços PEER/MAC com base em pedidos ARP não solicitados da rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-572">NetX also implements the automatic ARP entry feature where it records peer IP/MAC address mapping based on unsolicited ARP requests from the network.</span></span> <span data-ttu-id="daf05-573">Esta funcionalidade permite que a tabela ARP seja povoada com informações de pares, reduzindo o atraso necessário para passar pelo ciclo de pedido/resposta ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-573">This feature allows the ARP table to be populated with peer information, reducing the delay needed to go through the ARP request/response cycle.</span></span> <span data-ttu-id="daf05-574">No entanto, a desvantagem com a ativação automática do ARP é que a tabela ARP tende a encher-se rapidamente numa rede movimentada com muitos nós na ligação local, o que acabaria por levar à substituição da entrada do ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-574">However the downside with enabling automatic ARP is that the ARP table tend to fill up quickly on a busy network with many nodes on the local link, which would eventually lead to ARP entry replacement.</span></span>

<span data-ttu-id="daf05-575">Esta funcionalidade é ativada por padrão.</span><span class="sxs-lookup"><span data-stu-id="daf05-575">This feature is enabled by default.</span></span> <span data-ttu-id="daf05-576">Para desativá-la, a biblioteca NetX deve ser compilada com o símbolo ***NX_DISABLE_ARP_AUTO_ENTRY*** definido.</span><span class="sxs-lookup"><span data-stu-id="daf05-576">To disable it, the NetX library must be compiled with the symbol ***NX_DISABLE_ARP_AUTO_ENTRY*** defined.</span></span>

### <a name="arp-messages"></a><span data-ttu-id="daf05-577">Mensagens ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-577">ARP Messages</span></span>

<span data-ttu-id="daf05-578">Como mencionado anteriormente, uma mensagem de pedido ARP é enviada quando a tarefa IP deteta que o mapeamento é necessário para um endereço IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-578">As mentioned previously, an ARP request message is sent when the IP task detects that mapping is needed for an IP address.</span></span> <span data-ttu-id="daf05-579">Os pedidos de ARP são enviados periodicamente (a cada \***NX_ARP_UPDATE_RATE** _ segundos) até que seja recebida uma resposta ARP correspondente.</span><span class="sxs-lookup"><span data-stu-id="daf05-579">ARP requests are sent periodically (every \***NX_ARP_UPDATE_RATE** _ seconds) until a corresponding ARP response is received.</span></span> <span data-ttu-id="daf05-580">Um total de _ *_NX_ARP_MAXIMUM_RETRIES_*\* pedidos de ARP são feitos antes da tentativa de ARP ser abandonada.</span><span class="sxs-lookup"><span data-stu-id="daf05-580">A total of _ *_NX_ARP_MAXIMUM_RETRIES_*\* ARP requests are made before the ARP attempt is abandoned.</span></span> <span data-ttu-id="daf05-581">Quando uma resposta ARP é recebida, as informações de endereço físico associados são armazenadas na entrada ARP que está na cache.</span><span class="sxs-lookup"><span data-stu-id="daf05-581">When an ARP response is received, the associated physical address information is stored in the ARP entry that is in the cache.</span></span>

<span data-ttu-id="daf05-582">Para sistemas multihomes, o NetX determina qual a interface para enviar os pedidos e respostas ARP com base no endereço de destino especificado.</span><span class="sxs-lookup"><span data-stu-id="daf05-582">For multihome systems, NetX determines which interface to send the ARP requests and responses based on destination address specified.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-583">*Os pacotes IP de saída são em fila enquanto o NetX aguarda a resposta ARP. O número de* *pacotes* IP de saída em fila é definido pela NX_ARP_MAX_QUEUE_DEPTH constante  \* .\*</span><span class="sxs-lookup"><span data-stu-id="daf05-583">*Outgoing IP packets are queued while NetX waits for the ARP response. The number of outgoing IP* *packets queued is defined by the constant* \***NX_ARP_MAX_QUEUE_DEPTH**.\*</span></span>

<span data-ttu-id="daf05-584">NetX também responde a pedidos de ARP de outros nós na rede IP local.</span><span class="sxs-lookup"><span data-stu-id="daf05-584">NetX also responds to ARP requests from other nodes on the local IP network.</span></span> <span data-ttu-id="daf05-585">Quando é feito um pedido de ARP externo que corresponde ao endereço IP atual da interface que recebe o pedido ARP, o NetX constrói uma mensagem de resposta ARP que contém o endereço físico atual.</span><span class="sxs-lookup"><span data-stu-id="daf05-585">When an external ARP request is made that matches the current IP address of the interface that receives the ARP request, NetX builds an ARP response message that contains the current physical address.</span></span>

<span data-ttu-id="daf05-586">Os formatos dos pedidos e respostas da Ethernet ARP são apresentados na Figura 6 e são descritos abaixo:</span><span class="sxs-lookup"><span data-stu-id="daf05-586">The formats of Ethernet ARP requests and responses are shown in Figure 6 and are described below:</span></span>

| <span data-ttu-id="daf05-587">Campo de Pedido/Resposta</span><span class="sxs-lookup"><span data-stu-id="daf05-587">Request/Response Field</span></span>       | <span data-ttu-id="daf05-588">Objetivo</span><span class="sxs-lookup"><span data-stu-id="daf05-588">Purpose</span></span>    |
|------------------------------|-----------------|
| <span data-ttu-id="daf05-589">Endereço de destino Ethernet</span><span class="sxs-lookup"><span data-stu-id="daf05-589">Ethernet Destination Address</span></span> | <span data-ttu-id="daf05-590">Este campo de 6 bytes contém o endereço de destino para a resposta ARP e é uma transmissão (todas) para pedidos ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-590">This 6-byte field contains the destination address for the ARP response and is a broadcast (all ones) for ARP requests.</span></span> <span data-ttu-id="daf05-591">Este campo é configurado pelo controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-591">This field is setup by the network driver.</span></span> |
| <span data-ttu-id="daf05-592">Endereço de origem Ethernet</span><span class="sxs-lookup"><span data-stu-id="daf05-592">Ethernet Source Address</span></span>      | <span data-ttu-id="daf05-593">Este campo de 6 bytes contém o endereço do remetente do pedido ou resposta ARP e é criado pelo controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-593">This 6-byte field contains the address of the sender of the ARP request or response and is set up by the network driver.</span></span> |
| <span data-ttu-id="daf05-594">Tipo de quadro</span><span class="sxs-lookup"><span data-stu-id="daf05-594">Frame Type</span></span>                   | <span data-ttu-id="daf05-595">Este campo de 2 bytes contém o tipo de quadro Ethernet presente e, para pedidos e respostas ARP, este é igual a 0x0806.</span><span class="sxs-lookup"><span data-stu-id="daf05-595">This 2-byte field contains the type of Ethernet frame present and, for ARP requests and responses, this is equal to 0x0806.</span></span> <span data-ttu-id="daf05-596">Este é o último campo que o controlador de rede é responsável pela configuração.</span><span class="sxs-lookup"><span data-stu-id="daf05-596">This is the last field the network driver is responsible for setting up.</span></span> |
| <span data-ttu-id="daf05-597">Tipo de hardware</span><span class="sxs-lookup"><span data-stu-id="daf05-597">Hardware Type</span></span>                | <span data-ttu-id="daf05-598">Este campo de 2 bytes contém o tipo de hardware, que é 0x0001 para o Ethernet.</span><span class="sxs-lookup"><span data-stu-id="daf05-598">This 2-byte field contains the hardware type, which is 0x0001 for Ethernet.</span></span> |
| <span data-ttu-id="daf05-599">Tipo de Protocolo</span><span class="sxs-lookup"><span data-stu-id="daf05-599">Protocol Type</span></span>                | <span data-ttu-id="daf05-600">Este campo de 2 bytes contém o tipo de protocolo, que é 0x0800 para endereços IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-600">This 2-byte field contains the protocol type, which is 0x0800 for IP addresses.</span></span> |
| <span data-ttu-id="daf05-601">Tamanho do hardware</span><span class="sxs-lookup"><span data-stu-id="daf05-601">Hardware Size</span></span>                | <span data-ttu-id="daf05-602">Este campo de 1 byte contém o tamanho do endereço de hardware, que é 6 para endereços Ethernet.</span><span class="sxs-lookup"><span data-stu-id="daf05-602">This 1-byte field contains the hardware address size, which is 6 for Ethernet addresses.</span></span> |


![Formato de pacote ARP](./media/user-guide/arp-packet-format.png)

<span data-ttu-id="daf05-604">**FIGURA 6. Formato de pacote ARP**</span><span class="sxs-lookup"><span data-stu-id="daf05-604">**FIGURE 6. ARP Packet Format**</span></span>

| <span data-ttu-id="daf05-605">Campo de Pedido/Resposta</span><span class="sxs-lookup"><span data-stu-id="daf05-605">Request/Response Field</span></span> | <span data-ttu-id="daf05-606">Objetivo</span><span class="sxs-lookup"><span data-stu-id="daf05-606">Purpose</span></span>  |
|---|---|
| <span data-ttu-id="daf05-607">Tamanho do protocolo</span><span class="sxs-lookup"><span data-stu-id="daf05-607">Protocol Size</span></span> | <span data-ttu-id="daf05-608">Este campo de 1 byte contém o tamanho do endereço IP, que é 4 para endereços IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-608">This 1-byte field contains the IP address size, which is 4 for IP addresses.</span></span>  |
| <span data-ttu-id="daf05-609">Código de Operação</span><span class="sxs-lookup"><span data-stu-id="daf05-609">Operation Code</span></span> | <span data-ttu-id="daf05-610">Este campo de 2 bytes contém a operação para este pacote ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-610">This 2-byte field contains the operation for this ARP packet.</span></span> <span data-ttu-id="daf05-611">Um pedido ARP é especificado com o valor de 0x0001, enquanto uma resposta ARP é representada por um valor de 0x0002.</span><span class="sxs-lookup"><span data-stu-id="daf05-611">An ARP request is specified with the value of 0x0001, while an ARP response is represented by a value of 0x0002.</span></span>  |
| <span data-ttu-id="daf05-612">Endereço Ethernet Ethernet</span><span class="sxs-lookup"><span data-stu-id="daf05-612">Sender Ethernet Address</span></span> | <span data-ttu-id="daf05-613">Este campo de 6 bytes contém o endereço Ethernet do remetente.</span><span class="sxs-lookup"><span data-stu-id="daf05-613">This 6-byte field contains the sender's Ethernet address.</span></span> |
| <span data-ttu-id="daf05-614">Endereço IP remetente</span><span class="sxs-lookup"><span data-stu-id="daf05-614">Sender IP Address</span></span> | <span data-ttu-id="daf05-615">Este campo de 4 bytes contém o endereço IP do remetente.</span><span class="sxs-lookup"><span data-stu-id="daf05-615">This 4-byte field contains the sender's IP address.</span></span> |
| <span data-ttu-id="daf05-616">Endereço Ethernet alvo</span><span class="sxs-lookup"><span data-stu-id="daf05-616">Target Ethernet Address</span></span> | <span data-ttu-id="daf05-617">Este campo de 6 bytes contém o endereço Ethernet do alvo.</span><span class="sxs-lookup"><span data-stu-id="daf05-617">This 6-byte field contains the target's Ethernet address.</span></span> |
| <span data-ttu-id="daf05-618">Endereço IP alvo</span><span class="sxs-lookup"><span data-stu-id="daf05-618">Target IP Address</span></span> | <span data-ttu-id="daf05-619">Este campo de 4 bytes contém o endereço IP do alvo.</span><span class="sxs-lookup"><span data-stu-id="daf05-619">This 4-byte field contains the target's IP address.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="daf05-620">*Os pedidos e respostas da ARP são pacotes ao nível da Ethernet. Todos os outros pacotes TCP/IP são encapsulados por um cabeçalho de pacote IP.*</span><span class="sxs-lookup"><span data-stu-id="daf05-620">*ARP requests and responses are Ethernet-level packets. All other TCP/IP packets are encapsulated by an IP packet header.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-621">*Espera-se que todas as mensagens ARP na implementação TCP/IP estejam em grande formato endiano. Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="daf05-621">*All ARP messages in the TCP/IP implementation are expected to be in big endian format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

### <a name="arp-aging"></a><span data-ttu-id="daf05-622">Envelhecimento ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-622">ARP Aging</span></span>

<span data-ttu-id="daf05-623">NetX suporta a invalidação de entrada ARP dinâmica automática.</span><span class="sxs-lookup"><span data-stu-id="daf05-623">NetX supports automatic dynamic ARP entry invalidation.</span></span><span data-ttu-id="daf05-624">\ ***NX_ARP_EXPIRATION_RATE** _specifies o número de segundos que um endereço IP estabelecido para mapeamento físico permanece válido.</span><span class="sxs-lookup"><span data-stu-id="daf05-624">\ ***NX_ARP_EXPIRATION_RATE** _specifies the number of seconds an established IP address to physical mapping stays valid.</span></span> <span data-ttu-id="daf05-625">Após a expiração, a entrada ARP é removida da cache ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-625">After expiration, the ARP entry is removed from the ARP cache.</span></span> <span data-ttu-id="daf05-626">A próxima tentativa de envio para o endereço IP correspondente resultará num novo pedido de ARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-626">The next attempt to send to the corresponding IP address will result in a new ARP request.</span></span> <span data-ttu-id="daf05-627">Definição _ *_NX_ARP_EXPIRATION_RATE_*\* a zero desativa o envelhecimento do ARP, que é a configuração padrão.</span><span class="sxs-lookup"><span data-stu-id="daf05-627">Setting _ *_NX_ARP_EXPIRATION_RATE_*\* to zero disables ARP aging, which is the default configuration.</span></span>

### <a name="arp-defend"></a><span data-ttu-id="daf05-628">ARP Defender</span><span class="sxs-lookup"><span data-stu-id="daf05-628">ARP Defend</span></span>

<span data-ttu-id="daf05-629">Quando um pacote de resposta ARP ou ARP é recebido e o remetente tem o mesmo endereço IP, que entra em conflito com o endereço IP deste nó, o NetX envia um pedido de ARP para esse endereço como defesa.</span><span class="sxs-lookup"><span data-stu-id="daf05-629">When an ARP request or ARP response packet is received and the sender has the same IP address, which conflicts with the IP address of this node, NetX sends an ARP request for that address as a defense.</span></span> <span data-ttu-id="daf05-630">Se o pacote ARP de conflito for recebido mais de uma vez em 10 segundos, a NetX não envia mais pacotes de defesa.</span><span class="sxs-lookup"><span data-stu-id="daf05-630">If the conflict ARP packet is received more than once in 10 seconds, NetX does not send more defend packets.</span></span> <span data-ttu-id="daf05-631">O intervalo padrão de 10 segundos pode ser redefinido por \***NX_ARP_DEFEND_INTERVAL** _.</span><span class="sxs-lookup"><span data-stu-id="daf05-631">The default interval 10 seconds can be redefined by \***NX_ARP_DEFEND_INTERVAL** _.</span></span> <span data-ttu-id="daf05-632">Este comportamento segue a política especificada em 2.4(c) de RFC5227.</span><span class="sxs-lookup"><span data-stu-id="daf05-632">This behavior follows the policy specified in 2.4(c) of RFC5227.</span></span> <span data-ttu-id="daf05-633">Uma vez que o Windows XP ignora o anúncio do ARP como resposta para a sua sonda ARP, o utilizador pode definir _\*_NX_ARP_DEFEND_BY_REPLY_\*\*para enviar a resposta ARP como defesa adicional.</span><span class="sxs-lookup"><span data-stu-id="daf05-633">Since Windows XP ignores ARP announcement as a response for its ARP probe, user can define _\*_NX_ARP_DEFEND_BY_REPLY_\*\*to send ARP response as additional defence.</span></span>

### <a name="arp-statistics-and-errors"></a><span data-ttu-id="daf05-634">Estatísticas e erros da ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-634">ARP Statistics and Errors</span></span>

<span data-ttu-id="daf05-635">Se ativado, o software ARP NetX regista várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-635">If enabled, the NetX ARP software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-636">São mantidas as seguintes estatísticas e relatórios de erro para o processamento de ARP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="daf05-636">The following statistics and error reports are maintained for each IP's ARP processing:</span></span>

- <span data-ttu-id="daf05-637">Total de pedidos de ARP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-637">Total ARP Requests Sent</span></span>
- <span data-ttu-id="daf05-638">Total de pedidos de ARP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-638">Total ARP Requests Received</span></span>
- <span data-ttu-id="daf05-639">Total de respostas ARP enviadas</span><span class="sxs-lookup"><span data-stu-id="daf05-639">Total ARP Responses Sent</span></span>
- <span data-ttu-id="daf05-640">Total de respostas ARP recebidas</span><span class="sxs-lookup"><span data-stu-id="daf05-640">Total ARP Responses Received</span></span>
- <span data-ttu-id="daf05-641">Entradas dinâmicas totais do ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-641">Total ARP Dynamic Entries</span></span>
- <span data-ttu-id="daf05-642">Total de entradas estáticas ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-642">Total ARP Static Entries</span></span>
- <span data-ttu-id="daf05-643">Total de entradas envelhecidas em ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-643">Total ARP Aged Entries</span></span>
- <span data-ttu-id="daf05-644">Total de mensagens inválidas da ARP</span><span class="sxs-lookup"><span data-stu-id="daf05-644">Total ARP Invalid Messages</span></span>

<span data-ttu-id="daf05-645">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_arp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="daf05-645">All these statistics and error reports are available to the application with the ***nx_arp_info_get*** service.</span></span>

## <a name="reverse-address-resolution-protocol-rarp-in-ip"></a><span data-ttu-id="daf05-646">Protocolo de Resolução de Endereços Reversos (RARP) em IP</span><span class="sxs-lookup"><span data-stu-id="daf05-646">Reverse Address Resolution Protocol (RARP) in IP</span></span>

<span data-ttu-id="daf05-647">O Protocolo de Resolução de Endereços Reversos (RARP) é o protocolo para solicitar a atribuição de rede dos endereços IP de 32 bits do anfitrião (RFC 903).</span><span class="sxs-lookup"><span data-stu-id="daf05-647">The Reverse Address Resolution Protocol (RARP) is the protocol for requesting network assignment of the host's 32-bit IP addresses (RFC 903).</span></span> <span data-ttu-id="daf05-648">Isto é feito através de um pedido RARP e continua periodicamente até que um membro da rede atribua um endereço IP à interface de rede de anfitrião numa resposta RARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-648">This is done through an RARP request and continues periodically until a network member assigns an IP address to the host network interface in an RARP response.</span></span> <span data-ttu-id="daf05-649">A aplicação cria uma instância IP pelo serviço ***nx_ip_create*** com um endereço IP zero.</span><span class="sxs-lookup"><span data-stu-id="daf05-649">The application creates an IP instance by the service ***nx_ip_create*** with a zero IP address.</span></span> <span data-ttu-id="daf05-650">Se o RARP estiver ativado pela aplicação, pode utilizar o protocolo RARP para solicitar um endereço IP a partir do servidor de rede acessível através da interface que tem um endereço IP zero.</span><span class="sxs-lookup"><span data-stu-id="daf05-650">If RARP is enabled by the application, it can use the RARP protocol to request an IP address from the network server accessible through the interface that has a zero IP address.</span></span>

### <a name="rarp-enable"></a><span data-ttu-id="daf05-651">Ativar RARP</span><span class="sxs-lookup"><span data-stu-id="daf05-651">RARP Enable</span></span>

<span data-ttu-id="daf05-652">Para utilizar o RARP, a aplicação deve criar a instância IP com um endereço IP de zero e, em seguida, ativar o RARP utilizando o serviço ***nx_rarp_enable***.</span><span class="sxs-lookup"><span data-stu-id="daf05-652">To use RARP, the application must create the IP instance with an IP address of zero, then enable RARP using the service ***nx_rarp_enable***.</span></span> <span data-ttu-id="daf05-653">Para os sistemas multihome, pelo menos um dispositivo de rede associado à instância IP deve ter um endereço IP de zero.</span><span class="sxs-lookup"><span data-stu-id="daf05-653">For multihome systems, at least one network device associated with the IP instance must have an IP address of zero.</span></span> <span data-ttu-id="daf05-654">O processamento rarp envia periodicamente mensagens de pedido rarp para o sistema NetX que requer um endereço IP até que seja recebida uma resposta RARP válida com o endereço IP designado pela rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-654">The RARP processing periodically sends RARP request messages for the NetX system requiring an IP address until a valid RARP reply with the network designated IP address is received.</span></span> <span data-ttu-id="daf05-655">Neste momento, o processamento de RARP está completo.</span><span class="sxs-lookup"><span data-stu-id="daf05-655">At this point, RARP processing is complete.</span></span>

<span data-ttu-id="daf05-656">Depois de o RARP ter sido ativado, este é desativado automaticamente depois de resolvidos todos os endereços de interface.</span><span class="sxs-lookup"><span data-stu-id="daf05-656">After RARP has been enabled, it is disabled automatically after all interface addresses are resolved.</span></span> <span data-ttu-id="daf05-657">O pedido pode forçar a RARP a encerrar utilizando o serviço ***nx_rarp_disable***.</span><span class="sxs-lookup"><span data-stu-id="daf05-657">The application may force RARP to terminate by using the service ***nx_rarp_disable***.</span></span>

###  <a name="rarp-request"></a><span data-ttu-id="daf05-658">Pedido RARP</span><span class="sxs-lookup"><span data-stu-id="daf05-658">RARP Request</span></span>

<span data-ttu-id="daf05-659">O formato de um pacote de pedido RARP é quase idêntico ao pacote ARP mostrado na Figura 6 no tópico [ARP Messages](#arp-messages). A única diferença é que o campo do tipo de fotogramas é 0x8035 e o campo *Código de Operação* é 3, designando um pedido RARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-659">The format of an RARP request packet is almost identical to the ARP packet shown in Figure 6 in the topic [ARP Messages](#arp-messages).The only difference is the frame type field is 0x8035 and the *Operation Code* field is 3, designating an RARP request.</span></span> <span data-ttu-id="daf05-660">Como mencionado anteriormente, os pedidos de RARP serão enviados periodicamente (a cada ***NX_RARP_UPDATE_RATE*** segundos) até que seja recebida uma resposta RARP com o endereço IP atribuído à rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-660">As mentioned previously, RARP requests will be sent periodically (every ***NX_RARP_UPDATE_RATE*** seconds) until a RARP reply with the network assigned IP address is received.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-661">*Espera-se que todas as mensagens RARP na implementação TCP/IP estejam em grande formato endiano. Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="daf05-661">*All RARP messages in the TCP/IP implementation are expected to be in big endian format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

### <a name="rarp-reply"></a><span data-ttu-id="daf05-662">Resposta RARP</span><span class="sxs-lookup"><span data-stu-id="daf05-662">RARP Reply</span></span>

<span data-ttu-id="daf05-663">As mensagens de resposta RARP são recebidas da rede e contêm o endereço IP atribuído à rede para este anfitrião.</span><span class="sxs-lookup"><span data-stu-id="daf05-663">RARP reply messages are received from the network and contain the network assigned IP address for this host.</span></span> <span data-ttu-id="daf05-664">O formato de um pacote de resposta RARP é quase idêntico ao pacote ARP indicado na Figura 6.</span><span class="sxs-lookup"><span data-stu-id="daf05-664">The format of an RARP reply packet is almost identical to the ARP packet shown in Figure 6.</span></span> <span data-ttu-id="daf05-665">A única diferença é que o campo do tipo de fotogramas é 0x8035 e o campo *Código de Operação* é 4, que designa uma resposta RARP.</span><span class="sxs-lookup"><span data-stu-id="daf05-665">The only difference is the frame type field is 0x8035 and the *Operation Code* field is 4, which designates an RARP reply.</span></span> <span data-ttu-id="daf05-666">Depois de recebido, o endereço IP é configurado no caso IP, o pedido periódico de RARP é desativado, e a instância IP está agora pronta para o funcionamento normal da rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-666">After received, the IP address is setup in the IP instance, the periodic RARP request is disabled, and the IP instance is now ready for normal network operation.</span></span>

<span data-ttu-id="daf05-667">Para os anfitriões multihome, o endereço IP é aplicado à interface de rede de pedidos.</span><span class="sxs-lookup"><span data-stu-id="daf05-667">For multihome hosts, the IP address is applied to the requesting network interface.</span></span> <span data-ttu-id="daf05-668">Se existirem outras interfaces de rede que ainda solicitam uma atribuição de endereço IP, o serviço raRP periódico continua até que todos os pedidos de endereço IP de interface sejam resolvidos.</span><span class="sxs-lookup"><span data-stu-id="daf05-668">If there are other network interfaces still requesting an IP address assignment, the periodic RARP service continues until all interface IP address requests are resolved.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-669">*O pedido não deve utilizar a instância IP até que o processamento rarp esteja completo. O **nx_ip_status_check** pode ser utilizado por aplicações para aguardar a conclusão do RARP. Para sistemas multihome, a aplicação não deve utilizar a interface de pedido até que o processamento rarp esteja completo nessa interface. O estado do endereço IP no dispositivo secundário pode ser verificado com o serviço **nx_ip_interface_status_check.***</span><span class="sxs-lookup"><span data-stu-id="daf05-669">*The application should not use the IP instance until the RARP processing is complete. The **nx_ip_status_check** may be used by applications to wait for the RARP completion. For multihome systems, the application should not use the requesting interface until the RARP processing is complete on that interface. Status of the IP address on the secondary device can be checked with the **nx_ip_interface_status_check** service.*</span></span>

### <a name="rarp-statistics-and-errors"></a><span data-ttu-id="daf05-670">Estatísticas e erros da RARP</span><span class="sxs-lookup"><span data-stu-id="daf05-670">RARP Statistics and Errors</span></span>

<span data-ttu-id="daf05-671">Se ativado, o software NetX RARP regista várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-671">If enabled, the NetX RARP software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-672">São mantidas as seguintes estatísticas e relatórios de erro para o processamento de RARP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="daf05-672">The following statistics and error reports are maintained for each IP's RARP processing:</span></span>

- <span data-ttu-id="daf05-673">Total de pedidos de RARP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-673">Total RARP Requests Sent</span></span>
- <span data-ttu-id="daf05-674">Total de respostas rarp recebidas</span><span class="sxs-lookup"><span data-stu-id="daf05-674">Total RARP Responses Received</span></span>
- <span data-ttu-id="daf05-675">Total de mensagens inválidas da RARP</span><span class="sxs-lookup"><span data-stu-id="daf05-675">Total RARP Invalid Messages</span></span>

<span data-ttu-id="daf05-676">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_rarp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="daf05-676">All these statistics and error reports are available to the application with the ***nx_rarp_info_get*** service.</span></span>

## <a name="internet-control-message-protocol-icmp"></a><span data-ttu-id="daf05-677">Protocolo de mensagem de controlo da Internet (ICMP)</span><span class="sxs-lookup"><span data-stu-id="daf05-677">Internet Control Message Protocol (ICMP)</span></span>

<span data-ttu-id="daf05-678">O Protocolo de Mensagem de Controlo de Internet para IP (ICMP) limita-se a passar informações de erro e controlo entre membros da rede IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-678">Internet Control Message Protocol for IP (ICMP) is limited to passing error and control information between IP network members.</span></span>

<span data-ttu-id="daf05-679">Tal como a maioria das outras mensagens de camada de aplicação (por exemplo, TCP/IP), as mensagens ICMP são encapsuladas por um cabeçalho IP com a designação do protocolo ICMP.</span><span class="sxs-lookup"><span data-stu-id="daf05-679">Like most other application layer (e.g., TCP/IP) messages, ICMP messages are encapsulated by an IP header with the ICMP protocol designation.</span></span>

### <a name="icmp-statistics-and-errors"></a><span data-ttu-id="daf05-680">Estatísticas e erros do ICMP</span><span class="sxs-lookup"><span data-stu-id="daf05-680">ICMP Statistics and Errors</span></span>

<span data-ttu-id="daf05-681">Se ativado, o NetX regista várias estatísticas e erros do ICMP que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-681">If enabled, NetX keeps track of several ICMP statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-682">São mantidas as seguintes estatísticas e relatórios de erro para o processamento do ICMP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="daf05-682">The following statistics and error reports are maintained for each IP's ICMP processing:</span></span>

- <span data-ttu-id="daf05-683">Total de pings ICMP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-683">Total ICMP Pings Sent</span></span>
- <span data-ttu-id="daf05-684">Total de tempo de ping ICMP</span><span class="sxs-lookup"><span data-stu-id="daf05-684">Total ICMP Ping Timeouts</span></span>
- <span data-ttu-id="daf05-685">Fios de ping total do ICMP suspensos</span><span class="sxs-lookup"><span data-stu-id="daf05-685">Total ICMP Ping Threads Suspended</span></span>
- <span data-ttu-id="daf05-686">Total de respostas de ping do ICMP recebidas</span><span class="sxs-lookup"><span data-stu-id="daf05-686">Total ICMP Ping Responses Received</span></span>
- <span data-ttu-id="daf05-687">Erros totais de verificação do ICMP</span><span class="sxs-lookup"><span data-stu-id="daf05-687">Total ICMP Checksum Errors</span></span>
- <span data-ttu-id="daf05-688">Total de mensagens não manipuladas do ICMP</span><span class="sxs-lookup"><span data-stu-id="daf05-688">Total ICMP Unhandled Messages</span></span>

<span data-ttu-id="daf05-689">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_icmp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="daf05-689">All these statistics and error reports are available to the application with the ***nx_icmp_info_get*** service.</span></span>

### <a name="icmp-enable"></a><span data-ttu-id="daf05-690">ICMP Ativar</span><span class="sxs-lookup"><span data-stu-id="daf05-690">ICMP Enable</span></span>
<span data-ttu-id="daf05-691">Antes de as mensagens ICMP poderem ser processadas pelo NetX, a aplicação deve ligar para o serviço ***nx_icmp_enable*** para permitir o processamento do ICMP.</span><span class="sxs-lookup"><span data-stu-id="daf05-691">Before ICMP messages can be processed by NetX, the application must call the ***nx_icmp_enable*** service to enable ICMP processing.</span></span> <span data-ttu-id="daf05-692">Depois disso, a aplicação pode emitir pedidos de ping e pacotes de ping de entrada no campo.</span><span class="sxs-lookup"><span data-stu-id="daf05-692">After this is done, the application can issue ping requests and field incoming ping packets.</span></span>

### <a name="icmp-echo-request"></a><span data-ttu-id="daf05-693">Pedido de Eco ICMP</span><span class="sxs-lookup"><span data-stu-id="daf05-693">ICMP Echo Request</span></span>
<span data-ttu-id="daf05-694">Um pedido de eco é um tipo de mensagem ICMP que é normalmente usada para verificar a existência de um nó específico na rede, identificado pelo seu endereço IP anfitrião.</span><span class="sxs-lookup"><span data-stu-id="daf05-694">An echo request is one type of ICMP message that is typically used to check for the existence of a specific node on the network, as identified by its host IP address.</span></span> <span data-ttu-id="daf05-695">O comando de ping popular é implementado usando mensagens de pedido de eco/eco ICMP.</span><span class="sxs-lookup"><span data-stu-id="daf05-695">The popular ping command is implemented using ICMP echo request/echo reply messages.</span></span> <span data-ttu-id="daf05-696">Se o anfitrião específico estiver presente, a sua pilha de rede processa o pedido de ping e as respostas com uma resposta de ping.</span><span class="sxs-lookup"><span data-stu-id="daf05-696">If the specific host is present, its network stack processes the ping request and responses with a ping response.</span></span> <span data-ttu-id="daf05-697">A Figura 7 detalha o formato de mensagem de ping ICMP.</span><span class="sxs-lookup"><span data-stu-id="daf05-697">Figure 7 details the ICMP ping message format.</span></span>

![Mensagem de ping ICMP](./media/user-guide/icmp-ping-message.png)

<span data-ttu-id="daf05-699">**FIGURA 7. Mensagem de ping ICMP**</span><span class="sxs-lookup"><span data-stu-id="daf05-699">**FIGURE 7. ICMP Ping Message**</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-700">*Espera-se que todas as mensagens ICMP na implementação TCP/IP estejam em grande formato endiano. Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="daf05-700">*All ICMP messages in the TCP/IP implementation are expected to be in big endian format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

<span data-ttu-id="daf05-701">A tabela a seguir descreve o formato do cabeçalho ICMP:</span><span class="sxs-lookup"><span data-stu-id="daf05-701">The following table describes the ICMP header format:</span></span>

| <span data-ttu-id="daf05-702">Campo de Cabeçalho</span><span class="sxs-lookup"><span data-stu-id="daf05-702">Header Field</span></span>    | <span data-ttu-id="daf05-703">Objetivo</span><span class="sxs-lookup"><span data-stu-id="daf05-703">Purpose</span></span> |
|-----------------|---------------------------------------------------|
| <span data-ttu-id="daf05-704">Tipo</span><span class="sxs-lookup"><span data-stu-id="daf05-704">Type</span></span>            | <span data-ttu-id="daf05-705">Este campo especifica a mensagem ICMP (bits 31-24).</span><span class="sxs-lookup"><span data-stu-id="daf05-705">This field specifies the ICMP message (bits 31- 24).</span></span> <span data-ttu-id="daf05-706">As mais comuns são: 0 Echo Answer 8 Echo Request</span><span class="sxs-lookup"><span data-stu-id="daf05-706">The most common are:   0 Echo Reply   8 Echo Request</span></span> |
| <span data-ttu-id="daf05-707">Código</span><span class="sxs-lookup"><span data-stu-id="daf05-707">Code</span></span>            | <span data-ttu-id="daf05-708">Este campo é de contexto específico no campo tipo (bits 23-16).</span><span class="sxs-lookup"><span data-stu-id="daf05-708">This field is context specific on the type field (bits 23-16).</span></span> <span data-ttu-id="daf05-709">Para um pedido de eco ou resposta, o código está definido para zero.</span><span class="sxs-lookup"><span data-stu-id="daf05-709">For an echo request or reply the code is set to zero.</span></span> |
| <span data-ttu-id="daf05-710">Soma de verificação</span><span class="sxs-lookup"><span data-stu-id="daf05-710">Checksum</span></span>        | <span data-ttu-id="daf05-711">Este campo contém a parte de verificação de 16 bits da soma complementar da mensagem ICMP, incluindo todo o cabeçalho ICMP a começar pelo campo Tipo.</span><span class="sxs-lookup"><span data-stu-id="daf05-711">This field contains the 16-bit checksum of the one's complement sum of the ICMP message including the entire the ICMP header starting with the Type field.</span></span> <span data-ttu-id="daf05-712">Antes de gerar a caixa de verificação, o campo de verificação está limpo.</span><span class="sxs-lookup"><span data-stu-id="daf05-712">Before generating the checksum, the checksum field is cleared.</span></span>                 |
| <span data-ttu-id="daf05-713">Identificação</span><span class="sxs-lookup"><span data-stu-id="daf05-713">Identification</span></span>  | <span data-ttu-id="daf05-714">Este campo contém um valor de identificação que identifica o hospedeiro; um hospedeiro deve utilizar o ID extraído de um pedido DE ECO na RESPOSTA ECHO (bits 31-16).</span><span class="sxs-lookup"><span data-stu-id="daf05-714">This field contains an ID value identifying the host; a host should use the ID extracted from an ECHO request in the ECHO REPLY (bits 31-16).</span></span> |
| <span data-ttu-id="daf05-715">Número de sequência</span><span class="sxs-lookup"><span data-stu-id="daf05-715">Sequence number</span></span> | <span data-ttu-id="daf05-716">Este campo contém um valor de ID; um hospedeiro deve utilizar o ID extraído de um pedido DE ECO na RESPOSTA ECHO (bits 31-16).</span><span class="sxs-lookup"><span data-stu-id="daf05-716">This field contains an ID value; a host should use the ID extracted from an ECHO request in the ECHO REPLY (bits 31-16).</span></span> <span data-ttu-id="daf05-717">Ao contrário do campo do identificador, este valor mudará num pedido de Eco subsequente do mesmo anfitrião (bits 15-0).</span><span class="sxs-lookup"><span data-stu-id="daf05-717">Unlike the identifier field, this value will change in a subsequent Echo request from the same host (bits 15-0).</span></span> |


### <a name="icmp-echo-response"></a><span data-ttu-id="daf05-718">Resposta ao eco do ICMP</span><span class="sxs-lookup"><span data-stu-id="daf05-718">ICMP Echo Response</span></span>
<span data-ttu-id="daf05-719">Uma resposta de ping é outro tipo de mensagem ICMP que é gerada internamente pela componente ICMP em resposta a um pedido externo de ping.</span><span class="sxs-lookup"><span data-stu-id="daf05-719">A ping response is another type of ICMP message that is generated internally by the ICMP component in response to an external ping request.</span></span> <span data-ttu-id="daf05-720">Além do reconhecimento, a resposta ao ping contém também uma cópia dos dados do utilizador fornecidos no pedido de ping.</span><span class="sxs-lookup"><span data-stu-id="daf05-720">In addition to acknowledgement, the ping response also contains a copy of the user data supplied in the ping request.</span></span>

## <a name="internet-group-management-protocol-igmp"></a><span data-ttu-id="daf05-721">Protocolo de Gestão do Grupo de Internet (IGMP)</span><span class="sxs-lookup"><span data-stu-id="daf05-721">Internet Group Management Protocol (IGMP)</span></span>

<span data-ttu-id="daf05-722">O Protocolo de Gestão do Grupo internet (IGMP) fornece um dispositivo para comunicar com os seus vizinhos e seus routers que pretende receber, ou aderir, a um grupo multicast IP (RFC 1112 e RFC 2236).</span><span class="sxs-lookup"><span data-stu-id="daf05-722">The Internet Group Management Protocol (IGMP) provides a device to communicate with its neighbors and its routers that it intends to receive, or join, an IP multicast group (RFC 1112 and RFC 2236).</span></span> <span data-ttu-id="daf05-723">Um grupo multicast é basicamente uma coleção dinâmica de membros da rede e é representado por um endereço IP classe D.</span><span class="sxs-lookup"><span data-stu-id="daf05-723">A multicast group is basically a dynamic collection of network members and is represented by a Class D IP address.</span></span> <span data-ttu-id="daf05-724">Os membros do grupo multicast podem sair a qualquer momento, e os novos membros podem aderir a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="daf05-724">Members of the multicast group may leave at any time, and new members may join at any time.</span></span> <span data-ttu-id="daf05-725">A coordenação envolvida na adesão e saída do grupo é da responsabilidade do IGMP.</span><span class="sxs-lookup"><span data-stu-id="daf05-725">The coordination involved in joining and leaving the group is the responsibility of IGMP.</span></span>

### <a name="igmp-enable"></a><span data-ttu-id="daf05-726">IGMP Ativar</span><span class="sxs-lookup"><span data-stu-id="daf05-726">IGMP Enable</span></span>

<span data-ttu-id="daf05-727">Antes de qualquer atividade multicasting poder ocorrer no NetX, a aplicação deve ligar para o ***serviço nx_igmp_enable.***</span><span class="sxs-lookup"><span data-stu-id="daf05-727">Before any multicasting activity can take place in NetX, the application must call the ***nx_igmp_enable*** service.</span></span> <span data-ttu-id="daf05-728">Este serviço realiza a inicialização básica do IGMP em preparação para pedidos multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-728">This service performs basic IGMP initialization in preparation for multicast requests.</span></span>

### <a name="multicast-ip-addressing"></a><span data-ttu-id="daf05-729">Endereço IP multicast</span><span class="sxs-lookup"><span data-stu-id="daf05-729">Multicast IP Addressing</span></span>

<span data-ttu-id="daf05-730">Como mencionado anteriormente, os endereços multicast são na verdade endereços IP de classe D, como mostrado na Figura 4 na página 58.</span><span class="sxs-lookup"><span data-stu-id="daf05-730">As mentioned previously, multicast addresses are actually Class D IP addresses as shown in Figure 4 on page 58.</span></span> <span data-ttu-id="daf05-731">Os 28 bits inferiores do endereço classe D correspondem ao ID do grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-731">The lower 28-bits of the Class D address correspond to the multicast group ID.</span></span> <span data-ttu-id="daf05-732">Há uma série de endereços multicast pré-definidos.</span><span class="sxs-lookup"><span data-stu-id="daf05-732">There are a series of pre-defined multicast addresses.</span></span> <span data-ttu-id="daf05-733">No entanto, o *endereço de todos os anfitriões* (244.0.0.1) é particularmente importante para o processamento do IGMP.</span><span class="sxs-lookup"><span data-stu-id="daf05-733">However, the *all hosts address* (244.0.0.1) is particularly important to IGMP processing.</span></span> <span data-ttu-id="daf05-734">O *endereço de todos os anfitriões* é utilizado pelos routers para consultar todos os membros multicasts para informar em que grupos multicast pertencem.</span><span class="sxs-lookup"><span data-stu-id="daf05-734">The *all hosts address* is used by routers to query all multicast members to report on which multicast groups they belong to.</span></span>

### <a name="physical-address-mapping-in-ip"></a><span data-ttu-id="daf05-735">Mapeamento de endereço físico em IP</span><span class="sxs-lookup"><span data-stu-id="daf05-735">Physical Address Mapping in IP</span></span>

<span data-ttu-id="daf05-736">Endereços multicast classe D mapeam diretamente para endereços físicos Ethernet variando de 01.00.5e.00.00.00 a 01.00.5e.7f.ff.ff.</span><span class="sxs-lookup"><span data-stu-id="daf05-736">Class D multicast addresses map directly to physical Ethernet addresses ranging from 01.00.5e.00.00.00 through 01.00.5e.7f.ff.ff.</span></span> <span data-ttu-id="daf05-737">Os 23 bits inferiores do mapa de endereços multicast IP diretamente para os 23 bits inferiores do endereço Ethernet.</span><span class="sxs-lookup"><span data-stu-id="daf05-737">The lower 23 bits of the IP multicast address map directly to the lower 23 bits of the Ethernet address.</span></span>

### <a name="multicast-group-join"></a><span data-ttu-id="daf05-738">Grupo Multicast Junta-se</span><span class="sxs-lookup"><span data-stu-id="daf05-738">Multicast Group Join</span></span>

<span data-ttu-id="daf05-739">As aplicações que precisam de aderir a um determinado grupo multicast podem fazê-lo chamando o ***serviço nx_igmp_multicast_join.***</span><span class="sxs-lookup"><span data-stu-id="daf05-739">Applications that need to join a particular multicast group may do so by calling the ***nx_igmp_multicast_join*** service.</span></span> <span data-ttu-id="daf05-740">Este serviço acompanha o número de pedidos para se juntar a este grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-740">This service keeps track of the number of requests to join this multicast group.</span></span> <span data-ttu-id="daf05-741">Se este for o primeiro pedido de candidatura para aderir ao grupo multicast, é enviado um relatório IGMP na rede primária indicando a intenção deste anfitrião de se juntar ao grupo.</span><span class="sxs-lookup"><span data-stu-id="daf05-741">If this is the first application request to join the multicast group, an IGMP report is sent out on the primary network indicating this host's intention to join the group.</span></span> <span data-ttu-id="daf05-742">Em seguida, o controlador de rede é chamado a configurar para ouvir pacotes com o endereço Ethernet para este grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-742">Next, the network driver is called to set up for listening for packets with the Ethernet address for this multicast group.</span></span>

<span data-ttu-id="daf05-743">Num sistema multihome, se o grupo multicast estiver acessível através de uma interface específica, a aplicação utilizará o serviço ***nx_igmp_multicast_interface_join*** em vez de \*\*\*nx_igmp_multicast_join\*\*\*\*, que se limita a grupos multicast na rede primária.</span><span class="sxs-lookup"><span data-stu-id="daf05-743">In a multihome system, if the multicast group is accessible via a specific interface, application shall use the service ***nx_igmp_multicast_interface_join*** instead of \***nx_igmp_multicast_join**,\* which is limited to multicast groups on the primary network.</span></span>

### <a name="multicast-group-leave"></a><span data-ttu-id="daf05-744">Licença de grupo multicast</span><span class="sxs-lookup"><span data-stu-id="daf05-744">Multicast Group Leave</span></span>

<span data-ttu-id="daf05-745">As aplicações que necessitem de deixar um grupo multicast previamente aderido podem fazê-lo chamando o ***serviço nx_igmp_multicast_leave.***</span><span class="sxs-lookup"><span data-stu-id="daf05-745">Applications that need to leave a previously joined multicast group may do so by calling the ***nx_igmp_multicast_leave*** service.</span></span> <span data-ttu-id="daf05-746">Este serviço reduz a contagem interna associada à quantidade de vezes que o grupo se juntou.</span><span class="sxs-lookup"><span data-stu-id="daf05-746">This service reduces the internal count associated with how many times the group was joined.</span></span> <span data-ttu-id="daf05-747">Se não houver pedidos de participação pendentes para um grupo, o controlador de rede é chamado a desativar a audição de pacotes com o endereço Ethernet deste grupo multicast</span><span class="sxs-lookup"><span data-stu-id="daf05-747">If there are no outstanding join requests for a group, the network driver is called to disable listening for packets with this multicast group's Ethernet address</span></span>

### <a name="multicast-loopback"></a><span data-ttu-id="daf05-748">Multicast Loopback</span><span class="sxs-lookup"><span data-stu-id="daf05-748">Multicast Loopback</span></span>

<span data-ttu-id="daf05-749">Um pedido pode pretender receber tráfego multicast originário de uma das fontes no mesmo nó.</span><span class="sxs-lookup"><span data-stu-id="daf05-749">An application may wish to receive multicast traffic originated from one of the sources on the same node.</span></span> <span data-ttu-id="daf05-750">Isto requer que o componente multicast IP tenha o loopback ativado utilizando o serviço ***nx_igmp_loopback_enable***.</span><span class="sxs-lookup"><span data-stu-id="daf05-750">This requires the IP multicast component to have loopback enabled by using the service ***nx_igmp_loopback_enable***.</span></span>

### <a name="igmp-report-message"></a><span data-ttu-id="daf05-751">Mensagem de relatório IGMP</span><span class="sxs-lookup"><span data-stu-id="daf05-751">IGMP Report Message</span></span>

<span data-ttu-id="daf05-752">Quando a aplicação se junta a um grupo multicast, uma mensagem de relatório IGMP é enviada através da rede para indicar a intenção do anfitrião de se juntar a um determinado grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-752">When the application joins a multicast group, an IGMP report message is sent via the network to indicate the host's intention to join a particular multicast group.</span></span> <span data-ttu-id="daf05-753">O formato da mensagem de relatório IGMP é mostrado na Figura 8.</span><span class="sxs-lookup"><span data-stu-id="daf05-753">The format of the IGMP report message is shown in Figure 8.</span></span> <span data-ttu-id="daf05-754">O endereço de grupo multicast é utilizado tanto para a mensagem de grupo na mensagem de relatório IGMP como para o endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-754">The multicast group address is used for both the group message in the IGMP report message and the destination IP address.</span></span>

![Mensagem de relatório IGMP](./media/user-guide/igmp-report-message.png)

<span data-ttu-id="daf05-756">**FIGURA 8. Mensagem de relatório IGMP**</span><span class="sxs-lookup"><span data-stu-id="daf05-756">**FIGURE 8. IGMP Report Message**</span></span>

<span data-ttu-id="daf05-757">Na figura acima (Figura 8), o cabeçalho IGMP contém uma versão/tipo de campo, tempo de resposta máximo, um campo de verificação e um campo de endereços de grupo multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-757">In the figure above (Figure 8), the IGMP header contains a version/type field, maximum response time, a checksum field, and a multicast group address field.</span></span> <span data-ttu-id="daf05-758">Para as mensagens IGMPv1, o campo Tempo de Resposta Máxima está sempre definido para zero, uma vez que este não faz parte do protocolo IGMPv1.</span><span class="sxs-lookup"><span data-stu-id="daf05-758">For IGMPv1 messages, the Maximum Response Time field is always set to zero, as this is not part of the IGMPv1 protocol.</span></span> <span data-ttu-id="daf05-759">O campo Tempo de Resposta Máxima é definido quando o anfitrião recebe uma mensagem IGMP tipo consulta e apurada quando um anfitrião recebe a mensagem do tipo Relatório de outro anfitrião, tal como definido pelo protocolo IGMPv2.</span><span class="sxs-lookup"><span data-stu-id="daf05-759">The Maximum Response Time field is set when the host receives a Query type IGMP message and cleared when a host receives another host's Report type message as defined by the IGMPv2 protocol.</span></span>

<span data-ttu-id="daf05-760">O seguinte descreve o formato do cabeçalho IGMP:</span><span class="sxs-lookup"><span data-stu-id="daf05-760">The following describes the IGMP header format:</span></span>

| <span data-ttu-id="daf05-761">**Campo de Cabeçalho**</span><span class="sxs-lookup"><span data-stu-id="daf05-761">**Header Field**</span></span>          | <span data-ttu-id="daf05-762">**Objetivo**</span><span class="sxs-lookup"><span data-stu-id="daf05-762">**Purpose**</span></span> |
|-----------------------|--------------------------------------------------------------------|
| <span data-ttu-id="daf05-763">Versão</span><span class="sxs-lookup"><span data-stu-id="daf05-763">Version</span></span>               | <span data-ttu-id="daf05-764">Este campo especifica a versão IGMP (bits 31-28).</span><span class="sxs-lookup"><span data-stu-id="daf05-764">This field specifies the IGMP version (bits 31- 28).</span></span>                                                                               |
| <span data-ttu-id="daf05-765">Tipo</span><span class="sxs-lookup"><span data-stu-id="daf05-765">Type</span></span>                  | <span data-ttu-id="daf05-766">Este campo especifica o tipo de mensagem IGMP (bits 27-24).</span><span class="sxs-lookup"><span data-stu-id="daf05-766">This field specifies the type of IGMP message (bits 27 -24).</span></span>                                                                       |
| <span data-ttu-id="daf05-767">Tempo máximo de resposta</span><span class="sxs-lookup"><span data-stu-id="daf05-767">Maximum Response Time</span></span> | <span data-ttu-id="daf05-768">Não usado no IGMPv1.</span><span class="sxs-lookup"><span data-stu-id="daf05-768">Not used in IGMPv1.</span></span> <span data-ttu-id="daf05-769">No IGMPv2 este campo serve como o tempo máximo de resposta.</span><span class="sxs-lookup"><span data-stu-id="daf05-769">In IGMPv2 this field serves as the maximum response time.</span></span>                                                      |
| <span data-ttu-id="daf05-770">Soma de verificação</span><span class="sxs-lookup"><span data-stu-id="daf05-770">Checksum</span></span>              | <span data-ttu-id="daf05-771">Este campo contém a parte de verificação de 16 bits da soma de complemento da mensagem IGMP a começar pela versão IGMP (bits 0-15)</span><span class="sxs-lookup"><span data-stu-id="daf05-771">This field contains the 16-bit checksum of the one's complement sum of the IGMP message starting with the IGMP version (bits 0-15)</span></span> |
| <span data-ttu-id="daf05-772">Endereço de grupo</span><span class="sxs-lookup"><span data-stu-id="daf05-772">Group Address</span></span>         | <span data-ttu-id="daf05-773">Endereço IP do grupo D de 32 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-773">32-bit class D group IP address</span></span> |


<span data-ttu-id="daf05-774">As mensagens de relatório IGMP também são enviadas em resposta às mensagens de consulta IGMP enviadas por um router multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-774">IGMP report messages are also sent in response to IGMP query messages sent by a multicast router.</span></span> <span data-ttu-id="daf05-775">Os routers multicast enviam periodicamente mensagens de consulta para ver quais os anfitriões que ainda precisam de ser membros do grupo.</span><span class="sxs-lookup"><span data-stu-id="daf05-775">Multicast routers periodically send query messages out to see which hosts still require group membership.</span></span> <span data-ttu-id="daf05-776">As mensagens de consulta têm o mesmo formato que a mensagem IGMP Report mostrada na Figura 8.</span><span class="sxs-lookup"><span data-stu-id="daf05-776">Query messages have the same format as the IGMP Report message shown in Figure 8.</span></span> <span data-ttu-id="daf05-777">As únicas diferenças são que o tipo IGMP é igual a 1 e o campo de endereços de grupo está definido para 0.</span><span class="sxs-lookup"><span data-stu-id="daf05-777">The only differences are the IGMP type is equal to 1 and the group address field is set to 0.</span></span> <span data-ttu-id="daf05-778">As mensagens de consulta IGMP são enviadas para o endereço IP *de todos os anfitriões* pelo router multicast.</span><span class="sxs-lookup"><span data-stu-id="daf05-778">IGMP Query messages are sent to the *all hosts* IP address by the multicast router.</span></span> <span data-ttu-id="daf05-779">Um anfitrião que ainda deseja manter a adesão ao grupo responde enviando outra mensagem do IGMP Report.</span><span class="sxs-lookup"><span data-stu-id="daf05-779">A host that still wishes to maintain group membership responds by sending another IGMP Report message.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-780">*Espera-se que todas as mensagens na implementação TCP/IP estejam em grande formato **endiano.** Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="daf05-780">*All messages in the TCP/IP implementation are expected to be in **big endian** format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

### <a name="igmp-statistics-and-errors"></a><span data-ttu-id="daf05-781">Estatísticas e erros do IGMP</span><span class="sxs-lookup"><span data-stu-id="daf05-781">IGMP Statistics and Errors</span></span>

<span data-ttu-id="daf05-782">Se ativado, o software NetX IGMP regista várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-782">If enabled, the NetX IGMP software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-783">São mantidas as seguintes estatísticas e relatórios de erro para o processamento de IGMP de cada IP:</span><span class="sxs-lookup"><span data-stu-id="daf05-783">The following statistics and error reports are maintained for each IP's IGMP processing:</span></span>

- <span data-ttu-id="daf05-784">Total de relatórios IGMP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-784">Total IGMP Reports Sent</span></span>
- <span data-ttu-id="daf05-785">Total de consultas IGMP recebidas</span><span class="sxs-lookup"><span data-stu-id="daf05-785">Total IGMP Queries Received</span></span>
- <span data-ttu-id="daf05-786">Erros totais do IGMP Checksum</span><span class="sxs-lookup"><span data-stu-id="daf05-786">Total IGMP Checksum Errors</span></span>
- <span data-ttu-id="daf05-787">Total de grupos atuais do IGMP aderidos</span><span class="sxs-lookup"><span data-stu-id="daf05-787">Total IGMP Current Groups Joined</span></span>

<span data-ttu-id="daf05-788">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_igmp_info_get.***</span><span class="sxs-lookup"><span data-stu-id="daf05-788">All these statistics and error reports are available to the application with the ***nx_igmp_info_get*** service.</span></span>

## <a name="user-datagram-protocol-udp"></a><span data-ttu-id="daf05-789">Protocolo de Datagrama do Utilizador (UDP)</span><span class="sxs-lookup"><span data-stu-id="daf05-789">User Datagram Protocol (UDP)</span></span>

<span data-ttu-id="daf05-790">O Protocolo de Datagrama do Utilizador (UDP) fornece a forma mais simples de transferência de dados entre membros da rede (RFC 768).</span><span class="sxs-lookup"><span data-stu-id="daf05-790">The User Datagram Protocol (UDP) provides the simplest form of data transfer between network members (RFC 768).</span></span> <span data-ttu-id="daf05-791">Os pacotes de dados da UDP são enviados de um membro da rede para outro da melhor forma de esforço; ou seja, não existe um mecanismo incorporado para reconhecimento pelo destinatário do pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-791">UDP data packets are sent from one network member to another in a best effort fashion; i.e., there is no built-in mechanism for acknowledgement by the packet recipient.</span></span> <span data-ttu-id="daf05-792">Além disso, o envio de um pacote UDP não requer qualquer ligação a ser estabelecida antecipadamente.</span><span class="sxs-lookup"><span data-stu-id="daf05-792">In addition, sending a UDP packet does not require any connection to be established in advance.</span></span> <span data-ttu-id="daf05-793">Por causa disso, a transmissão de pacotes da UDP é muito eficiente.</span><span class="sxs-lookup"><span data-stu-id="daf05-793">Because of this, UDP packet transmission is very efficient.</span></span>

### <a name="udp-header"></a><span data-ttu-id="daf05-794">Cabeçalho UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-794">UDP Header</span></span>
<span data-ttu-id="daf05-795">A UDP coloca um simples cabeçalho de pacote na frente dos dados da aplicação sobre a transmissão, e remove um cabeçalho UDP semelhante do pacote na receção antes de entregar um pacote UDP recebido à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-795">UDP places a simple packet header in front of the application's data on transmission, and removes a similar UDP header from the packet on reception before delivering a received UDP packet to the application.</span></span> <span data-ttu-id="daf05-796">O UDP utiliza o protocolo IP para o envio e receção de pacotes, o que significa que há um cabeçalho IP em frente ao cabeçalho da UDP quando o pacote está na rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-796">UDP utilizes the IP protocol for sending and receiving packets, which means there is an IP header in front of the UDP header when the packet is on the network.</span></span> <span data-ttu-id="daf05-797">A figura 9 mostra o formato do cabeçalho da UDP.</span><span class="sxs-lookup"><span data-stu-id="daf05-797">Figure 9 shows the format of the UDP header.</span></span>

![Cabeçalho UDP](./media/user-guide/udp-header.png)

<span data-ttu-id="daf05-799">**FIGURA 9. Cabeçalho UDP**</span><span class="sxs-lookup"><span data-stu-id="daf05-799">**FIGURE 9. UDP Header**</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-800">*Espera-se que todos os cabeçalhos na implementação UDP/IP estejam em grande formato endiano. Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="daf05-800">*All headers in the UDP/IP implementation are expected to be in big endian format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

<span data-ttu-id="daf05-801">O seguinte descreve o formato do cabeçalho UDP:</span><span class="sxs-lookup"><span data-stu-id="daf05-801">The following describes the UDP header format:</span></span>

| <span data-ttu-id="daf05-802">Campo de Cabeçalho</span><span class="sxs-lookup"><span data-stu-id="daf05-802">Header Field</span></span>                   | <span data-ttu-id="daf05-803">Objetivo</span><span class="sxs-lookup"><span data-stu-id="daf05-803">Purpose</span></span> |
|--------------------------------|---------------------------------------------|
| <span data-ttu-id="daf05-804">Número de porta de 16 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-804">16-bit source port number</span></span>      | <span data-ttu-id="daf05-805">Este campo contém a porta de onde o pacote UDP está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="daf05-805">This field contains the port on which the UDP packet is being sent from.</span></span> <span data-ttu-id="daf05-806">As portas UDP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="daf05-806">Valid UDP ports range from 1 through 0xFFFF.</span></span> |
| <span data-ttu-id="daf05-807">Número da porta de destino de 16 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-807">16-bit destination port number</span></span> | <span data-ttu-id="daf05-808">Este campo contém a porta UDP para a qual o pacote está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="daf05-808">This field contains the UDP port to which the packet is being sent to.</span></span> <span data-ttu-id="daf05-809">As portas UDP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="daf05-809">Valid UDP ports range from 1 through 0xFFFF.</span></span>   |
| <span data-ttu-id="daf05-810">Comprimento uDP de 16 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-810">16-bit UDP length</span></span>   | <span data-ttu-id="daf05-811">Este campo contém o número de bytes no pacote UDP, incluindo o tamanho do cabeçalho UDP.</span><span class="sxs-lookup"><span data-stu-id="daf05-811">This field contains the number of bytes in the UDP packet, including the size of the UDP header.</span></span>                                  |
| <span data-ttu-id="daf05-812">16 bits UDP checksum</span><span class="sxs-lookup"><span data-stu-id="daf05-812">16-bit UDP checksum</span></span> | <span data-ttu-id="daf05-813">Este campo contém a 16-bit checkum para o pacote, incluindo o cabeçalho UDP, a área de dados do pacote, e o cabeçalho pseudo IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-813">This field contains the 16-bit checksum for the packet, including the UDP header, the packet data area, and the pseudo IP header.</span></span> |

### <a name="udp-enable"></a><span data-ttu-id="daf05-814">Ativação uDP</span><span class="sxs-lookup"><span data-stu-id="daf05-814">UDP Enable</span></span>

<span data-ttu-id="daf05-815">Antes de a transmissão de pacotes da UDP ser possível, a aplicação deve primeiro permitir a UDP, ligando para o serviço ***nx_udp_enable.***</span><span class="sxs-lookup"><span data-stu-id="daf05-815">Before UDP packet transmission is possible, the application must first enable UDP by calling the ***nx_udp_enable*** service.</span></span> <span data-ttu-id="daf05-816">Depois de ativado, a aplicação é gratuita para enviar e receber pacotes UDP.</span><span class="sxs-lookup"><span data-stu-id="daf05-816">After enabled, the application is free to send and receive UDP packets.</span></span>

### <a name="udp-socket-create"></a><span data-ttu-id="daf05-817">Criação de tomada uDP</span><span class="sxs-lookup"><span data-stu-id="daf05-817">UDP Socket Create</span></span>

<span data-ttu-id="daf05-818">As tomadas UDP são criadas durante a inicialização ou durante o tempo de funcionamento por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-818">UDP sockets are created either during initialization or during runtime by application threads.</span></span> <span data-ttu-id="daf05-819">O tipo inicial de serviço, tempo para viver e receber profundidade de fila são definidos pelo ***serviço nx_udp_socket_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-819">The initial type of service, time to live, and receive queue depth are defined by the ***nx_udp_socket_create*** service.</span></span> <span data-ttu-id="daf05-820">Não existem limites ao número de tomadas UDP numa aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-820">There are no limits on the number of UDP sockets in an application.</span></span>

### <a name="udp-checksum"></a><span data-ttu-id="daf05-821">UDP Checksum</span><span class="sxs-lookup"><span data-stu-id="daf05-821">UDP Checksum</span></span>

<span data-ttu-id="daf05-822">O UDP especifica a parte de verificação de 16 bits de um complemento que cobre o cabeçalho IP pseudo (composto pelo endereço IP de origem, endereço IP de destino e a palavra IP protocol/comprimento), o cabeçalho UDP e os dados do pacote UDP.</span><span class="sxs-lookup"><span data-stu-id="daf05-822">UDP specifies a one's complement 16-bit checksum that covers the IP pseudo header (consisting of the source IP address, destination IP address, and the protocol/length IP word), the UDP header, and the UDP packet data.</span></span> <span data-ttu-id="daf05-823">Se a úmis calculado da UDP for 0, é armazenada como todas (0xFFFF).</span><span class="sxs-lookup"><span data-stu-id="daf05-823">If the calculated UDP checksum is 0, it is stored as all ones (0xFFFF).</span></span> <span data-ttu-id="daf05-824">Se a tomada de envio tiver a lógica de verificação UDP desativada, é colocado um zero no campo de verificação da UDP para indicar que a parte de verificação não foi calculada.</span><span class="sxs-lookup"><span data-stu-id="daf05-824">If the sending socket has the UDP checksum logic disabled, a zero is placed in the UDP checksum field to indicate the checksum was not calculated.</span></span> <span data-ttu-id="daf05-825">Se a sala de verificação UDP não corresponder à parte de verificação calculada pelo recetor, o pacote UDP é simplesmente descartado.</span><span class="sxs-lookup"><span data-stu-id="daf05-825">If the UDP checksum does not match the computed checksum by the receiver, the UDP packet is simply discarded.</span></span>

<span data-ttu-id="daf05-826">Na rede IP, a UDP checksum é opcional.</span><span class="sxs-lookup"><span data-stu-id="daf05-826">On the IP network, UDP checksum is optional.</span></span> <span data-ttu-id="daf05-827">O NetX permite que uma aplicação permita ou desative o cálculo do UDP checkum numa base por tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-827">NetX allows an application to enable or disable UDP checksum calculation on a per-socket basis.</span></span> <span data-ttu-id="daf05-828">Por predefinição, a lógica de verificação da tomada UDP está ativada.</span><span class="sxs-lookup"><span data-stu-id="daf05-828">By default, the UDP socket checksum logic is enabled.</span></span> <span data-ttu-id="daf05-829">A aplicação pode desativar a lógica de checkum para uma determinada tomada UDP, chamando o serviço ***nx_udp_socket_checksum_disable.***</span><span class="sxs-lookup"><span data-stu-id="daf05-829">The application can disable checksum logic for a particular UDP socket by calling the ***nx_udp_socket_checksum_disable*** service.</span></span>

<span data-ttu-id="daf05-830">Certos controladores Ethernet são capazes de gerar o checkum uDP em movimento.</span><span class="sxs-lookup"><span data-stu-id="daf05-830">Certain Ethernet controllers are able to generate the UDP checksum on the fly.</span></span> <span data-ttu-id="daf05-831">Se o sistema for capaz de utilizar a funcionalidade de cálculo de checkum de hardware, a biblioteca NetX pode ser construída sem a lógica de checkum.</span><span class="sxs-lookup"><span data-stu-id="daf05-831">If the system is able to use hardware checksum computation feature, the NetX library can be built without the checksum logic.</span></span> <span data-ttu-id="daf05-832">Para desativar a caixa de verificação do software UDP, a biblioteca NetX deve ser construída com os seguintes símbolos definidos: ***NX_DISABLE_UDP_TX_CHECKSUM*** e \***NX_DISABLE_UDP_RX_CHECKSUM**_ (descrito no [capítulo 2](chapter2.md)). As opções de configuração removem totalmente a lógica de verificação do UDP do NetX, enquanto o\*\*\*\* serviço de nx_udp_socket_checksum_disable _ permite que a aplicação desative o processamento de checkum ipdp numa base de tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-832">To disable UDP software checksum, the NetX library must be built with the following symbols defined: ***NX_DISABLE_UDP_TX_CHECKSUM*** and ***NX_DISABLE_UDP_RX_CHECKSUM\*\*_ (described in [Chapter 2](chapter2.md)). The configuration options remove UDP checksum logic from NetX entirely, while calling the _* nx_udp_socket_checksum_disable**\* service allows the application to disable IP UDP checksum processing on a per socket basis.</span></span>

### <a name="udp-ports-and-binding"></a><span data-ttu-id="daf05-833">Portos da UDP e Encadernação</span><span class="sxs-lookup"><span data-stu-id="daf05-833">UDP Ports and Binding</span></span>

<span data-ttu-id="daf05-834">Uma porta UDP é um ponto final lógico no protocolo UDP.</span><span class="sxs-lookup"><span data-stu-id="daf05-834">A UDP port is a logical end point in the UDP protocol.</span></span> <span data-ttu-id="daf05-835">Existem 65.535 portas válidas na componente UDP da NetX, que variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="daf05-835">There are 65,535 valid ports in the UDP component of NetX, ranging from 1 through 0xFFFF.</span></span> <span data-ttu-id="daf05-836">Para enviar ou receber dados da UDP, a aplicação deve primeiro criar uma tomada UDP e, em seguida, ligá-la a uma porta desejada.</span><span class="sxs-lookup"><span data-stu-id="daf05-836">To send or receive UDP data, the application must first create a UDP socket, then bind it to a desired port.</span></span> <span data-ttu-id="daf05-837">Depois de ligar uma tomada UDP a uma porta, o pedido pode enviar e receber dados sobre essa tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-837">After binding a UDP socket to a port, the application may send and receive data on that socket.</span></span>

### <a name="udp-fast-pathtrade"></a><span data-ttu-id="daf05-838">Caminho Rápido da UDP&trade;</span><span class="sxs-lookup"><span data-stu-id="daf05-838">UDP Fast Path&trade;</span></span>

<span data-ttu-id="daf05-839">O Caminho Rápido da UDP &trade; é o nome para um caminho de sobrecarga de baixo pacote através da implementação do NetX UDP.</span><span class="sxs-lookup"><span data-stu-id="daf05-839">The UDP Fast Path&trade; is the name for a low packet overhead path through the NetX UDP implementation.</span></span> <span data-ttu-id="daf05-840">O envio de um pacote UDP requer apenas algumas chamadas de função: ***nx_udp_socket_send** _, _*_nx_ip_packet_send_\*_, e a eventual chamada para o controlador de rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-840">Sending a UDP packet requires just a few function calls: ***nx_udp_socket_send** _, _*_nx_ip_packet_send_\*_, and the eventual call to the network driver.</span></span> <span data-ttu-id="daf05-841">_*_nx_udp_socket_send_*_ está disponível no NetX para aplicações NetX existentes e só é aplicável para pacotes IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-841">_*_nx_udp_socket_send_*_ is available in NetX for existing NetX applications and is only applicable for IP packets.</span></span> <span data-ttu-id="daf05-842">O método preferido, no entanto, é usar o serviço _ *_nx_udp_socket_send_*\* discutido abaixo.</span><span class="sxs-lookup"><span data-stu-id="daf05-842">The preferred method, however, is to use _ *_nx_udp_socket_send_*\* service discussed below.</span></span> <span data-ttu-id="daf05-843">Na receção do pacote UDP, o pacote UDP é colocado na tomada UDP adequada receber fila ou entregue a um fio de aplicação suspenso numa única chamada de função do processamento de interrupção de receção do condutor da rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-843">On UDP packet reception, the UDP packet is either placed on the appropriate UDP socket receive queue or delivered to a suspended application thread in a single function call from the network driver's receive interrupt processing.</span></span> <span data-ttu-id="daf05-844">Esta lógica altamente otimizada para o envio e receção de pacotes UDP é a essência da tecnologia UDP Fast Path.</span><span class="sxs-lookup"><span data-stu-id="daf05-844">This highly optimized logic for sending and receiving UDP packets is the essence of UDP Fast Path technology.</span></span>

### <a name="udp-packet-send"></a><span data-ttu-id="daf05-845">Envio de pacote de UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-845">UDP Packet Send</span></span>

<span data-ttu-id="daf05-846">O envio de dados UDP através de redes IP é facilmente realizado através da função \***nx_udp_socket_send** _ .</span><span class="sxs-lookup"><span data-stu-id="daf05-846">Sending UDP data over IP networks is easily accomplished by calling the \***nx_udp_socket_send** _ function.</span></span> <span data-ttu-id="daf05-847">O chamador deve definir a versão IP no campo _IP endereço\*.</span><span class="sxs-lookup"><span data-stu-id="daf05-847">The caller must set the IP version in the _IP address\* field.</span></span> <span data-ttu-id="daf05-848">O NetX determinará o melhor endereço de origem para pacotes de UDP transmitidos com base no endereço IP de destino.</span><span class="sxs-lookup"><span data-stu-id="daf05-848">NetX will determine the best source address for transmitted UDP packets based on the destination IP address.</span></span> <span data-ttu-id="daf05-849">Este serviço coloca um cabeçalho UDP na frente dos dados do pacote e envia-o para a rede usando uma rotina interna de envio de IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-849">This service places a UDP header in front of the packet data and sends it out onto the network using an internal IP send routine.</span></span> <span data-ttu-id="daf05-850">Não existe suspensão de fio no envio de pacotes UDP porque todas as transmissões de pacotes UDP são processadas imediatamente.</span><span class="sxs-lookup"><span data-stu-id="daf05-850">There is no thread suspension on sending UDP packets because all UDP packet transmissions are processed immediately.</span></span>

<span data-ttu-id="daf05-851">Para destinos multicast ou de difusão, a aplicação deve especificar o endereço IP de origem para utilizar se o dispositivo NetX tiver vários endereços IP para escolher.</span><span class="sxs-lookup"><span data-stu-id="daf05-851">For multicast or broadcast destinations, the application should specify the source IP address to use if the NetX device has multiple IP addresses to choose from.</span></span> <span data-ttu-id="daf05-852">Isto pode ser feito com os serviços ***nx_udp_socket_interface_send.***</span><span class="sxs-lookup"><span data-stu-id="daf05-852">This can be done with the services ***nx_udp_socket_interface_send.***</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-853">*Se **nx_udp_socket_send** for utilizado para transmitir pacotes multicast ou de transmissão, o endereço IP da primeira interface é utilizado como endereço de origem.*</span><span class="sxs-lookup"><span data-stu-id="daf05-853">*If **nx_udp_socket_send** is used for transmitting multicast or broadcast packets, the IP address of the first interface is used as source address.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-854">*Se a lógica de verificação da UDP estiver ativada para esta tomada, a operação de checkum é realizada no contexto do fio de chamada, sem bloquear o acesso às estruturas de dados UDP ou IP.*</span><span class="sxs-lookup"><span data-stu-id="daf05-854">*If UDP checksum logic is enabled for this socket, the checksum operation is performed in the context of the calling thread, without blocking access to the UDP or IP data structures.*</span></span>

> [!NOTE]
> <span data-ttu-id="daf05-855">*Os dados de carga útil da UDP que residem na estrutura **NX_PACKET** devem residir num limite de palavras longas. A aplicação precisa de deixar espaço suficiente entre o ponteiro pré-reto e o ponteiro de início de dados para o NetX colocar os cabeçalhos UDP, IP e meios de comunicação físicos.*</span><span class="sxs-lookup"><span data-stu-id="daf05-855">*The UDP payload data residing in the **NX_PACKET** structure should reside on a long-word boundary. The application needs to leave sufficient space between the prepend pointer and the data start pointer for NetX to place the UDP, IP, and physical media headers.*</span></span>

### <a name="udp-packet-receive"></a><span data-ttu-id="daf05-856">Receber pacote da UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-856">UDP Packet Receive</span></span>

<span data-ttu-id="daf05-857">Os fios de aplicação podem receber pacotes UDP de uma determinada tomada chamando ***nx_udp_socket_receive***.</span><span class="sxs-lookup"><span data-stu-id="daf05-857">Application threads may receive UDP packets from a particular socket by calling ***nx_udp_socket_receive***.</span></span> <span data-ttu-id="daf05-858">A função de receção da tomada fornece o pacote mais antigo da fila de receção da tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-858">The socket receive function delivers the oldest packet on the socket's receive queue.</span></span> <span data-ttu-id="daf05-859">Se não houver pacotes na fila de receção, o fio de chamada pode suspender (com um intervalo opcional) até chegar um pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-859">If there are no packets on the receive queue, the calling thread can suspend (with an optional timeout) until a packet arrives.</span></span>

<span data-ttu-id="daf05-860">O processamento de pacotes UDP (normalmente chamado do controlador de interrupção de receção do controlador de receção do condutor da rede) é responsável por colocar o pacote na fila de receção da tomada UDP ou entregá-lo ao primeiro fio suspenso à espera de um pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-860">The UDP receive packet processing (usually called from the network driver's receive interrupt handler) is responsible for either placing the packet on the UDP socket's receive queue or delivering it to the first suspended thread waiting for a packet.</span></span> <span data-ttu-id="daf05-861">Se o pacote estiver em fila, o processamento de receção também verifica a profundidade máxima de receção associada à tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-861">If the packet is queued, the receive processing also checks the maximum receive queue depth associated with the socket.</span></span> <span data-ttu-id="daf05-862">Se este pacote recém-em fila exceder a profundidade da fila, o pacote mais antigo da fila é descartado.</span><span class="sxs-lookup"><span data-stu-id="daf05-862">If this newly queued packet exceeds the queue depth, the oldest packet in the queue is discarded.</span></span>

### <a name="udp-receive-notify"></a><span data-ttu-id="daf05-863">Notificação de receção da UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-863">UDP Receive Notify</span></span>

<span data-ttu-id="daf05-864">Se o fio de aplicação precisar de processar dados recebidos de mais de uma tomada, deve ser utilizada a função ***nx_udp_socket_receive_notify.***</span><span class="sxs-lookup"><span data-stu-id="daf05-864">If the application thread needs to process received data from more than one socket, the ***nx_udp_socket_receive_notify*** function should be used.</span></span> <span data-ttu-id="daf05-865">Esta função regista uma função de chamada de pacote de receção para a tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-865">This function registers a receive packet callback function for the socket.</span></span> <span data-ttu-id="daf05-866">Sempre que um pacote é recebido na tomada, a função de retorno é executada.</span><span class="sxs-lookup"><span data-stu-id="daf05-866">Whenever a packet is received on the socket, the callback function is executed.</span></span>

<span data-ttu-id="daf05-867">O conteúdo da função de retorno é específico da aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-867">The contents of the callback function is application-specific.</span></span> <span data-ttu-id="daf05-868">No entanto, provavelmente conteria lógica para informar o fio de processamento de que um pacote está agora disponível na tomada correspondente.</span><span class="sxs-lookup"><span data-stu-id="daf05-868">However, it would most likely contain logic to inform the processing thread that a packet is now available on the corresponding socket.</span></span>

### <a name="peer-address-and-port"></a><span data-ttu-id="daf05-869">Endereço de pares e porto</span><span class="sxs-lookup"><span data-stu-id="daf05-869">Peer Address and Port</span></span>

<span data-ttu-id="daf05-870">Ao receber um pacote UDP, a aplicação pode encontrar o endereço IP e o número de porta do remetente utilizando o ***serviço nx_udp_packet_info_extract***.</span><span class="sxs-lookup"><span data-stu-id="daf05-870">On receiving a UDP packet, application may find the sender's IP address and port number by using the service ***nx_udp_packet_info_extract***.</span></span> <span data-ttu-id="daf05-871">Na devolução bem sucedida, este serviço fornece informações sobre o endereço IP do remetente, o número de porta do remetente e a interface local através da qual o pacote foi recebido.</span><span class="sxs-lookup"><span data-stu-id="daf05-871">On successful return, this service provides information on the sender's IP address, sender's port number, and the local interface through which the packet was received.</span></span>

### <a name="thread-suspension"></a><span data-ttu-id="daf05-872">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="daf05-872">Thread Suspension</span></span>

<span data-ttu-id="daf05-873">Como mencionado anteriormente, os fios de aplicação podem suspender enquanto tentam receber um pacote UDP em uma determinada porta UDP.</span><span class="sxs-lookup"><span data-stu-id="daf05-873">As mentioned previously, application threads can suspend while attempting to receive a UDP packet on a particular UDP port.</span></span> <span data-ttu-id="daf05-874">Depois de recebido um pacote naquela porta, é dado ao primeiro fio suspenso e esse fio é retomado.</span><span class="sxs-lookup"><span data-stu-id="daf05-874">After a packet is received on that port, it is given to the first thread suspended and that thread is then resumed.</span></span> <span data-ttu-id="daf05-875">Um tempo limite opcional está disponível ao suspender um pacote de receção UDP, uma funcionalidade disponível para a maioria dos serviços NetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-875">An optional timeout is available when suspending on a UDP receive packet, a feature available for most NetX services.</span></span>

### <a name="udp-socket-statistics-and-errors"></a><span data-ttu-id="daf05-876">Estatísticas e erros da tomada de UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-876">UDP Socket Statistics and Errors</span></span>

<span data-ttu-id="daf05-877">Se ativado, o software de tomadas UDP NetX mantém o registo de várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-877">If enabled, the NetX UDP socket software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-878">As seguintes estatísticas e relatórios de erro são mantidos para cada instância IP/UDP:</span><span class="sxs-lookup"><span data-stu-id="daf05-878">The following statistics and error reports are maintained for each IP/UDP instance:</span></span>

- <span data-ttu-id="daf05-879">Total de pacotes UDP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-879">Total UDP Packets Sent</span></span>
- <span data-ttu-id="daf05-880">Total de bytes UDP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-880">Total UDP Bytes Sent</span></span>
- <span data-ttu-id="daf05-881">Total de pacotes UDP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-881">Total UDP Packets Received</span></span>
- <span data-ttu-id="daf05-882">Total de bytes UDP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-882">Total UDP Bytes Received</span></span>
- <span data-ttu-id="daf05-883">Total de pacotes inválidos da UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-883">Total UDP Invalid Packets</span></span>
- <span data-ttu-id="daf05-884">Total de pacotes de receção udp caídos</span><span class="sxs-lookup"><span data-stu-id="daf05-884">Total UDP Receive Packets Dropped</span></span>
- <span data-ttu-id="daf05-885">Total da UDP recebe erros de checkum</span><span class="sxs-lookup"><span data-stu-id="daf05-885">Total UDP Receive Checksum Errors</span></span>
- <span data-ttu-id="daf05-886">Pacotes de tomada udp enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-886">UDP Socket Packets Sent</span></span>
- <span data-ttu-id="daf05-887">UDP Socket Bytes Enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-887">UDP Socket Bytes Sent</span></span>
- <span data-ttu-id="daf05-888">Pacotes de tomada udp recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-888">UDP Socket Packets Received</span></span>
- <span data-ttu-id="daf05-889">UDP Socket Bytes Recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-889">UDP Socket Bytes Received</span></span>
- <span data-ttu-id="daf05-890">Pacotes de tomada uDP em fila</span><span class="sxs-lookup"><span data-stu-id="daf05-890">UDP Socket Packets Queued</span></span>
- <span data-ttu-id="daf05-891">Tomada UDP receber pacotes caídos</span><span class="sxs-lookup"><span data-stu-id="daf05-891">UDP Socket Receive Packets Dropped</span></span>
- <span data-ttu-id="daf05-892">Erros de verificação da tomada da UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-892">UDP Socket Checksum Errors</span></span>

<span data-ttu-id="daf05-893">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_udp_info_get*** para estatísticas de UDP acumulados em todas as tomadas UDP, e o serviço ***de nx_udp_socket_info_get*** para estatísticas de UDP na tomada de UDP especificada.</span><span class="sxs-lookup"><span data-stu-id="daf05-893">All these statistics and error reports are available to the application with the ***nx_udp_info_get*** service for UDP statistics amassed over all UDP sockets, and the ***nx_udp_socket_info_get*** service for UDP statistics on the specified UDP socket.</span></span>

### <a name="udp-socket-control-block-nx_udp_socket"></a><span data-ttu-id="daf05-894">NX_UDP_SOCKET do bloco de controlo da tomada UDP</span><span class="sxs-lookup"><span data-stu-id="daf05-894">UDP Socket Control Block NX_UDP_SOCKET</span></span>

<span data-ttu-id="daf05-895">As características de cada tomada UDP encontram-se no bloco de controlo **NX_UDP_SOCKET** associado.</span><span class="sxs-lookup"><span data-stu-id="daf05-895">The characteristics of each UDP socket are found in the associated **NX_UDP_SOCKET** control block.</span></span> <span data-ttu-id="daf05-896">Contém informações úteis, tais como a ligação à estrutura de dados IP, a interface de rede para os caminhos de envio e receção, a porta vinculada e a fila de pacotes de receção.</span><span class="sxs-lookup"><span data-stu-id="daf05-896">It contains useful information such as the link to the IP data structure, the network interface for the sending and receiving paths, the bound port, and the receive packet queue.</span></span> <span data-ttu-id="daf05-897">Esta estrutura é definida no ficheiro **_nx_api.h._**</span><span class="sxs-lookup"><span data-stu-id="daf05-897">This structure is defined in the **_nx_api.h_** file.</span></span>

## <a name="transmission-control-protocol-tcp"></a><span data-ttu-id="daf05-898">Protocolo de Controlo de Transmissão (TCP)</span><span class="sxs-lookup"><span data-stu-id="daf05-898">Transmission Control Protocol (TCP)</span></span>

<span data-ttu-id="daf05-899">O Protocolo de Controlo de Transmissão (TCP) fornece transferência fiável de dados de fluxo entre dois membros da rede (RFC 793).</span><span class="sxs-lookup"><span data-stu-id="daf05-899">The Transmission Control Protocol (TCP) provides reliable stream data transfer between two network members (RFC 793).</span></span> <span data-ttu-id="daf05-900">Todos os dados enviados de um membro da rede são verificados e reconhecidos pelo membro recetor.</span><span class="sxs-lookup"><span data-stu-id="daf05-900">All data sent from one network member are verified and acknowledged by the receiving member.</span></span> <span data-ttu-id="daf05-901">Além disso, os dois membros devem ter estabelecido uma ligação antes de qualquer transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="daf05-901">In addition, the two members must have established a connection prior to any data transfer.</span></span> <span data-ttu-id="daf05-902">Tudo isto resulta numa transferência de dados fiável; no entanto, requer substancialmente mais despesas do que a transferência de dados da UDP anteriormente descrita.</span><span class="sxs-lookup"><span data-stu-id="daf05-902">All this results in reliable data transfer; however, it does require substantially more overhead than the previously described UDP data transfer.</span></span>

### <a name="tcp-header"></a><span data-ttu-id="daf05-903">Cabeçalho TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-903">TCP Header</span></span>

<span data-ttu-id="daf05-904">Na transmissão, o cabeçalho TCP é colocado na frente dos dados do utilizador.</span><span class="sxs-lookup"><span data-stu-id="daf05-904">On transmission, TCP header is placed in front of the data from the user.</span></span> <span data-ttu-id="daf05-905">Na receção, o cabeçalho TCP é removido do pacote de entrada, deixando apenas os dados do utilizador disponíveis para a aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-905">On reception, TCP header is removed from the incoming packet, leaving only the user data available to the application.</span></span> <span data-ttu-id="daf05-906">A TCP utiliza o protocolo IP para enviar e receber pacotes, o que significa que há um cabeçalho IP em frente ao cabeçalho TCP quando o pacote está na rede.</span><span class="sxs-lookup"><span data-stu-id="daf05-906">TCP utilizes the IP protocol to send and receive packets, which means there is an IP header in front of the TCP header when the packet is on the network.</span></span> <span data-ttu-id="daf05-907">A figura 10 mostra o formato do cabeçalho TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-907">Figure 10 shows the format of the TCP header.</span></span>

![Cabeçalho TCP](./media/user-guide/tcp-header.png)

<span data-ttu-id="daf05-909">**FIGURA 10. Cabeçalho TCP**</span><span class="sxs-lookup"><span data-stu-id="daf05-909">**FIGURE 10. TCP Header**</span></span>

<span data-ttu-id="daf05-910">O seguinte descreve o formato do cabeçalho TCP:</span><span class="sxs-lookup"><span data-stu-id="daf05-910">The following describes the TCP header format:</span></span>

| <span data-ttu-id="daf05-911">Campo de Cabeçalho</span><span class="sxs-lookup"><span data-stu-id="daf05-911">Header Field</span></span> | <span data-ttu-id="daf05-912">Objetivo</span><span class="sxs-lookup"><span data-stu-id="daf05-912">Purpose</span></span> |
|---|---|
| <span data-ttu-id="daf05-913">Número de porta de 16 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-913">16-bit source port number</span></span> | <span data-ttu-id="daf05-914">Este campo contém a porta onde o pacote TCP está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="daf05-914">This field contains the port the TCP packet is being sent out on.</span></span> <span data-ttu-id="daf05-915">As portas TCP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="daf05-915">Valid TCP ports range from 1 through 0xFFFF.</span></span> |
| <span data-ttu-id="daf05-916">Número da porta de destino de 16 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-916">16-bit destination port number</span></span> | <span data-ttu-id="daf05-917">Este campo contém a porta TCP para onde o pacote está a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="daf05-917">This field contains the TCP port the packet is being sent to.</span></span> <span data-ttu-id="daf05-918">As portas TCP válidas variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="daf05-918">Valid TCP ports range from 1 through 0xFFFF.</span></span> |
| <span data-ttu-id="daf05-919">Número de sequência de 32 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-919">32-bit sequence number</span></span> | <span data-ttu-id="daf05-920">Este campo contém o número de sequência para os dados enviados a partir desta extremidade da ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-920">This field contains the sequence number for data sent from this end of the connection.</span></span> <span data-ttu-id="daf05-921">A sequência original é estabelecida durante a sequência de ligação inicial entre dois nós TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-921">The original sequence is established during the initial connection sequence between two TCP nodes.</span></span> <span data-ttu-id="daf05-922">Cada transferência de dados a partir desse ponto resulta num incremento do número de sequência pelo número de bytes enviados.</span><span class="sxs-lookup"><span data-stu-id="daf05-922">Every data transfer from that point results in an increment of the sequence number by the amount bytes sent.</span></span> |
| <span data-ttu-id="daf05-923">Número de reconhecimento de 32 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-923">32-bit acknowledgement number</span></span> | <span data-ttu-id="daf05-924">Este campo contém o número de sequência correspondente ao último byte recebido por este lado da ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-924">This field contains the sequence number corresponding to the last byte received by this side of the connection.</span></span> <span data-ttu-id="daf05-925">Isto é usado para determinar se os dados anteriormente enviados foram recebidos com sucesso pela outra extremidade da ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-925">This is used to determine whether or not data previously sent has successfully been received by the other end of the connection.</span></span> |
| <span data-ttu-id="daf05-926">Comprimento do cabeçalho de 4 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-926">4-bit header length</span></span>           | <span data-ttu-id="daf05-927">Este campo contém o número de palavras de 32 bits no cabeçalho TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-927">This field contains the number of 32-bit words in the TCP header.</span></span> <span data-ttu-id="daf05-928">Se não houver opções no cabeçalho TCP, este campo é 5.</span><span class="sxs-lookup"><span data-stu-id="daf05-928">If no options are present in the TCP header, this field is 5.</span></span> |
| <span data-ttu-id="daf05-929">Bits de código de 6 bits</span><span class="sxs-lookup"><span data-stu-id="daf05-929">6-bit code bits</span></span>               | <span data-ttu-id="daf05-930">Este campo contém os seis bits de código diferentes utilizados para indicar várias informações de controlo associadas à ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-930">This field contains the six different code bits used to indicate various control information associated with the connection.</span></span> <span data-ttu-id="daf05-931">As bits de controlo são definidas da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="daf05-931">The control bits are defined as follows:</span></span> |



| <span data-ttu-id="daf05-932">Name</span><span class="sxs-lookup"><span data-stu-id="daf05-932">Name</span></span> | <span data-ttu-id="daf05-933">Pouco</span><span class="sxs-lookup"><span data-stu-id="daf05-933">Bit</span></span> | <span data-ttu-id="daf05-934">Significado</span><span class="sxs-lookup"><span data-stu-id="daf05-934">Meaning</span></span>                                                     |
|------|-----|-------------------------------------------------------------|
| <span data-ttu-id="daf05-935">URG</span><span class="sxs-lookup"><span data-stu-id="daf05-935">URG</span></span>  | <span data-ttu-id="daf05-936">21</span><span class="sxs-lookup"><span data-stu-id="daf05-936">21</span></span>  | <span data-ttu-id="daf05-937">Dados urgentes presentes</span><span class="sxs-lookup"><span data-stu-id="daf05-937">Urgent data present</span></span>                                         |
| <span data-ttu-id="daf05-938">Rio ACK</span><span class="sxs-lookup"><span data-stu-id="daf05-938">ACK</span></span>  | <span data-ttu-id="daf05-939">20</span><span class="sxs-lookup"><span data-stu-id="daf05-939">20</span></span>  | <span data-ttu-id="daf05-940">O número de agradecimento é válido</span><span class="sxs-lookup"><span data-stu-id="daf05-940">Acknowledgement number is valid</span></span>                             |
| <span data-ttu-id="daf05-941">PSH</span><span class="sxs-lookup"><span data-stu-id="daf05-941">PSH</span></span>  | <span data-ttu-id="daf05-942">19</span><span class="sxs-lookup"><span data-stu-id="daf05-942">19</span></span>  | <span data-ttu-id="daf05-943">Trate estes dados imediatamente</span><span class="sxs-lookup"><span data-stu-id="daf05-943">Handle this data immediately</span></span>                                |
| <span data-ttu-id="daf05-944">RST</span><span class="sxs-lookup"><span data-stu-id="daf05-944">RST</span></span>  | <span data-ttu-id="daf05-945">18</span><span class="sxs-lookup"><span data-stu-id="daf05-945">18</span></span>  | <span data-ttu-id="daf05-946">Repor a ligação</span><span class="sxs-lookup"><span data-stu-id="daf05-946">Reset the connection</span></span>                                        |
| <span data-ttu-id="daf05-947">SIN</span><span class="sxs-lookup"><span data-stu-id="daf05-947">SYN</span></span>  | <span data-ttu-id="daf05-948">17</span><span class="sxs-lookup"><span data-stu-id="daf05-948">17</span></span>  | <span data-ttu-id="daf05-949">Sincronizar os números de sequência (usado para estabelecer a ligação)</span><span class="sxs-lookup"><span data-stu-id="daf05-949">Synchronize sequence numbers (used to establish connection)</span></span> |
| <span data-ttu-id="daf05-950">FIN</span><span class="sxs-lookup"><span data-stu-id="daf05-950">FIN</span></span>  | <span data-ttu-id="daf05-951">16</span><span class="sxs-lookup"><span data-stu-id="daf05-951">16</span></span>  | <span data-ttu-id="daf05-952">O remetente é terminado com o transmissor (usado para fechar a ligação)</span><span class="sxs-lookup"><span data-stu-id="daf05-952">Sender is finished with transmit (used to close connection)</span></span> |

<span data-ttu-id="daf05-953">**Janela de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="daf05-953">**16-bit window**</span></span>

<span data-ttu-id="daf05-954">Este campo é utilizado para o controlo de fluxos.</span><span class="sxs-lookup"><span data-stu-id="daf05-954">This field is used for flow control.</span></span> <span data-ttu-id="daf05-955">Contém a quantidade de bytes que a tomada pode receber atualmente.</span><span class="sxs-lookup"><span data-stu-id="daf05-955">It contains the amount of bytes the socket can currently receive.</span></span> <span data-ttu-id="daf05-956">Isto é basicamente usado para o controlo de fluxo.</span><span class="sxs-lookup"><span data-stu-id="daf05-956">This basically is used for flow control.</span></span> <span data-ttu-id="daf05-957">O remetente é responsável por se certificar de que os dados a enviar se encaixam na janela anunciada do recetor.</span><span class="sxs-lookup"><span data-stu-id="daf05-957">The sender is responsible for making sure the data to send will fit into the receiver’s advertised window.</span></span>

| <span data-ttu-id="daf05-958">**Campo de Cabeçalho**</span><span class="sxs-lookup"><span data-stu-id="daf05-958">**Header Field**</span></span>          | <span data-ttu-id="daf05-959">**Objetivo**</span><span class="sxs-lookup"><span data-stu-id="daf05-959">**Purpose**</span></span> |
| ------------------------- | --- |
| <span data-ttu-id="daf05-960">**Cheque TCP de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="daf05-960">**16-bit TCP checksum**</span></span>   | <span data-ttu-id="daf05-961">Este campo contém a 16-bit checkum para o pacote, incluindo o cabeçalho TCP, a área de dados do pacote e o cabeçalho pseudo IP.</span><span class="sxs-lookup"><span data-stu-id="daf05-961">This field contains the 16-bit checksum for the packet including the TCP header, the packet data area, and the pseudo IP header.</span></span>                |
| <span data-ttu-id="daf05-962">**Ponteiro urgente de 16 bits**</span><span class="sxs-lookup"><span data-stu-id="daf05-962">**16-bit urgent pointer**</span></span> | <span data-ttu-id="daf05-963">Este campo contém a compensação positiva do último byte dos dados urgentes.</span><span class="sxs-lookup"><span data-stu-id="daf05-963">This field contains the positive offset of the last byte of the urgent data.</span></span> <span data-ttu-id="daf05-964">Este campo só é válido se a broca de código urg estiver definida no cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="daf05-964">This field is only valid if the URG code bit is set in the header.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="daf05-965">*Espera-se que todos os cabeçalhos na implementação TCP/IP estejam em grande formato endiano. Neste formato, o byte mais significativo da palavra reside no endereço byte mais baixo.*</span><span class="sxs-lookup"><span data-stu-id="daf05-965">*All headers in the TCP/IP implementation are expected to be in big endian format. In this format, the most significant byte of the word resides at the lowest byte address.*</span></span>

### <a name="tcp-enable"></a><span data-ttu-id="daf05-966">Ativar TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-966">TCP Enable</span></span>

<span data-ttu-id="daf05-967">Antes de as ligações TCP e as transmissões de pacotes serem possíveis, a aplicação deve primeiro permitir a TCP, ligando para o serviço nx_tcp_enable.</span><span class="sxs-lookup"><span data-stu-id="daf05-967">Before TCP connections and packet transmissions are possible, the application must first enable TCP by calling the nx_tcp_enable service.</span></span> <span data-ttu-id="daf05-968">Depois de ativado, a aplicação é gratuita para aceder a todos os serviços TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-968">After enabled, the application is free to access all TCP services.</span></span>

### <a name="tcp-socket-create"></a><span data-ttu-id="daf05-969">Criação de tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-969">TCP Socket Create</span></span>

<span data-ttu-id="daf05-970">As tomadas TCP são criadas durante a inicialização ou durante o tempo de funcionamento por fios de aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-970">TCP sockets are created either during initialization or during runtime by application threads.</span></span> <span data-ttu-id="daf05-971">O tipo inicial de serviço, tempo para viver e tamanho da janela são definidos pelo ***serviço nx_tcp_socket_create.***</span><span class="sxs-lookup"><span data-stu-id="daf05-971">The initial type of service, time to live, and window size are defined by the ***nx_tcp_socket_create*** service.</span></span> <span data-ttu-id="daf05-972">Não existem limites ao número de tomadas TCP numa aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-972">There are no limits on the number of TCP sockets in an application.</span></span>

### <a name="tcp-checksum"></a><span data-ttu-id="daf05-973">TCP Checksum</span><span class="sxs-lookup"><span data-stu-id="daf05-973">TCP Checksum</span></span>

<span data-ttu-id="daf05-974">A TCP especifica a parte de verificação de 16 bits de um complemento que cobre o cabeçalho IP pseudo (composto pelo endereço IP de origem, endereço IP de destino e a palavra IP protocol/comprimento), o cabeçalho TCP e os dados do pacote TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-974">TCP specifies a one’s complement 16-bit checksum that covers the IP pseudo header, (consisting of the source IP address, destination IP address, and the protocol/length IP word), the TCP header, and the TCP packet data.</span></span>

<span data-ttu-id="daf05-975">Certos controladores de rede são capazes de realizar cálculo e validação de verificação de TCP em hardware.</span><span class="sxs-lookup"><span data-stu-id="daf05-975">Certain network controllers are able to perform TCP checksum computation and validation in hardware.</span></span> <span data-ttu-id="daf05-976">Para estes sistemas, as aplicações podem pretender utilizar a lógica de hardware checksum tanto quanto possível para reduzir a sobrecarga de tempo de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="daf05-976">For such systems, applications may want to use hardware checksum logic as much as possible to reduce runtime overhead.</span></span> <span data-ttu-id="daf05-977">As aplicações podem desativar a lógica de cálculo de checkum da TCP da biblioteca NetX completamente no tempo de construção, definindo **NX_DISABLE_TCP_TX_CHECKSUM** e **NX_DISABLE_TCP_RX_CHECKSUM**.</span><span class="sxs-lookup"><span data-stu-id="daf05-977">Applications may disable TCP checksum computation logic from the NetX library altogether at build time by defining **NX_DISABLE_TCP_TX_CHECKSUM** and **NX_DISABLE_TCP_RX_CHECKSUM**.</span></span> <span data-ttu-id="daf05-978">Desta forma, o código de verificação TCP não é compilado.</span><span class="sxs-lookup"><span data-stu-id="daf05-978">This way, the TCP checksum code is not compiled in.</span></span>

### <a name="tcp-port"></a><span data-ttu-id="daf05-979">Porta TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-979">TCP Port</span></span>

<span data-ttu-id="daf05-980">Uma porta TCP é um ponto de ligação lógico no protocolo TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-980">A TCP port is a logical connection point in the TCP protocol.</span></span> <span data-ttu-id="daf05-981">Existem 65.535 portas válidas na componente TCP da NetX, que variam de 1 a 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="daf05-981">There are 65,535 valid ports in the TCP component of NetX, ranging from 1 through 0xFFFF.</span></span> <span data-ttu-id="daf05-982">Ao contrário da UDP em que os dados de uma porta podem ser enviados para qualquer outra porta de destino, uma porta TCP está ligada a outra porta TCP específica, e só quando esta ligação é estabelecida pode ocorrer qualquer transferência de dados — e apenas entre as duas portas que compõem a ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-982">Unlike UDP in which data from one port can be sent to any other destination port, a TCP port is connected to another specific TCP port, and only when this connection is established can any data transfer take place—and only between the two ports making up the connection.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-983">*As portas TCP são completamente separadas das portas UDP; por exemplo, a porta udp número 1 não tem qualquer relação com a porta TCP número 1.*</span><span class="sxs-lookup"><span data-stu-id="daf05-983">*TCP ports are completely separate from UDP ports; e.g., UDP port number 1 has no relation to TCP port number 1.*</span></span>

## <a name="client-server-model"></a><span data-ttu-id="daf05-984">Modelo Client-Server</span><span class="sxs-lookup"><span data-stu-id="daf05-984">Client-Server Model</span></span>

<span data-ttu-id="daf05-985">Para utilizar o TCP para transferência de dados, deve primeiro ser estabelecida uma ligação entre as duas tomadas TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-985">To use TCP for data transfer, a connection must first be established between the two TCP sockets.</span></span> <span data-ttu-id="daf05-986">O estabelecimento da ligação é feito de forma cliente-servidor.</span><span class="sxs-lookup"><span data-stu-id="daf05-986">The establishment of the connection is done in a client-server fashion.</span></span> <span data-ttu-id="daf05-987">O lado cliente da ligação é o lado que inicia a ligação, enquanto o lado do servidor simplesmente aguarda os pedidos de ligação do cliente antes de qualquer processamento ser feito.</span><span class="sxs-lookup"><span data-stu-id="daf05-987">The client side of the connection is the side that initiates the connection, while the server side simply waits for client connection requests before any processing is done.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-988">*Para dispositivos multihomes, o NetX determina automaticamente o endereço de origem a utilizar para a ligação e o próximo endereço de lúpulo baseado no endereço IP de destino da ligação.*</span><span class="sxs-lookup"><span data-stu-id="daf05-988">*For multihome devices, NetX automatically determines the source address to use for the connection, and the next hop address based on the destination IP address of the connection.*</span></span>

### <a name="tcp-socket-state-machine"></a><span data-ttu-id="daf05-989">Máquina de estado de tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-989">TCP Socket State Machine</span></span>

<span data-ttu-id="daf05-990">A ligação entre duas tomadas TCP (um cliente e um servidor) é complexa e é gerida de forma estatal.</span><span class="sxs-lookup"><span data-stu-id="daf05-990">The connection between two TCP sockets (one client and one server) is complex and is managed in a state machine manner.</span></span> <span data-ttu-id="daf05-991">Cada tomada TCP começa em estado fechado.</span><span class="sxs-lookup"><span data-stu-id="daf05-991">Each TCP socket starts in a CLOSED state.</span></span> <span data-ttu-id="daf05-992">Através de eventos de ligação, a máquina estatal de cada tomada migra para o estado ESTABELECIDO, que é onde ocorre a maior parte da transferência de dados em TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-992">Through connection events each socket's state machine migrates into the ESTABLISHED state, which is where the bulk of the data transfer in TCP takes place.</span></span> <span data-ttu-id="daf05-993">Quando um dos lados da ligação já não deseja enviar dados, desliga-se.</span><span class="sxs-lookup"><span data-stu-id="daf05-993">When one side of the connection no longer wishes to send data, it disconnects.</span></span> <span data-ttu-id="daf05-994">Depois de o outro lado desligar, eventualmente a tomada TCP volta ao estado fechado.</span><span class="sxs-lookup"><span data-stu-id="daf05-994">After the other side disconnects, eventually the TCP socket returns to the CLOSED state.</span></span> <span data-ttu-id="daf05-995">Este processo repete-se sempre que um cliente e servidor TCP estabelecem e fecham uma ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-995">This process repeats each time a TCP client and server establish and close a connection.</span></span> <span data-ttu-id="daf05-996">A figura 11 mostra os vários estados da máquina estatal TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-996">Figure 11 shows the various states of the TCP state machine.</span></span>

![Estados da Máquina Estatal TCP](./media/user-guide/states-tcp-state-machine.png)

### <a name="figure-11-states-of-the-tcp-state-machine"></a><span data-ttu-id="daf05-998">FIGURA 11.</span><span class="sxs-lookup"><span data-stu-id="daf05-998">FIGURE 11.</span></span> <span data-ttu-id="daf05-999">Estados da Máquina Estatal TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-999">States of the TCP State Machine</span></span>

### <a name="tcp-client-connection"></a><span data-ttu-id="daf05-1000">Conexão ao cliente TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1000">TCP Client Connection</span></span>

<span data-ttu-id="daf05-1001">Como mencionado anteriormente, o lado cliente da ligação TCP inicia um pedido de ligação a um servidor TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-1001">As mentioned previously, the client side of the TCP connection initiates a connection request to a TCP server.</span></span> <span data-ttu-id="daf05-1002">Antes de um pedido de ligação ser feito, o TCP deve ser ativado na instância IP do cliente.</span><span class="sxs-lookup"><span data-stu-id="daf05-1002">Before a connection request can be made, TCP must be enabled on the client IP instance.</span></span> <span data-ttu-id="daf05-1003">Além disso, a tomada TCP do cliente deve ser criada em seguida com o serviço ***nx_tcp_socket_create** _ e vinculada a uma porta através do serviço _*_nx_tcp_client_socket_bind._\*_</span><span class="sxs-lookup"><span data-stu-id="daf05-1003">In addition, the client TCP socket must next be created with the ***nx_tcp_socket_create** _ service and bound to a port via the _*_nx_tcp_client_socket_bind_\*_ service.</span></span> <span data-ttu-id="daf05-1004">Depois de a tomada do cliente estar ligada, o serviço _ *_nx_tcp_client_socket_connect_*\* é utilizado para estabelecer uma ligação com um servidor TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-1004">After the client socket is bound, the _ *_nx_tcp_client_socket_connect_*\* service is used to establish a connection with a TCP server.</span></span> <span data-ttu-id="daf05-1005">Note que a tomada deve estar num estado fechado para iniciar uma tentativa de ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1005">Note the socket must be in a CLOSED state to initiate a connection attempt.</span></span> <span data-ttu-id="daf05-1006">O estabelecimento da ligação começa com a emissão de um pacote SYN E, em seguida, à espera de um pacote SYN ACK de volta do servidor, o que significa a aceitação do pedido de ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1006">Establishing the connection starts with NetX issuing a SYN packet and then waiting for a SYN ACK packet back from the server, which signifies acceptance of the connection request.</span></span> <span data-ttu-id="daf05-1007">Após a receção do SYN ACK, a NetX responde com um pacote ACK e promove a tomada do cliente para o estado estabelecido.</span><span class="sxs-lookup"><span data-stu-id="daf05-1007">After the SYN ACK is received, NetX responds with an ACK packet and promotes the client socket to the ESTABLISHED state.</span></span>

### <a name="tcp-client-disconnection"></a><span data-ttu-id="daf05-1008">Desconexão do cliente TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1008">TCP Client Disconnection</span></span>

<span data-ttu-id="daf05-1009">O fecho da ligação é realizado chamando ***nx_tcp_socket_disconnect***.</span><span class="sxs-lookup"><span data-stu-id="daf05-1009">Closing the connection is accomplished by calling ***nx_tcp_socket_disconnect***.</span></span> <span data-ttu-id="daf05-1010">Se não for especificada qualquer suspensão, a tomada do cliente envia um pacote RST para a tomada do servidor e coloca a tomada no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="daf05-1010">If no suspension is specified, the client socket sends a RST packet to the server socket and places the socket in the CLOSED state.</span></span> <span data-ttu-id="daf05-1011">Caso contrário, se for solicitada uma suspensão, é executada a completa do protocolo de desconexão TCP, da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="daf05-1011">Otherwise, if a suspension is requested, the full TCP disconnect protocol is performed, as follows:</span></span>

- <span data-ttu-id="daf05-1012">Se o servidor já tinha iniciado um pedido de desconexão (a tomada do cliente já recebeu um pacote FIN, respondeu com um ACK, e está no estado CLOSE WAIT), a NetX promove o estado de tomada TCP do cliente para o estado de ÚLTIMA ACK e envia um pacote FIN.</span><span class="sxs-lookup"><span data-stu-id="daf05-1012">If the server previously initiated a disconnect request (the client socket has already received a FIN packet, responded with an ACK, and is in the CLOSE WAIT state), NetX promotes the client TCP socket state to the LAST ACK state and sends a FIN packet.</span></span> <span data-ttu-id="daf05-1013">Em seguida, aguarda um ACK do servidor antes de completar a desconexão e entrar no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="daf05-1013">It then waits for an ACK from the server before completing the disconnect and entering the CLOSED state.</span></span>

- <span data-ttu-id="daf05-1014">Se, por outro lado, o cliente for o primeiro a iniciar um pedido de desconexão (o servidor não foi desligado e a tomada ainda se encontra no estado ESTABELECIDO), o NetX envia um pacote FIN para iniciar a desconexão e espera receber uma FIN e um ACK do servidor antes de completar a desconexão e colocar a tomada num estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="daf05-1014">If on the other hand, the client is the first to initiate a disconnect request (the server has not disconnected and the socket is still in the ESTABLISHED state), NetX sends a FIN packet to initiate the disconnect and waits to receive a FIN and an ACK from the server before completing the disconnect and placing the socket in a CLOSED state.</span></span>

<span data-ttu-id="daf05-1015">Se ainda existirem pacotes na fila de transmissão da tomada, o NetX suspende o tempo limite especificado para permitir o reconhecimento dos pacotes.</span><span class="sxs-lookup"><span data-stu-id="daf05-1015">If there are still packets on the socket transmit queue, NetX suspends for the specified timeout to allow the packets to be acknowledged.</span></span> <span data-ttu-id="daf05-1016">Se o tempo limite expirar, o NetX esvazia a fila de transmissão da tomada do cliente.</span><span class="sxs-lookup"><span data-stu-id="daf05-1016">If the timeout expires, NetX empties the transmit queue of the client socket.</span></span>

<span data-ttu-id="daf05-1017">Para desvindia a porta da tomada do cliente, a aplicação chama ***nx_tcp_client_socket_unbind***.</span><span class="sxs-lookup"><span data-stu-id="daf05-1017">To unbind the port from the client socket, the application calls ***nx_tcp_client_socket_unbind***.</span></span> <span data-ttu-id="daf05-1018">A tomada deve estar num estado fechado ou em processo de desconexão (isto é, estado de espera TIMED) antes de a porta ser libertada; caso contrário, um erro é devolvido.</span><span class="sxs-lookup"><span data-stu-id="daf05-1018">The socket must be in a CLOSED state or in the process of disconnecting (i.e., TIMED WAIT state) before the port is released; otherwise, an error is returned.</span></span>

<span data-ttu-id="daf05-1019">Finalmente, se a aplicação já não necessitar da tomada do cliente, chama ***nx_tcp_socket_delete*** para apagar a tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1019">Finally, if the application no longer needs the client socket, it calls ***nx_tcp_socket_delete*** to delete the socket.</span></span>

### <a name="tcp-server-connection"></a><span data-ttu-id="daf05-1020">Conexão do servidor TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1020">TCP Server Connection</span></span>

<span data-ttu-id="daf05-1021">O lado do servidor de uma ligação TCP é passivo; ou seja, o servidor aguarda que um cliente inicie o pedido de ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1021">The server side of a TCP connection is passive; i.e., the server waits for a client to initiate connection request.</span></span> <span data-ttu-id="daf05-1022">Para aceitar uma ligação ao cliente, a TCP deve primeiro ser ativada na instância IP, ligando para o serviço \***nx_tcp_enable** _.</span><span class="sxs-lookup"><span data-stu-id="daf05-1022">To accept a client connection, TCP must first be enabled on the IP instance by calling the service \***nx_tcp_enable** _.</span></span> <span data-ttu-id="daf05-1023">Em seguida, a aplicação deve criar uma tomada TCP utilizando o serviço _ *_nx_tcp_socket_create_*\* .</span><span class="sxs-lookup"><span data-stu-id="daf05-1023">Next, the application must create a TCP socket using the _ *_nx_tcp_socket_create_*\* service.</span></span>

<span data-ttu-id="daf05-1024">A tomada do servidor também deve ser configurada para ouvir pedidos de ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1024">The server socket must also be set up for listening for connection requests.</span></span> <span data-ttu-id="daf05-1025">Isto é conseguido utilizando o serviço ***nx_tcp_server_socket_listen.***</span><span class="sxs-lookup"><span data-stu-id="daf05-1025">This is achieved by using the ***nx_tcp_server_socket_listen*** service.</span></span> <span data-ttu-id="daf05-1026">Este serviço coloca a tomada do servidor no estado LISTEN e liga a porta do servidor especificada à tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1026">This service places the server socket in the LISTEN state and binds the specified server port to the socket.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-1027">*Para definir uma rotina de chamada de chamada de tomada, a aplicação especifica a função de retorno adequada para o argumento tcp_listen_callback do serviço **nx_tcp_server_socket_listen.** Esta função de chamada de aplicação é então executada pelo NetX sempre que uma nova ligação é solicitada nesta porta do servidor. O processamento na chamada está sob controlo de aplicação.*</span><span class="sxs-lookup"><span data-stu-id="daf05-1027">*To set a socket listen callback routine the application specifies the appropriate callback function for the tcp_listen_callback argument of the **nx_tcp_server_socket_listen** service. This application callback function is then executed by NetX whenever a new connection is requested on this server port. The processing in the callback is under application control.*</span></span>

<span data-ttu-id="daf05-1028">Para aceitar pedidos de ligação ao cliente, a aplicação liga para o serviço \***nx_tcp_server_socket_accept** _ .</span><span class="sxs-lookup"><span data-stu-id="daf05-1028">To accept client connection requests, the application calls the \***nx_tcp_server_socket_accept** _ service.</span></span> <span data-ttu-id="daf05-1029">A tomada do servidor deve estar num estado DE ESCUTA ou num estado SYN RECEIVED (ou seja, o servidor está no estado LISTEN e recebeu um pacote SYN de um cliente que solicita uma ligação) para ligar para o serviço de aceitação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1029">The server socket must either be in a LISTEN state or a SYN RECEIVED state (i.e., the server is in the LISTEN state and has received a SYN packet from a client requesting a connection) to call the accept service.</span></span> <span data-ttu-id="daf05-1030">Um estado de retorno bem sucedido de _ *_nx_tcp_server_socket_accept_*\* indica que a ligação foi configurada e a tomada do servidor está no estado ESTABELECIDO.</span><span class="sxs-lookup"><span data-stu-id="daf05-1030">A successful return status from _ *_nx_tcp_server_socket_accept_*\* indicates the connection has been set up and the server socket is in the ESTABLISHED state.</span></span>

<span data-ttu-id="daf05-1031">Depois de a tomada do servidor ter uma ligação válida, os pedidos adicionais de ligação ao cliente são colocados na fila até à profundidade especificada pelo *listen_queue_size,* transmitidos para o serviço \***nx_tcp_server_socket_listen** _ .</span><span class="sxs-lookup"><span data-stu-id="daf05-1031">After the server socket has a valid connection, additional client connection requests are queued up to the depth specified by the *listen_queue_size*, passed into the \***nx_tcp_server_socket_listen** _ service.</span></span> <span data-ttu-id="daf05-1032">Para processar as ligações subsequentes numa porta do servidor, a aplicação deve ligar para _ *_nx_tcp_server_socket_relisten_*\* com uma tomada disponível (ou seja, uma tomada em estado fechado).</span><span class="sxs-lookup"><span data-stu-id="daf05-1032">In order to process subsequent connections on a server port, the application must call _ *_nx_tcp_server_socket_relisten_*\* with an available socket (i.e., a socket in a CLOSED state).</span></span> <span data-ttu-id="daf05-1033">Note que a mesma tomada do servidor pode ser utilizada se a ligação anterior associada à tomada estiver concluída e a tomada estiver no estado fechado.</span><span class="sxs-lookup"><span data-stu-id="daf05-1033">Note that the same server socket could be used if the previous connection associated with the socket is now finished and the socket is in the CLOSED state.</span></span>

### <a name="tcp-server-disconnection"></a><span data-ttu-id="daf05-1034">Desconexão do servidor TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1034">TCP Server Disconnection</span></span>

<span data-ttu-id="daf05-1035">O fecho da ligação é realizado chamando ***nx_tcp_socket_disconnect***.</span><span class="sxs-lookup"><span data-stu-id="daf05-1035">Closing the connection is accomplished by calling ***nx_tcp_socket_disconnect***.</span></span> <span data-ttu-id="daf05-1036">Se não for especificada qualquer suspensão, a tomada do servidor envia um pacote RST para a tomada do cliente e coloca a tomada no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="daf05-1036">If no suspension is specified, the server socket sends a RST packet to the client socket and places the socket in the CLOSED state.</span></span> <span data-ttu-id="daf05-1037">Caso contrário, se for solicitada uma suspensão, é executada a completa do protocolo de desconexão TCP: |</span><span class="sxs-lookup"><span data-stu-id="daf05-1037">Otherwise, if a suspension is requested, the full TCP disconnect protocol is performed, as follows: |</span></span>

- <span data-ttu-id="daf05-1038">Se o cliente já tinha iniciado um pedido de desconexão (a tomada do servidor já recebeu um pacote FIN, respondeu com um ACK, e está no estado CLOSE WAIT), a NetX promove o estado de tomada TCP para o estado de última ACK e envia um pacote FIN.</span><span class="sxs-lookup"><span data-stu-id="daf05-1038">If the client previously initiated a disconnect request (the server socket has already received a FIN packet, responded with an ACK, and is in the CLOSE WAIT state), NetX promotes the TCP socket state to the LAST ACK state and sends a FIN packet.</span></span> <span data-ttu-id="daf05-1039">Em seguida, aguarda um ACK do cliente antes de completar a desconexão e entrar no estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="daf05-1039">It then waits for an ACK from the client before completing the disconnect and entering the CLOSED state.</span></span>

- <span data-ttu-id="daf05-1040">Se, por outro lado, o servidor for o primeiro a iniciar um pedido de desconexão (o cliente não se desligou e a tomada ainda se encontra no estado ESTABELECIDO), a NetX envia um pacote FIN para iniciar a desconexão e espera receber uma FIN e um ACK do cliente antes de completar a desconexão e colocar a tomada num estado FECHADO.</span><span class="sxs-lookup"><span data-stu-id="daf05-1040">If on the other hand, the server is the first to initiate a disconnect request (the client has not disconnected and the socket is still in the ESTABLISHED state), NetX sends a FIN packet to initiate the disconnect and waits to receive a FIN and an ACK from the client before completing the disconnect and placing the socket in a CLOSED state.</span></span>

<span data-ttu-id="daf05-1041">Se ainda existirem pacotes na fila de transmissão da tomada, o NetX suspende o tempo limite especificado para permitir que esses pacotes sejam reconhecidos.</span><span class="sxs-lookup"><span data-stu-id="daf05-1041">If there are still packets on the socket transmit queue, NetX suspends for the specified timeout to allow those packets to be acknowledged.</span></span> <span data-ttu-id="daf05-1042">Se o tempo limite expirar, o NetX descarrega a fila de transmissão da tomada do servidor.</span><span class="sxs-lookup"><span data-stu-id="daf05-1042">If the timeout expires, NetX flushes the transmit queue of the server socket.</span></span>

<span data-ttu-id="daf05-1043">Após o processamento da desconexão estar concluído e a tomada do servidor estiver no estado FECHADO, a aplicação deve chamar o serviço ***nx_tcp_server_socket_unaccept*** para terminar a associação desta tomada com a porta do servidor.</span><span class="sxs-lookup"><span data-stu-id="daf05-1043">After the disconnect processing is complete and the server socket is in the CLOSED state, the application must call the ***nx_tcp_server_socket_unaccept*** service to end the association of this socket with the server port.</span></span> <span data-ttu-id="daf05-1044">Note que este serviço deve ser chamado pela aplicação mesmo ***que nx_tcp_socket_disconnect*** ou \***nx_tcp_server_socket_accept** _ devolva um estado de erro.</span><span class="sxs-lookup"><span data-stu-id="daf05-1044">Note this service must be called by the application even if ***nx_tcp_socket_disconnect*** or \***nx_tcp_server_socket_accept** _ return an error status.</span></span> <span data-ttu-id="daf05-1045">Após a devolução do _ *_nx_tcp_server_socket_unaccept*_\* a tomada pode ser utilizada como tomada de cliente ou servidor, ou mesmo eliminada se já não for necessária.</span><span class="sxs-lookup"><span data-stu-id="daf05-1045">After the _ *_nx_tcp_server_socket_unaccept_*\* returns, the socket can be used as a client or server socket, or even deleted if it is no longer needed.</span></span> <span data-ttu-id="daf05-1046">Se aceitar outra ligação ao cliente na mesma porta do servidor, o serviço ***nx_tcp_server_socket_relisten*** deve ser chamado nesta tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1046">If accepting another client connection on the same server port is desired, the ***nx_tcp_server_socket_relisten*** service should be called on this socket.</span></span>

<span data-ttu-id="daf05-1047">O seguinte segmento de código ilustra a sequência de chamadas que um servidor típico de TCP utiliza:</span><span class="sxs-lookup"><span data-stu-id="daf05-1047">The following code segment illustrates the sequence of calls a typical TCP server uses:</span></span>

```c
/* Set up a previously created TCP socket to listen on port 12 */

nx_tcp_server_socket_listen()

/* Loop to make a (another) connection. */
while(1) {

    /* Wait for a client socket connection request for 100 ticks. */
    nx_tcp_server_socket_accept();

    /* (Send and receive TCP messages with the TCP client) */

    /* Disconnect the server socket. */
    nx_tcp_socket_disconnect();

    /* Remove this server socket from listening on the port. */

    nx_tcp_server_socket_unaccept(&server_socket);

    /* Set up server socket to relisten on the same port for the next
    client. */
    nx_tcp_server_socket_relisten();
}
```

### <a name="mss-validation"></a><span data-ttu-id="daf05-1048">Validação mss</span><span class="sxs-lookup"><span data-stu-id="daf05-1048">MSS Validation</span></span>

<span data-ttu-id="daf05-1049">O Tamanho Máximo do Segmento (MSS) é a quantidade máxima de bytes que um hospedeiro TCP pode receber sem ser fragmentado pela camada IP subjacente.</span><span class="sxs-lookup"><span data-stu-id="daf05-1049">The Maximum Segment Size (MSS) is the maximum amount of bytes a TCP host can receive without being fragmented by the underlying IP layer.</span></span> <span data-ttu-id="daf05-1050">Durante a fase de estabelecimento de ligação TCP, ambas as extremidades trocam o seu próprio valor de MSS TCP, de modo que o remetente não envie um segmento de dados TCP maior do que o MSS do recetor.</span><span class="sxs-lookup"><span data-stu-id="daf05-1050">During TCP connection establishment phase, both ends exchanges its own TCP MSS value, so that the sender does not send a TCP data segment that is larger than the receiver's MSS.</span></span> <span data-ttu-id="daf05-1051">O módulo NetX TCP validará opcionalmente o valor mss anunciado do seu par antes de estabelecer uma ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1051">NetX TCP module will optionally validate its peer's advertised MSS value before establishing a connection.</span></span> <span data-ttu-id="daf05-1052">Por predefinição, o NetX não permite tal verificação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1052">By default NetX does not enable such a check.</span></span> <span data-ttu-id="daf05-1053">As candidaturas que desejem realizar a validação do MSS devem definir ***NX_ENABLE_TCP_MSS_CHECKING** _ na construção da biblioteca NetX, e o valor mínimo será definido em _*_NX_TCP_MSS_MINIMUM_\*_.</span><span class="sxs-lookup"><span data-stu-id="daf05-1053">Applications wishing to perform MSS validation shall define ***NX_ENABLE_TCP_MSS_CHECKING** _ when building the NetX library, and the minimum value shall be defined in _*_NX_TCP_MSS_MINIMUM_\*_.</span></span> <span data-ttu-id="daf05-1054">As ligações TCP recebidas com valores DESS abaixo _ *_NX_TCP_MSS_MINIMUM_*\* são largadas.</span><span class="sxs-lookup"><span data-stu-id="daf05-1054">Incoming TCP connections with MSS values below _ *_NX_TCP_MSS_MINIMUM_*\* are dropped.</span></span>

### <a name="stop-listening-on-a-server-port"></a><span data-ttu-id="daf05-1055">Pare de ouvir numa porta do servidor</span><span class="sxs-lookup"><span data-stu-id="daf05-1055">Stop Listening on a Server Port</span></span>

<span data-ttu-id="daf05-1056">Se a aplicação já não pretender ouvir os pedidos de ligação ao cliente numa porta de servidor que foi previamente especificada por uma chamada para o serviço ***nx_tcp_server_socket_listen** _ , a aplicação simplesmente liga para o serviço _ *_nx_tcp_server_socket_unlisten_** .</span><span class="sxs-lookup"><span data-stu-id="daf05-1056">If the application no longer wishes to listen for client connection requests on a server port that was previously specified by a call to the ***nx_tcp_server_socket_listen** _ service, the application simply calls the _ *_nx_tcp_server_socket_unlisten_** service.</span></span> <span data-ttu-id="daf05-1057">Este serviço coloca qualquer tomada à espera de uma ligação no estado FECHADO e liberta quaisquer pacotes de pedido de ligação ao cliente em fila.</span><span class="sxs-lookup"><span data-stu-id="daf05-1057">This service places any socket waiting for a connection back in the CLOSED state and releases any queued client connection request packets.</span></span>

### <a name="tcp-window-size"></a><span data-ttu-id="daf05-1058">Tamanho da janela TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1058">TCP Window Size</span></span>

<span data-ttu-id="daf05-1059">Durante as fases de configuração e transferência de dados da ligação, cada porta reporta a quantidade de dados que pode manusear, que é chamado de tamanho da janela.</span><span class="sxs-lookup"><span data-stu-id="daf05-1059">During both the setup and data transfer phases of the connection, each port reports the amount of data it can handle, which is called its window size.</span></span> <span data-ttu-id="daf05-1060">À medida que os dados são recebidos e processados, este tamanho da janela é ajustado dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="daf05-1060">As data are received and processed, this window size is adjusted dynamically.</span></span> <span data-ttu-id="daf05-1061">Em TCP, um remetente só pode enviar uma quantidade de dados que se encaixem na janela do recetor.</span><span class="sxs-lookup"><span data-stu-id="daf05-1061">In TCP, a sender can only send an amount of data that fits into the receiver's window.</span></span> <span data-ttu-id="daf05-1062">Na essência, o tamanho da janela fornece controlo de fluxo para transferência de dados em cada direção da ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1062">In essence, the window size provides flow control for data transfer in each direction of the connection.</span></span>

### <a name="tcp-packet-send"></a><span data-ttu-id="daf05-1063">Envio de pacote TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1063">TCP Packet Send</span></span>

<span data-ttu-id="daf05-1064">O envio de dados TCP é facilmente realizado através da chamada ***de nx_tcp_socket_send*** função.</span><span class="sxs-lookup"><span data-stu-id="daf05-1064">Sending TCP data is easily accomplished by calling the ***nx_tcp_socket_send*** function.</span></span> <span data-ttu-id="daf05-1065">Se o tamanho dos dados transmitidos for maior do que o valor MSS da tomada ou o atual par receber o tamanho da janela, o que for menor, a lógica interna da TCP esculpe os dados que se encaixam em min (MSS, peer receive Window) para transmissão.</span><span class="sxs-lookup"><span data-stu-id="daf05-1065">If the size of the data being transmitted is larger than the MSS value of the socket or the current peer receive window size, whichever is smaller, TCP internal logic carves off the data that fits into min (MSS, peer receive Window) for transmission.</span></span> <span data-ttu-id="daf05-1066">Este serviço constrói então um cabeçalho TCP em frente ao pacote (incluindo o cálculo da caixa de verificação).</span><span class="sxs-lookup"><span data-stu-id="daf05-1066">This service then builds a TCP header in front of the packet (including the checksum calculation).</span></span> <span data-ttu-id="daf05-1067">Se o tamanho da janela do recetor não for zero, o chamador enviará o máximo de dados possível para preencher o tamanho da janela do recetor.</span><span class="sxs-lookup"><span data-stu-id="daf05-1067">If the receiver's window size is not zero, the caller will send as much data as it can to fill up the receiver window size.</span></span> <span data-ttu-id="daf05-1068">Se a janela de receção se tornar zero, o chamador pode suspender e esperar que o tamanho da janela do recetor aumente o suficiente para que este pacote seja enviado.</span><span class="sxs-lookup"><span data-stu-id="daf05-1068">If the receive window becomes zero, the caller may suspend and wait for the receiver's window size to increase enough for this packet to be sent.</span></span> <span data-ttu-id="daf05-1069">A qualquer momento, vários fios podem suspender-se enquanto tentam enviar dados através da mesma tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1069">At any given time, multiple threads may suspend while trying to send data through the same socket.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-1070">*Os dados da TCP que residem na estrutura NX_PACKET devem residir num limite de palavras longas. Além disso, deve haver espaço suficiente entre o ponteiro pré-remend e o ponteiro de início de dados para colocar os cabeçalhos TCP, IP e meios de comunicação físicos.*</span><span class="sxs-lookup"><span data-stu-id="daf05-1070">*The TCP data residing in the NX_PACKET structure should reside on a long-word boundary. In addition, there needs to be sufficient space between the prepend pointer and the data start pointer to place the TCP, IP, and physical media headers.*</span></span>

### <a name="tcp-packet-retransmit"></a><span data-ttu-id="daf05-1071">Retransmissão de pacotes TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1071">TCP Packet Retransmit</span></span>

<span data-ttu-id="daf05-1072">Pacotes TCP previamente transmitidos enviados realmente armazenados internamente até que um ACK seja devolvido do outro lado da ligação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1072">Previously transmitted TCP packets sent actually stored internally until an ACK is returned from the other side of the connection.</span></span> <span data-ttu-id="daf05-1073">Se os dados transmitidos não forem reconhecidos dentro do período de tempo limite, o pacote armazenado é reencaminhado e o período de tempo seguinte é definido.</span><span class="sxs-lookup"><span data-stu-id="daf05-1073">If transmitted data is not acknowledged within the timeout period, the stored packet is re-sent and the next timeout period is set.</span></span> <span data-ttu-id="daf05-1074">Quando um ACK é recebido, todos os pacotes cobertos pelo número de reconhecimento na fila de transmissão interna são finalmente libertados.</span><span class="sxs-lookup"><span data-stu-id="daf05-1074">When an ACK is received, all packets covered by the acknowledgement number in the internal transmit queue are finally released.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="daf05-1075">\*A aplicação não reutilizar o pacote nem alterar o conteúdo do pacote após o \***nx_tcp_socket_send** _ função retorna com NX_SUCCESS.</span><span class="sxs-lookup"><span data-stu-id="daf05-1075">\*Application shall not reuse the packet or alter the contents of the packet after the \***nx_tcp_socket_send** _ function returns with NX_SUCCESS.</span></span> <span data-ttu-id="daf05-1076">O pacote transmitido é eventualmente libertado pelo processamento interno da NetX após os dados ser reconhecidos pelo outro end._</span><span class="sxs-lookup"><span data-stu-id="daf05-1076">The transmitted packet is eventually released by NetX internal processing after the data is acknowledged by the other end._</span></span>

### <a name="tcp-keepalive"></a><span data-ttu-id="daf05-1077">TCP Keepalive</span><span class="sxs-lookup"><span data-stu-id="daf05-1077">TCP Keepalive</span></span>

<span data-ttu-id="daf05-1078">A função TCP Keepalive permite que uma tomada detete se o seu par desliga ou não sem uma terminação adequada (por exemplo, o par se despenhou), ou para impedir que certas instalações de monitorização da rede cessem uma ligação por longos períodos de inatividade.</span><span class="sxs-lookup"><span data-stu-id="daf05-1078">TCP Keepalive feature allows a socket to detect whether or not its peer disconnects without proper termination (for example, the peer crashed), or to prevent certain network monitoring facilities to terminate a connection for long periods of idle.</span></span> <span data-ttu-id="daf05-1079">A TCP Keepalive funciona enviando periodicamente uma moldura TCP sem dados, e o número de sequência definido para um a menos do que o número atual da sequência.</span><span class="sxs-lookup"><span data-stu-id="daf05-1079">TCP Keepalive works by periodically sending a TCP frame with no data, and the sequence number set to one less than the current sequence number.</span></span> <span data-ttu-id="daf05-1080">Ao receber tal moldura de resalamento TCP, o destinatário, se ainda estiver vivo, responde com um ACK para o seu número de sequência atual.</span><span class="sxs-lookup"><span data-stu-id="daf05-1080">On receiving such TCP Keepalive frame, the recipient, if still alive, responses with an ACK for its current sequence number.</span></span> <span data-ttu-id="daf05-1081">Isto completa a transação de manter.</span><span class="sxs-lookup"><span data-stu-id="daf05-1081">This completes the keepalive transaction.</span></span>

<span data-ttu-id="daf05-1082">Por predefinição, a função keepalive não está ativada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1082">By default the keepalive feature is not enabled.</span></span> <span data-ttu-id="daf05-1083">Para utilizar esta função, a biblioteca NetX deve ser construída com \***NX_ENABLE_TCP_KEEPALIVE** _ definido.</span><span class="sxs-lookup"><span data-stu-id="daf05-1083">To use this feature, NetX library must be built with \***NX_ENABLE_TCP_KEEPALIVE** _ defined.</span></span> <span data-ttu-id="daf05-1084">O símbolo _ *_NX_TCP_KEEPALIVE_INITIAL_*\* especifica o número de segundos de inatividade antes do início da estrutura de manter.</span><span class="sxs-lookup"><span data-stu-id="daf05-1084">The symbol _ *_NX_TCP_KEEPALIVE_INITIAL_*\* specifies the number of seconds of inactivity before the keepalive frame is initiated.</span></span>

### <a name="tcp-packet-receive"></a><span data-ttu-id="daf05-1085">Receber pacote TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1085">TCP Packet Receive</span></span>

<span data-ttu-id="daf05-1086">O processamento de pacotes de receção de TCP (chamado a partir do fio do ajudante IP) é responsável pelo manuseamento de várias ações de ligação e desconexão, bem como pelo processamento de reconhecimento de transmissão.</span><span class="sxs-lookup"><span data-stu-id="daf05-1086">The TCP receive packet processing (called from the IP helper thread) is responsible for handling various connection and disconnection actions as well as transmit acknowledge processing.</span></span> <span data-ttu-id="daf05-1087">Além disso, o processamento de pacotes de receção de TCP é responsável pela colocação de pacotes com dados de receção da fila de receção da tomada TCP adequada ou entregando o pacote ao primeiro fio suspenso à espera de um pacote.</span><span class="sxs-lookup"><span data-stu-id="daf05-1087">In addition, the TCP receive packet processing is responsible for placing packets with receive data on the appropriate TCP socket's receive queue or delivering the packet to the first suspended thread waiting for a packet.</span></span>

### <a name="tcp-receive-notify"></a><span data-ttu-id="daf05-1088">Notificação de receção de TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1088">TCP Receive Notify</span></span>

<span data-ttu-id="daf05-1089">Se o fio de aplicação precisar de processar dados recebidos de mais de uma tomada, deve ser utilizada a função ***nx_tcp_socket_receive_notify.***</span><span class="sxs-lookup"><span data-stu-id="daf05-1089">If the application thread needs to process received data from more than one socket, the ***nx_tcp_socket_receive_notify*** function should be used.</span></span> <span data-ttu-id="daf05-1090">Esta função regista uma função de chamada de pacote de receção para a tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1090">This function registers a receive packet callback function for the socket.</span></span> <span data-ttu-id="daf05-1091">Sempre que um pacote é recebido na tomada, a função de retorno é executada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1091">Whenever a packet is received on the socket, the callback function is executed.</span></span>

<span data-ttu-id="daf05-1092">O conteúdo da função de retorno é específico da aplicação; no entanto, a função provavelmente conteria lógica para informar o fio de processamento de que um pacote está disponível na tomada correspondente.</span><span class="sxs-lookup"><span data-stu-id="daf05-1092">The contents of the callback function are application-specific; however, the function would most likely contain logic to inform the processing thread that a packet is available on the corresponding socket.</span></span>

### <a name="thread-suspension"></a><span data-ttu-id="daf05-1093">Suspensão do fio</span><span class="sxs-lookup"><span data-stu-id="daf05-1093">Thread Suspension</span></span>

<span data-ttu-id="daf05-1094">Como mencionado anteriormente, os fios de aplicação podem suspender enquanto tentam receber dados de uma determinada porta TCP.</span><span class="sxs-lookup"><span data-stu-id="daf05-1094">As mentioned previously, application threads can suspend while attempting to receive data from a particular TCP port.</span></span> <span data-ttu-id="daf05-1095">Depois de recebido um pacote naquela porta, é dado ao primeiro fio suspenso e esse fio é retomado.</span><span class="sxs-lookup"><span data-stu-id="daf05-1095">After a packet is received on that port, it is given to the first thread suspended and that thread is then resumed.</span></span> <span data-ttu-id="daf05-1096">Um tempo limite opcional está disponível ao suspender um pacote de receção TCP, uma funcionalidade disponível para a maioria dos serviços NetX.</span><span class="sxs-lookup"><span data-stu-id="daf05-1096">An optional timeout is available when suspending on a TCP receive packet, a feature available for most NetX services.</span></span>

<span data-ttu-id="daf05-1097">A suspensão thread também está disponível para serviços de ligação (cliente e servidor), ligação ao cliente e serviços de desconexão.</span><span class="sxs-lookup"><span data-stu-id="daf05-1097">Thread suspension is also available for connection (both client and server), client binding, and disconnection services.</span></span>

### <a name="tcp-socket-statistics-and-errors"></a><span data-ttu-id="daf05-1098">Estatísticas e erros da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1098">TCP Socket Statistics and Errors</span></span>

<span data-ttu-id="daf05-1099">Se ativado, o software de tomada NetX TCP regista várias estatísticas e erros que podem ser úteis à aplicação.</span><span class="sxs-lookup"><span data-stu-id="daf05-1099">If enabled, the NetX TCP socket software keeps track of several statistics and errors that may be useful to the application.</span></span> <span data-ttu-id="daf05-1100">São mantidas as seguintes estatísticas e relatórios de erro para cada instância IP/TCP:</span><span class="sxs-lookup"><span data-stu-id="daf05-1100">The following statistics and error reports are maintained for each IP/TCP instance:</span></span>

- <span data-ttu-id="daf05-1101">Total de pacotes TCP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-1101">Total TCP Packets Sent</span></span>
- <span data-ttu-id="daf05-1102">Total de bytes TCP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-1102">Total TCP Bytes Sent</span></span>
- <span data-ttu-id="daf05-1103">Total de pacotes TCP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-1103">Total TCP Packets Received</span></span>
- <span data-ttu-id="daf05-1104">Total de bytes TCP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-1104">Total TCP Bytes Received</span></span>
- <span data-ttu-id="daf05-1105">Total de pacotes inválidos TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1105">Total TCP Invalid Packets</span></span>
- <span data-ttu-id="daf05-1106">Total de pacotes de receção TCP caídos</span><span class="sxs-lookup"><span data-stu-id="daf05-1106">Total TCP Receive Packets Dropped</span></span>
- <span data-ttu-id="daf05-1107">Total de erros de receção de TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1107">Total TCP Receive Checksum Errors</span></span>
- <span data-ttu-id="daf05-1108">Total de ligações TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1108">Total TCP Connections</span></span>
- <span data-ttu-id="daf05-1109">Total de desconexões TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1109">Total TCP Disconnections</span></span>
- <span data-ttu-id="daf05-1110">Total de ligações TCP caídas</span><span class="sxs-lookup"><span data-stu-id="daf05-1110">Total TCP Connections Dropped</span></span>
- <span data-ttu-id="daf05-1111">Retransmissão total de pacotes TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1111">Total TCP Packet Retransmits</span></span>
- <span data-ttu-id="daf05-1112">Pacotes de tomada TCP enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-1112">TCP Socket Packets Sent</span></span>
- <span data-ttu-id="daf05-1113">TCP Socket Bytes Enviados</span><span class="sxs-lookup"><span data-stu-id="daf05-1113">TCP Socket Bytes Sent</span></span>
- <span data-ttu-id="daf05-1114">Pacotes de tomada TCP recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-1114">TCP Socket Packets Received</span></span>
- <span data-ttu-id="daf05-1115">TCP Socket Bytes Recebidos</span><span class="sxs-lookup"><span data-stu-id="daf05-1115">TCP Socket Bytes Received</span></span>
- <span data-ttu-id="daf05-1116">Retransmissão do pacote de tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1116">TCP Socket Packet Retransmits</span></span>
- <span data-ttu-id="daf05-1117">Pacotes de tomada TCP em fila</span><span class="sxs-lookup"><span data-stu-id="daf05-1117">TCP Socket Packets Queued</span></span>
- <span data-ttu-id="daf05-1118">Erros de verificação da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1118">TCP Socket Checksum Errors</span></span>
- <span data-ttu-id="daf05-1119">Estado da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1119">TCP Socket State</span></span>
- <span data-ttu-id="daf05-1120">Órbita de transmissão da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1120">TCP Socket Transmit Queue Depth</span></span>
- <span data-ttu-id="daf05-1121">Tamanho da janela de transmissão da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1121">TCP Socket Transmit Window Size</span></span>
- <span data-ttu-id="daf05-1122">Tomada TCP receber tamanho da janela</span><span class="sxs-lookup"><span data-stu-id="daf05-1122">TCP Socket Receive Window Size</span></span>

<span data-ttu-id="daf05-1123">Todas estas estatísticas e relatórios de erro estão disponíveis para a aplicação com o serviço ***nx_tcp_info_get** _ para o total das estatísticas TCP e o serviço _ *_nx_tcp_socket_info_get_** para as estatísticas de TCP por tomada.</span><span class="sxs-lookup"><span data-stu-id="daf05-1123">All these statistics and error reports are available to the application with the ***nx_tcp_info_get** _ service for total TCP statistics and the _ *_nx_tcp_socket_info_get_** service for TCP statistics per socket.</span></span>

## <a name="tcp-socket-control-block-nx_tcp_socket"></a><span data-ttu-id="daf05-1124">NX_TCP_SOCKET do bloco de controlo da tomada TCP</span><span class="sxs-lookup"><span data-stu-id="daf05-1124">TCP Socket Control Block NX_TCP_SOCKET</span></span>

<span data-ttu-id="daf05-1125">As características de cada tomada TCP encontram-se no bloco de controlo *NX_TCP_SOCKET* associado, que contém informações úteis, tais como a ligação à estrutura de dados IP, a interface de ligação à rede, a porta vinculada e a fila do pacote de receção.</span><span class="sxs-lookup"><span data-stu-id="daf05-1125">The characteristics of each TCP socket are found in the associated *NX_TCP_SOCKET* control block, which contains useful information such as the link to the IP data structure, the network connection interface, the bound port, and the receive packet queue.</span></span> <span data-ttu-id="daf05-1126">Esta estrutura é definida no ficheiro ***nx_api.h.***</span><span class="sxs-lookup"><span data-stu-id="daf05-1126">This structure is defined in the ***nx_api.h*** file.</span></span>
